<div id="Word">
<div class="head">
<h1>Theory Word</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Sebastian Skalberg, TU Muenchen
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Binary Words›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Word
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Auxilary Lemmas›</span></span>

<span class="keyword1" id="Word-max_le"><span class="command">lemma</span></span> max_le <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span><span class="main">;</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">|]</span> <span class="main">==&gt;</span> max <span class="free">x</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>

<span class="keyword1" id="Word-max_mono"><span class="command">lemma</span></span> max_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linorder"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mf<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"max <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span>max <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> mf <span class="keyword2"><span class="keyword">and</span></span> max.cobounded1 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> fx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span>max <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monoD<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> mf <span class="keyword2"><span class="keyword">and</span></span> max.cobounded2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> fy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span>max <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monoD<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> fx <span class="keyword2"><span class="keyword">and</span></span> fy
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"max <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span>max <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">declare</span></span> zero_le_power <span class="main">[</span><span class="operator">intro</span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> zero_less_power <span class="main">[</span><span class="operator">intro</span><span class="main">]</span>

<span class="keyword1" id="Word-int_nat_two_exp"><span class="command">lemma</span></span> int_nat_two_exp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="free">k</span> <span class="main">=</span> int <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bits›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> bit <span class="main">=</span>
    Zero <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">𝟬</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
  <span class="main">|</span> One <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">𝟭</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">bitval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bit <span class="main">=&gt;</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">bitval</span> <span class="main">𝟬</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bitval</span> <span class="main">𝟭</span> <span class="main">=</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">bitnot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bit <span class="main">=&gt;</span> bit"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword1">¬<span class="hidden">⇩</span><sub>b</sub></span> _"</span> <span class="main">[</span>40<span class="main">]</span> 40<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    bitnot_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1"><span class="free">¬<span class="hidden">⇩</span><sub>b</sub></span></span> <span class="main">𝟬</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
  <span class="main">|</span> bitnot_one <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1"><span class="free">¬<span class="hidden">⇩</span><sub>b</sub></span></span> <span class="main">𝟭</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">bitand</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bit <span class="main">=&gt;</span> bit <span class="main">=&gt;</span> bit"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∧<span class="hidden">⇩</span><sub>b</sub></span>"</span> 35<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    bitand_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">𝟬</span> <span class="keyword1"><span class="free">∧<span class="hidden">⇩</span><sub>b</sub></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span>
  <span class="main">|</span> bitand_one<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">𝟭</span> <span class="keyword1"><span class="free">∧<span class="hidden">⇩</span><sub>b</sub></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">bitor</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bit <span class="main">=&gt;</span> bit <span class="main">=&gt;</span> bit"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∨<span class="hidden">⇩</span><sub>b</sub></span>"</span> 30<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    bitor_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">𝟬</span> <span class="keyword1"><span class="free">∨<span class="hidden">⇩</span><sub>b</sub></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
  <span class="main">|</span> bitor_one<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">𝟭</span> <span class="keyword1"><span class="free">∨<span class="hidden">⇩</span><sub>b</sub></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">bitxor</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bit <span class="main">=&gt;</span> bit <span class="main">=&gt;</span> bit"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⊕<span class="hidden">⇩</span><sub>b</sub></span>"</span> 30<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    bitxor_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">𝟬</span> <span class="keyword1"><span class="free">⊕<span class="hidden">⇩</span><sub>b</sub></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
  <span class="main">|</span> bitxor_one<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">𝟭</span> <span class="keyword1"><span class="free">⊕<span class="hidden">⇩</span><sub>b</sub></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>bitnot <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Word-bitnot_bitnot"><span class="command">lemma</span></span> bitnot_bitnot <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bitnot <span class="main">(</span>bitnot <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Word-bitand_cancel"><span class="command">lemma</span></span> bitand_cancel <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="keyword1">∧<span class="hidden">⇩</span><sub>b</sub></span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Word-bitor_cancel"><span class="command">lemma</span></span> bitor_cancel <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="keyword1">∨<span class="hidden">⇩</span><sub>b</sub></span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Word-bitxor_cancel"><span class="command">lemma</span></span> bitxor_cancel <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="keyword1">⊕<span class="hidden">⇩</span><sub>b</sub></span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bit Vectors›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First, a couple of theorems expressing case analysis and
induction principles for bit vectors.›</span></span>

<span class="keyword1" id="Word-bit_list_cases"><span class="command">lemma</span></span> bit_list_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">==&gt;</span> <span class="free">P</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     zero<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">bs</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> <span class="main">𝟬</span> <span class="main">#</span> <span class="bound">bs</span> <span class="main">==&gt;</span> <span class="free">P</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     one<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">bs</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">#</span> <span class="bound">bs</span> <span class="main">==&gt;</span> <span class="free">P</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> empty<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">bs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">#</span> <span class="skolem">bs</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="main">𝟬</span> <span class="main">#</span> <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zero<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">#</span> <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> one<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-bit_list_induct"><span class="command">lemma</span></span> bit_list_induct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     zero<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">bs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">bs</span> <span class="main">==&gt;</span> <span class="free">P</span> <span class="main">(</span><span class="main">𝟬</span><span class="main">#</span><span class="bound">bs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     one<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">bs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">bs</span> <span class="main">==&gt;</span> <span class="free">P</span> <span class="main">(</span><span class="main">𝟭</span><span class="main">#</span><span class="bound">bs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">w</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> empty<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">bs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">bs</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">bs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> zero one<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">bv_msb</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bit list <span class="main">=&gt;</span> bit"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bv_msb</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="main">𝟬</span> <span class="keyword1">else</span> hd <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">bv_extend</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>nat<span class="main">,</span>bit<span class="main">,</span>bit list<span class="main">]</span><span class="main">=&gt;</span>bit list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bv_extend</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="main">(</span>replicate <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> length <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">bv_not</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bit list <span class="main">=&gt;</span> bit list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bv_not</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> map bitnot <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>

<span class="keyword1" id="Word-bv_length_extend"><span class="command">lemma</span></span> bv_length_extend <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">w</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">==&gt;</span> length <span class="main">(</span>bv_extend <span class="free">i</span> <span class="free">b</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_extend_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_not_Nil"><span class="command">lemma</span></span> bv_not_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_not <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_not_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_not_Cons"><span class="command">lemma</span></span> bv_not_Cons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_not <span class="main">(</span><span class="free">b</span><span class="main">#</span><span class="free">bs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>bitnot <span class="free">b</span><span class="main">)</span> <span class="main">#</span> bv_not <span class="free">bs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_not_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_not_bv_not"><span class="command">lemma</span></span> bv_not_bv_not <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_not <span class="main">(</span>bv_not <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_induct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Word-bv_msb_Nil"><span class="command">lemma</span></span> bv_msb_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_msb <span class="main">[]</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_msb_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_msb_Cons"><span class="command">lemma</span></span> bv_msb_Cons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_msb <span class="main">(</span><span class="free">b</span><span class="main">#</span><span class="free">bs</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_msb_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_msb_bv_not"><span class="command">lemma</span></span> bv_msb_bv_not <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="free">w</span> <span class="main">==&gt;</span> bv_msb <span class="main">(</span>bv_not <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>bitnot <span class="main">(</span>bv_msb <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Word-bv_msb_one_length"><span class="command">lemma</span></span> bv_msb_one_length <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_msb <span class="free">w</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">==&gt;</span> <span class="main">0</span> <span class="main">&lt;</span> length <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Word-length_bv_not"><span class="command">lemma</span></span> length_bv_not <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>bv_not <span class="free">w</span><span class="main">)</span> <span class="main">=</span> length <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">bv_to_nat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bit list <span class="main">=&gt;</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bv_to_nat</span> <span class="main">=</span> foldl <span class="main">(</span><span class="main">%</span><span class="bound">bn</span> <span class="bound">b</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">bn</span> <span class="main">+</span> bitval <span class="bound">b</span><span class="main">)</span> <span class="main">0</span>"</span></span>

<span class="keyword1" id="Word-bv_to_nat_Nil"><span class="command">lemma</span></span> bv_to_nat_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_to_nat_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_to_nat_helper"><span class="command">lemma</span></span> bv_to_nat_helper <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="main">(</span><span class="free">b</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="main">=</span> bitval <span class="free">b</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="free">bs</span> <span class="main">+</span> bv_to_nat <span class="free">bs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bv_to_nat'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"foldl <span class="main">(</span><span class="main">λ</span><span class="bound">bn</span> <span class="bound">b</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">bn</span> <span class="main">+</span> bitval <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> helper<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">base</span><span class="main">.</span> <span class="var">?bv_to_nat'</span> <span class="bound">base</span> <span class="free">bs</span> <span class="main">=</span> <span class="bound">base</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="free">bs</span> <span class="main">+</span> <span class="var">?bv_to_nat'</span> <span class="main">0</span> <span class="free">bs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">base</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> foldl_Cons<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Cons <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="numeral"><span class="numeral">2</span></span> <span class="main"><span class="main">*</span></span> <span class="skolem"><span class="skolem">base</span></span> <span class="main"><span class="main">+</span></span> bitval <span class="skolem"><span class="skolem">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Cons <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"bitval <span class="skolem"><span class="skolem">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mult_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_to_nat_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> helper<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-bv_to_nat0"><span class="command">lemma</span></span> bv_to_nat0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="main">(</span><span class="main">𝟬</span><span class="main">#</span><span class="free">bs</span><span class="main">)</span> <span class="main">=</span> bv_to_nat <span class="free">bs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Word-bv_to_nat1"><span class="command">lemma</span></span> bv_to_nat1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="main">(</span><span class="main">𝟭</span><span class="main">#</span><span class="free">bs</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="free">bs</span> <span class="main">+</span> bv_to_nat <span class="free">bs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Word-bv_to_nat_upper_range"><span class="command">lemma</span></span> bv_to_nat_upper_range<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="free">w</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">w</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">bs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="skolem">bs</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">bs</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bitval <span class="skolem">b</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">bs</span> <span class="main">+</span> bv_to_nat <span class="skolem">bs</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">bs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="skolem">bs</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="skolem">bs</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="skolem">bs</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">bs</span> <span class="main">+</span> bv_to_nat <span class="skolem">bs</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">bs</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="skolem">bs</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-bv_extend_longer"><span class="command">lemma</span></span> bv_extend_longer <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> length <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"bv_extend <span class="free">n</span> <span class="free">b</span> <span class="free">w</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_extend_def wn<span class="main">)</span>

<span class="keyword1" id="Word-bv_extend_shorter"><span class="command">lemma</span></span> bv_extend_shorter <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wn<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">w</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"bv_extend <span class="free">n</span> <span class="free">b</span> <span class="free">w</span> <span class="main">=</span> bv_extend <span class="free">n</span> <span class="free">b</span> <span class="main">(</span><span class="free">b</span><span class="main">#</span><span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> wn
  <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> Suc <span class="main">(</span>length <span class="free">w</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> length <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_extend <span class="free">n</span> <span class="free">b</span> <span class="free">w</span> <span class="main">=</span> replicate <span class="main">(</span><span class="free">n</span> <span class="main">-</span> length <span class="free">w</span><span class="main">)</span> <span class="free">b</span> <span class="main">@</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_extend_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> replicate <span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="main">(</span>length <span class="free">w</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">b</span> <span class="main">@</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> s<span class="main">)</span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>replicate <span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="main">(</span>length <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span> <span class="main">@</span> replicate <span class="main">1</span> <span class="free">b</span><span class="main">)</span> <span class="main">@</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> replicate_add<span class="main">)</span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> replicate <span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="main">(</span>length <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span> <span class="main">@</span> <span class="free">b</span> <span class="main">#</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bv_extend <span class="free">n</span> <span class="free">b</span> <span class="main">(</span><span class="free">b</span><span class="main">#</span><span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_extend_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bv_extend <span class="free">n</span> <span class="free">b</span> <span class="free">w</span> <span class="main">=</span> bv_extend <span class="free">n</span> <span class="free">b</span> <span class="main">(</span><span class="free">b</span><span class="main">#</span><span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">rem_initial</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bit <span class="main">=&gt;</span> bit list <span class="main">=&gt;</span> bit list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">rem_initial</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rem_initial</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">then</span> <span class="free">rem_initial</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Word-rem_initial_length"><span class="command">lemma</span></span> rem_initial_length<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>rem_initial <span class="free">b</span> <span class="free">w</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_induct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Word-rem_initial_equal"><span class="command">lemma</span></span> rem_initial_equal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>rem_initial <span class="free">b</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> length <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"rem_initial <span class="free">b</span> <span class="free">w</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>rem_initial <span class="free">b</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> length <span class="free">w</span> <span class="main">--&gt;</span> rem_initial <span class="free">b</span> <span class="free">w</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">w</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>rem_initial <span class="free">b</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">xs</span> <span class="main">--&gt;</span> rem_initial <span class="free">b</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">xs</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>rem_initial <span class="free">b</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> rem_initial_length <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rem_initial <span class="free">b</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="free">b</span><span class="main">#</span><span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> p <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-bv_extend_rem_initial"><span class="command">lemma</span></span> bv_extend_rem_initial<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_extend <span class="main">(</span>length <span class="free">w</span><span class="main">)</span> <span class="free">b</span> <span class="main">(</span>rem_initial <span class="free">b</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">w</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">assume</span></span> ind<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_extend <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="free">b</span> <span class="main">(</span>rem_initial <span class="free">b</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">xs</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> rem_initial_length <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> length <span class="main">(</span>rem_initial <span class="free">b</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">1</span> <span class="main">+</span> <span class="main">(</span>length <span class="skolem">xs</span> <span class="main">-</span> length <span class="main">(</span>rem_initial <span class="free">b</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_extend <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span> <span class="main">(</span>rem_initial <span class="free">b</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span>
      replicate <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> length <span class="main">(</span>rem_initial <span class="free">b</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span> <span class="main">@</span> <span class="main">(</span>rem_initial <span class="free">b</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_extend_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>
      replicate <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span>length <span class="skolem">xs</span> <span class="main">-</span> length <span class="main">(</span>rem_initial <span class="free">b</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span> <span class="main">@</span> rem_initial <span class="free">b</span> <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>
      <span class="main">(</span>replicate <span class="main">1</span> <span class="free">b</span> <span class="main">@</span> replicate <span class="main">(</span>length <span class="skolem">xs</span> <span class="main">-</span> length <span class="main">(</span>rem_initial <span class="free">b</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span><span class="main">)</span> <span class="main">@</span> rem_initial <span class="free">b</span> <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> replicate_add<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">b</span> <span class="main">#</span> bv_extend <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="free">b</span> <span class="main">(</span>rem_initial <span class="free">b</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_extend_def <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">b</span> <span class="main">#</span> <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ind<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bv_extend <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span> <span class="main">(</span>rem_initial <span class="free">b</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span> <span class="main">#</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-rem_initial_append1"><span class="command">lemma</span></span> rem_initial_append1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rem_initial <span class="free">b</span> <span class="free">xs</span> <span class="main">~=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"rem_initial <span class="free">b</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> rem_initial <span class="free">b</span> <span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Word-rem_initial_append2"><span class="command">lemma</span></span> rem_initial_append2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rem_initial <span class="free">b</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"rem_initial <span class="free">b</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> rem_initial <span class="free">b</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">norm_unsigned</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bit list <span class="main">=&gt;</span> bit list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">norm_unsigned</span> <span class="main">=</span> rem_initial <span class="main">𝟬</span>"</span></span>

<span class="keyword1" id="Word-norm_unsigned_Nil"><span class="command">lemma</span></span> norm_unsigned_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm_unsigned <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_unsigned_def<span class="main">)</span>

<span class="keyword1" id="Word-norm_unsigned_Cons0"><span class="command">lemma</span></span> norm_unsigned_Cons0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm_unsigned <span class="main">(</span><span class="main">𝟬</span><span class="main">#</span><span class="free">bs</span><span class="main">)</span> <span class="main">=</span> norm_unsigned <span class="free">bs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_unsigned_def<span class="main">)</span>

<span class="keyword1" id="Word-norm_unsigned_Cons1"><span class="command">lemma</span></span> norm_unsigned_Cons1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm_unsigned <span class="main">(</span><span class="main">𝟭</span><span class="main">#</span><span class="free">bs</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">#</span><span class="free">bs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_unsigned_def<span class="main">)</span>

<span class="keyword1" id="Word-norm_unsigned_idem"><span class="command">lemma</span></span> norm_unsigned_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm_unsigned <span class="main">(</span>norm_unsigned <span class="free">w</span><span class="main">)</span> <span class="main">=</span> norm_unsigned <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_induct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span>
  <span class="entity">nat_to_bv_helper</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">=&gt;</span> bit list <span class="main">=&gt;</span> bit list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nat_to_bv_helper</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span>
                               <span class="keyword1">else</span> <span class="free">nat_to_bv_helper</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">𝟬</span> <span class="keyword1">else</span> <span class="main">𝟭</span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">nat_to_bv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">=&gt;</span> bit list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nat_to_bv</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> nat_to_bv_helper <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">[]</span>"</span></span>

<span class="keyword1" id="Word-nat_to_bv0"><span class="command">lemma</span></span> nat_to_bv0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nat_to_bv <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_to_bv_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> <span class="main">=</span> nat_to_bv_helper.simps

<span class="keyword1" id="Word-n_div_2_cases"><span class="command">lemma</span></span> n_div_2_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">==&gt;</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     div <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>         <span class="quoted"><span class="quoted">"<span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">R</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zero<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">~=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">R</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> div<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-int_wf_ge_induct"><span class="command">lemma</span></span> int_wf_ge_induct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ind <span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">i</span><span class="main">::</span>int<span class="main">.</span> <span class="main">(</span><span class="main">!!</span><span class="bound">j</span><span class="main">.</span> <span class="main">[|</span> <span class="free">k</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">;</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="free">P</span> <span class="bound">j</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="free">P</span> <span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>          <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wf_induct_rule <span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_int_ge_less_than<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> ih<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">y</span><span class="main">::</span>int<span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> int_ge_less_than <span class="free">k</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ind<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_ge_less_than_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-unfold_nat_to_bv_helper"><span class="command">lemma</span></span> unfold_nat_to_bv_helper<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nat_to_bv_helper <span class="free">b</span> <span class="free">l</span> <span class="main">=</span> nat_to_bv_helper <span class="free">b</span> <span class="main">[]</span> <span class="main">@</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span><span class="main">.</span> nat_to_bv_helper <span class="free">b</span> <span class="bound">l</span> <span class="main">=</span> nat_to_bv_helper <span class="free">b</span> <span class="main">[]</span> <span class="main">@</span> <span class="bound">l</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="main">∀</span> <span class="bound">l</span><span class="main">.</span> nat_to_bv_helper <span class="bound">j</span> <span class="bound">l</span> <span class="main">=</span> nat_to_bv_helper <span class="bound">j</span> <span class="main">[]</span> <span class="main">@</span> <span class="bound">l</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span><span class="main">.</span> nat_to_bv_helper <span class="skolem">n</span> <span class="bound">l</span> <span class="main">=</span> nat_to_bv_helper <span class="skolem">n</span> <span class="main">[]</span> <span class="main">@</span> <span class="bound">l</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nat_to_bv_helper <span class="skolem">n</span> <span class="skolem">l</span> <span class="main">=</span> nat_to_bv_helper <span class="skolem">n</span> <span class="main">[]</span> <span class="main">@</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_to_bv_helper.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> n_div_2_cases <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> nat_to_bv_helper.simps <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> n2n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> n20<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
          <span class="keyword1"><span class="command">from</span></span> ind <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> n2n n20
          <span class="keyword1"><span class="command">have</span></span> ind'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span><span class="main">.</span> nat_to_bv_helper <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="bound">l</span> <span class="main">=</span> nat_to_bv_helper <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">[]</span> <span class="main">@</span> <span class="bound">l</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> nat_to_bv_helper.simps <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> if_False<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> spec <span class="main"><span class="main">[</span></span><span class="operator">OF</span> ind'<span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">𝟬</span></span><span class="main"><span class="main">#</span></span><span class="skolem"><span class="skolem">l</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> spec <span class="main"><span class="main">[</span></span><span class="operator">OF</span> ind'<span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">𝟭</span></span><span class="main"><span class="main">#</span></span><span class="skolem"><span class="skolem">l</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> spec <span class="main"><span class="main">[</span></span><span class="operator">OF</span> ind'<span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="main"><span class="main">𝟭</span></span><span class="main"><span class="main">]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> spec <span class="main"><span class="main">[</span></span><span class="operator">OF</span> ind'<span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="main"><span class="main">𝟬</span></span><span class="main"><span class="main">]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-nat_to_bv_non0"><span class="command">lemma</span></span> nat_to_bv_non0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">≠</span><span class="main">0</span> <span class="main">==&gt;</span> nat_to_bv <span class="free">n</span> <span class="main">=</span> nat_to_bv <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="keyword1">if</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">𝟬</span> <span class="keyword1">else</span> <span class="main">𝟭</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> nat_to_bv_def <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> nat_to_bv_helper.simps <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> unfold_nat_to_bv_helper<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> nat_to_bv_def <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span> <span class="keyword1"><span class="keyword1">div</span></span> <span class="numeral"><span class="numeral">2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-bv_to_nat_dist_append"><span class="command">lemma</span></span> bv_to_nat_dist_append<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bv_to_nat <span class="main">(</span><span class="free">l1</span> <span class="main">@</span> <span class="free">l2</span><span class="main">)</span> <span class="main">=</span> bv_to_nat <span class="free">l1</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="free">l2</span> <span class="main">+</span> bv_to_nat <span class="free">l2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l2</span><span class="main">.</span> bv_to_nat <span class="main">(</span><span class="free">l1</span> <span class="main">@</span> <span class="bound">l2</span><span class="main">)</span> <span class="main">=</span> bv_to_nat <span class="free">l1</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="bound">l2</span> <span class="main">+</span> bv_to_nat <span class="bound">l2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span>
    <span class="keyword3"><span class="command">assume</span></span> ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l2</span><span class="main">.</span> bv_to_nat <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="bound">l2</span><span class="main">)</span> <span class="main">=</span> bv_to_nat <span class="skolem">xs</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="bound">l2</span> <span class="main">+</span> bv_to_nat <span class="bound">l2</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l2</span><span class="main">::</span>bit list<span class="main">.</span> bitval <span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="skolem">xs</span> <span class="main">+</span> length <span class="bound">l2</span><span class="main">)</span> <span class="main">+</span> bv_to_nat <span class="skolem">xs</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="bound">l2</span> <span class="main">=</span> <span class="main">(</span>bitval <span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">xs</span> <span class="main">+</span> bv_to_nat <span class="skolem">xs</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="bound">l2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l2</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bitval <span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="skolem">xs</span> <span class="main">+</span> length <span class="skolem">l2</span><span class="main">)</span> <span class="main">+</span> bv_to_nat <span class="skolem">xs</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">l2</span> <span class="main">=</span> <span class="main">(</span>bitval <span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">xs</span> <span class="main">+</span> bv_to_nat <span class="skolem">xs</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">l2</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">^</span> <span class="main">(</span>length <span class="skolem">xs</span> <span class="main">+</span> length <span class="skolem">l2</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">xs</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">l2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="main"><span class="main">(</span></span><span class="quoted"><span class="quoted">"length <span class="skolem">xs</span>"</span></span><span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"bitval <span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="skolem">xs</span> <span class="main">+</span> length <span class="skolem">l2</span><span class="main">)</span> <span class="main">+</span> bv_to_nat <span class="skolem">xs</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">l2</span> <span class="main">=</span>
          bitval <span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">xs</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">l2</span> <span class="main">+</span> bv_to_nat <span class="skolem">xs</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">l2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>bitval <span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">xs</span> <span class="main">+</span> bv_to_nat <span class="skolem">xs</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">l2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_distribs<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-bv_nat_bv"><span class="command">lemma</span></span> bv_nat_bv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">assume</span></span> ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">⟹</span> bv_to_nat <span class="main">(</span>nat_to_bv <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="bound">j</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="main">(</span>nat_to_bv <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> n_div_2_cases <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> nn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> n0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> ind <span class="keyword2"><span class="keyword">and</span></span> nn
    <span class="keyword1"><span class="command">have</span></span> ind'<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> n0 <span class="keyword1"><span class="command">have</span></span> n0'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> nat_to_bv_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> nat_to_bv_helper.simps <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> n0' if_False<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> unfold_nat_to_bv_helper<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> bv_to_nat_dist_append<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> nat_to_bv_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ind' <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> div_mult_mod_eq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> div_mult_mod_eq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-bv_to_nat_type"><span class="command">lemma</span></span> bv_to_nat_type <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="main">(</span>norm_unsigned <span class="free">w</span><span class="main">)</span> <span class="main">=</span> bv_to_nat <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Word-length_norm_unsigned_le"><span class="command">lemma</span></span> length_norm_unsigned_le <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>norm_unsigned <span class="free">w</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Word-bv_to_nat_rew_msb"><span class="command">lemma</span></span> bv_to_nat_rew_msb<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_msb <span class="free">w</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">==&gt;</span> bv_to_nat <span class="free">w</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> bv_to_nat <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_cases <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Word-norm_unsigned_result"><span class="command">lemma</span></span> norm_unsigned_result<span class="main">:</span> <span class="quoted"><span class="quoted">"norm_unsigned <span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> bv_msb <span class="main">(</span>norm_unsigned <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> length_induct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bit list"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ys</span><span class="main">.</span> length <span class="bound">ys</span> <span class="main">&lt;</span> length <span class="skolem">xs</span> <span class="main">--&gt;</span> norm_unsigned <span class="bound">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> bv_msb <span class="main">(</span>norm_unsigned <span class="bound">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm_unsigned <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> bv_msb <span class="main">(</span>norm_unsigned <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_cases <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">xs</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">bs</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">𝟬</span><span class="main">#</span><span class="skolem">bs</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> ind
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">bs</span> <span class="main">&lt;</span> length <span class="skolem">xs</span> <span class="main">--&gt;</span> norm_unsigned <span class="skolem">bs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> bv_msb <span class="main">(</span>norm_unsigned <span class="skolem">bs</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"norm_unsigned <span class="skolem">bs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> bv_msb <span class="main">(</span>norm_unsigned <span class="skolem">bs</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-norm_empty_bv_to_nat_zero"><span class="command">lemma</span></span> norm_empty_bv_to_nat_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nw<span class="main">:</span> <span class="quoted"><span class="quoted">"norm_unsigned <span class="free">w</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"bv_to_nat <span class="free">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="free">w</span> <span class="main">=</span> bv_to_nat <span class="main">(</span>norm_unsigned <span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bv_to_nat <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nw<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-bv_to_nat_lower_limit"><span class="command">lemma</span></span> bv_to_nat_lower_limit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> w0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> bv_to_nat <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>norm_unsigned <span class="free">w</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> bv_to_nat <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> w0 <span class="keyword2"><span class="keyword">and</span></span> norm_unsigned_result <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> msbw<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_msb <span class="main">(</span>norm_unsigned <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_empty_bv_to_nat_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>norm_unsigned <span class="free">w</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> bv_to_nat <span class="main">(</span>norm_unsigned <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> bv_to_nat_rew_msb <span class="main"><span class="main">[</span></span><span class="operator">OF</span> msbw<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> <span class="main">=</span> nat_to_bv_non0

<span class="keyword1" id="Word-norm_unsigned_length"><span class="command">lemma</span></span> norm_unsigned_length <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>norm_unsigned <span class="free">w</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> norm_unsigned_def<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> rem_initial_length<span class="main">)</span>

<span class="keyword1" id="Word-norm_unsigned_equal"><span class="command">lemma</span></span> norm_unsigned_equal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="main">(</span>norm_unsigned <span class="free">w</span><span class="main">)</span> <span class="main">=</span> length <span class="free">w</span> <span class="main">==&gt;</span> norm_unsigned <span class="free">w</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_unsigned_def<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> rem_initial_equal<span class="main">)</span>

<span class="keyword1" id="Word-bv_extend_norm_unsigned"><span class="command">lemma</span></span> bv_extend_norm_unsigned<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_extend <span class="main">(</span>length <span class="free">w</span><span class="main">)</span> <span class="main">𝟬</span> <span class="main">(</span>norm_unsigned <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_unsigned_def<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> bv_extend_rem_initial<span class="main">)</span>

<span class="keyword1" id="Word-norm_unsigned_append1"><span class="command">lemma</span></span> norm_unsigned_append1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"norm_unsigned <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">==&gt;</span> norm_unsigned <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> norm_unsigned <span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_unsigned_def<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> rem_initial_append1<span class="main">)</span>

<span class="keyword1" id="Word-norm_unsigned_append2"><span class="command">lemma</span></span> norm_unsigned_append2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"norm_unsigned <span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">==&gt;</span> norm_unsigned <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> norm_unsigned <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_unsigned_def<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> rem_initial_append2<span class="main">)</span>

<span class="keyword1" id="Word-bv_to_nat_zero_imp_empty"><span class="command">lemma</span></span> bv_to_nat_zero_imp_empty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bv_to_nat <span class="free">w</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> norm_unsigned <span class="free">w</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> bit_list_induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Word-bv_to_nat_nzero_imp_nempty"><span class="command">lemma</span></span> bv_to_nat_nzero_imp_nempty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bv_to_nat <span class="free">w</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> norm_unsigned <span class="free">w</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> bit_list_induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Word-nat_helper1"><span class="command">lemma</span></span> nat_helper1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"nat_to_bv <span class="main">(</span>bv_to_nat <span class="free">w</span><span class="main">)</span> <span class="main">=</span> norm_unsigned <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>        <span class="quoted"><span class="quoted">"nat_to_bv <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> bv_to_nat <span class="free">w</span> <span class="main">+</span> bitval <span class="free">x</span><span class="main">)</span> <span class="main">=</span> norm_unsigned <span class="main">(</span><span class="free">w</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_to_bv <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> bv_to_nat <span class="free">w</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">𝟭</span><span class="main">]</span> <span class="main">=</span>
      nat_to_bv <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> bv_to_nat <span class="free">w</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">𝟭</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> nat_to_bv <span class="main">(</span>bv_to_nat <span class="free">w</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">𝟭</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> div_add1_eq<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> norm_unsigned <span class="free">w</span> <span class="main">@</span> <span class="main">[</span><span class="main">𝟭</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ass<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> norm_unsigned <span class="main">(</span><span class="free">w</span> <span class="main">@</span> <span class="main">[</span><span class="main">𝟭</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"norm_unsigned <span class="free">w</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_to_bv <span class="main">(</span>Suc <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> bv_to_nat <span class="free">w</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">𝟭</span><span class="main">]</span> <span class="main">=</span> norm_unsigned <span class="main">(</span><span class="free">w</span> <span class="main">@</span> <span class="main">[</span><span class="main">𝟭</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_to_bv_non0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="free">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="free">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_to_nat_zero_imp_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="free">w</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> nat_to_bv_non0<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> ass<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"norm_unsigned <span class="free">w</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_empty_bv_to_nat_zero<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-nat_helper2"><span class="command">lemma</span></span> nat_helper2<span class="main">:</span> <span class="quoted"><span class="quoted">"nat_to_bv <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> length <span class="free">xs</span> <span class="main">+</span> bv_to_nat <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">#</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span><span class="main">.</span> nat_to_bv <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> length <span class="main">(</span>rev <span class="bound">xs</span><span class="main">)</span> <span class="main">+</span> bv_to_nat <span class="main">(</span>rev <span class="bound">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">#</span> <span class="main">(</span>rev <span class="bound">xs</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">xs</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> length_induct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">xs</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bit list"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ys</span><span class="main">.</span> length <span class="bound">ys</span> <span class="main">&lt;</span> length <span class="skolem">xs</span> <span class="main">--&gt;</span> <span class="var">?P</span> <span class="bound">ys</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_to_bv_non0<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="skolem">ys</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> bv_to_nat_dist_append<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_to_bv <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">ys</span> <span class="main">+</span> <span class="main">(</span>bv_to_nat <span class="main">(</span>rev <span class="skolem">ys</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">+</span> bitval <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            nat_to_bv <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">ys</span> <span class="main">+</span> bv_to_nat <span class="main">(</span>rev <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> bitval <span class="skolem">y</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> nat_to_bv <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>bv_to_nat <span class="main">(</span><span class="main">𝟭</span><span class="main">#</span>rev <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> bitval <span class="skolem">y</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> norm_unsigned <span class="main">(</span><span class="main">𝟭</span><span class="main">#</span>rev <span class="skolem">ys</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">from</span></span> ind
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_to_bv <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> length <span class="main">(</span>rev <span class="skolem">ys</span><span class="main">)</span> <span class="main">+</span> bv_to_nat <span class="main">(</span>rev <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">#</span> rev <span class="skolem">ys</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nat_to_bv <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">ys</span> <span class="main">+</span> bv_to_nat <span class="main">(</span>rev <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">#</span> rev <span class="skolem">ys</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> nat_helper1<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">𝟭</span><span class="main">#</span>rev <span class="skolem">ys</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">#</span> rev <span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nat_to_bv <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">ys</span> <span class="main">+</span> <span class="main">(</span>bv_to_nat <span class="main">(</span>rev <span class="skolem">ys</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">+</span> bitval <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">𝟭</span> <span class="main">#</span> rev <span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nat_to_bv <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> length <span class="main">(</span>rev <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> bv_to_nat <span class="main">(</span>rev <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">𝟭</span> <span class="main">#</span> rev <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-nat_bv_nat"><span class="command">lemma</span></span> nat_bv_nat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nat_to_bv <span class="main">(</span>bv_to_nat <span class="free">w</span><span class="main">)</span> <span class="main">=</span> norm_unsigned <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_induct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"nat_to_bv <span class="main">(</span>bv_to_nat <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> norm_unsigned <span class="skolem">xs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="skolem">xs</span> <span class="main">=</span> bv_to_nat <span class="main">(</span>norm_unsigned <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="skolem">xs</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bv_to_nat_upper_range<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nat_to_bv <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">xs</span> <span class="main">+</span> bv_to_nat <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">#</span> <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nat_helper2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-bv_to_nat_qinj"><span class="command">lemma</span></span> bv_to_nat_qinj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> one<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="free">xs</span> <span class="main">=</span> bv_to_nat <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>        <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> one
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_to_bv <span class="main">(</span>bv_to_nat <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> nat_to_bv <span class="main">(</span>bv_to_nat <span class="free">ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> xsys<span class="main">:</span> <span class="quoted"><span class="quoted">"norm_unsigned <span class="free">xs</span> <span class="main">=</span> norm_unsigned <span class="free">ys</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> bv_extend <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">𝟬</span> <span class="main">(</span>norm_unsigned <span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_extend_norm_unsigned<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bv_extend <span class="main">(</span>length <span class="free">ys</span><span class="main">)</span> <span class="main">𝟬</span> <span class="main">(</span>norm_unsigned <span class="free">ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xsys len<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">ys</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_extend_norm_unsigned<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-norm_unsigned_nat_to_bv"><span class="command">lemma</span></span> norm_unsigned_nat_to_bv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"norm_unsigned <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span> <span class="main">=</span> nat_to_bv <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm_unsigned <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span> <span class="main">=</span> nat_to_bv <span class="main">(</span>bv_to_nat <span class="main">(</span>norm_unsigned <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nat_bv_nat<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> nat_to_bv <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-length_nat_to_bv_upper_limit"><span class="command">lemma</span></span> length_nat_to_bv_upper_limit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"length <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_to_bv_def nat_to_bv_helper.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> n0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span> length <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> length <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> length <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">^</span> <span class="free">k</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>norm_unsigned <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> bv_to_nat <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bv_to_nat_lower_limit<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n0<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> n0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">with</span></span> nk <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-length_nat_to_bv_lower_limit"><span class="command">lemma</span></span> length_nat_to_bv_lower_limit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> length <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span> <span class="free">k</span> <span class="main">&lt;</span> length <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> lnk<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> bv_to_nat <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bv_to_nat_upper_range<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> lnk <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> nk <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Unsigned Arithmetic Operations›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">bv_add</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>bit list<span class="main">,</span> bit list <span class="main">]</span> <span class="main">=&gt;</span> bit list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bv_add</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> nat_to_bv <span class="main">(</span>bv_to_nat <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">+</span> bv_to_nat <span class="free"><span class="bound"><span class="entity">w2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Word-bv_add_type1"><span class="command">lemma</span></span> bv_add_type1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_add <span class="main">(</span>norm_unsigned <span class="free">w1</span><span class="main">)</span> <span class="free">w2</span> <span class="main">=</span> bv_add <span class="free">w1</span> <span class="free">w2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_add_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_add_type2"><span class="command">lemma</span></span> bv_add_type2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_add <span class="free">w1</span> <span class="main">(</span>norm_unsigned <span class="free">w2</span><span class="main">)</span> <span class="main">=</span> bv_add <span class="free">w1</span> <span class="free">w2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_add_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_add_returntype"><span class="command">lemma</span></span> bv_add_returntype <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm_unsigned <span class="main">(</span>bv_add <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span> <span class="main">=</span> bv_add <span class="free">w1</span> <span class="free">w2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_add_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_add_length"><span class="command">lemma</span></span> bv_add_length<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>bv_add <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">(</span>max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> bv_add_def<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> length_nat_to_bv_upper_limit<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> bv_to_nat_upper_range <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w1</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> bv_to_nat_upper_range <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w2</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="free">w1</span> <span class="main">+</span> bv_to_nat <span class="free">w2</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span>
      max <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> max <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> add_mono<span class="main"><span class="keyword3">,</span></span><span class="operator">safe</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> max.cobounded1 max.cobounded2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> max <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="main">(</span>max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="free">w1</span> <span class="main">≤</span> length <span class="free">w2</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> w1w2<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">w1</span> <span class="main">≤</span> length <span class="free">w2</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">^</span> length <span class="free">w1</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="free">w2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">^</span> length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">with</span></span> w1w2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_mult_distrib2 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> split_max<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">≤</span> length <span class="free">w2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">^</span> length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">^</span> length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">^</span> length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> add_right_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">^</span> length <span class="free">w1</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="free">w2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="free">w1</span> <span class="main">≤</span> length <span class="free">w2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_mult_distrib2 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> split_max<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="free">w1</span> <span class="main">+</span> bv_to_nat <span class="free">w2</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="main">(</span>max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">bv_mult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>bit list<span class="main">,</span> bit list <span class="main">]</span> <span class="main">=&gt;</span> bit list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bv_mult</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> nat_to_bv <span class="main">(</span>bv_to_nat <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">*</span> bv_to_nat <span class="free"><span class="bound"><span class="entity">w2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Word-bv_mult_type1"><span class="command">lemma</span></span> bv_mult_type1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_mult <span class="main">(</span>norm_unsigned <span class="free">w1</span><span class="main">)</span> <span class="free">w2</span> <span class="main">=</span> bv_mult <span class="free">w1</span> <span class="free">w2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_mult_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_mult_type2"><span class="command">lemma</span></span> bv_mult_type2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_mult <span class="free">w1</span> <span class="main">(</span>norm_unsigned <span class="free">w2</span><span class="main">)</span> <span class="main">=</span> bv_mult <span class="free">w1</span> <span class="free">w2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_mult_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_mult_returntype"><span class="command">lemma</span></span> bv_mult_returntype <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm_unsigned <span class="main">(</span>bv_mult <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span> <span class="main">=</span> bv_mult <span class="free">w1</span> <span class="free">w2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_mult_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_mult_length"><span class="command">lemma</span></span> bv_mult_length<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>bv_mult <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">w1</span> <span class="main">+</span> length <span class="free">w2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> bv_mult_def<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> length_nat_to_bv_upper_limit<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> bv_to_nat_upper_range <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w1</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> bv_to_nat_upper_range <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w2</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="free">w1</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∧</span> bv_to_nat <span class="free">w2</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="free">w1</span> <span class="main">*</span> bv_to_nat <span class="free">w2</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> h<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_mono<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="free">w1</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="free">w2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_strict_mono<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">+</span> length <span class="free">w2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="free">w1</span> <span class="main">*</span> bv_to_nat <span class="free">w2</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">+</span> length <span class="free">w2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Signed Vectors›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">norm_signed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bit list <span class="main">=&gt;</span> bit list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    norm_signed_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">norm_signed</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="main">|</span> norm_signed_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">norm_signed</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">of</span>
        <span class="main">𝟬</span> <span class="main">=&gt;</span> <span class="keyword1">if</span> norm_unsigned <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">#</span>norm_unsigned <span class="free"><span class="bound"><span class="entity">bs</span></span></span>
      <span class="main">|</span> <span class="main">𝟭</span> <span class="main">=&gt;</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">#</span>rem_initial <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Word-norm_signed0"><span class="command">lemma</span></span> norm_signed0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm_signed <span class="main">[</span><span class="main">𝟬</span><span class="main">]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Word-norm_signed1"><span class="command">lemma</span></span> norm_signed1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm_signed <span class="main">[</span><span class="main">𝟭</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">𝟭</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Word-norm_signed01"><span class="command">lemma</span></span> norm_signed01 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm_signed <span class="main">(</span><span class="main">𝟬</span><span class="main">#</span><span class="main">𝟭</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟬</span><span class="main">#</span><span class="main">𝟭</span><span class="main">#</span><span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Word-norm_signed00"><span class="command">lemma</span></span> norm_signed00 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm_signed <span class="main">(</span><span class="main">𝟬</span><span class="main">#</span><span class="main">𝟬</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> norm_signed <span class="main">(</span><span class="main">𝟬</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Word-norm_signed10"><span class="command">lemma</span></span> norm_signed10 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm_signed <span class="main">(</span><span class="main">𝟭</span><span class="main">#</span><span class="main">𝟬</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">#</span><span class="main">𝟬</span><span class="main">#</span><span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Word-norm_signed11"><span class="command">lemma</span></span> norm_signed11 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm_signed <span class="main">(</span><span class="main">𝟭</span><span class="main">#</span><span class="main">𝟭</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> norm_signed <span class="main">(</span><span class="main">𝟭</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> <span class="main">=</span> norm_signed_Cons

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">int_to_bv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">=&gt;</span> bit list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">int_to_bv</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">0</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>
                 <span class="keyword1">then</span> norm_signed <span class="main">(</span><span class="main">𝟬</span><span class="main">#</span>nat_to_bv <span class="main">(</span>nat <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>
                 <span class="keyword1">else</span> norm_signed <span class="main">(</span>bv_not <span class="main">(</span><span class="main">𝟬</span><span class="main">#</span>nat_to_bv <span class="main">(</span>nat <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Word-int_to_bv_ge0"><span class="command">lemma</span></span> int_to_bv_ge0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">==&gt;</span> int_to_bv <span class="free">n</span> <span class="main">=</span> norm_signed <span class="main">(</span><span class="main">𝟬</span> <span class="main">#</span> nat_to_bv <span class="main">(</span>nat <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_to_bv_def<span class="main">)</span>

<span class="keyword1" id="Word-int_to_bv_lt0"><span class="command">lemma</span></span> int_to_bv_lt0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">==&gt;</span> int_to_bv <span class="free">n</span> <span class="main">=</span> norm_signed <span class="main">(</span>bv_not <span class="main">(</span><span class="main">𝟬</span><span class="main">#</span>nat_to_bv <span class="main">(</span>nat <span class="main">(</span><span class="main">-</span><span class="free">n</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_to_bv_def<span class="main">)</span>

<span class="keyword1" id="Word-norm_signed_idem"><span class="command">lemma</span></span> norm_signed_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm_signed <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span> <span class="main">=</span> norm_signed <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_induct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"norm_signed <span class="main">(</span>norm_signed <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> norm_signed <span class="skolem">xs</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm_signed <span class="main">(</span>norm_signed <span class="main">(</span><span class="main">𝟬</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> norm_signed <span class="main">(</span><span class="main">𝟬</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_cases <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">xs</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ys</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">𝟬</span><span class="main">#</span><span class="skolem">ys</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> eq
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm_signed <span class="main">(</span>norm_signed <span class="main">(</span><span class="main">𝟬</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> norm_signed <span class="main">(</span><span class="main">𝟬</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"norm_signed <span class="main">(</span>norm_signed <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> norm_signed <span class="skolem">xs</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm_signed <span class="main">(</span>norm_signed <span class="main">(</span><span class="main">𝟭</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> norm_signed <span class="main">(</span><span class="main">𝟭</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_cases <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">xs</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ys</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">#</span><span class="skolem">ys</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> eq
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm_signed <span class="main">(</span>norm_signed <span class="main">(</span><span class="main">𝟭</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> norm_signed <span class="main">(</span><span class="main">𝟭</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">bv_to_int</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bit list <span class="main">=&gt;</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bv_to_int</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">case</span> bv_msb <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1">of</span> <span class="main">𝟬</span> <span class="main">=&gt;</span> int <span class="main">(</span>bv_to_nat <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span>
    <span class="main">|</span> <span class="main">𝟭</span> <span class="main">=&gt;</span> <span class="main">-</span> int <span class="main">(</span>bv_to_nat <span class="main">(</span>bv_not <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Word-bv_to_int_Nil"><span class="command">lemma</span></span> bv_to_int_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_to_int_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_to_int_Cons0"><span class="command">lemma</span></span> bv_to_int_Cons0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span><span class="main">𝟬</span><span class="main">#</span><span class="free">bs</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span>bv_to_nat <span class="free">bs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_to_int_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_to_int_Cons1"><span class="command">lemma</span></span> bv_to_int_Cons1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span><span class="main">𝟭</span><span class="main">#</span><span class="free">bs</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> int <span class="main">(</span>bv_to_nat <span class="main">(</span>bv_not <span class="free">bs</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_to_int_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_to_int_type"><span class="command">lemma</span></span> bv_to_int_type <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span> <span class="main">=</span> bv_to_int <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_induct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">assume</span></span> ind<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span>norm_signed <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> bv_to_int <span class="skolem">xs</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span>norm_signed <span class="main">(</span><span class="main">𝟬</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span>bv_to_nat <span class="skolem">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_cases <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">xs</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ys</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">𝟬</span><span class="main">#</span><span class="skolem">ys</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> ind
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span>norm_signed <span class="main">(</span><span class="main">𝟬</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span>bv_to_nat <span class="skolem">ys</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">assume</span></span> ind<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span>norm_signed <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> bv_to_int <span class="skolem">xs</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span>norm_signed <span class="main">(</span><span class="main">𝟭</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">-</span> int <span class="main">(</span>bv_to_nat <span class="main">(</span>bv_not <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_cases <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">xs</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ys</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">#</span><span class="skolem">ys</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> ind
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span>norm_signed <span class="main">(</span><span class="main">𝟭</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">-</span> int <span class="main">(</span>bv_to_nat <span class="main">(</span>bv_not <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-bv_to_int_upper_range"><span class="command">lemma</span></span> bv_to_int_upper_range<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_cases <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_to_nat_upper_range<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">bs</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">-</span> int <span class="main">(</span>bv_to_nat <span class="main">(</span>bv_not <span class="skolem">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">bs</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">-</span> int <span class="main">(</span>bv_to_nat <span class="main">(</span>bv_not <span class="skolem">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-bv_to_int_lower_range"><span class="command">lemma</span></span> bv_to_int_lower_range<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> bv_to_int <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_cases <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">bs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bit list"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">bs</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">bs</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> int <span class="main">(</span>bv_to_nat <span class="skolem">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">bs</span><span class="main">)</span> <span class="main">≤</span> int <span class="main">(</span>bv_to_nat <span class="skolem">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">bs</span>
  <span class="keyword1"><span class="command">from</span></span> bv_to_nat_upper_range <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"bv_not <span class="skolem">bs</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> length <span class="skolem">bs</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span> <span class="main">-</span> int <span class="main">(</span>bv_to_nat <span class="main">(</span>bv_not <span class="skolem">bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> of_nat_power add.commute not_less of_nat_numeral zle_add1_eq_le of_nat_le_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-int_bv_int"><span class="command">lemma</span></span> int_bv_int <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"int_to_bv <span class="main">(</span>bv_to_int <span class="free">w</span><span class="main">)</span> <span class="main">=</span> norm_signed <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_cases <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="main">𝟬</span><span class="main">#</span><span class="skolem">xs</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> norm_signed_Cons <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">𝟬</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">xs</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">using</span></span> norm_unsigned_result <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_cases <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"norm_unsigned <span class="skolem"><span class="skolem">xs</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">#</span><span class="skolem">xs</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> int_to_bv_lt0<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_induct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">xs</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> int_to_bv_lt0<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">linarith</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> add.commute bitnot_zero bv_not_Cons bv_not_bv_not int_nat_two_exp length_bv_not nat_helper2 nat_int norm_signed10 of_nat_add<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-bv_int_bv"><span class="command">lemma</span></span> bv_int_bv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">i</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Word-bv_msb_norm"><span class="command">lemma</span></span> bv_msb_norm <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_msb <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span> <span class="main">=</span> bv_msb <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_cases <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_signed_Cons<span class="main">)</span>

<span class="keyword1" id="Word-norm_signed_length"><span class="command">lemma</span></span> norm_signed_length<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">w</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> norm_signed_Cons<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rem_initial_length<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Word-norm_signed_equal"><span class="command">lemma</span></span> norm_signed_equal<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span> <span class="main">=</span> length <span class="free">w</span> <span class="main">==&gt;</span> norm_signed <span class="free">w</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_cases <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>norm_signed <span class="main">(</span><span class="main">𝟬</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"norm_signed <span class="main">(</span><span class="main">𝟬</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟬</span><span class="main">#</span><span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_signed_Cons norm_unsigned_equal <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> eqTrueI<span class="main"><span class="main">]</span></span>
             <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>norm_signed <span class="main">(</span><span class="main">𝟭</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"norm_signed <span class="main">(</span><span class="main">𝟭</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">#</span><span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_signed_Cons<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rem_initial_equal<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-bv_extend_norm_signed"><span class="command">lemma</span></span> bv_extend_norm_signed<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_msb <span class="free">w</span> <span class="main">=</span> <span class="free">b</span> <span class="main">==&gt;</span> bv_extend <span class="main">(</span>length <span class="free">w</span><span class="main">)</span> <span class="free">b</span> <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_cases <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bv_extend <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">𝟬</span> <span class="main">(</span>norm_signed <span class="main">(</span><span class="main">𝟬</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟬</span><span class="main">#</span><span class="skolem">xs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_signed_def<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"norm_unsigned <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> xx<span class="main">:</span> <span class="quoted"><span class="quoted">"rem_initial <span class="main">𝟬</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_unsigned_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_extend <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">𝟬</span> <span class="main">(</span><span class="main">𝟬</span><span class="main">#</span>rem_initial <span class="main">𝟬</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟬</span><span class="main">#</span><span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_extend_def replicate_app_Cons_same<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> bv_extend_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bv_extend_rem_initial<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"bv_extend <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">𝟬</span> <span class="main">[</span><span class="main">𝟬</span><span class="main">]</span> <span class="main">=</span> <span class="main">𝟬</span><span class="main">#</span><span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xx<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bv_extend <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">𝟬</span> <span class="main">(</span><span class="main">𝟬</span><span class="main">#</span>norm_unsigned <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟬</span><span class="main">#</span><span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_unsigned_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_extend_def replicate_app_Cons_same<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> bv_extend_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bv_extend_rem_initial<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bv_extend <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">𝟭</span> <span class="main">(</span>norm_signed <span class="main">(</span><span class="main">𝟭</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">#</span><span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_signed_Cons<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_extend_def replicate_app_Cons_same<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> bv_extend_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bv_extend_rem_initial<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-bv_to_int_qinj"><span class="command">lemma</span></span> bv_to_int_qinj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> one<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">xs</span> <span class="main">=</span> bv_to_int <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>        <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> one
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int_to_bv <span class="main">(</span>bv_to_int <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> int_to_bv <span class="main">(</span>bv_to_int <span class="free">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> xsys<span class="main">:</span> <span class="quoted"><span class="quoted">"norm_signed <span class="free">xs</span> <span class="main">=</span> norm_signed <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> xsys'<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_msb <span class="free">xs</span> <span class="main">=</span> bv_msb <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_msb <span class="free">xs</span> <span class="main">=</span> bv_msb <span class="main">(</span>norm_signed <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bv_msb <span class="main">(</span>norm_signed <span class="free">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xsys<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bv_msb <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> bv_extend <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>bv_msb <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>norm_signed <span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_extend_norm_signed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bv_extend <span class="main">(</span>length <span class="free">ys</span><span class="main">)</span> <span class="main">(</span>bv_msb <span class="free">ys</span><span class="main">)</span> <span class="main">(</span>norm_signed <span class="free">ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xsys xsys' len<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">ys</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_extend_norm_signed<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-int_to_bv_returntype"><span class="command">lemma</span></span> int_to_bv_returntype <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm_signed <span class="main">(</span>int_to_bv <span class="free">w</span><span class="main">)</span> <span class="main">=</span> int_to_bv <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_to_bv_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_to_int_msb0"><span class="command">lemma</span></span> bv_to_int_msb0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> bv_to_int <span class="free">w1</span> <span class="main">==&gt;</span> bv_msb <span class="free">w1</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_cases<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Word-bv_to_int_msb1"><span class="command">lemma</span></span> bv_to_int_msb1<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w1</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">==&gt;</span> bv_msb <span class="free">w1</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_cases<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Word-bv_to_int_lower_limit_gt0"><span class="command">lemma</span></span> bv_to_int_lower_limit_gt0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> w0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> bv_to_int <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> bv_to_int <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> w0
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> bv_to_int <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_msb <span class="free">w</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bv_to_int_msb0<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> bv_to_int <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_cases <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> w0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w'</span>
    <span class="keyword3"><span class="command">assume</span></span> weq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="main">𝟬</span> <span class="main">#</span> <span class="skolem">w'</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_signed_Cons<span class="main"><span class="keyword3">,</span></span><span class="operator">safe</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"norm_unsigned <span class="skolem">w'</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> weq <span class="keyword2"><span class="keyword">and</span></span> w0 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_empty_bv_to_nat_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> w'0<span class="main">:</span> <span class="quoted"><span class="quoted">"norm_unsigned <span class="skolem">w'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> bv_to_nat <span class="skolem">w'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span> <span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> bv_to_nat <span class="skolem">w'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="skolem">w'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"norm_unsigned <span class="skolem">w'</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_to_nat_zero_imp_empty<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> w'0
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> bv_to_nat_lower_limit <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">w'</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>norm_unsigned <span class="skolem">w'</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> bv_to_nat <span class="skolem">w'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> One_nat_def int_nat_two_exp <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w'</span>
    <span class="keyword3"><span class="command">assume</span></span> weq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">#</span> <span class="skolem">w'</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> w0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_msb <span class="free">w</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> weq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>  <span class="main">=</span> bv_to_int <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-norm_signed_result"><span class="command">lemma</span></span> norm_signed_result<span class="main">:</span> <span class="quoted"><span class="quoted">"norm_signed <span class="free">w</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> norm_signed <span class="free">w</span> <span class="main">=</span> <span class="main">[</span><span class="main">𝟭</span><span class="main">]</span> <span class="main">∨</span> bv_msb <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span> <span class="main">≠</span> bv_msb <span class="main">(</span>tl <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_cases <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">bs</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_signed_Cons<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span>
  <span class="keyword3"><span class="command">assume</span></span> msb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟬</span> <span class="main">=</span> bv_msb <span class="main">(</span>norm_unsigned <span class="skolem">l</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"norm_unsigned <span class="skolem">l</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> norm_unsigned_result <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_msb <span class="main">(</span>norm_unsigned <span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> msb <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">=</span> bv_msb <span class="main">(</span>tl <span class="main">(</span>norm_signed <span class="main">(</span><span class="main">𝟭</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">≠</span> bv_msb <span class="main">(</span>tl <span class="main">(</span>norm_signed <span class="main">(</span><span class="main">𝟭</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_induct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">xs</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> p <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-bv_to_int_upper_limit_lem1"><span class="command">lemma</span></span> bv_to_int_upper_limit_lem1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> w0<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w</span> <span class="main">&lt;</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> w0
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> msbw <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_msb <span class="free">w</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bv_to_int_msb1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w</span> <span class="main">=</span> bv_to_int <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> norm_signed_result <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"norm_signed <span class="free">w</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> w0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"norm_signed <span class="free">w</span> <span class="main">=</span> <span class="main">[</span><span class="main">𝟭</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> w0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bv_msb <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span> <span class="main">≠</span> bv_msb <span class="main">(</span>tl <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> msb_tl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">≠</span> bv_msb <span class="main">(</span>tl <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_cases <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"norm_signed <span class="free"><span class="free">w</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"norm_signed <span class="free">w</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> w0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w'</span>
      <span class="keyword3"><span class="command">assume</span></span> nw<span class="main">:</span> <span class="quoted"><span class="quoted">"norm_signed <span class="free">w</span> <span class="main">=</span> <span class="main">𝟬</span> <span class="main">#</span> <span class="skolem">w'</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> msbw <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_msb <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> nw <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w'</span>
      <span class="keyword3"><span class="command">assume</span></span> weq<span class="main">:</span> <span class="quoted"><span class="quoted">"norm_signed <span class="free">w</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">#</span> <span class="skolem">w'</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bit_list_cases <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">w'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> w'eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w'</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> w0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> w'eq <span class="keyword2"><span class="keyword">and</span></span> weq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w''</span>
        <span class="keyword3"><span class="command">assume</span></span> w'eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w'</span> <span class="main">=</span> <span class="main">𝟬</span> <span class="main">#</span> <span class="skolem">w''</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> weq w'eq<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w''</span>
        <span class="keyword3"><span class="command">assume</span></span> w'eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w'</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">#</span> <span class="skolem">w''</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> weq <span class="keyword2"><span class="keyword">and</span></span> msb_tl <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-length_int_to_bv_upper_limit_gt0"><span class="command">lemma</span></span> length_int_to_bv_upper_limit_gt0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> w0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     wk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> w0 wk
  <span class="keyword1"><span class="command">have</span></span> k1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span> length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>norm_signed <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> bv_to_int <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bv_to_int_lower_limit_gt0<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> w0 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> bv_to_int <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> wk <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-pos_length_pos"><span class="command">lemma</span></span> pos_length_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> bv_to_int <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> norm_signed_result <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"norm_signed <span class="free">w</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ii<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> i0 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"norm_signed <span class="free">w</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> jj<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_msb <span class="free">w</span> <span class="main">≠</span> <span class="main">𝟬</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟬</span> <span class="main">=</span> bv_msb <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ii<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">𝟬</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> jj<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> length <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> norm_signed_length<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-neg_length_pos"><span class="command">lemma</span></span> neg_length_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i0<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> norm_signed_result <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"norm_signed <span class="free">w</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ii<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> i0 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"norm_signed <span class="free">w</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> jj<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_msb <span class="free">w</span> <span class="main">≠</span> <span class="main">𝟬</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟬</span> <span class="main">=</span> bv_msb <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ii<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">𝟬</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> jj<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> length <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> norm_signed_length<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-length_int_to_bv_lower_limit_gt0"><span class="command">lemma</span></span> length_int_to_bv_lower_limit_gt0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zero_less_power<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wk<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> i0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> lii0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> pos_length_pos<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> i0<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span> <span class="free">k</span> <span class="main">&lt;</span> length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> lii0
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> bv_to_int <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bv_to_int_upper_range<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> wk <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-length_int_to_bv_upper_limit_lem1"><span class="command">lemma</span></span> length_int_to_bv_upper_limit_lem1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> w1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     wk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> w1 wk
  <span class="keyword1"><span class="command">have</span></span> k1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span> length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> bv_to_int <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>norm_signed <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bv_to_int_upper_limit_lem1<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> w1<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> wk <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-length_int_to_bv_lower_limit_lem1"><span class="command">lemma</span></span> length_int_to_bv_lower_limit_lem1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> wk <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zero_less_power<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> i1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> lii0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> neg_length_pos<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span> <span class="free">k</span> <span class="main">&lt;</span> length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> lii0 <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> bv_to_int <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bv_to_int_lower_range<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> wk <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Signed Arithmetic Operations›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Conversion from unsigned to signed›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">utos</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bit list <span class="main">=&gt;</span> bit list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">utos</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> norm_signed <span class="main">(</span><span class="main">𝟬</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Word-utos_type"><span class="command">lemma</span></span> utos_type <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"utos <span class="main">(</span>norm_unsigned <span class="free">w</span><span class="main">)</span> <span class="main">=</span> utos <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utos_def norm_signed_Cons<span class="main">)</span>

<span class="keyword1" id="Word-utos_returntype"><span class="command">lemma</span></span> utos_returntype <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm_signed <span class="main">(</span>utos <span class="free">w</span><span class="main">)</span> <span class="main">=</span> utos <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utos_def<span class="main">)</span>

<span class="keyword1" id="Word-utos_length"><span class="command">lemma</span></span> utos_length<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>utos <span class="free">w</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">(</span>length <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utos_def norm_signed_Cons<span class="main">)</span>

<span class="keyword1" id="Word-bv_to_int_utos"><span class="command">lemma</span></span> bv_to_int_utos<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span>utos <span class="free">w</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span>bv_to_nat <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utos_def norm_signed_Cons<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"norm_unsigned <span class="free">w</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="main">(</span>norm_unsigned <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="free">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Unary minus›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">bv_uminus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bit list <span class="main">=&gt;</span> bit list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bv_uminus</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> int_to_bv <span class="main">(</span><span class="main">-</span> bv_to_int <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Word-bv_uminus_type"><span class="command">lemma</span></span> bv_uminus_type <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_uminus <span class="main">(</span>norm_signed <span class="free">w</span><span class="main">)</span> <span class="main">=</span> bv_uminus <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_uminus_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_uminus_returntype"><span class="command">lemma</span></span> bv_uminus_returntype <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm_signed <span class="main">(</span>bv_uminus <span class="free">w</span><span class="main">)</span> <span class="main">=</span> bv_uminus <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_uminus_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_uminus_length"><span class="command">lemma</span></span> bv_uminus_length<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>bv_uminus <span class="free">w</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">(</span>length <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="main">-</span>bv_to_int <span class="free">w</span> <span class="main">∨</span> <span class="main">-</span>bv_to_int <span class="free">w</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="main">-</span>bv_to_int <span class="free">w</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">-</span>bv_to_int <span class="free">w</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">∨</span> <span class="main">-</span>bv_to_int <span class="free">w</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="main">-</span> bv_to_int <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> lw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="free">w</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> neg_length_pos<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> p
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_uminus_def<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> length_int_to_bv_upper_limit_gt0<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> p <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>length <span class="free">w</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> bv_to_int <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bv_to_int_lower_range<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> bv_to_int <span class="free">w</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>length <span class="free">w</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> lw <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> bv_to_int <span class="free">w</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> bv_to_int <span class="free">w</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> lw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> p
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_uminus_def<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> lw
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_to_bv_non0<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> bv_to_int <span class="free">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_uminus_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> bv_to_int <span class="free">w</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_uminus_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> bv_to_int <span class="free">w</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_uminus_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> length_int_to_bv_upper_limit_lem1<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> p<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bv_to_int_upper_range<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-bv_uminus_length_utos"><span class="command">lemma</span></span> bv_uminus_length_utos<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>bv_uminus <span class="main">(</span>utos <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">(</span>length <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>bv_to_int <span class="main">(</span>utos <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">-</span>bv_to_int <span class="main">(</span>utos <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">∨</span> <span class="main">-</span>bv_to_int <span class="main">(</span>utos <span class="free">w</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_to_int_utos<span class="main"><span class="keyword3">,</span></span> <span class="operator">arith</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>bv_to_int <span class="main">(</span>utos <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_uminus_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>bv_to_int <span class="main">(</span>utos <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_uminus_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span>bv_to_int <span class="main">(</span>utos <span class="free">w</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_uminus_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> length_int_to_bv_upper_limit_lem1<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> p<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_to_int_utos<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> bv_to_nat_upper_range <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span> int_nat_two_exp <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">bv_sadd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>bit list<span class="main">,</span> bit list <span class="main">]</span> <span class="main">=&gt;</span> bit list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bv_sadd</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> int_to_bv <span class="main">(</span>bv_to_int <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">+</span> bv_to_int <span class="free"><span class="bound"><span class="entity">w2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Word-bv_sadd_type1"><span class="command">lemma</span></span> bv_sadd_type1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_sadd <span class="main">(</span>norm_signed <span class="free">w1</span><span class="main">)</span> <span class="free">w2</span> <span class="main">=</span> bv_sadd <span class="free">w1</span> <span class="free">w2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_sadd_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_sadd_type2"><span class="command">lemma</span></span> bv_sadd_type2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_sadd <span class="free">w1</span> <span class="main">(</span>norm_signed <span class="free">w2</span><span class="main">)</span> <span class="main">=</span> bv_sadd <span class="free">w1</span> <span class="free">w2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_sadd_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_sadd_returntype"><span class="command">lemma</span></span> bv_sadd_returntype <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm_signed <span class="main">(</span>bv_sadd <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span> <span class="main">=</span> bv_sadd <span class="free">w1</span> <span class="free">w2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_sadd_def<span class="main">)</span>

<span class="keyword1" id="Word-adder_helper"><span class="command">lemma</span></span> adder_helper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
      <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>max_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> lw
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> power_Suc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-bv_sadd_length"><span class="command">lemma</span></span> bv_sadd_length<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>bv_sadd <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">(</span>max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w1</span> <span class="main">+</span> bv_to_int <span class="free">w2</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> helper<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">==&gt;</span> <span class="main">0</span> <span class="main">&lt;</span> max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_max_iff_disj<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> p <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="var">?Q</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_sadd_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_sadd_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="var">?Q</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_sadd_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> length_int_to_bv_upper_limit_gt0<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> p<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> bv_to_int_upper_range <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w2</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w2</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> bv_to_int_upper_range <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w1</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w1</span> <span class="main">+</span> bv_to_int <span class="free">w2</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> add_less_le_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> adder_helper<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> helper<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> p
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_sadd_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> length_int_to_bv_upper_limit_lem1<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> p<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> adder_helper<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> helper<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> p
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?Q</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> add_mono<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bv_to_int_lower_range <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bv_to_int_lower_range <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w2</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span>max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">bv_sub</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>bit list<span class="main">,</span> bit list<span class="main">]</span> <span class="main">=&gt;</span> bit list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bv_sub</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> bv_sadd <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">(</span>bv_uminus <span class="free"><span class="bound"><span class="entity">w2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Word-bv_sub_type1"><span class="command">lemma</span></span> bv_sub_type1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_sub <span class="main">(</span>norm_signed <span class="free">w1</span><span class="main">)</span> <span class="free">w2</span> <span class="main">=</span> bv_sub <span class="free">w1</span> <span class="free">w2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_sub_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_sub_type2"><span class="command">lemma</span></span> bv_sub_type2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_sub <span class="free">w1</span> <span class="main">(</span>norm_signed <span class="free">w2</span><span class="main">)</span> <span class="main">=</span> bv_sub <span class="free">w1</span> <span class="free">w2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_sub_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_sub_returntype"><span class="command">lemma</span></span> bv_sub_returntype <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm_signed <span class="main">(</span>bv_sub <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span> <span class="main">=</span> bv_sub <span class="free">w1</span> <span class="free">w2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_sub_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_sub_length"><span class="command">lemma</span></span> bv_sub_length<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>bv_sub <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">(</span>max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w2</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_sub_def bv_sadd_def bv_uminus_def p<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>norm_signed <span class="free">w1</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">w1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> norm_signed_length<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> max.cobounded1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> Suc <span class="main">(</span>max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>norm_signed <span class="free">w1</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">(</span>max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="free">w2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">w2</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> lmw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w1</span> <span class="main">-</span> bv_to_int <span class="free">w2</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="var">?Q</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_sub_def bv_sadd_def bv_uminus_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_sub_def bv_sadd_def bv_uminus_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="var">?Q</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_sub_def bv_sadd_def bv_uminus_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> length_int_to_bv_upper_limit_gt0<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> p<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> bv_to_int_lower_range <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w2</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> v2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> bv_to_int <span class="free">w2</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w1</span> <span class="main">+</span> <span class="main">-</span> bv_to_int <span class="free">w2</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> add_less_le_mono<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bv_to_int_upper_range <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> v2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> adder_helper<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> lmw<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_sub_def bv_sadd_def bv_uminus_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> length_int_to_bv_upper_limit_lem1<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> p<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> adder_helper<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> lmw<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> bv_to_int <span class="free">w1</span> <span class="main">+</span> <span class="main">-</span>bv_to_int <span class="free">w2</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> add_mono<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bv_to_int_lower_range <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> bv_to_int_upper_range <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w2</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span>max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">bv_smult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>bit list<span class="main">,</span> bit list<span class="main">]</span> <span class="main">=&gt;</span> bit list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bv_smult</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> int_to_bv <span class="main">(</span>bv_to_int <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">*</span> bv_to_int <span class="free"><span class="bound"><span class="entity">w2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Word-bv_smult_type1"><span class="command">lemma</span></span> bv_smult_type1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_smult <span class="main">(</span>norm_signed <span class="free">w1</span><span class="main">)</span> <span class="free">w2</span> <span class="main">=</span> bv_smult <span class="free">w1</span> <span class="free">w2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_smult_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_smult_type2"><span class="command">lemma</span></span> bv_smult_type2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_smult <span class="free">w1</span> <span class="main">(</span>norm_signed <span class="free">w2</span><span class="main">)</span> <span class="main">=</span> bv_smult <span class="free">w1</span> <span class="free">w2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_smult_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_smult_returntype"><span class="command">lemma</span></span> bv_smult_returntype <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm_signed <span class="main">(</span>bv_smult <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span> <span class="main">=</span> bv_smult <span class="free">w1</span> <span class="free">w2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_smult_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_smult_length"><span class="command">lemma</span></span> bv_smult_length<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>bv_smult <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">w1</span> <span class="main">+</span> length <span class="free">w2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w1</span> <span class="main">*</span> bv_to_int <span class="free">w2</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> lmw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">==&gt;</span> <span class="main">0</span> <span class="main">&lt;</span> length <span class="free">w1</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> length <span class="free">w2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="var">?Q</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> iffD1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> mult_eq_0_iff<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_smult_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_smult_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_smult_def p<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> lmw<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">using</span></span> p
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="var">?Q</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_less_mult_iff<span class="main"><span class="keyword3">,</span></span><span class="operator">safe</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> bi1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> bv_to_int <span class="free">w1</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> bi2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> bv_to_int <span class="free">w2</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_smult_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> length_int_to_bv_upper_limit_gt0<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> p<span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_strict_mono<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bv_to_int_upper_range<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bv_to_int_upper_range<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> zero_less_power<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">using</span></span> bi2
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">+</span> length <span class="free">w2</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> power_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">+</span> length <span class="free">w2</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> bi1<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w1</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> bi2<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w2</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_smult_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> length_int_to_bv_upper_limit_gt0<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> p<span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>bv_to_int <span class="free">w1</span> <span class="main">*</span> <span class="main">-</span>bv_to_int <span class="free">w2</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span><span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_mono<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> bv_to_int_lower_range <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w1</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">using</span></span> bv_to_int_lower_range <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w2</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> zero_le_power<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> bi2
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span><span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">+</span> length <span class="free">w2</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> power_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> lmw<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> p<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">+</span> length <span class="free">w2</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> bv_smult_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> length_int_to_bv_upper_limit_lem1<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> p<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span><span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">+</span> length <span class="free">w2</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> power_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">+</span> length <span class="free">w2</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?Q</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> p
        <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w1</span> <span class="main">*</span> bv_to_int <span class="free">w2</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_less_0_iff<span class="main"><span class="keyword3">,</span></span><span class="operator">safe</span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> bi1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> bv_to_int <span class="free">w1</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> bi2<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w2</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>bv_to_int <span class="free">w2</span> <span class="main">*</span> bv_to_int <span class="free">w1</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span><span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_mono<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> bv_to_int_lower_range <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w2</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">using</span></span> bv_to_int_upper_range <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w1</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> zero_le_power<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> bi1
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="var">?Q</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span><span class="main">(</span>length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span><span class="main">(</span>length <span class="free">w1</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?Q</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> bi1<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w1</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> bi2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> bv_to_int <span class="free">w2</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>bv_to_int <span class="free">w1</span> <span class="main">*</span> bv_to_int <span class="free">w2</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span><span class="main">(</span>length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_mono<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> bv_to_int_lower_range <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w1</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">using</span></span> bv_to_int_upper_range <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w2</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> zero_le_power<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> bi2
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="var">?Q</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span><span class="main">(</span>length <span class="free">w1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span><span class="main">(</span>length <span class="free">w1</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?Q</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">+</span> length <span class="free">w2</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-bv_msb_one"><span class="command">lemma</span></span> bv_msb_one<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_msb <span class="free">w</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">==&gt;</span> bv_to_nat <span class="free">w</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Word-bv_smult_length_utos"><span class="command">lemma</span></span> bv_smult_length_utos<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>bv_smult <span class="main">(</span>utos <span class="free">w1</span><span class="main">)</span> <span class="free">w2</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">w1</span> <span class="main">+</span> length <span class="free">w2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span>utos <span class="free">w1</span><span class="main">)</span> <span class="main">*</span> bv_to_int <span class="free">w2</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> lmw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">==&gt;</span> <span class="main">0</span> <span class="main">&lt;</span> length <span class="main">(</span>utos <span class="free">w1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> length <span class="free">w2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="var">?Q</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> iffD1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> mult_eq_0_iff<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span>utos <span class="free">w1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_smult_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_smult_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="var">?Q</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_less_mult_iff<span class="main"><span class="keyword3">,</span></span><span class="operator">safe</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> biw2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> bv_to_int <span class="free">w2</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_smult_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> length_int_to_bv_upper_limit_gt0<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> p<span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="free">w1</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_strict_mono<span class="main">)</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_to_int_utos bv_to_nat_upper_range int_nat_two_exp <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_power<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bv_to_int_upper_range<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> zero_less_power<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> biw2
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">+</span> length <span class="free">w2</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> power_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> lmw<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
          <span class="keyword1"><span class="command">using</span></span> p
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">+</span> length <span class="free">w2</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span>utos <span class="free">w1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_to_int_utos<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_smult_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> lmw<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> bv_smult_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> length_int_to_bv_upper_limit_lem1<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> p<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> length <span class="free">w1</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span><span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">+</span> length <span class="free">w2</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> power_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> lmw<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> p<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">+</span> length <span class="free">w2</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span> length <span class="free">w1</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?Q</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> p
        <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span>utos <span class="free">w1</span><span class="main">)</span> <span class="main">*</span> bv_to_int <span class="free">w2</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_less_0_iff<span class="main"><span class="keyword3">,</span></span><span class="operator">safe</span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> bi1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> bv_to_int <span class="main">(</span>utos <span class="free">w1</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> bi2<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="free">w2</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>bv_to_int <span class="free">w2</span> <span class="main">*</span> bv_to_int <span class="main">(</span>utos <span class="free">w1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span><span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> length <span class="free">w1</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_mono<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> bv_to_int_lower_range <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w2</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_to_int_utos<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> bv_to_nat_upper_range <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w1</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_nat_two_exp <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_power<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> zero_le_power<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> bi1
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="var">?Q</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?Q</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> bi1<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span>utos <span class="free">w1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w2</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?Q</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_to_int_utos<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">w1</span> <span class="main">+</span> length <span class="free">w2</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-bv_smult_sym"><span class="command">lemma</span></span> bv_smult_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_smult <span class="free">w1</span> <span class="free">w2</span> <span class="main">=</span> bv_smult <span class="free">w2</span> <span class="free">w1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_smult_def <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Structural operations›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">bv_select</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>bit list<span class="main">,</span>nat<span class="main">]</span> <span class="main">=&gt;</span> bit"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bv_select</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">!</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">bv_chop</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>bit list<span class="main">,</span>nat<span class="main">]</span> <span class="main">=&gt;</span> bit list <span class="main">*</span> bit list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bv_chop</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">len</span> <span class="main">=</span> length <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1">in</span> <span class="main">(</span>take <span class="main">(</span><span class="bound">len</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">,</span>drop <span class="main">(</span><span class="bound">len</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">bv_slice</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>bit list<span class="main">,</span>nat<span class="main">*</span>nat<span class="main">]</span> <span class="main">=&gt;</span> bit list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bv_slice</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span><span class="main">.</span> fst <span class="main">(</span>bv_chop <span class="main">(</span>snd <span class="main">(</span>bv_chop <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">(</span><span class="bound">b</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Word-bv_select_rev"><span class="command">lemma</span></span> bv_select_rev<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> notnull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>            <span class="quoted"><span class="quoted">"bv_select <span class="free">w</span> <span class="free">n</span> <span class="main">=</span> rev <span class="free">w</span> <span class="main">!</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> length <span class="free">w</span> <span class="main">--&gt;</span> bv_select <span class="free">w</span> <span class="bound">n</span> <span class="main">=</span> rev <span class="free">w</span> <span class="main">!</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> length_induct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_select_def<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bit list"</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ys</span><span class="main">::</span>bit list<span class="main">.</span> length <span class="bound">ys</span> <span class="main">&lt;</span> length <span class="skolem">xs</span> <span class="main">--&gt;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> length <span class="bound">ys</span> <span class="main">--&gt;</span> <span class="bound">ys</span> <span class="main">!</span> <span class="main">(</span>length <span class="bound">ys</span> <span class="main">-</span> Suc <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> rev <span class="bound">ys</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> notx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="skolem">xs</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">xs</span> <span class="main">-</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> rev <span class="skolem">xs</span> <span class="main">!</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> notx <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="skolem">ys</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> noty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="skolem">ys</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> spec <span class="main">[</span><span class="operator">OF</span> ind<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> length <span class="skolem">ys</span> <span class="main">--&gt;</span> <span class="skolem">ys</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">ys</span> <span class="main">-</span> Suc <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> rev <span class="skolem">ys</span> <span class="main">!</span> <span class="bound">n</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="skolem">ys</span> <span class="main">--&gt;</span> <span class="skolem">ys</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">ys</span> <span class="main">-</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> rev <span class="skolem">ys</span> <span class="main">!</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> noty
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">ys</span> <span class="main">-</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> rev <span class="skolem">ys</span> <span class="main">!</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span> <span class="skolem">n</span> <span class="main">&lt;</span> length <span class="skolem">ys</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ys</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> notx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> length <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> length <span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="free">w</span> <span class="main">--&gt;</span> bv_select <span class="free">w</span> <span class="free">n</span> <span class="main">=</span> rev <span class="free">w</span> <span class="main">!</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> notnull <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-bv_chop_append"><span class="command">lemma</span></span> bv_chop_append<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_chop <span class="main">(</span><span class="free">w1</span> <span class="main">@</span> <span class="free">w2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">w1</span><span class="main">,</span><span class="free">w2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_chop_def Let_def<span class="main">)</span>

<span class="keyword1" id="Word-append_bv_chop_id"><span class="command">lemma</span></span> append_bv_chop_id<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>bv_chop <span class="free">w</span> <span class="free">l</span><span class="main">)</span> <span class="main">@</span> snd <span class="main">(</span>bv_chop <span class="free">w</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_chop_def Let_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_chop_length_fst"><span class="command">lemma</span></span> bv_chop_length_fst <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>fst <span class="main">(</span>bv_chop <span class="free">w</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="free">w</span> <span class="main">-</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_chop_def Let_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_chop_length_snd"><span class="command">lemma</span></span> bv_chop_length_snd <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>snd <span class="main">(</span>bv_chop <span class="free">w</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> min <span class="free">i</span> <span class="main">(</span>length <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_chop_def Let_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_slice_length"><span class="command">lemma</span></span> bv_slice_length <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">j</span> <span class="main">≤</span> <span class="free">i</span><span class="main">;</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">w</span> <span class="main">|]</span> <span class="main">==&gt;</span> length <span class="main">(</span>bv_slice <span class="free">w</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span> <span class="main">-</span> <span class="free">j</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_slice_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">length_nat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">=&gt;</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">length_nat</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Word-length_nat"><span class="command">lemma</span></span> length_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span> <span class="main">=</span> length_nat <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_nat_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> length_nat_to_bv_upper_limit<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> length <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> length <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> length_nat_to_bv_lower_limit<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-length_nat_0"><span class="command">lemma</span></span> length_nat_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length_nat <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_nat_def Least_equality<span class="main">)</span>

<span class="keyword1" id="Word-length_nat_non0"><span class="command">lemma</span></span> length_nat_non0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"length_nat <span class="free">n</span> <span class="main">=</span> Suc <span class="main">(</span>length_nat <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_nat <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> nat_to_bv_non0 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">length_int</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">=&gt;</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">length_int</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">then</span> Suc <span class="main">(</span>length_nat <span class="main">(</span>nat <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span>
    <span class="keyword1">else</span> Suc <span class="main">(</span>length_nat <span class="main">(</span>nat <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Word-length_int"><span class="command">lemma</span></span> length_int<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">=</span> length_int <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> i0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">=</span>
      length <span class="main">(</span>norm_signed <span class="main">(</span><span class="main">𝟬</span> <span class="main">#</span> norm_unsigned <span class="main">(</span>nat_to_bv <span class="main">(</span>nat <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> norm_unsigned_result <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"nat_to_bv <span class="main">(</span>nat <span class="free">i</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Suc <span class="main">(</span>length_nat <span class="main">(</span>nat <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> norm_unsigned_nat_to_bv<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> norm_empty_bv_to_nat_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> i0 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"norm_unsigned <span class="main">(</span>nat_to_bv <span class="main">(</span>nat <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> norm_empty_bv_to_nat_zero <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"nat_to_bv <span class="main"><span class="main">(</span></span>nat <span class="free"><span class="free">i</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> i0 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i0<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> i0 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_nat <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> i0
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_int_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> i0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_int_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> i0 <span class="keyword1"><span class="command">have</span></span> i0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>int_to_bv <span class="free">i</span><span class="main">)</span> <span class="main">=</span>
        length <span class="main">(</span>norm_signed <span class="main">(</span><span class="main">𝟭</span> <span class="main">#</span> bv_not <span class="main">(</span>norm_unsigned <span class="main">(</span>nat_to_bv <span class="main">(</span>nat <span class="main">(</span><span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_to_bv_def nat_diff_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> norm_unsigned_result <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"nat_to_bv <span class="main">(</span>nat <span class="main">(</span><span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Suc <span class="main">(</span>length_nat <span class="main">(</span>nat <span class="main">(</span><span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> norm_unsigned_nat_to_bv<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> norm_empty_bv_to_nat_zero <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"nat_to_bv <span class="main"><span class="main">(</span></span>nat <span class="main"><span class="main">(</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">i</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">-</span></span> Suc <span class="main"><span class="main">0</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> i0 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_nat <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"norm_unsigned <span class="main">(</span>nat_to_bv <span class="main">(</span>nat <span class="main">(</span><span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">finally</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> i0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_int_def nat_diff_distrib <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> int_to_bv_lt0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-length_int_0"><span class="command">lemma</span></span> length_int_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length_int <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_int_def<span class="main">)</span>

<span class="keyword1" id="Word-length_int_gt0"><span class="command">lemma</span></span> length_int_gt0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span> <span class="main">==&gt;</span> length_int <span class="free">i</span> <span class="main">=</span> Suc <span class="main">(</span>length_nat <span class="main">(</span>nat <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_int_def<span class="main">)</span>

<span class="keyword1" id="Word-length_int_lt0"><span class="command">lemma</span></span> length_int_lt0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">==&gt;</span> length_int <span class="free">i</span> <span class="main">=</span> Suc <span class="main">(</span>length_nat <span class="main">(</span>nat <span class="main">(</span><span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_int_def nat_diff_distrib<span class="main">)</span>

<span class="keyword1" id="Word-bv_chopI"><span class="command">lemma</span></span> bv_chopI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">w</span> <span class="main">=</span> <span class="free">w1</span> <span class="main">@</span> <span class="free">w2</span> <span class="main">;</span> <span class="free">i</span> <span class="main">=</span> length <span class="free">w2</span> <span class="main">|]</span> <span class="main">==&gt;</span> bv_chop <span class="free">w</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">w1</span><span class="main">,</span><span class="free">w2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_chop_def Let_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_sliceI"><span class="command">lemma</span></span> bv_sliceI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">j</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">;</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">w</span> <span class="main">;</span> <span class="free">w</span> <span class="main">=</span> <span class="free">w1</span> <span class="main">@</span> <span class="free">w2</span> <span class="main">@</span> <span class="free">w3</span> <span class="main">;</span> Suc <span class="free">i</span> <span class="main">=</span> length <span class="free">w2</span> <span class="main">+</span> <span class="free">j</span> <span class="main">;</span> <span class="free">j</span> <span class="main">=</span> length <span class="free">w3</span>  <span class="main">|]</span> <span class="main">==&gt;</span> bv_slice <span class="free">w</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">w2</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_slice_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> bv_chopI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">w1</span></span> <span class="main"><span class="main">@</span></span> <span class="free"><span class="free">w2</span></span> <span class="main"><span class="main">@</span></span> <span class="free"><span class="free">w3</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w1</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">w2</span></span> <span class="main"><span class="main">@</span></span> <span class="free"><span class="free">w3</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> bv_chopI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">w2</span></span> <span class="main"><span class="main">@</span></span> <span class="free"><span class="free">w3</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w3</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Word-bv_slice_bv_slice"><span class="command">lemma</span></span> bv_slice_bv_slice<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ki<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     jl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     lw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&lt;</span> length <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"bv_slice <span class="free">w</span> <span class="main">(</span><span class="free">j</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> bv_slice <span class="main">(</span>bv_slice <span class="free">w</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">j</span><span class="main">-</span><span class="free">k</span><span class="main">,</span><span class="free">i</span><span class="main">-</span><span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">w1</span></span> <span class="skolem"><span class="skolem">w2</span></span> <span class="skolem"><span class="skolem">w3</span></span> <span class="skolem"><span class="skolem">w4</span></span> <span class="skolem"><span class="skolem">w5</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> w_defs<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">w1</span> <span class="main">=</span> fst <span class="main">(</span>bv_chop <span class="free">w</span> <span class="main">(</span>Suc <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">w2</span> <span class="main">=</span> fst <span class="main">(</span>bv_chop <span class="main">(</span>snd <span class="main">(</span>bv_chop <span class="free">w</span> <span class="main">(</span>Suc <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">w3</span> <span class="main">=</span> fst <span class="main">(</span>bv_chop <span class="main">(</span>snd <span class="main">(</span>bv_chop <span class="main">(</span>snd <span class="main">(</span>bv_chop <span class="free">w</span> <span class="main">(</span>Suc <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">w4</span> <span class="main">=</span> fst <span class="main">(</span>bv_chop <span class="main">(</span>snd <span class="main">(</span>bv_chop <span class="main">(</span>snd <span class="main">(</span>bv_chop <span class="main">(</span>snd <span class="main">(</span>bv_chop <span class="free">w</span> <span class="main">(</span>Suc <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">w5</span> <span class="main">=</span> snd <span class="main">(</span>bv_chop <span class="main">(</span>snd <span class="main">(</span>bv_chop <span class="main">(</span>snd <span class="main">(</span>bv_chop <span class="main">(</span>snd <span class="main">(</span>bv_chop <span class="free">w</span> <span class="main">(</span>Suc <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> w_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="skolem">w1</span> <span class="main">@</span> <span class="skolem">w2</span> <span class="main">@</span> <span class="skolem">w3</span> <span class="main">@</span> <span class="skolem">w4</span> <span class="main">@</span> <span class="skolem">w5</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> w_defs append_bv_chop_id<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> ki ij jl lw
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> bv_sliceI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?j</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">i</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?i</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">j</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?w</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?w1.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">w1</span></span> <span class="main"><span class="main">@</span></span> <span class="skolem"><span class="skolem">w2</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?w2.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">w3</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?w3.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">w4</span></span> <span class="main"><span class="main">@</span></span> <span class="skolem"><span class="skolem">w5</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> w_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> w_defs<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> w_defs<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> bv_sliceI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?j</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?i</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">l</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?w</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?w1.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">w1</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?w2.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">w2</span></span> <span class="main"><span class="main">@</span></span> <span class="skolem"><span class="skolem">w3</span></span> <span class="main"><span class="main">@</span></span> <span class="skolem"><span class="skolem">w4</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?w3.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">w5</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> w_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> w_defs<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> w_defs<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> bv_sliceI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?j</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">i</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">k</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?i</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">j</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">k</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?w</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">w2</span></span> <span class="main"><span class="main">@</span></span> <span class="skolem"><span class="skolem">w3</span></span> <span class="main"><span class="main">@</span></span> <span class="skolem"><span class="skolem">w4</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?w1.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">w2</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?w2.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">w3</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?w3.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">w4</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> w_defs<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-bv_to_nat_extend"><span class="command">lemma</span></span> bv_to_nat_extend <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="main">(</span>bv_extend <span class="free">n</span> <span class="main">𝟬</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> bv_to_nat <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_extend_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> bv_to_nat_dist_append<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="main"><span class="main">(</span></span><span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> length <span class="free">w</span>"</span></span><span class="main"><span class="main">)</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Word-bv_msb_extend_same"><span class="command">lemma</span></span> bv_msb_extend_same <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_msb <span class="free">w</span> <span class="main">=</span> <span class="free">b</span> <span class="main">==&gt;</span> bv_msb <span class="main">(</span>bv_extend <span class="free">n</span> <span class="free">b</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_extend_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> length <span class="free">w</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Word-bv_to_int_extend"><span class="command">lemma</span></span> bv_to_int_extend <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_msb <span class="free">w</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"bv_to_int <span class="main">(</span>bv_extend <span class="free">n</span> <span class="free">b</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> bv_to_int <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bv_msb <span class="free">w</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_msb <span class="free">w</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">𝟬</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_to_int_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_msb <span class="free">w</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_to_int_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_extend_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="main"><span class="main">(</span></span><span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> length <span class="free">w</span>"</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-length_nat_mono"><span class="command">lemma</span></span> length_nat_mono <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">==&gt;</span> length_nat <span class="free">x</span> <span class="main">≤</span> length_nat <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span> length_nat <span class="free">x</span> <span class="main">≤</span> length_nat <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> lxly<span class="main">:</span> <span class="quoted"><span class="quoted">"length_nat <span class="free">y</span> <span class="main">&lt;</span> length_nat <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length_nat <span class="free">y</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_nat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> length_nat <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> not_less_Least<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> xx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> length_nat <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> yy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> length_nat <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_nat_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> LeastI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">y</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">assumption</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">y</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">with</span></span> xx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> xy <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Word-length_nat_mono_int"><span class="command">lemma</span></span> length_nat_mono_int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">==&gt;</span> length_nat <span class="free">x</span> <span class="main">≤</span> length_nat <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> length_nat_mono<span class="main">)</span> <span class="operator">arith</span>

<span class="keyword1" id="Word-length_nat_pos"><span class="command">lemma</span></span> length_nat_pos <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">==&gt;</span> <span class="main">0</span> <span class="main">&lt;</span> length_nat <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_nat_non0<span class="main">)</span>

<span class="keyword1" id="Word-length_int_mono_gt0"><span class="command">lemma</span></span> length_int_mono_gt0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">|]</span> <span class="main">==&gt;</span> length_int <span class="free">x</span> <span class="main">≤</span> length_int <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_int_gt0 nat_le_eq_zle<span class="main">)</span>

<span class="keyword1" id="Word-length_int_mono_lt0"><span class="command">lemma</span></span> length_int_mono_lt0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">;</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">|]</span> <span class="main">==&gt;</span> length_int <span class="free">y</span> <span class="main">≤</span> length_int <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_int_lt0<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> length_nat_non0

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">fast_bv_to_nat_helper</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>bit list<span class="main">,</span> num<span class="main">]</span> <span class="main">=&gt;</span> num"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    fast_bv_to_nat_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fast_bv_to_nat_helper</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>"</span></span>
  <span class="main">|</span> fast_bv_to_nat_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fast_bv_to_nat_helper</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span>
      <span class="free">fast_bv_to_nat_helper</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span><span class="main">(</span>case_bit Num.Bit0 Num.Bit1 <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> fast_bv_to_nat_helper.simps <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword">del</span></span><span class="main">]</span>

<span class="keyword1" id="Word-fast_bv_to_nat_Cons0"><span class="command">lemma</span></span> fast_bv_to_nat_Cons0<span class="main">:</span> <span class="quoted"><span class="quoted">"fast_bv_to_nat_helper <span class="main">(</span><span class="main">𝟬</span><span class="main">#</span><span class="free">bs</span><span class="main">)</span> <span class="free">bin</span> <span class="main">=</span>
    fast_bv_to_nat_helper <span class="free">bs</span> <span class="main">(</span>Num.Bit0 <span class="free">bin</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Word-fast_bv_to_nat_Cons1"><span class="command">lemma</span></span> fast_bv_to_nat_Cons1<span class="main">:</span> <span class="quoted"><span class="quoted">"fast_bv_to_nat_helper <span class="main">(</span><span class="main">𝟭</span><span class="main">#</span><span class="free">bs</span><span class="main">)</span> <span class="free">bin</span> <span class="main">=</span>
    fast_bv_to_nat_helper <span class="free">bs</span> <span class="main">(</span>Num.Bit1 <span class="free">bin</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Word-mult_Bit0_left"><span class="command">lemma</span></span> mult_Bit0_left<span class="main">:</span> <span class="quoted"><span class="quoted">"Num.Bit0 <span class="free">m</span> <span class="main">*</span> <span class="free">n</span> <span class="main">=</span> Num.Bit0 <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> num_eq_iff nat_of_num_mult distrib_right<span class="main">)</span>

<span class="keyword1" id="Word-fast_bv_to_nat_def"><span class="command">lemma</span></span> fast_bv_to_nat_def<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bv_to_nat <span class="main">(</span><span class="main">𝟭</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="main">==</span> numeral <span class="main">(</span>fast_bv_to_nat_helper <span class="free">bs</span> Num.One<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> foldl <span class="main">(</span><span class="main">λ</span><span class="bound">bn</span> <span class="bound">b</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">bn</span> <span class="main">+</span> bitval <span class="bound">b</span><span class="main">)</span> <span class="main">(</span>numeral <span class="bound">k</span><span class="main">)</span> <span class="free">bs</span> <span class="main">=</span> numeral <span class="main">(</span>fast_bv_to_nat_helper <span class="free">bs</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_Bit0_left<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">PROP</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_to_nat_def <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_One <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
      <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> numeral_One One_nat_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">declare</span></span> fast_bv_to_nat_Cons <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> fast_bv_to_nat_Cons0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> fast_bv_to_nat_Cons1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">simproc_setup</span></span> bv_to_nat <span class="main">(</span><span class="quoted"><span class="quoted">"bv_to_nat <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="main">=</span> <span class="quoted">‹
  <span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ct</span> <span class="main">=&gt;</span>
    <span class="keyword2"><span class="keyword">let</span></span>
      <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">is_const_bool</span> <span class="main">(</span>Const<span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> True<span class="antiquote">}</span></span><span class="main">,</span><span class="main">_</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> true
        <span class="main">|</span> <span class="entity">is_const_bool</span> <span class="main">(</span>Const<span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> False<span class="antiquote">}</span></span><span class="main">,</span><span class="main">_</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> true
        <span class="main">|</span> <span class="entity">is_const_bool</span> <span class="main">_</span> <span class="main">=</span> false
      <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">is_const_bit</span> <span class="main">(</span>Const<span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Zero<span class="antiquote">}</span></span><span class="main">,</span><span class="main">_</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> true
        <span class="main">|</span> <span class="entity">is_const_bit</span> <span class="main">(</span>Const<span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> One<span class="antiquote">}</span></span><span class="main">,</span><span class="main">_</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> true
        <span class="main">|</span> <span class="entity">is_const_bit</span> <span class="main">_</span> <span class="main">=</span> false
      <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">vec_is_usable</span> <span class="main">(</span>Const<span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Nil<span class="antiquote">}</span></span><span class="main">,</span><span class="main">_</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> true
        <span class="main">|</span> <span class="entity">vec_is_usable</span> <span class="main">(</span>Const<span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Cons<span class="antiquote">}</span></span><span class="main">,</span><span class="main">_</span><span class="main">)</span> $ <span class="entity">b</span> $ <span class="entity">bs</span><span class="main">)</span> <span class="main">=</span>
            <span class="entity">vec_is_usable</span> <span class="entity">bs</span> <span class="keyword1"><span class="keyword">andalso</span></span> <span class="entity">is_const_bit</span> <span class="entity">b</span>
        <span class="main">|</span> <span class="entity">vec_is_usable</span> <span class="main">_</span> <span class="main">=</span> false
      <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">proc</span> <span class="main">(</span>Const<span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> bv_to_nat<span class="antiquote">}</span></span><span class="main">,</span><span class="main">_</span><span class="main">)</span> $
        <span class="main">(</span>Const<span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Cons<span class="antiquote">}</span></span><span class="main">,</span><span class="main">_</span><span class="main">)</span> $ Const<span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> One<span class="antiquote">}</span></span><span class="main">,</span><span class="main">_</span><span class="main">)</span> $ <span class="entity">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">vec_is_usable</span> <span class="entity">t</span> <span class="keyword2"><span class="keyword">then</span></span>
              SOME
                <span class="main">(</span>infer_instantiate <span class="entity">ctxt</span>
                  <span class="main">[</span><span class="main">(</span><span class="main">(</span><span class="inner_quoted">"bs"</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">)</span><span class="main">,</span> Thm.cterm_of <span class="entity">ctxt</span> <span class="entity">t</span><span class="main">)</span><span class="main">]</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> fast_bv_to_nat_def<span class="antiquote">}</span></span></span><span class="main">)</span>
            <span class="keyword2"><span class="keyword">else</span></span> NONE
        <span class="main">|</span> <span class="entity">proc</span> <span class="main">_</span> <span class="main">=</span> NONE
    <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">proc</span> <span class="main">(</span>Thm.term_of <span class="entity">ct</span><span class="main">)</span> <span class="keyword2"><span class="keyword">end</span></span>
›</span>

<span class="keyword1"><span class="command">declare</span></span> bv_to_nat1 <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> bv_to_nat_helper <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">bv_mapzip</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>bit <span class="main">=&gt;</span> bit <span class="main">=&gt;</span> bit<span class="main">,</span>bit list<span class="main">,</span> bit list<span class="main">]</span> <span class="main">=&gt;</span> bit list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bv_mapzip</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">g</span> <span class="main">=</span> bv_extend <span class="main">(</span>max <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">w1</span></span></span><span class="main">)</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">w2</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">𝟬</span>
     <span class="keyword1">in</span> map <span class="main">(</span>case_prod <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span><span class="bound">g</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">g</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Word-bv_length_bv_mapzip"><span class="command">lemma</span></span> bv_length_bv_mapzip <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"length <span class="main">(</span>bv_mapzip <span class="free">f</span> <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">w2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_mapzip_def Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> split_max<span class="main">)</span>

<span class="keyword1" id="Word-bv_mapzip_Nil"><span class="command">lemma</span></span> bv_mapzip_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bv_mapzip <span class="free">f</span> <span class="main">[]</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_mapzip_def Let_def<span class="main">)</span>

<span class="keyword1" id="Word-bv_mapzip_Cons"><span class="command">lemma</span></span> bv_mapzip_Cons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">w1</span> <span class="main">=</span> length <span class="free">w2</span> <span class="main">==&gt;</span>
    bv_mapzip <span class="free">f</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">w1</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span><span class="main">#</span><span class="free">w2</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">#</span> bv_mapzip <span class="free">f</span> <span class="free">w1</span> <span class="free">w2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_mapzip_def Let_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="WordOperations">
<div class="head">
<h1>Theory WordOperations</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      RSAPSS/Wordoperations.thy
    Author:     Christina Lindenberg, Kai Wirt, Technische Universität Darmstadt
    Copyright:  2005 - Technische Universität Darmstadt
*)</span>

<span class="keyword1"><span class="command">section</span></span>  <span class="quoted"><span class="plain_text">‹Extensions to the Word theory required for SHA1›</span></span>

<span class="keyword1"><span class="command">theory</span></span> WordOperations
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Word">Word</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> bv <span class="main">=</span> <span class="quoted"><span class="quoted">"bit list"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> HEX <span class="main">=</span> x0 <span class="main">|</span> x1 <span class="main">|</span> x2 <span class="main">|</span> x3 <span class="main">|</span> x4 <span class="main">|</span> x5 <span class="main">|</span> x6 <span class="main">|</span> x7 <span class="main">|</span> x8 <span class="main">|</span> x9 <span class="main">|</span> xA <span class="main">|</span> xB <span class="main">|</span> xC <span class="main">|</span> xD <span class="main">|</span> xE <span class="main">|</span> xF

<span class="keyword1"><span class="command">definition</span></span>
  bvxor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bvxor</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> bv_mapzip <span class="keyword1">(⊕<span class="hidden">⇩</span><sub>b</sub>)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  bvand<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bvand</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> bv_mapzip <span class="keyword1">(∧<span class="hidden">⇩</span><sub>b</sub>)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  bvor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bvor</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> bv_mapzip <span class="keyword1">(∨<span class="hidden">⇩</span><sub>b</sub>)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">last</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">last</span> <span class="main">[]</span> <span class="main">=</span> Zero"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">last</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">=</span><span class="main">[]</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">last</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">dellast</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dellast</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">dellast</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free">dellast</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">bvrol</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bvrol</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bvrol</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bvrol</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">bvrol</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">@</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">bvror</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bvror</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bvror</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bvror</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">bvror</span> <span class="main">(</span>last <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> dellast <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">selecthelp</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">selecthelp</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&lt;=</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">[</span>Zero<span class="main">]</span> <span class="keyword1">else</span> <span class="main">(</span>Zero <span class="main">#</span> <span class="free">selecthelp</span> <span class="main">[]</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">selecthelp</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&lt;=</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free">selecthelp</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">select</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">select</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;=</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>selecthelp <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">select</span> <span class="main">[]</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">select</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;=</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>selecthelp <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">select</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  addmod32<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">addmod32</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span>
    rev <span class="main">(</span>select <span class="main">(</span>rev <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="main">(</span>bv_to_nat <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>bv_to_nat <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="numeral">31</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  bv_prepend<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bv_prepend</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">bv</span></span></span> <span class="main">=</span> replicate <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">bv</span></span></span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">zerolist</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">zerolist</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">zerolist</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">zerolist</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>  <span class="main">@</span> <span class="main">[</span>Zero<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">hextobv</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">hextobv</span> x0 <span class="main">=</span> <span class="main">[</span>Zero<span class="main">,</span>Zero<span class="main">,</span>Zero<span class="main">,</span>Zero<span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">hextobv</span> x1 <span class="main">=</span> <span class="main">[</span>Zero<span class="main">,</span>Zero<span class="main">,</span>Zero<span class="main">,</span>One<span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">hextobv</span> x2 <span class="main">=</span> <span class="main">[</span>Zero<span class="main">,</span>Zero<span class="main">,</span>One<span class="main">,</span>Zero<span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">hextobv</span> x3 <span class="main">=</span> <span class="main">[</span>Zero<span class="main">,</span>Zero<span class="main">,</span>One<span class="main">,</span>One<span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">hextobv</span> x4 <span class="main">=</span> <span class="main">[</span>Zero<span class="main">,</span>One<span class="main">,</span>Zero<span class="main">,</span>Zero<span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">hextobv</span> x5 <span class="main">=</span> <span class="main">[</span>Zero<span class="main">,</span>One<span class="main">,</span>Zero<span class="main">,</span>One<span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">hextobv</span> x6 <span class="main">=</span> <span class="main">[</span>Zero<span class="main">,</span>One<span class="main">,</span>One<span class="main">,</span>Zero<span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">hextobv</span> x7 <span class="main">=</span> <span class="main">[</span>Zero<span class="main">,</span>One<span class="main">,</span>One<span class="main">,</span>One<span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">hextobv</span> x8 <span class="main">=</span> <span class="main">[</span>One<span class="main">,</span>Zero<span class="main">,</span>Zero<span class="main">,</span>Zero<span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">hextobv</span> x9 <span class="main">=</span> <span class="main">[</span>One<span class="main">,</span>Zero<span class="main">,</span>Zero<span class="main">,</span>One<span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">hextobv</span> xA <span class="main">=</span> <span class="main">[</span>One<span class="main">,</span>Zero<span class="main">,</span>One<span class="main">,</span>Zero<span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">hextobv</span> xB <span class="main">=</span> <span class="main">[</span>One<span class="main">,</span>Zero<span class="main">,</span>One<span class="main">,</span>One<span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">hextobv</span> xC <span class="main">=</span> <span class="main">[</span>One<span class="main">,</span>One<span class="main">,</span>Zero<span class="main">,</span>Zero<span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">hextobv</span> xD <span class="main">=</span> <span class="main">[</span>One<span class="main">,</span>One<span class="main">,</span>Zero<span class="main">,</span>One<span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">hextobv</span> xE <span class="main">=</span> <span class="main">[</span>One<span class="main">,</span>One<span class="main">,</span>One<span class="main">,</span>Zero<span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">hextobv</span> xF <span class="main">=</span> <span class="main">[</span>One<span class="main">,</span>One<span class="main">,</span>One<span class="main">,</span>One<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">hexvtobv</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">hexvtobv</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">hexvtobv</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> hextobv <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">@</span> <span class="free">hexvtobv</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1" id="WordOperations-selectlenhelp"><span class="command">lemma</span></span> selectlenhelp<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>selecthelp <span class="free">l</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>selecthelp <span class="skolem">l</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"selecthelp <span class="skolem">l</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[</span>Zero<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">as</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"selecthelp <span class="skolem">l</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>selecthelp <span class="skolem">l</span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"selecthelp <span class="skolem">l</span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> Zero <span class="main">#</span> selecthelp <span class="skolem">l</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>selecthelp <span class="skolem">l</span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"selecthelp <span class="skolem">l</span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> selecthelp <span class="skolem">b</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>selecthelp <span class="skolem">l</span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> length <span class="main">(</span>selecthelp <span class="skolem">b</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>selecthelp <span class="skolem">l</span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="WordOperations-selectlenhelp2"><span class="command">lemma</span></span> selectlenhelp2<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">∀</span><span class="bound">l</span> <span class="bound">j</span><span class="main">.</span> <span class="main">∃</span><span class="bound">k</span><span class="main">.</span> select <span class="bound">l</span> <span class="bound">i</span> <span class="bound">j</span> <span class="main">=</span> select <span class="bound">k</span> <span class="main">0</span> <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">j</span><span class="main">.</span> <span class="main">∃</span><span class="bound">k</span><span class="main">.</span> select <span class="bound">l</span> <span class="skolem">i</span> <span class="bound">j</span> <span class="main">=</span> select <span class="bound">k</span> <span class="main">0</span> <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">j</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"select <span class="skolem">l</span> <span class="main">0</span> <span class="skolem">j</span> <span class="main">=</span> select <span class="skolem">l</span> <span class="main">0</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> select <span class="skolem">l</span> <span class="main">0</span> <span class="skolem">j</span> <span class="main">=</span> select <span class="bound">k</span> <span class="main">0</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"select <span class="skolem">l</span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">=</span> select <span class="main">(</span>tl <span class="skolem">l</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"select <span class="skolem">l</span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">=</span> select <span class="skolem">l</span> <span class="skolem">x</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tl <span class="skolem">l</span> <span class="main">=</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">head</span> <span class="skolem">tail</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"select <span class="skolem">l</span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">=</span> select <span class="skolem">tail</span> <span class="skolem">x</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tail</span> <span class="main">=</span> tl <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> select <span class="skolem">l</span> <span class="skolem">x</span> <span class="skolem">j</span> <span class="main">=</span> select <span class="bound">k</span> <span class="main">0</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">x</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> select <span class="main">(</span>tl <span class="skolem">l</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">=</span> select <span class="bound">k</span> <span class="main">0</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="skolem">x</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"tl <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> select <span class="skolem">l</span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">=</span> select <span class="bound">k</span> <span class="main">0</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">x</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> select <span class="skolem">l</span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">=</span> select <span class="bound">k</span> <span class="main">0</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> Suc <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="WordOperations-selectlenhelp3"><span class="command">lemma</span></span> selectlenhelp3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">.</span> select <span class="free">l</span> <span class="main">0</span> <span class="bound">j</span> <span class="main">=</span> selecthelp <span class="free">l</span> <span class="bound">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"select <span class="free">l</span> <span class="main">0</span> <span class="skolem">j</span> <span class="main">=</span> selecthelp <span class="free">l</span> <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main">=</span><span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"select <span class="free">l</span> <span class="main">0</span> <span class="skolem">j</span> <span class="main">=</span> selecthelp <span class="free">l</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"select <span class="free">l</span> <span class="main">0</span> <span class="skolem">j</span> <span class="main">=</span> selecthelp <span class="free">l</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="WordOperations-selectlen"><span class="command">lemma</span></span> selectlen<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>select <span class="free">l</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">j</span> <span class="main">-</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> selectlenhelp2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> select <span class="free">l</span> <span class="free">i</span> <span class="free">j</span> <span class="main">=</span> select <span class="bound">k</span> <span class="main">0</span> <span class="main">(</span><span class="free">j</span><span class="main">-</span><span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> length <span class="main">(</span>select <span class="free">l</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>select <span class="bound">k</span> <span class="main">0</span> <span class="main">(</span><span class="free">j</span><span class="main">-</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> length <span class="main">(</span>select <span class="free">l</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>selecthelp <span class="bound">k</span> <span class="main">(</span><span class="free">j</span><span class="main">-</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> selectlenhelp3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> c <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>select <span class="free">l</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>selecthelp <span class="skolem">k</span> <span class="main">(</span><span class="free">j</span><span class="main">-</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;=</span><span class="free">j</span><span class="main">-</span><span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>selecthelp <span class="skolem">k</span> <span class="main">(</span><span class="free">j</span><span class="main">-</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">j</span><span class="main">-</span><span class="free">i</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> selectlenhelp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>select <span class="free">l</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">j</span><span class="main">-</span><span class="free">i</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="WordOperations-addmod32len"><span class="command">lemma</span></span> addmod32len<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> length <span class="main">(</span>addmod32 <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">32</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> selectlen <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="numeral">31</span></span><span class="main">]</span> addmod32 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SHA1Padding">
<div class="head">
<h1>Theory SHA1Padding</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      RSAPSS/SHA1Padding.thy
    Author:     Christina Lindenberg, Kai Wirt, Technische Universität Darmstadt
    Copyright:  2005 - Technische Universität Darmstadt
*)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Message Padding for SHA1"</span></span>

<span class="keyword1"><span class="command">theory</span></span> SHA1Padding
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#WordOperations">WordOperations</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">zerocount</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  zerocount<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">zerocount</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">+</span> <span class="numeral">64</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">512</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">512</span><span class="main">)</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span> <span class="main">(</span><span class="numeral">65</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">helppadd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv <span class="main">⇒</span> nat <span class="main">⇒</span> bv"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">helppadd</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">@</span> <span class="main">[</span>One<span class="main">]</span> <span class="main">@</span> zerolist <span class="main">(</span>zerocount <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">@</span> zerolist <span class="main">(</span><span class="numeral">64</span> <span class="main">-</span> length <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">@</span><span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sha1padd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  sha1padd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sha1padd</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> helppadd <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>nat_to_bv <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SHA1">
<div class="head">
<h1>Theory SHA1</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      RSAPSS/SHA1.thy
    Author:     Christina Lindenberg, Kai Wirt, Technische Universität Darmstadt
    Copyright:  2005 - Technische Universität Darmstadt
*)</span>

<span class="keyword1"><span class="command">section</span></span>  <span class="quoted"><span class="plain_text">"Formal definition of the secure hash algorithm"</span></span>

<span class="keyword1"><span class="command">theory</span></span> SHA1
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#SHA1Padding">SHA1Padding</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define the secure hash algorithm SHA-1 and give a proof for the
  length of the message digest›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fif</span> <span class="keyword2"><span class="keyword">where</span></span>
  fif<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fif</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> bvor <span class="main">(</span>bvand <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">(</span>bvand <span class="main">(</span>bv_not <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fxor</span> <span class="keyword2"><span class="keyword">where</span></span>
  fxor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fxor</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> bvxor <span class="main">(</span>bvxor <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fmaj</span> <span class="keyword2"><span class="keyword">where</span></span>
  fmaj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fmaj</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> bvor <span class="main">(</span>bvor <span class="main">(</span>bvand <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">(</span>bvand <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>bvand <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fselect</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bit list <span class="main">⇒</span> bit list <span class="main">⇒</span> bit list <span class="main">⇒</span> bit list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  fselect<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fselect</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">&lt;</span> <span class="numeral">20</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>fif <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="keyword1">else</span> 
                        <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">&lt;</span> <span class="numeral">40</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>fxor <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="keyword1">else</span>
                          <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">&lt;</span> <span class="numeral">60</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>fmaj <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="keyword1">else</span>
                             <span class="main">(</span>fxor <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">K1</span> <span class="keyword2"><span class="keyword">where</span></span>
  K1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">K1</span> <span class="main">=</span> hexvtobv <span class="main">[</span>x5<span class="main">,</span>xA<span class="main">,</span>x8<span class="main">,</span>x2<span class="main">,</span>x7<span class="main">,</span>x9<span class="main">,</span>x9<span class="main">,</span>x9<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">K2</span> <span class="keyword2"><span class="keyword">where</span></span>
  K2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">K2</span> <span class="main">=</span> hexvtobv <span class="main">[</span>x6<span class="main">,</span>xE<span class="main">,</span>xD<span class="main">,</span>x9<span class="main">,</span>xE<span class="main">,</span>xB<span class="main">,</span>xA<span class="main">,</span>x1<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">K3</span> <span class="keyword2"><span class="keyword">where</span></span>
  K3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">K3</span> <span class="main">=</span> hexvtobv <span class="main">[</span>x8<span class="main">,</span>xF<span class="main">,</span>x1<span class="main">,</span>xB<span class="main">,</span>xB<span class="main">,</span>xC<span class="main">,</span>xD<span class="main">,</span>xC<span class="main">]</span>"</span></span>
 
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">K4</span> <span class="keyword2"><span class="keyword">where</span></span>
  K4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">K4</span> <span class="main">=</span> hexvtobv <span class="main">[</span>xC<span class="main">,</span>xA<span class="main">,</span>x6<span class="main">,</span>x2<span class="main">,</span>xC<span class="main">,</span>x1<span class="main">,</span>xD<span class="main">,</span>x6<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">kselect</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bit list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  kselect<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">kselect</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">&lt;</span> <span class="numeral">20</span><span class="main">)</span> <span class="keyword1">then</span> K1 <span class="keyword1">else</span> 
                    <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">&lt;</span> <span class="numeral">40</span><span class="main">)</span> <span class="keyword1">then</span> K2 <span class="keyword1">else</span>
                        <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">&lt;</span> <span class="numeral">60</span><span class="main">)</span> <span class="keyword1">then</span> K3 <span class="keyword1">else</span>
                            K4<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">getblock</span> <span class="keyword2"><span class="keyword">where</span></span>
  getblock<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">getblock</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> select <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span> <span class="numeral">511</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">delblockhelp</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">delblockhelp</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">delblockhelp</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&lt;=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="keyword1">else</span> <span class="free">delblockhelp</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">delblock</span> <span class="keyword2"><span class="keyword">where</span></span>
  delblock<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">delblock</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> delblockhelp <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="numeral">512</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">sha1compress</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sha1compress</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">79</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">in</span>
                                       <span class="main">(</span><span class="keyword1">let</span> <span class="bound">W</span> <span class="main">=</span> select <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span><span class="numeral">32</span><span class="main">*</span><span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="numeral">32</span><span class="main">*</span><span class="bound">j</span><span class="main">)</span><span class="main">+</span><span class="numeral">31</span><span class="main">)</span> <span class="keyword1">in</span> 
                                        <span class="main">(</span><span class="keyword1">let</span> <span class="bound">AA</span> <span class="main">=</span> addmod32 <span class="main">(</span>addmod32 <span class="main">(</span>addmod32 <span class="bound">W</span> <span class="main">(</span>bvrol <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="numeral">5</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fselect <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>addmod32 <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">(</span>kselect <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
                                             <span class="bound">BB</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">;</span>
                                             <span class="bound">CC</span> <span class="main">=</span> bvrol <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="numeral">30</span><span class="main">;</span>
                                             <span class="bound">DD</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">;</span>
                                             <span class="bound">EE</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="keyword1">in</span>
                                <span class="bound">AA</span><span class="main">@</span><span class="bound">BB</span><span class="main">@</span><span class="bound">CC</span><span class="main">@</span><span class="bound">DD</span><span class="main">@</span><span class="bound">EE</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sha1compress</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">79</span> <span class="main">-</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">in</span>
                                       <span class="main">(</span><span class="keyword1">let</span> <span class="bound">W</span> <span class="main">=</span> select <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span><span class="numeral">32</span><span class="main">*</span><span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="numeral">32</span><span class="main">*</span><span class="bound">j</span><span class="main">)</span><span class="main">+</span><span class="numeral">31</span><span class="main">)</span> <span class="keyword1">in</span> 
                                        <span class="main">(</span><span class="keyword1">let</span> <span class="bound">AA</span> <span class="main">=</span> addmod32 <span class="main">(</span>addmod32 <span class="main">(</span>addmod32 <span class="bound">W</span> <span class="main">(</span>bvrol <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="numeral">5</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fselect <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>addmod32 <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">(</span>kselect <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
                                             <span class="bound">BB</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">;</span>
                                             <span class="bound">CC</span> <span class="main">=</span> bvrol <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="numeral">30</span><span class="main">;</span>
                                             <span class="bound">DD</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">;</span>
                                             <span class="bound">EE</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="keyword1">in</span>
                               <span class="free">sha1compress</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">AA</span> <span class="bound">BB</span> <span class="bound">CC</span> <span class="bound">DD</span> <span class="bound">EE</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sha1expandhelp</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sha1expandhelp</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">79</span><span class="main">+</span><span class="numeral">16</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="keyword1">in</span> <span class="main">(</span>bvrol <span class="main">(</span>bvxor<span class="main">(</span>bvxor<span class="main">(</span>
    select <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="numeral">32</span><span class="main">*</span><span class="main">(</span><span class="bound">j</span><span class="main">-</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">31</span><span class="main">+</span><span class="main">(</span><span class="numeral">32</span><span class="main">*</span><span class="main">(</span><span class="bound">j</span><span class="main">-</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>select <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="numeral">32</span><span class="main">*</span><span class="main">(</span><span class="bound">j</span><span class="main">-</span><span class="main">(</span><span class="numeral">8</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">31</span><span class="main">+</span><span class="main">(</span><span class="numeral">32</span><span class="main">*</span><span class="main">(</span><span class="bound">j</span><span class="main">-</span><span class="main">(</span><span class="numeral">8</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>bvxor<span class="main">(</span>select <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="numeral">32</span><span class="main">*</span><span class="main">(</span><span class="bound">j</span><span class="main">-</span><span class="main">(</span><span class="numeral">14</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">31</span><span class="main">+</span><span class="main">(</span><span class="numeral">32</span><span class="main">*</span><span class="main">(</span><span class="bound">j</span><span class="main">-</span><span class="main">(</span><span class="numeral">14</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>select <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="numeral">32</span><span class="main">*</span><span class="main">(</span><span class="bound">j</span><span class="main">-</span><span class="main">(</span><span class="numeral">16</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">31</span><span class="main">+</span><span class="main">(</span><span class="numeral">32</span><span class="main">*</span><span class="main">(</span><span class="bound">j</span><span class="main">-</span><span class="main">(</span><span class="numeral">16</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sha1expand</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sha1expand</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> <span class="numeral">16</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">else</span>
     <span class="keyword1">let</span> <span class="bound">y</span> <span class="main">=</span> sha1expandhelp <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">in</span>
   <span class="free">sha1expand</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">@</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sha1compressstart</span> <span class="keyword2"><span class="keyword">where</span></span>
  sha1compressstart<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sha1compressstart</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">=</span> sha1compress <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span>sha1expand <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="numeral">79</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span>"</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="main">(</span>sequential<span class="main">)</span> <span class="entity">sha1block</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sha1block</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">H</span> <span class="main">=</span> sha1compressstart <span class="numeral">79</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">;</span>
                                   <span class="bound">AA</span> <span class="main">=</span> addmod32 <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>select <span class="bound">H</span> <span class="main">0</span> <span class="numeral">31</span><span class="main">)</span><span class="main">;</span>
                                   <span class="bound">BB</span> <span class="main">=</span> addmod32 <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">(</span>select <span class="bound">H</span> <span class="numeral">32</span> <span class="numeral">63</span><span class="main">)</span><span class="main">;</span>
                                   <span class="bound">CC</span> <span class="main">=</span> addmod32 <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">(</span>select <span class="bound">H</span> <span class="numeral">64</span> <span class="numeral">95</span><span class="main">)</span><span class="main">;</span>
                                   <span class="bound">DD</span> <span class="main">=</span> addmod32 <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">(</span>select <span class="bound">H</span> <span class="numeral">96</span> <span class="numeral">127</span><span class="main">)</span><span class="main">;</span>
                                   <span class="bound">EE</span> <span class="main">=</span> addmod32 <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">(</span>select <span class="bound">H</span> <span class="numeral">128</span> <span class="numeral">159</span><span class="main">)</span>
                               <span class="keyword1">in</span> <span class="bound">AA</span><span class="main">@</span><span class="bound">BB</span><span class="main">@</span><span class="bound">CC</span><span class="main">@</span><span class="bound">DD</span><span class="main">@</span><span class="bound">EE</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sha1block</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">=</span>  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">H</span> <span class="main">=</span> sha1compressstart <span class="numeral">79</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">;</span>
                                     <span class="bound">AA</span> <span class="main">=</span> addmod32 <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>select <span class="bound">H</span> <span class="main">0</span> <span class="numeral">31</span><span class="main">)</span><span class="main">;</span>
                                     <span class="bound">BB</span> <span class="main">=</span> addmod32 <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">(</span>select <span class="bound">H</span> <span class="numeral">32</span> <span class="numeral">63</span><span class="main">)</span><span class="main">;</span>
                                     <span class="bound">CC</span> <span class="main">=</span> addmod32 <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">(</span>select <span class="bound">H</span> <span class="numeral">64</span> <span class="numeral">95</span><span class="main">)</span><span class="main">;</span>
                                     <span class="bound">DD</span> <span class="main">=</span> addmod32 <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">(</span>select <span class="bound">H</span> <span class="numeral">96</span> <span class="numeral">127</span><span class="main">)</span><span class="main">;</span>
                                     <span class="bound">EE</span> <span class="main">=</span> addmod32 <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">(</span>select <span class="bound">H</span> <span class="numeral">128</span> <span class="numeral">159</span><span class="main">)</span>
                               <span class="keyword1">in</span> <span class="free">sha1block</span> <span class="main">(</span>getblock <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>delblock <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="bound">AA</span> <span class="bound">BB</span> <span class="bound">CC</span> <span class="bound">DD</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">xs</span> <span class="main">::</span> bit list<span class="main">.</span> length <span class="main">(</span>delblockhelp <span class="bound">xs</span> <span class="bound">n</span><span class="main">)</span> <span class="main">&lt;=</span> length <span class="bound">xs</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bit list"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>delblockhelp <span class="skolem">xs</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> length <span class="skolem">xs</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> delblockhelp.induct<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">xs</span> <span class="main">::</span> bit list<span class="main">.</span> length <span class="main">(</span>delblock <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="bound">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bit list"</span></span>
    <span class="keyword1"><span class="command">from</span></span> aux <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>delblockhelp <span class="skolem">xs</span> <span class="numeral">511</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_less_trans <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>delblockhelp <span class="skolem">xs</span> <span class="numeral">511</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>delblock <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delblock<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">x</span><span class="main">,</span> <span class="bound">A</span><span class="main">,</span> <span class="bound">B</span><span class="main">,</span> <span class="bound">C</span><span class="main">,</span> <span class="bound">D</span><span class="main">,</span> <span class="bound">E</span><span class="main">)</span><span class="main">.</span> length <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">IV1</span> <span class="keyword2"><span class="keyword">where</span></span>
  IV1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">IV1</span> <span class="main">=</span> hexvtobv <span class="main">[</span>x6<span class="main">,</span>x7<span class="main">,</span>x4<span class="main">,</span>x5<span class="main">,</span>x2<span class="main">,</span>x3<span class="main">,</span>x0<span class="main">,</span>x1<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">IV2</span> <span class="keyword2"><span class="keyword">where</span></span>
  IV2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">IV2</span> <span class="main">=</span> hexvtobv <span class="main">[</span>xE<span class="main">,</span>xF<span class="main">,</span>xC<span class="main">,</span>xD<span class="main">,</span>xA<span class="main">,</span>xB<span class="main">,</span>x8<span class="main">,</span>x9<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">IV3</span> <span class="keyword2"><span class="keyword">where</span></span>
  IV3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">IV3</span> <span class="main">=</span> hexvtobv <span class="main">[</span>x9<span class="main">,</span>x8<span class="main">,</span>xB<span class="main">,</span>xA<span class="main">,</span>xD<span class="main">,</span>xC<span class="main">,</span>xF<span class="main">,</span>xE<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">IV4</span> <span class="keyword2"><span class="keyword">where</span></span>
  IV4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">IV4</span> <span class="main">=</span> hexvtobv <span class="main">[</span>x1<span class="main">,</span>x0<span class="main">,</span>x3<span class="main">,</span>x2<span class="main">,</span>x5<span class="main">,</span>x4<span class="main">,</span>x7<span class="main">,</span>x6<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">IV5</span> <span class="keyword2"><span class="keyword">where</span></span>
  IV5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">IV5</span> <span class="main">=</span> hexvtobv <span class="main">[</span>xC<span class="main">,</span>x3<span class="main">,</span>xD<span class="main">,</span>x2<span class="main">,</span>xE<span class="main">,</span>x1<span class="main">,</span>xF<span class="main">,</span>x0<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sha1</span> <span class="keyword2"><span class="keyword">where</span></span>
  sha1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sha1</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">y</span> <span class="main">=</span> sha1padd <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">in</span>
  sha1block <span class="main">(</span>getblock <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>delblock <span class="bound">y</span><span class="main">)</span> IV1 IV2 IV3 IV4 IV5<span class="main">)</span>"</span></span>


<span class="keyword1" id="SHA1-sha1blocklen"><span class="command">lemma</span></span> sha1blocklen<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>sha1block <span class="free">b</span> <span class="free">x</span> <span class="free">A</span> <span class="free">B</span> <span class="free">C</span> <span class="free">D</span> <span class="free">E</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">160</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">D</span></span> <span class="quoted"><span class="free">E</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sha1block.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def addmod32len<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SHA1-sha1len"><span class="command">lemma</span></span> sha1len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">160</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sha1 Let_def sha1blocklen <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Wordarith">
<div class="head">
<h1>Theory Wordarith</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      RSAPSS/Wordarith.thy
    Author:     Christina Lindenberg, Kai Wirt, Technische Universität Darmstadt
    Copyright:  2005 - Technische Universität Darmstadt
*)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Extensions to the Word theory required for PSS"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Wordarith
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#WordOperations">WordOperations</a> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Computational_Algebra/Primes.html">HOL-Computational_Algebra.Primes</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">nat_to_bv_length</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span>  bv"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="comment1">(* nat_to_bv_length converts nat (if 0 ≤ nat ∧ nat &lt; 2^nat) nato a bit string of length l *)</span>
  nat_to_bv_length<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">nat_to_bv_length</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> length<span class="main">(</span>nat_to_bv <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">then</span> bv_extend <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">𝟬</span> <span class="main">(</span>nat_to_bv <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span>"</span></span>


<span class="keyword1" id="Wordarith-length_nat_to_bv_length"><span class="command">lemma</span></span> length_nat_to_bv_length<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nat_to_bv_length <span class="free">x</span> <span class="free">y</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> length <span class="main">(</span>nat_to_bv_length <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nat_to_bv_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Wordarith-bv_to_nat_nat_to_bv_length"><span class="command">lemma</span></span> bv_to_nat_nat_to_bv_length<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nat_to_bv_length <span class="free">x</span> <span class="free">y</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> bv_to_nat <span class="main">(</span>nat_to_bv_length <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nat_to_bv_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">roundup</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  roundup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">roundup</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>


<span class="keyword1" id="Wordarith-rnddvd"><span class="command">lemma</span></span> rnddvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">⟹</span> roundup <span class="free">a</span> <span class="free">b</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> roundup dvd_eq_mod_eq_0<span class="main">)</span>

<span class="keyword1" id="Wordarith-bv_to_nat_zero_prepend"><span class="command">lemma</span></span> bv_to_nat_zero_prepend<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="free">a</span> <span class="main">=</span> bv_to_nat <span class="main">(</span><span class="main">𝟬</span><span class="main">#</span><span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">remzero</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">remzero</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">remzero</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">𝟭</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">remzero</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Wordarith-remzeroeq"><span class="command">lemma</span></span> remzeroeq<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="free">a</span> <span class="main">=</span> bv_to_nat <span class="main">(</span>remzero <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="main">[]</span> <span class="main">=</span> bv_to_nat <span class="main">(</span>remzero <span class="main">[]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a1</span> <span class="skolem">a2</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="skolem">a2</span> <span class="main">=</span> bv_to_nat <span class="main">(</span>remzero <span class="skolem">a2</span><span class="main">)</span> <span class="main">⟹</span>
       bv_to_nat <span class="main">(</span><span class="skolem">a1</span> <span class="main">#</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">=</span> bv_to_nat <span class="main">(</span>remzero <span class="main">(</span><span class="skolem">a1</span> <span class="main">#</span> <span class="skolem">a2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a1</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span><span class="main">=</span><span class="main">𝟬</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="main">(</span><span class="skolem">a1</span><span class="main">#</span><span class="skolem">a2</span><span class="main">)</span> <span class="main">=</span> bv_to_nat <span class="skolem">a2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bv_to_nat_zero_prepend <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"remzero <span class="main">(</span><span class="skolem">a1</span> <span class="main">#</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">=</span> remzero <span class="skolem">a2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span><span class="main">=</span><span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wordarith-len_nat_to_bv_pos"><span class="command">lemma</span></span> len_nat_to_bv_pos<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span> length <span class="main">(</span>nat_to_bv <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"nat_to_bv <span class="free">a</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="main">(</span>nat_to_bv <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword2"><span class="keyword">and</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="main">(</span>nat_to_bv <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> d <span class="keyword2"><span class="keyword">and</span></span> c <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wordarith-remzero_replicate"><span class="command">lemma</span></span> remzero_replicate<span class="main">:</span> <span class="quoted"><span class="quoted">"remzero <span class="main">(</span><span class="main">(</span>replicate <span class="free">n</span> <span class="main">𝟬</span><span class="main">)</span><span class="main">@</span><span class="free">l</span><span class="main">)</span> <span class="main">=</span> remzero <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Wordarith-length_bvxor_bound"><span class="command">lemma</span></span> length_bvxor_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;=</span> length <span class="free">l</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">&lt;=</span> length <span class="main">(</span>bvxor <span class="free">l</span> <span class="free">l2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">a</span> <span class="main">≤</span> length <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">with</span></span> Suc.hyps <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> length <span class="main">(</span>bvxor <span class="free">l</span> <span class="free">l2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">a</span> <span class="main">≤</span> length <span class="main">(</span>bvxor <span class="free">l</span> <span class="free">l2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> length <span class="main">(</span>bvxor <span class="free">l</span> <span class="free">l2</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">a</span> <span class="main">≤</span> length <span class="main">(</span>bvxor <span class="free">l</span> <span class="free">l2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bvxor<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">l</span> <span class="main">&lt;=</span> max <span class="main">(</span>length <span class="free">l</span><span class="main">)</span> <span class="main">(</span>length <span class="free">l2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">a</span> <span class="main">≤</span> max <span class="main">(</span>length <span class="free">l</span><span class="main">)</span> <span class="main">(</span>length <span class="free">l2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> length <span class="main">(</span>bvxor <span class="free">l</span> <span class="free">l2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> length <span class="main">(</span>bvxor <span class="free">l</span> <span class="free">l2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wordarith-nat_to_bv_helper_legacy_induct"><span class="command">lemma</span></span> nat_to_bv_helper_legacy_induct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> atomize_imp<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction_schema</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">lexicographic_order</span><span class="main">)</span>

<span class="keyword1" id="Wordarith-len_lower_bound"><span class="command">lemma</span></span> len_lower_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">&lt;</span><span class="free">n</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> l1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">&lt;</span><span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_to_bv_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_to_bv_helper_legacy_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="skolem">n</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span>Suc <span class="main">0</span><span class="main">&lt;</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="numeral">2</span> <span class="main">∨</span> <span class="skolem">n</span><span class="main">=</span><span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&lt;=</span><span class="numeral">3</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&lt;=</span><span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="numeral">2</span> <span class="main">∨</span> <span class="skolem">n</span><span class="main">=</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="skolem">n</span><span class="main">&lt;=</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="numeral">2</span> <span class="main">∨</span> <span class="skolem">n</span><span class="main">=</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv_helper <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="numeral">2</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_to_bv_helper <span class="skolem">n</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[</span><span class="main">𝟭</span><span class="main">,</span> <span class="main">𝟬</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_to_bv_helper <span class="skolem">n</span> <span class="main">[]</span> <span class="main">=</span> nat_to_bv <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_to_bv_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_to_bv_non0<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv_helper <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="numeral">2</span> <span class="main">∨</span> <span class="skolem">n</span><span class="main">=</span><span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">~=</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_to_bv_helper <span class="skolem">n</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[</span><span class="main">𝟭</span><span class="main">,</span> <span class="main">𝟭</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_to_bv_helper <span class="skolem">n</span> <span class="main">[]</span> <span class="main">=</span> nat_to_bv <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_to_bv_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_to_bv_non0<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span>length <span class="main">(</span>nat_to_bv_helper <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;=</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv_helper <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv_helper <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span>
      <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>length <span class="main">(</span>nat_to_bv_helper <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>nat_to_bv <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_to_bv_non0<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_to_bv_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span>length <span class="main">(</span>nat_to_bv_helper <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span>
      <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>length <span class="main">(</span>nat_to_bv_helper <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span>length <span class="main">(</span>nat_to_bv_helper <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span> <span class="main">-</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">*</span><span class="numeral">2</span> <span class="main">=</span>
        <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>length <span class="main">(</span>nat_to_bv_helper <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span>length <span class="main">(</span>nat_to_bv_helper <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span>
        <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>length <span class="main">(</span>nat_to_bv_helper <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_to_bv_non0<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span> length <span class="main">(</span>nat_to_bv_helper <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_to_bv_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">^</span> length <span class="main">(</span>nat_to_bv_helper <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span>
        <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv_helper <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv_helper <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;=</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_to_bv_def<span class="main">)</span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">1</span><span class="main">&lt;</span><span class="free">n</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">=</span><span class="main">1</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_to_bv <span class="free">n</span> <span class="main">=</span> <span class="main">[</span><span class="main">𝟭</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_to_bv_non0<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">~=</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="free">n</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wordarith-length_lower"><span class="command">lemma</span></span> length_lower<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">a</span> <span class="main">&lt;</span> length <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="main">~=</span> <span class="main">𝟬</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="free">a</span> <span class="main">&lt;</span> bv_to_nat <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ha<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="free">a</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span>length <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_to_nat_upper_range<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">~=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">=</span><span class="main">(</span>hd <span class="free">b</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>tl <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="free">b</span> <span class="main">=</span> bitval <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>length <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> bv_to_nat <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bv_to_nat_helper<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"tl <span class="free">b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bitval <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span> <span class="main">=</span> <span class="main">𝟬</span> "</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"bitval <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bitval <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> hb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span>length <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span> <span class="main">&lt;=</span> bv_to_nat <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span>length <span class="free">a</span><span class="main">)</span> <span class="main">&lt;=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span>length <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hb <span class="keyword2"><span class="keyword">and</span></span> ha <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wordarith-nat_to_bv_non_empty"><span class="command">lemma</span></span> nat_to_bv_non_empty<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nat_to_bv <span class="free">n</span> <span class="main">~=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> nat_to_bv_non0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> nat_to_bv <span class="free">n</span> <span class="main">=</span> <span class="bound">x</span><span class="main">@</span><span class="main">[</span><span class="keyword1">if</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">𝟬</span> <span class="keyword1">else</span> <span class="main">𝟭</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wordarith-hd_append"><span class="command">lemma</span></span> hd_append<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">~=</span> <span class="main">[]</span> <span class="main">⟹</span> hd <span class="main">(</span><span class="free">x</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> hd <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Wordarith-hd_one"><span class="command">lemma</span></span> hd_one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="free">n</span> <span class="main">⟹</span> hd <span class="main">(</span>nat_to_bv_helper <span class="free">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_to_bv_helper_legacy_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">⟶</span> hd <span class="main">(</span>nat_to_bv_helper <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>nat_to_bv_helper <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">⟶</span> hd <span class="main">(</span>nat_to_bv_helper <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>nat_to_bv_helper <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>nat_to_bv_helper <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span>
        hd <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="keyword1">if</span> <span class="skolem">n</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">𝟬</span> <span class="keyword1">else</span> <span class="main">𝟭</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nat_to_bv_def <span class="keyword2"><span class="keyword">and</span></span> nat_to_bv_non0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>nat_to_bv_helper <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span>
        hd <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nat_to_bv_non0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> c <span class="keyword2"><span class="keyword">and</span></span>
        nat_to_bv_non_empty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> hd_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">" nat_to_bv <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>nat_to_bv_helper <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span>nat_to_bv_helper <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nat_to_bv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>nat_to_bv_helper <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword2"><span class="keyword">and</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_to_bv_helper <span class="main">1</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[</span><span class="main">𝟭</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_to_bv_helper.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>nat_to_bv_helper <span class="skolem">n</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wordarith-prime_hd_non_zero"><span class="command">lemma</span></span> prime_hd_non_zero<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">~=</span> <span class="main">𝟬</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a b mult_is_0 neq0_conv not_prime_0<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hd_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> nat_to_bv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wordarith-primerew"><span class="command">lemma</span></span> primerew<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">m</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">;</span> <span class="free">m</span><span class="main">~=</span><span class="main">1</span><span class="main">;</span> <span class="free">m</span><span class="main">~=</span><span class="free">p</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">~</span> prime <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_nat_iff<span class="main">)</span>


<span class="keyword1" id="Wordarith-two_dvd_exp"><span class="command">lemma</span></span> two_dvd_exp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">dvd</span> <span class="numeral">2</span><span class="main">^</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Wordarith-exp_prod1"><span class="command">lemma</span></span> exp_prod1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">1</span><span class="main">&lt;</span><span class="free">b</span><span class="main">;</span><span class="numeral">2</span><span class="main">^</span><span class="free">x</span><span class="main">=</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="free">b</span><span class="main">::</span>nat<span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">x</span><span class="main">=</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="free">b</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">&lt;</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">&lt;</span><span class="free">x</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">&lt;</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">x</span> <span class="main">&lt;=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b
   <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">x</span> <span class="main">&lt;=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">~=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">x</span> <span class="main">&lt;=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">&lt;=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> s2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">x</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> s1 b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">-</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">x</span><span class="main">-</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">x</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> s1 <span class="keyword2"><span class="keyword">and</span></span> s2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> two_dvd_exp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wordarith-exp_prod2"><span class="command">lemma</span></span> exp_prod2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">1</span><span class="main">&lt;</span><span class="free">a</span><span class="main">;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">x</span><span class="main">=</span><span class="free">a</span><span class="main">*</span><span class="numeral">2</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">x</span><span class="main">=</span><span class="free">a</span><span class="main">*</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">x</span><span class="main">=</span><span class="numeral">2</span><span class="main">*</span><span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">&lt;</span><span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> exp_prod1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wordarith-odd_mul_odd"><span class="command">lemma</span></span> odd_mul_odd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">~</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">;</span> <span class="main">~</span><span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">~</span><span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Wordarith-prime_equal"><span class="command">lemma</span></span> prime_equal<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>prime <span class="free">p</span><span class="main">;</span> prime <span class="free">q</span><span class="main">;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">x</span><span class="main">=</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">p</span><span class="main">=</span><span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">x</span><span class="main">=</span><span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_nat_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> b <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">&lt;</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_nat_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="numeral">2</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c <span class="keyword2"><span class="keyword">and</span></span> exp_prod1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> e <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">=</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> primerew<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">~=</span><span class="numeral">2</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">=</span><span class="numeral">2</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c <span class="keyword2"><span class="keyword">and</span></span> exp_prod1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">=</span><span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> primerew<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">~=</span><span class="numeral">2</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="free">q</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span> <span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> primerew <span class="keyword2"><span class="keyword">and</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> primerew <span class="keyword2"><span class="keyword">and</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> odd_mul_odd<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">::</span> nat<span class="main">)</span> <span class="main">^</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> c<span class="main">)</span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">dvd</span> <span class="numeral">2</span><span class="main">^</span><span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">x</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c <span class="keyword2"><span class="keyword">and</span></span> d <span class="keyword2"><span class="keyword">and</span></span> e <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">~=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> two_dvd_exp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Wordarith-nat_to_bv_length_bv_to_nat"><span class="command">lemma</span></span> nat_to_bv_length_bv_to_nat<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> nat_to_bv_length <span class="main">(</span>bv_to_nat <span class="free">xs</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> nat_to_bv_length<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_extend_norm_unsigned<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="EMSAPSS">
<div class="head">
<h1>Theory EMSAPSS</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      RSAPSS/EMSAPSS.thy
    Author:     Christina Lindenberg, Kai Wirt, Technische Universität Darmstadt
    Copyright:  2005 - Technische Universität Darmstadt 
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"EMSA-PSS encoding and decoding operation"</span></span> 

<span class="keyword1"><span class="command">theory</span></span> EMSAPSS 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#SHA1">SHA1</a> <a href="#Wordarith">Wordarith</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define the encoding and decoding operations for the probabilistic
 signature scheme. Finally we show, that encoded messages always can be 
 verified›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">show_rightmost_bits</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> nat <span class="main">⇒</span> bv"</span></span> <span class="comment1">(* extract n rightmost bits of a bit string*)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">show_rightmost_bits</span> <span class="free"><span class="bound"><span class="entity">bvec</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> rev <span class="main">(</span>take <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>rev <span class="free"><span class="bound"><span class="entity">bvec</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">BC</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv"</span></span> <span class="comment1">(* 0xbc *)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">BC</span> <span class="main">=</span> <span class="main">[</span>One<span class="main">,</span> Zero<span class="main">,</span> One<span class="main">,</span> One<span class="main">,</span> One<span class="main">,</span> One<span class="main">,</span> Zero<span class="main">,</span> Zero<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">salt</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">salt</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sLen</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat"</span></span> <span class="comment1">(* length of salt *)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sLen</span> <span class="main">=</span> length salt"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">generate_M'</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv <span class="main">⇒</span> bv"</span></span> <span class="comment1">(* generate_M' outputs "M'" a bit string of length "64 + length(sha1 _ ) + sLen" with 64 initial zero bits *)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">generate_M'</span> <span class="free"><span class="bound"><span class="entity">mHash</span></span></span> <span class="free"><span class="bound"><span class="entity">salt_new</span></span></span> <span class="main">=</span> bv_prepend <span class="numeral">64</span> <span class="main">𝟬</span> <span class="main">[]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">mHash</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">salt_new</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">generate_PS</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> bv"</span></span> <span class="comment1">(* generate_PS outputs "PS" a bit string consisting of "nat (roundup emBits 8) * 8 - sLen - length (sha1 _ ) - 16" zero bits *)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">generate_PS</span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="free"><span class="bound"><span class="entity">hLen</span></span></span> <span class="main">=</span> bv_prepend <span class="main">(</span><span class="main">(</span>roundup <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="numeral">8</span><span class="main">)</span><span class="main">*</span><span class="numeral">8</span> <span class="main">-</span> sLen <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">hLen</span></span></span> <span class="main">-</span> <span class="numeral">16</span><span class="main">)</span> <span class="main">𝟬</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">generate_DB</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv"</span></span> <span class="comment1">(* generate_DB outputs the bit string DB="PS#(0x01)#salt" of length "nat (roundup emBits 8) * 8 - length (sha1 _ ) - 8" *)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">generate_DB</span> <span class="free"><span class="bound"><span class="entity">PS</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">PS</span></span></span> <span class="main">@</span> <span class="main">[</span>Zero<span class="main">,</span> Zero<span class="main">,</span> Zero<span class="main">,</span> Zero<span class="main">,</span> Zero<span class="main">,</span> Zero<span class="main">,</span> Zero<span class="main">,</span> One<span class="main">]</span> <span class="main">@</span> salt"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">maskedDB_zero</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> nat <span class="main">⇒</span> bv"</span></span> <span class="comment1">(* sets "roundup emBits 8 * 8 - emBits" bits of maskedDB to zero *)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">maskedDB_zero</span> <span class="free"><span class="bound"><span class="entity">maskedDB</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="main">=</span> bv_prepend <span class="main">(</span><span class="main">(</span>roundup <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="numeral">8</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span><span class="main">)</span>  <span class="main">𝟬</span> <span class="main">(</span>drop <span class="main">(</span><span class="main">(</span>roundup <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="numeral">8</span><span class="main">)</span><span class="main">*</span><span class="numeral">8</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">maskedDB</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">generate_H</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> bv"</span></span> <span class="comment1">(* generate_H returns a bit string of length (sha1 _) *)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">generate_H</span> <span class="free"><span class="bound"><span class="entity">EM</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="free"><span class="bound"><span class="entity">hLen</span></span></span> <span class="main">=</span> take <span class="free"><span class="bound"><span class="entity">hLen</span></span></span> <span class="main">(</span>drop <span class="main">(</span><span class="main">(</span>roundup <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="numeral">8</span><span class="main">)</span><span class="main">*</span><span class="numeral">8</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">hLen</span></span></span> <span class="main">-</span> <span class="numeral">8</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">EM</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">generate_maskedDB</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> bv "</span></span> <span class="comment1">(* outputs a bit string of length "nat (roundup emBits 8) * 8 - length (sha1 _) - 8" *)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">generate_maskedDB</span> <span class="free"><span class="bound"><span class="entity">EM</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="free"><span class="bound"><span class="entity">hLen</span></span></span> <span class="main">=</span> take <span class="main">(</span><span class="main">(</span>roundup <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="numeral">8</span><span class="main">)</span><span class="main">*</span><span class="numeral">8</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">hLen</span></span></span> <span class="main">-</span> <span class="numeral">8</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">EM</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">generate_salt</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv"</span></span> <span class="comment1">(* outputs a bit string of length sLen *)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">generate_salt</span> <span class="free"><span class="bound"><span class="entity">DB_zero</span></span></span> <span class="main">=</span> show_rightmost_bits <span class="free"><span class="bound"><span class="entity">DB_zero</span></span></span> sLen"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">MGF2</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> nat <span class="main">⇒</span> bv"</span></span> <span class="comment1">(* help function for MGF1 *)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">MGF2</span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span> <span class="main">0</span> <span class="main">=</span> sha1 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Z</span></span></span><span class="main">@</span><span class="main">(</span>nat_to_bv_length <span class="main">0</span> <span class="numeral">32</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">MGF2</span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">MGF2</span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">@</span><span class="main">(</span>sha1 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Z</span></span></span><span class="main">@</span><span class="main">(</span>nat_to_bv_length <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="numeral">32</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">MGF1</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> bv"</span></span> <span class="comment1">(* help function for MGF *)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">MGF1</span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> take <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">(</span>MGF2 <span class="free"><span class="bound"><span class="entity">Z</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">MGF</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> nat <span class="main">⇒</span> bv"</span></span> <span class="comment1">(* mask generation function *)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">MGF</span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">32</span><span class="main">*</span><span class="main">(</span>length <span class="main">(</span>sha1 <span class="free"><span class="bound"><span class="entity">Z</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span>
              <span class="keyword1">then</span> <span class="main">[]</span>
              <span class="keyword1">else</span> MGF1 <span class="free"><span class="bound"><span class="entity">Z</span></span></span> <span class="main">(</span> roundup <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">(</span>length <span class="main">(</span>sha1 <span class="free"><span class="bound"><span class="entity">Z</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="main">-</span> <span class="main">1</span> <span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emsapss_encode_help8</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv <span class="main">⇒</span> bv"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emsapss_encode_help8</span> <span class="free"><span class="bound"><span class="entity">DBzero</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">DBzero</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">@</span> BC"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emsapss_encode_help7</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv <span class="main">⇒</span> nat <span class="main">⇒</span> bv"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emsapss_encode_help7</span> <span class="free"><span class="bound"><span class="entity">maskedDB</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="main">=</span>
    emsapss_encode_help8 <span class="main">(</span>maskedDB_zero <span class="free"><span class="bound"><span class="entity">maskedDB</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emsapss_encode_help6</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv <span class="main">⇒</span> bv <span class="main">⇒</span> nat <span class="main">⇒</span> bv"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emsapss_encode_help6</span> <span class="free"><span class="bound"><span class="entity">DB</span></span></span> <span class="free"><span class="bound"><span class="entity">dbMask</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">dbMask</span></span></span> <span class="main">=</span> <span class="main">[]</span>
     <span class="keyword1">then</span> <span class="main">[]</span>
     <span class="keyword1">else</span> emsapss_encode_help7 <span class="main">(</span>bvxor <span class="free"><span class="bound"><span class="entity">DB</span></span></span> <span class="free"><span class="bound"><span class="entity">dbMask</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emsapss_encode_help5</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv <span class="main">⇒</span> nat <span class="main">⇒</span> bv"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emsapss_encode_help5</span> <span class="free"><span class="bound"><span class="entity">DB</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="main">=</span>
    emsapss_encode_help6 <span class="free"><span class="bound"><span class="entity">DB</span></span></span> <span class="main">(</span>MGF <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">DB</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emsapss_encode_help4</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv <span class="main">⇒</span> nat <span class="main">⇒</span> bv"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emsapss_encode_help4</span> <span class="free"><span class="bound"><span class="entity">PS</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="main">=</span>
    emsapss_encode_help5 <span class="main">(</span>generate_DB <span class="free"><span class="bound"><span class="entity">PS</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emsapss_encode_help3</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> nat <span class="main">⇒</span> bv"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emsapss_encode_help3</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="main">=</span>
    emsapss_encode_help4 <span class="main">(</span>generate_PS <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emsapss_encode_help2</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> nat <span class="main">⇒</span> bv"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emsapss_encode_help2</span> <span class="free"><span class="bound"><span class="entity">M'</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="main">=</span> emsapss_encode_help3 <span class="main">(</span>sha1 <span class="free"><span class="bound"><span class="entity">M'</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emsapss_encode_help1</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> nat <span class="main">⇒</span> bv"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emsapss_encode_help1</span> <span class="free"><span class="bound"><span class="entity">mHash</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span>  <span class="main">&lt;</span> length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">mHash</span></span></span><span class="main">)</span> <span class="main">+</span> sLen <span class="main">+</span> <span class="numeral">16</span>
     <span class="keyword1">then</span> <span class="main">[]</span>
     <span class="keyword1">else</span> emsapss_encode_help2 <span class="main">(</span>generate_M' <span class="free"><span class="bound"><span class="entity">mHash</span></span></span> salt<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emsapss_encode</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> nat <span class="main">⇒</span> bv"</span></span> <span class="comment1">(* outputs the encoded message of length emBits *)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emsapss_encode</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">64</span> <span class="main">≤</span> length <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">∨</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">32</span> <span class="main">*</span> <span class="numeral">160</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span><span class="main">)</span>
     <span class="keyword1">then</span> <span class="main">[]</span>
     <span class="keyword1">else</span> emsapss_encode_help1 <span class="main">(</span>sha1 <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emsapss_decode_help11</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emsapss_decode_help11</span> <span class="free"><span class="bound"><span class="entity">H'</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">H'</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="keyword1">then</span> False <span class="keyword1">else</span> True<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emsapss_decode_help10</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emsapss_decode_help10</span> <span class="free"><span class="bound"><span class="entity">M'</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> emsapss_decode_help11 <span class="main">(</span>sha1 <span class="free"><span class="bound"><span class="entity">M'</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emsapss_decode_help9</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv <span class="main">⇒</span> bv <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emsapss_decode_help9</span> <span class="free"><span class="bound"><span class="entity">mHash</span></span></span> <span class="free"><span class="bound"><span class="entity">salt_new</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span>
    emsapss_decode_help10 <span class="main">(</span>generate_M' <span class="free"><span class="bound"><span class="entity">mHash</span></span></span> <span class="free"><span class="bound"><span class="entity">salt_new</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emsapss_decode_help8</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv <span class="main">⇒</span> bv <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emsapss_decode_help8</span> <span class="free"><span class="bound"><span class="entity">mHash</span></span></span> <span class="free"><span class="bound"><span class="entity">DB_zero</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span>
    emsapss_decode_help9 <span class="free"><span class="bound"><span class="entity">mHash</span></span></span> <span class="main">(</span>generate_salt <span class="free"><span class="bound"><span class="entity">DB_zero</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emsapss_decode_help7</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv <span class="main">⇒</span> bv <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emsapss_decode_help7</span> <span class="free"><span class="bound"><span class="entity">mHash</span></span></span> <span class="free"><span class="bound"><span class="entity">DB_zero</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="main">=</span>
   <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>take <span class="main">(</span> <span class="main">(</span>roundup <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="numeral">8</span><span class="main">)</span><span class="main">*</span><span class="numeral">8</span> <span class="main">-</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">mHash</span></span></span><span class="main">)</span> <span class="main">-</span> sLen <span class="main">-</span> <span class="numeral">16</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">DB_zero</span></span></span> <span class="main">≠</span> bv_prepend <span class="main">(</span> <span class="main">(</span>roundup <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="numeral">8</span><span class="main">)</span><span class="main">*</span><span class="numeral">8</span> <span class="main">-</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">mHash</span></span></span><span class="main">)</span> <span class="main">-</span> sLen <span class="main">-</span> <span class="numeral">16</span><span class="main">)</span> <span class="main">𝟬</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>take <span class="numeral">8</span> <span class="main">(</span> drop <span class="main">(</span><span class="main">(</span>roundup <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="numeral">8</span><span class="main">)</span><span class="main">*</span><span class="numeral">8</span> <span class="main">-</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">mHash</span></span></span><span class="main">)</span> <span class="main">-</span> sLen <span class="main">-</span> <span class="numeral">16</span> <span class="main">)</span> <span class="free"><span class="bound"><span class="entity">DB_zero</span></span></span> <span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>Zero<span class="main">,</span> Zero<span class="main">,</span> Zero<span class="main">,</span> Zero<span class="main">,</span> Zero<span class="main">,</span> Zero<span class="main">,</span> Zero<span class="main">,</span> One<span class="main">]</span><span class="main">)</span>
    <span class="keyword1">then</span> False
    <span class="keyword1">else</span> emsapss_decode_help8 <span class="free"><span class="bound"><span class="entity">mHash</span></span></span> <span class="free"><span class="bound"><span class="entity">DB_zero</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emsapss_decode_help6</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv <span class="main">⇒</span> bv <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emsapss_decode_help6</span> <span class="free"><span class="bound"><span class="entity">mHash</span></span></span> <span class="free"><span class="bound"><span class="entity">DB</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="main">=</span>
    emsapss_decode_help7 <span class="free"><span class="bound"><span class="entity">mHash</span></span></span> <span class="main">(</span>maskedDB_zero <span class="free"><span class="bound"><span class="entity">DB</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emsapss_decode_help5</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv <span class="main">⇒</span> bv <span class="main">⇒</span> bv <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emsapss_decode_help5</span> <span class="free"><span class="bound"><span class="entity">mHash</span></span></span> <span class="free"><span class="bound"><span class="entity">maskedDB</span></span></span> <span class="free"><span class="bound"><span class="entity">dbMask</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="main">=</span>
    emsapss_decode_help6 <span class="free"><span class="bound"><span class="entity">mHash</span></span></span> <span class="main">(</span>bvxor <span class="free"><span class="bound"><span class="entity">maskedDB</span></span></span> <span class="free"><span class="bound"><span class="entity">dbMask</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emsapss_decode_help4</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv <span class="main">⇒</span> bv <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emsapss_decode_help4</span> <span class="free"><span class="bound"><span class="entity">mHash</span></span></span> <span class="free"><span class="bound"><span class="entity">maskedDB</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="main">=</span>
   <span class="main">(</span><span class="keyword1">if</span> take <span class="main">(</span><span class="main">(</span>roundup <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="numeral">8</span><span class="main">)</span><span class="main">*</span><span class="numeral">8</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">maskedDB</span></span></span> <span class="main">≠</span> bv_prepend <span class="main">(</span><span class="main">(</span>roundup <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="numeral">8</span><span class="main">)</span><span class="main">*</span><span class="numeral">8</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span><span class="main">)</span> <span class="main">𝟬</span> <span class="main">[]</span>
    <span class="keyword1">then</span> False
    <span class="keyword1">else</span> emsapss_decode_help5 <span class="free"><span class="bound"><span class="entity">mHash</span></span></span> <span class="free"><span class="bound"><span class="entity">maskedDB</span></span></span> <span class="main">(</span>MGF <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">(</span><span class="main">(</span>roundup <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="numeral">8</span><span class="main">)</span><span class="main">*</span><span class="numeral">8</span> <span class="main">-</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">mHash</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="numeral">8</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emsapss_decode_help3</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emsapss_decode_help3</span> <span class="free"><span class="bound"><span class="entity">mHash</span></span></span> <span class="free"><span class="bound"><span class="entity">EM</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="main">=</span>
    emsapss_decode_help4 <span class="free"><span class="bound"><span class="entity">mHash</span></span></span> <span class="main">(</span>generate_maskedDB <span class="free"><span class="bound"><span class="entity">EM</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">mHash</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>generate_H <span class="free"><span class="bound"><span class="entity">EM</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">mHash</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emsapss_decode_help2</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emsapss_decode_help2</span> <span class="free"><span class="bound"><span class="entity">mHash</span></span></span> <span class="free"><span class="bound"><span class="entity">EM</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="main">=</span>
   <span class="main">(</span><span class="keyword1">if</span> show_rightmost_bits <span class="free"><span class="bound"><span class="entity">EM</span></span></span> <span class="numeral">8</span> <span class="main">≠</span> BC
    <span class="keyword1">then</span> False
    <span class="keyword1">else</span> emsapss_decode_help3 <span class="free"><span class="bound"><span class="entity">mHash</span></span></span> <span class="free"><span class="bound"><span class="entity">EM</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emsapss_decode_help1</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emsapss_decode_help1</span> <span class="free"><span class="bound"><span class="entity">mHash</span></span></span> <span class="free"><span class="bound"><span class="entity">EM</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">mHash</span></span></span><span class="main">)</span> <span class="main">+</span> sLen <span class="main">+</span> <span class="numeral">16</span>
     <span class="keyword1">then</span> False 
     <span class="keyword1">else</span> emsapss_decode_help2 <span class="free"><span class="bound"><span class="entity">mHash</span></span></span> <span class="free"><span class="bound"><span class="entity">EM</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emsapss_decode</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span> <span class="comment1">(* outputs "true" if EM is encoding of M *)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emsapss_decode</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">EM</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">64</span> <span class="main">≤</span> length <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">∨</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">32</span><span class="main">*</span><span class="numeral">160</span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">emBits</span></span></span><span class="main">)</span>
     <span class="keyword1">then</span> False
     <span class="keyword1">else</span> emsapss_decode_help1 <span class="main">(</span>sha1 <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">EM</span></span></span> <span class="free"><span class="bound"><span class="entity">emBits</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="EMSAPSS-roundup_positiv"><span class="command">lemma</span></span> roundup_positiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">emBits</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> roundup <span class="free">emBits</span> <span class="numeral">160</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> roundup<span class="main">)</span>

<span class="keyword1" id="EMSAPSS-roundup_ge_emBits"><span class="command">lemma</span></span> roundup_ge_emBits<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">0</span> <span class="main">&lt;</span> <span class="free">emBits</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">emBits</span> <span class="main">≤</span> <span class="main">(</span>roundup <span class="free">emBits</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> roundup mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">*</span><span class="main">(</span><span class="free">emBits</span> <span class="keyword1">div</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> mult_div_mod_eq <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">emBits</span> <span class="keyword1">mod</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">arith</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mod_less_divisor<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="EMSAPSS-roundup_ge_0"><span class="command">lemma</span></span> roundup_ge_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">emBits</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> roundup <span class="free">emBits</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span> <span class="main">-</span> <span class="free">emBits</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> roundup<span class="main">)</span>

<span class="keyword1" id="EMSAPSS-roundup_le_7"><span class="command">lemma</span></span> roundup_le_7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">emBits</span> <span class="main">⟹</span> roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="free">emBits</span> <span class="main">≤</span>  <span class="numeral">7</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> roundup<span class="main">)</span> <span class="operator">arith</span>

<span class="keyword1" id="EMSAPSS-roundup_nat_ge_8_help"><span class="command">lemma</span></span> roundup_nat_ge_8_help<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="main">(</span>sha1 <span class="free">M</span><span class="main">)</span> <span class="main">+</span> sLen <span class="main">+</span> <span class="numeral">16</span> <span class="main">≤</span> <span class="free">emBits</span> <span class="main">⟹</span> <span class="numeral">8</span> <span class="main">≤</span> roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="main">(</span>length <span class="main">(</span>sha1 <span class="free">M</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">8</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> roundup_ge_emBits <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">8</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> roundup sha1len sLen_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="EMSAPSS-roundup_nat_ge_8"><span class="command">lemma</span></span> roundup_nat_ge_8<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="main">(</span>sha1 <span class="free">M</span><span class="main">)</span> <span class="main">+</span> sLen <span class="main">+</span> <span class="numeral">16</span> <span class="main">≤</span> <span class="free">emBits</span> <span class="main">⟹</span> <span class="numeral">8</span> <span class="main">≤</span> roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="main">(</span>length <span class="main">(</span>sha1 <span class="free">M</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">8</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> roundup_nat_ge_8_help <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="EMSAPSS-roundup_le_ub"><span class="command">lemma</span></span> roundup_le_ub<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="numeral">176</span> <span class="main">+</span> sLen <span class="main">≤</span> <span class="free">emBits</span><span class="main">;</span> <span class="free">emBits</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">32</span> <span class="main">*</span> <span class="numeral">160</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>roundup <span class="free">emBits</span> <span class="numeral">8</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="numeral">168</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">32</span> <span class="main">*</span> <span class="numeral">160</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> roundup<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">arith</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
 
<span class="keyword1" id="EMSAPSS-modify_roundup_ge1"><span class="command">lemma</span></span> modify_roundup_ge1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="numeral">8</span> <span class="main">≤</span> roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="numeral">168</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="numeral">176</span> <span class="main">≤</span>  roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>

<span class="keyword1" id="EMSAPSS-modify_roundup_ge2"><span class="command">lemma</span></span> modify_roundup_ge2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="numeral">176</span> <span class="main">≤</span> roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="numeral">21</span> <span class="main">&lt;</span> roundup <span class="free">emBits</span> <span class="numeral">8</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="EMSAPSS-roundup_help1"><span class="command">lemma</span></span> roundup_help1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> roundup <span class="free">l</span> <span class="numeral">160</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>roundup <span class="free">l</span> <span class="numeral">160</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span>roundup <span class="free">l</span> <span class="numeral">160</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>

<span class="keyword1" id="EMSAPSS-roundup_help1_new"><span class="command">lemma</span></span> roundup_help1_new<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>roundup <span class="free">l</span> <span class="numeral">160</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span>roundup <span class="free">l</span> <span class="numeral">160</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> roundup_positiv <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">l</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="EMSAPSS-roundup_help2"><span class="command">lemma</span></span> roundup_help2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="numeral">176</span> <span class="main">+</span> sLen <span class="main">≤</span> <span class="free">emBits</span><span class="main">⟧</span> <span class="main">⟹</span> roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="free">emBits</span> <span class="main">&lt;=</span>  roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="numeral">160</span> <span class="main">-</span> sLen <span class="main">-</span> <span class="numeral">16</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sLen_def<span class="main">)</span>

<span class="keyword1" id="EMSAPSS-bv_prepend_equal"><span class="command">lemma</span></span> bv_prepend_equal<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_prepend <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">b</span> <span class="free">l</span> <span class="main">=</span> <span class="free">b</span><span class="main">#</span>bv_prepend <span class="free">n</span> <span class="free">b</span> <span class="free">l</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_prepend<span class="main">)</span>

<span class="keyword1" id="EMSAPSS-length_bv_prepend"><span class="command">lemma</span></span> length_bv_prepend<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>bv_prepend <span class="free">n</span> <span class="free">b</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span><span class="main">+</span>length <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_prepend<span class="main">)</span>

<span class="keyword1" id="EMSAPSS-length_bv_prepend_drop"><span class="command">lemma</span></span> length_bv_prepend_drop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;=</span> length <span class="free">xs</span> <span class="main">⟶</span> length <span class="main">(</span>bv_prepend <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>drop <span class="free">a</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>length_bv_prepend<span class="main">)</span>

<span class="keyword1" id="EMSAPSS-take_bv_prepend"><span class="command">lemma</span></span> take_bv_prepend<span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="free">n</span> <span class="main">(</span>bv_prepend <span class="free">n</span> <span class="free">b</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> bv_prepend <span class="free">n</span> <span class="free">b</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_prepend<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="EMSAPSS-take_bv_prepend2"><span class="command">lemma</span></span> take_bv_prepend2<span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="free">n</span> <span class="main">(</span>bv_prepend <span class="free">n</span> <span class="free">b</span> <span class="free">xs</span><span class="main">@</span><span class="free">ys</span><span class="main">@</span><span class="free">zs</span><span class="main">)</span> <span class="main">=</span> bv_prepend <span class="free">n</span> <span class="free">b</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_prepend<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="EMSAPSS-bv_prepend_append"><span class="command">lemma</span></span> bv_prepend_append<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_prepend <span class="free">a</span> <span class="free">b</span> <span class="free">x</span> <span class="main">=</span> bv_prepend <span class="free">a</span> <span class="free">b</span> <span class="main">[]</span> <span class="main">@</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_prepend<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_prepend_equal<span class="main">)</span>

<span class="keyword1" id="EMSAPSS-bv_prepend_append2"><span class="command">lemma</span></span> bv_prepend_append2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">⟹</span> bv_prepend <span class="free">y</span> <span class="free">b</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span>bv_prepend <span class="free">x</span> <span class="free">b</span> <span class="main">[]</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>bv_prepend <span class="main">(</span><span class="free">y</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="free">b</span> <span class="main">[]</span><span class="main">)</span><span class="main">@</span><span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_prepend replicate_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="EMSAPSS-drop_bv_prepend_help2"><span class="command">lemma</span></span> drop_bv_prepend_help2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> drop <span class="free">x</span> <span class="main">(</span>bv_prepend <span class="free">y</span> <span class="free">b</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> bv_prepend <span class="main">(</span><span class="free">y</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="free">b</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> bv_prepend_append2 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">y</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_bv_prepend<span class="main">)</span>

<span class="keyword1" id="EMSAPSS-drop_bv_prepend_help3"><span class="command">lemma</span></span> drop_bv_prepend_help3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">=</span> <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> drop <span class="free">x</span> <span class="main">(</span>bv_prepend <span class="free">y</span> <span class="free">b</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> bv_prepend <span class="main">(</span><span class="free">y</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="free">b</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> length_bv_prepend <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_prepend<span class="main">)</span>

<span class="keyword1" id="EMSAPSS-drop_bv_prepend_help4"><span class="command">lemma</span></span> drop_bv_prepend_help4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> drop <span class="free">x</span> <span class="main">(</span>bv_prepend <span class="free">y</span> <span class="free">b</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> bv_prepend <span class="main">(</span><span class="free">y</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="free">b</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> drop_bv_prepend_help2 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span><span class="main"><span class="main">]</span></span> drop_bv_prepend_help3 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">arith</span><span class="main">)</span>

<span class="keyword1" id="EMSAPSS-bv_prepend_add"><span class="command">lemma</span></span> bv_prepend_add<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_prepend <span class="free">x</span> <span class="free">b</span> <span class="main">[]</span> <span class="main">@</span> bv_prepend <span class="free">y</span> <span class="free">b</span> <span class="main">[]</span> <span class="main">=</span> bv_prepend <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="free">b</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_prepend<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="EMSAPSS-bv_prepend_drop"><span class="command">lemma</span></span> bv_prepend_drop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟶</span> bv_prepend <span class="free">x</span> <span class="free">b</span> <span class="main">(</span>drop <span class="free">x</span> <span class="main">(</span>bv_prepend <span class="free">y</span> <span class="free">b</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> bv_prepend <span class="free">y</span> <span class="free">b</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_bv_prepend_help4 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_prepend_append <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bv_prepend <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="free">b</span> <span class="main">[]</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span> bv_prepend_add<span class="main">)</span>

<span class="keyword1" id="EMSAPSS-bv_prepend_split"><span class="command">lemma</span></span> bv_prepend_split<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_prepend <span class="free">x</span> <span class="free">b</span> <span class="main">(</span><span class="free">left</span> <span class="main">@</span> <span class="free">right</span><span class="main">)</span> <span class="main">=</span> bv_prepend <span class="free">x</span> <span class="free">b</span> <span class="free">left</span> <span class="main">@</span> <span class="free">right</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_prepend<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="EMSAPSS-length_generate_DB"><span class="command">lemma</span></span> length_generate_DB<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>generate_DB <span class="free">PS</span><span class="main">)</span> <span class="main">=</span> length <span class="free">PS</span> <span class="main">+</span> <span class="numeral">8</span> <span class="main">+</span> sLen"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_DB_def sLen_def<span class="main">)</span>

<span class="keyword1" id="EMSAPSS-length_generate_PS"><span class="command">lemma</span></span> length_generate_PS<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>generate_PS <span class="free">emBits</span> <span class="numeral">160</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>roundup <span class="free">emBits</span> <span class="numeral">8</span><span class="main">)</span><span class="main">*</span><span class="numeral">8</span> <span class="main">-</span> sLen <span class="main">-</span> <span class="numeral">160</span> <span class="main">-</span> <span class="numeral">16</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_PS_def length_bv_prepend<span class="main">)</span>

<span class="keyword1" id="EMSAPSS-length_bvxor"><span class="command">lemma</span></span> length_bvxor<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">a</span> <span class="main">=</span> length <span class="free">b</span> <span class="main">⟹</span> length <span class="main">(</span>bvxor <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> length <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bvxor<span class="main">)</span>

<span class="keyword1" id="EMSAPSS-length_MGF2"><span class="command">lemma</span></span> length_MGF2<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>MGF2 <span class="free">Z</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> Suc <span class="free">m</span> <span class="main">*</span> length <span class="main">(</span>sha1 <span class="main">(</span><span class="free">Z</span> <span class="main">@</span> nat_to_bv_length <span class="free">m</span> <span class="numeral">32</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sha1len<span class="main">)</span>

<span class="keyword1" id="EMSAPSS-length_MGF1"><span class="command">lemma</span></span> length_MGF1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">160</span> <span class="main">⟹</span> length <span class="main">(</span>MGF1 <span class="free">Z</span> <span class="free">n</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MGF1_def length_MGF2 sha1len<span class="main">)</span>

<span class="keyword1" id="EMSAPSS-length_MGF"><span class="command">lemma</span></span> length_MGF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">l</span> <span class="main">⟹</span> <span class="free">l</span> <span class="main">≤</span>  <span class="numeral">2</span><span class="main">^</span><span class="numeral">32</span> <span class="main">*</span> length <span class="main">(</span>sha1 <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> length <span class="main">(</span>MGF <span class="free">x</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MGF_def sha1len<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> roundup_help1_new <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">l</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> length_MGF1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> roundup_ge_emBits <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">l</span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">160</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">arith</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="EMSAPSS-solve_length_generate_DB"><span class="command">lemma</span></span> solve_length_generate_DB<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">emBits</span><span class="main">;</span> length <span class="main">(</span>sha1 <span class="free">M</span><span class="main">)</span> <span class="main">+</span> sLen <span class="main">+</span> <span class="numeral">16</span> <span class="main">≤</span> <span class="free">emBits</span><span class="main">⟧</span>
  <span class="main">⟹</span> length <span class="main">(</span>generate_DB <span class="main">(</span>generate_PS <span class="free">emBits</span> <span class="main">(</span>length <span class="main">(</span>sha1 <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>roundup <span class="free">emBits</span> <span class="numeral">8</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="numeral">168</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> roundup_ge_emBits <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">8</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_generate_DB length_generate_PS sha1len<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="EMSAPSS-length_maskedDB_zero"><span class="command">lemma</span></span> length_maskedDB_zero<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="free">emBits</span> <span class="main">≤</span> length <span class="free">maskedDB</span><span class="main">⟧</span>
  <span class="main">⟹</span> length <span class="main">(</span>maskedDB_zero <span class="free">maskedDB</span> <span class="free">emBits</span><span class="main">)</span> <span class="main">=</span> length <span class="free">maskedDB</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> maskedDB_zero_def length_bv_prepend<span class="main">)</span>

<span class="keyword1" id="EMSAPSS-take_equal_bv_prepend"><span class="command">lemma</span></span> take_equal_bv_prepend<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="numeral">176</span> <span class="main">+</span> sLen <span class="main">≤</span> <span class="free">emBits</span><span class="main">;</span> roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="free">emBits</span> <span class="main">≤</span> <span class="numeral">7</span><span class="main">⟧</span>
  <span class="main">⟹</span> take <span class="main">(</span>roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> length <span class="main">(</span>sha1 <span class="free">M</span><span class="main">)</span> <span class="main">-</span> sLen <span class="main">-</span> <span class="numeral">16</span><span class="main">)</span> <span class="main">(</span>maskedDB_zero <span class="main">(</span>generate_DB <span class="main">(</span>generate_PS <span class="free">emBits</span> <span class="numeral">160</span><span class="main">)</span><span class="main">)</span> <span class="free">emBits</span><span class="main">)</span> <span class="main">=</span>
    bv_prepend <span class="main">(</span>roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> length <span class="main">(</span>sha1 <span class="free">M</span><span class="main">)</span> <span class="main">-</span> sLen <span class="main">-</span> <span class="numeral">16</span><span class="main">)</span> <span class="main">𝟬</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> roundup_help2 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span><span class="main"><span class="main">]</span></span> length_generate_PS <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sha1len maskedDB_zero_def generate_DB_def generate_PS_def
    bv_prepend_split bv_prepend_drop<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="EMSAPSS-lastbits_BC"><span class="command">lemma</span></span> lastbits_BC<span class="main">:</span> <span class="quoted"><span class="quoted">"BC <span class="main">=</span> show_rightmost_bits <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">@</span> BC<span class="main">)</span> <span class="numeral">8</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> show_rightmost_bits_def BC_def<span class="main">)</span>

<span class="keyword1" id="EMSAPSS-equal_zero"><span class="command">lemma</span></span> equal_zero<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="numeral">176</span> <span class="main">+</span> sLen <span class="main">≤</span> <span class="free">emBits</span> <span class="main">⟹</span> roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="free">emBits</span> <span class="main">≤</span> roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">176</span> <span class="main">+</span> sLen<span class="main">)</span>
  <span class="main">⟹</span> <span class="main">0</span> <span class="main">=</span> roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="free">emBits</span> <span class="main">-</span> <span class="main">(</span>roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">176</span> <span class="main">+</span> sLen<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>

<span class="keyword1" id="EMSAPSS-get_salt"><span class="command">lemma</span></span> get_salt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="numeral">176</span> <span class="main">+</span> sLen <span class="main">≤</span> <span class="free">emBits</span><span class="main">;</span> roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="free">emBits</span> <span class="main">≤</span> <span class="numeral">7</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>generate_salt <span class="main">(</span>maskedDB_zero <span class="main">(</span>generate_DB <span class="main">(</span>generate_PS <span class="free">emBits</span> <span class="numeral">160</span><span class="main">)</span><span class="main">)</span> <span class="free">emBits</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> salt"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> roundup_help2 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span><span class="main"><span class="main">]</span></span> length_generate_PS <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span><span class="main"><span class="main">]</span></span> equal_zero <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_DB_def generate_PS_def maskedDB_zero_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_prepend_split bv_prepend_drop generate_salt_def
    show_rightmost_bits_def sLen_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="EMSAPSS-generate_maskedDB_elim"><span class="command">lemma</span></span> generate_maskedDB_elim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="free">emBits</span> <span class="main">≤</span> length <span class="free">x</span><span class="main">;</span> <span class="main">(</span> roundup <span class="free">emBits</span> <span class="numeral">8</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="main">(</span>length <span class="main">(</span>sha1 <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">8</span> <span class="main">=</span> length <span class="main">(</span>maskedDB_zero <span class="free">x</span> <span class="free">emBits</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> generate_maskedDB <span class="main">(</span>maskedDB_zero <span class="free">x</span> <span class="free">emBits</span> <span class="main">@</span> <span class="free">y</span> <span class="main">@</span> <span class="free">z</span><span class="main">)</span> <span class="free">emBits</span> <span class="main">(</span>length<span class="main">(</span>sha1 <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> maskedDB_zero <span class="free">x</span> <span class="free">emBits</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> maskedDB_zero_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> length_bv_prepend_drop <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>roundup <span class="free"><span class="free">emBits</span></span> <span class="numeral"><span class="numeral">8</span></span> <span class="main"><span class="main">*</span></span> <span class="numeral"><span class="numeral">8</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">emBits</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_maskedDB_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="EMSAPSS-generate_H_elim"><span class="command">lemma</span></span> generate_H_elim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="free">emBits</span> <span class="main">≤</span> length <span class="free">x</span><span class="main">;</span> length <span class="main">(</span>maskedDB_zero <span class="free">x</span> <span class="free">emBits</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>roundup <span class="free">emBits</span> <span class="numeral">8</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="numeral">168</span><span class="main">;</span> length <span class="free">y</span> <span class="main">=</span> <span class="numeral">160</span><span class="main">⟧</span> <span class="main">⟹</span> generate_H <span class="main">(</span>maskedDB_zero <span class="free">x</span> <span class="free">emBits</span> <span class="main">@</span> <span class="free">y</span> <span class="main">@</span> <span class="free">z</span><span class="main">)</span> <span class="free">emBits</span> <span class="numeral">160</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> maskedDB_zero_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> length_bv_prepend_drop <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"roundup <span class="free"><span class="free">emBits</span></span> <span class="numeral"><span class="numeral">8</span></span> <span class="main"><span class="main">*</span></span> <span class="numeral"><span class="numeral">8</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">emBits</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_H_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="EMSAPSS-length_bv_prepend_drop_special"><span class="command">lemma</span></span> length_bv_prepend_drop_special<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span>roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="free">emBits</span> <span class="main">&lt;=</span> roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">176</span> <span class="main">+</span> sLen<span class="main">)</span><span class="main">;</span> length <span class="main">(</span>generate_PS <span class="free">emBits</span> <span class="numeral">160</span><span class="main">)</span> <span class="main">=</span> roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">176</span> <span class="main">+</span> sLen<span class="main">)</span><span class="main">|]</span> <span class="main">==&gt;</span> length <span class="main">(</span> bv_prepend <span class="main">(</span>roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="free">emBits</span><span class="main">)</span> <span class="main">𝟬</span> <span class="main">(</span>drop <span class="main">(</span>roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="free">emBits</span><span class="main">)</span> <span class="main">(</span>generate_PS <span class="free">emBits</span> <span class="numeral">160</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>generate_PS <span class="free">emBits</span> <span class="numeral">160</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_bv_prepend_drop<span class="main">)</span>

<span class="keyword1" id="EMSAPSS-x01_elim"><span class="command">lemma</span></span> x01_elim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="numeral">176</span> <span class="main">+</span> sLen <span class="main">≤</span> <span class="free">emBits</span><span class="main">;</span> roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="free">emBits</span> <span class="main">≤</span> <span class="numeral">7</span><span class="main">⟧</span> <span class="main">⟹</span> take <span class="numeral">8</span> <span class="main">(</span>drop <span class="main">(</span>roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="main">(</span>length <span class="main">(</span>sha1 <span class="free">M</span><span class="main">)</span> <span class="main">+</span> sLen <span class="main">+</span> <span class="numeral">16</span><span class="main">)</span><span class="main">)</span><span class="main">(</span>maskedDB_zero <span class="main">(</span>generate_DB <span class="main">(</span>generate_PS <span class="free">emBits</span> <span class="numeral">160</span><span class="main">)</span><span class="main">)</span> <span class="free">emBits</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="main">𝟬</span><span class="main">,</span> <span class="main">𝟬</span><span class="main">,</span> <span class="main">𝟬</span><span class="main">,</span> <span class="main">𝟬</span><span class="main">,</span> <span class="main">𝟬</span><span class="main">,</span> <span class="main">𝟬</span><span class="main">,</span> <span class="main">𝟬</span><span class="main">,</span> <span class="main">𝟭</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> roundup_help2 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span><span class="main"><span class="main">]</span></span> length_generate_PS <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span><span class="main"><span class="main">]</span></span> equal_zero <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sha1len maskedDB_zero_def generate_DB_def generate_PS_def
    bv_prepend_split bv_prepend_drop<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="EMSAPSS-drop_bv_mapzip"><span class="command">lemma</span></span> drop_bv_mapzip<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;=</span> length <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">x</span> <span class="main">=</span> length <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"drop <span class="free">n</span> <span class="main">(</span>bv_mapzip <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> bv_mapzip <span class="free">f</span> <span class="main">(</span>drop <span class="free">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>drop <span class="free">n</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;=</span> length <span class="bound">x</span> <span class="main">⟹</span> length <span class="bound">x</span> <span class="main">=</span> length <span class="bound">y</span> <span class="main">⟹</span>
      drop <span class="free">n</span> <span class="main">(</span>bv_mapzip <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> bv_mapzip <span class="free">f</span> <span class="main">(</span>drop <span class="free">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>drop <span class="free">n</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">y</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">a</span> <span class="main">=</span> length <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bvxor <span class="main">(</span>bvxor <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> length <span class="free">a</span> <span class="main">=</span> length <span class="bound">b</span> <span class="main">⟹</span> bvxor <span class="main">(</span>bvxor <span class="free">a</span> <span class="bound">b</span><span class="main">)</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bvxor<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">b</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a1</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="EMSAPSS-bvxorxor_elim_help"><span class="command">lemma</span></span> bvxorxor_elim_help<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;=</span> length <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">a</span> <span class="main">=</span> length <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bv_prepend <span class="free">x</span> <span class="main">𝟬</span> <span class="main">(</span>drop <span class="free">x</span> <span class="main">(</span>bvxor <span class="main">(</span>bv_prepend <span class="free">x</span> <span class="main">𝟬</span> <span class="main">(</span>drop <span class="free">x</span> <span class="main">(</span>bvxor <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    bv_prepend <span class="free">x</span> <span class="main">𝟬</span> <span class="main">(</span>drop <span class="free">x</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"drop <span class="free">x</span> <span class="main">(</span>bvxor <span class="main">(</span>bv_prepend <span class="free">x</span> <span class="main">𝟬</span> <span class="main">(</span>drop <span class="free">x</span> <span class="main">(</span>bvxor <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> drop <span class="free">x</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> bvxor bv_prepend<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> assms<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> length_replicate <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">𝟬</span></span></span></span> <span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> length_drop <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> length_drop <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> length_bvxor <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"drop <span class="free"><span class="free">x</span></span> <span class="free"><span class="free">a</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"drop <span class="free"><span class="free">x</span></span> <span class="free"><span class="free">b</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>replicate <span class="free">x</span> <span class="main">𝟬</span> <span class="main">@</span> drop <span class="free">x</span> <span class="main">(</span>bv_mapzip <span class="keyword1">(⊕<span class="hidden">⇩</span><sub>b</sub>)</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="free">b</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">(</span>take <span class="free">x</span> <span class="free">b</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>drop <span class="free">x</span> <span class="free">b</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> drop_bv_mapzip <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>replicate <span class="free"><span class="free">x</span></span> <span class="main"><span class="main">𝟬</span></span> <span class="main"><span class="main">@</span></span> drop <span class="free"><span class="free">x</span></span> <span class="main"><span class="main">(</span></span>bv_mapzip <span class="keyword1"><span class="keyword1">(⊕<span class="hidden">⇩</span><sub>b</sub>)</span></span> <span class="free"><span class="free">a</span></span> <span class="free"><span class="free">b</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">(⊕<span class="hidden">⇩</span><sub>b</sub>)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> drop_bv_mapzip <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">(⊕<span class="hidden">⇩</span><sub>b</sub>)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> bvxor<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="EMSAPSS-bvxorxor_elim"><span class="command">lemma</span></span> bvxorxor_elim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="free">emBits</span> <span class="main">≤</span> length <span class="free">a</span><span class="main">;</span> length <span class="free">a</span> <span class="main">=</span> length <span class="free">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>maskedDB_zero <span class="main">(</span>bvxor <span class="main">(</span>maskedDB_zero <span class="main">(</span>bvxor <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">emBits</span><span class="main">)</span><span class="free">b</span><span class="main">)</span> <span class="free">emBits</span><span class="main">)</span> <span class="main">=</span> bv_prepend <span class="main">(</span>roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="free">emBits</span><span class="main">)</span> <span class="main">𝟬</span> <span class="main">(</span>drop <span class="main">(</span>roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="free">emBits</span><span class="main">)</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> maskedDB_zero_def bvxorxor_elim_help<span class="main">)</span>

<span class="keyword1" id="EMSAPSS-verify"><span class="command">lemma</span></span> verify<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span>emsapss_encode <span class="free">M</span> <span class="free">emBits</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> <span class="free">EM</span><span class="main">=</span><span class="main">(</span>emsapss_encode <span class="free">M</span> <span class="free">emBits</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> emsapss_decode <span class="free">M</span> <span class="free">EM</span> <span class="free">emBits</span> <span class="main">=</span> True"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_decode_def emsapss_encode_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_decode_help1_def emsapss_encode_help1_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_decode_help2_def emsapss_encode_help2_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_encode_help3_def emsapss_encode_help4_def
    emsapss_encode_help5_def emsapss_encode_help6_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_encode_help7_def emsapss_encode_help8_def lastbits_BC <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_decode_help3_def emsapss_encode_help3_def
    emsapss_decode_help4_def emsapss_encode_help4_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> roundup_le_7 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span><span class="main"><span class="main">]</span></span> roundup_ge_0 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">8</span></span></span></span><span class="main"><span class="main">]</span></span> roundup_nat_ge_8 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_maskedDB_def emsapss_encode_help5_def emsapss_encode_help6_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_encode_help7_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> emsapss_encode_help8_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> maskedDB_zero_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> take_bv_prepend2 min.absorb1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_encode_help5_def emsapss_encode_help6_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> solve_length_generate_DB <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"generate_M' <span class="main"><span class="main">(</span></span>sha1 <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span> salt"</span></span></span><span class="main"><span class="main">]</span></span> roundup_le_ub <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> length_MGF <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>roundup <span class="free"><span class="free">emBits</span></span> <span class="numeral"><span class="numeral">8</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">*</span></span> <span class="numeral"><span class="numeral">8</span></span> <span class="main"><span class="main">-</span></span> <span class="numeral"><span class="numeral">168</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>sha1 <span class="main"><span class="main">(</span></span>generate_M' <span class="main"><span class="main">(</span></span>sha1 <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span> salt<span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> modify_roundup_ge1 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span><span class="main"><span class="main">]</span></span> modify_roundup_ge2 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sha1len emsapss_encode_help7_def emsapss_encode_help8_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> length_bvxor <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>generate_DB <span class="main"><span class="main">(</span></span>generate_PS <span class="free"><span class="free">emBits</span></span> <span class="numeral"><span class="numeral">160</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>MGF <span class="main"><span class="main">(</span></span>sha1 <span class="main"><span class="main">(</span></span>generate_M' <span class="main"><span class="main">(</span></span>sha1 <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span> salt<span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">(</span></span>roundup <span class="free"><span class="free">emBits</span></span> <span class="numeral"><span class="numeral">8</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">*</span></span> <span class="numeral"><span class="numeral">8</span></span> <span class="main"><span class="main">-</span></span> <span class="numeral"><span class="numeral">168</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> generate_maskedDB_elim <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>bvxor <span class="main"><span class="main">(</span></span>generate_DB <span class="main"><span class="main">(</span></span>generate_PS <span class="free"><span class="free">emBits</span></span> <span class="numeral"><span class="numeral">160</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">(</span></span>MGF <span class="main"><span class="main">(</span></span>sha1 <span class="main"><span class="main">(</span></span>generate_M' <span class="main"><span class="main">(</span></span>sha1 <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span> salt<span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">(</span></span>roundup <span class="free"><span class="free">emBits</span></span> <span class="numeral"><span class="numeral">8</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">*</span></span> <span class="numeral"><span class="numeral">8</span></span> <span class="main"><span class="main">-</span></span> <span class="numeral"><span class="numeral">168</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"sha1 <span class="main"><span class="main">(</span></span>generate_M' <span class="main"><span class="main">(</span></span>sha1 <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span> salt<span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="quoted">BC</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> length_maskedDB_zero <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>bvxor <span class="main"><span class="main">(</span></span>generate_DB <span class="main"><span class="main">(</span></span>generate_PS <span class="free"><span class="free">emBits</span></span> <span class="numeral"><span class="numeral">160</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">(</span></span>MGF <span class="main"><span class="main">(</span></span>sha1 <span class="main"><span class="main">(</span></span>generate_M' <span class="main"><span class="main">(</span></span>sha1 <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span> salt<span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">(</span></span>roundup <span class="free"><span class="free">emBits</span></span> <span class="numeral"><span class="numeral">8</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">*</span></span> <span class="numeral"><span class="numeral">8</span></span> <span class="main"><span class="main">-</span></span> <span class="numeral"><span class="numeral">168</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> generate_H_elim <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>bvxor <span class="main"><span class="main">(</span></span>generate_DB <span class="main"><span class="main">(</span></span>generate_PS <span class="free"><span class="free">emBits</span></span> <span class="numeral"><span class="numeral">160</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">(</span></span>MGF <span class="main"><span class="main">(</span></span>sha1 <span class="main"><span class="main">(</span></span>generate_M' <span class="main"><span class="main">(</span></span>sha1 <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span> salt<span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>roundup <span class="free"><span class="free">emBits</span></span> <span class="numeral"><span class="numeral">8</span></span> <span class="main"><span class="main">*</span></span> <span class="numeral"><span class="numeral">8</span></span> <span class="main"><span class="main">-</span></span> <span class="numeral"><span class="numeral">168</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"sha1 <span class="main"><span class="main">(</span></span>generate_M' <span class="main"><span class="main">(</span></span>sha1 <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span> salt<span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="quoted">BC</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sha1len emsapss_decode_help5_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> emsapss_decode_help6_def emsapss_decode_help7_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> bvxorxor_elim <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>generate_DB <span class="main"><span class="main">(</span></span>generate_PS <span class="free"><span class="free">emBits</span></span> <span class="numeral"><span class="numeral">160</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>MGF <span class="main"><span class="main">(</span></span>sha1 <span class="main"><span class="main">(</span></span>generate_M' <span class="main"><span class="main">(</span></span>sha1 <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span> salt<span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">(</span></span>roundup <span class="free"><span class="free">emBits</span></span> <span class="numeral"><span class="numeral">8</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">*</span></span> <span class="numeral"><span class="numeral">8</span></span> <span class="main"><span class="main">-</span></span> <span class="numeral"><span class="numeral">168</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> maskedDB_zero_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> take_equal_bv_prepend <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span><span class="main"><span class="main">]</span></span> x01_elim <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span><span class="main"><span class="main">]</span></span> get_salt <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">emBits</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_decode_help8_def emsapss_decode_help9_def emsapss_decode_help10_def emsapss_decode_help11_def<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Mod">
<div class="head">
<h1>Theory Mod</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      RSAPSS/Mod.thy

    Author:     Christina Lindenberg, Kai Wirt, Technische Universität Darmstadt
    Copyright:  2005 - Technische Universität Darmstadt 
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Leammata for modular arithmetic"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Mod
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Mod-divmultassoc"><span class="command">lemma</span></span> divmultassoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult.assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Mod-delmod"><span class="command">lemma</span></span> delmod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">c</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">mod</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mod_mod_cancel <span class="main"><span class="main">[</span></span><span class="operator">OF</span> dvd_triv_right<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Mod-timesmod1"><span class="command">lemma</span></span> timesmod1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">::</span>nat<span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="free">y</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mod_mult_right_eq<span class="main">)</span>

<span class="keyword1" id="Mod-timesmod3"><span class="command">lemma</span></span> timesmod3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">b</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mod_mult_left_eq<span class="main">)</span>

<span class="keyword1" id="Mod-remainderexplemma"><span class="command">lemma</span></span> remainderexplemma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">a</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="free">z</span> <span class="keyword1">mod</span> <span class="free">a</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">z</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mod_mult_cong <span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Mod-remainderexp"><span class="command">lemma</span></span> remainderexp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="free">i</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="free">i</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> power_mod<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Crypt">
<div class="head">
<h1>Theory Crypt</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      RSAPSS/Crypt.thy
 
    Author:     Christina Lindenberg, Kai Wirt, Technische Universität Darmstadt
    Copyright:  2005 - Technische Universität Darmstadt 
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Definition of rsacrypt"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Crypt
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a> <a href="#Mod">Mod</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This theory defines the rsacrypt function which implements RSA using fast
  exponentiation. An proof, that this function calculates RSA is also given
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rsa_crypt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  cryptcorrect<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">rsa_crypt</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">^</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1" id="Crypt-rsa_crypt_code"><span class="command">lemma</span></span> rsa_crypt_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"rsa_crypt <span class="free">M</span> <span class="free">e</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">e</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">mod</span> <span class="free">n</span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> even <span class="free">e</span> <span class="keyword1">then</span> rsa_crypt <span class="free">M</span> <span class="main">(</span><span class="free">e</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="free">n</span> <span class="main">^</span> <span class="numeral">2</span> <span class="keyword1">mod</span> <span class="free">n</span>
    <span class="keyword1">else</span> <span class="main">(</span><span class="free">M</span> <span class="main">*</span> rsa_crypt <span class="free">M</span> <span class="main">(</span><span class="free">e</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="free">n</span> <span class="main">^</span> <span class="numeral">2</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span> <span class="main">^</span> <span class="skolem">m</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">M</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="keyword1">mod</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mod<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">M</span> <span class="main">^</span> <span class="skolem">m</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">M</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">M</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">*</span> <span class="main">(</span><span class="free">M</span> <span class="main">^</span> <span class="skolem">m</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">=</span> <span class="free">M</span> <span class="main">*</span> <span class="main">(</span><span class="free">M</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="keyword1">mod</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mod_mult_right_eq power_mod<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cryptcorrect power_even_eq remainderexp <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> evenE oddE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Pdifference">
<div class="head">
<h1>Theory Pdifference</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      RSAPSS/Pdifference.thy

    Author:     Christina Lindenberg, Kai Wirt, Technische Universität Darmstadt
    Copyright:  2005 - Technische Universität Darmstadt
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Positive differences"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Pdifference
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Computational_Algebra/Primes.html">HOL-Computational_Algebra.Primes</a>"</span> <a href="#Mod">Mod</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">pdifference</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">pdifference</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Pdifference-timesdistributesoverpdifference"><span class="command">lemma</span></span> timesdistributesoverpdifference<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">*</span><span class="main">(</span>pdifference <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> pdifference <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="main">(</span><span class="free">a</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">m</span><span class="main">*</span> <span class="main">(</span><span class="free">b</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_distrib<span class="main">)</span>

<span class="keyword1" id="Pdifference-addconst"><span class="command">lemma</span></span> addconst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⟹</span> <span class="free">c</span><span class="main">+</span><span class="free">a</span> <span class="main">=</span> <span class="free">c</span><span class="main">+</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Pdifference-invers"><span class="command">lemma</span></span> invers<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">-</span> <span class="free">a</span> <span class="main">+</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Pdifference-invers2"><span class="command">lemma</span></span> invers2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">a</span> <span class="main">≤</span> <span class="free">b</span><span class="main">;</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">b</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">+</span><span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> addconst <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> add.commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> invers<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Pdifference-modadd"><span class="command">lemma</span></span> modadd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">b</span> <span class="main">=</span> <span class="free">a</span><span class="main">+</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">mod</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Pdifference-equalmodstrick1"><span class="command">lemma</span></span> equalmodstrick1<span class="main">:</span> <span class="quoted"><span class="quoted">"pdifference <span class="free">a</span> <span class="free">b</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">a</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">mod</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mod_eq_dvd_iff_nat <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> mod_eq_dvd_iff_nat <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Pdifference-diff_add_assoc"><span class="command">lemma</span></span> diff_add_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">-</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">-</span> <span class="free">c</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Pdifference-diff_add_assoc2"><span class="command">lemma</span></span> diff_add_assoc2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">-</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">c</span> <span class="main">+</span> <span class="main">(</span><span class="free">a</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> diff_diff_left <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> diff_add_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Pdifference-diff_add_diff"><span class="command">lemma</span></span> diff_add_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">b</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">-</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">-</span> <span class="free">b</span> <span class="main">=</span> <span class="free">y</span> <span class="main">-</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Pdifference-equalmodstrick2"><span class="command">lemma</span></span> equalmodstrick2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">mod</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pdifference <span class="free">a</span> <span class="free">b</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">=</span> <span class="skolem">b</span> <span class="keyword1">mod</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">a</span> <span class="keyword1">div</span> <span class="free">p</span> <span class="main">*</span> <span class="free">p</span> <span class="main">+</span> <span class="skolem">a</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">-</span> <span class="skolem">b</span> <span class="keyword1">div</span> <span class="free">p</span> <span class="main">*</span> <span class="free">p</span> <span class="main">-</span> <span class="skolem">b</span> <span class="keyword1">mod</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">a</span> <span class="keyword1">div</span> <span class="free">p</span> <span class="main">*</span> <span class="free">p</span> <span class="main">-</span> <span class="skolem">b</span> <span class="keyword1">div</span> <span class="free">p</span> <span class="main">*</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">div</span> <span class="free">p</span> <span class="main">-</span> <span class="skolem">b</span> <span class="keyword1">div</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_mult_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> this <span class="main">[</span><span class="operator">OF</span> assms <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Pdifference-primekeyrewrite"><span class="command">lemma</span></span> primekeyrewrite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>prime <span class="free">p</span><span class="main">;</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">b</span><span class="main">)</span><span class="main">;</span><span class="main">~</span><span class="main">(</span><span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> prime_dvd_mult_nat<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Pdifference-multzero"><span class="command">lemma</span></span> multzero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">p</span><span class="main">;</span> <span class="free">m</span><span class="main">*</span><span class="free">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Pdifference-primekeytrick"><span class="command">lemma</span></span> primekeytrick<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span> <span class="main">*</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="free">M</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="keyword1">mod</span> <span class="free">P</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">mod</span> <span class="free">P</span> <span class="main">=</span> <span class="free">B</span> <span class="keyword1">mod</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span><span class="main">.</span> <span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">M</span> <span class="main">*</span> <span class="bound">q</span> <span class="main">⟹</span> <span class="free">P</span> <span class="keyword1">dvd</span> <span class="bound">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> primekeyrewrite <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_eq_mod_eq_0 <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> equalmodstrick2 <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">M</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equalmodstrick1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> * dvdI <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_eq_mod_eq_0 <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> diff_mult_distrib2 <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Productdivides">
<div class="head">
<h1>Theory Productdivides</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      RSAPSS/Productdivides.thy
    Author:     Christina Lindenberg, Kai Wirt, Technische Universität Darmstadt
    Copyright:  2005 - Technische Universität Darmstadt 
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Lemmata for modular arithmetic with primes"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Productdivides
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Pdifference">Pdifference</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Productdivides-productdivides"><span class="command">lemma</span></span> productdivides<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="keyword1">mod</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">;</span> <span class="free">x</span> <span class="keyword1">mod</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span><span class="main">;</span> prime <span class="free">a</span><span class="main">;</span> prime <span class="free">b</span><span class="main">;</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_eq_0_iff_dvd primes_coprime divides_mult<span class="main">)</span>

<span class="keyword1" id="Productdivides-specializedtoprimes1"><span class="command">lemma</span></span> specializedtoprimes1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted">nat</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>prime <span class="free">p</span><span class="main">;</span> prime <span class="free">q</span><span class="main">;</span> <span class="free">p</span> <span class="main">≠</span> <span class="free">q</span><span class="main">;</span> <span class="free">a</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">;</span> <span class="free">a</span> <span class="keyword1">mod</span> <span class="free">q</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">⟧</span>
         <span class="main">⟹</span> <span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> equalmodstrick1 equalmodstrick2 productdivides<span class="main">)</span> 

<span class="keyword1" id="Productdivides-specializedtoprimes1a"><span class="command">lemma</span></span> specializedtoprimes1a<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted">nat</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>prime <span class="free">p</span><span class="main">;</span> prime <span class="free">q</span><span class="main">;</span> <span class="free">p</span> <span class="main">≠</span> <span class="free">q</span><span class="main">;</span> <span class="free">a</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">mod</span> <span class="free">p</span><span class="main">;</span> <span class="free">a</span> <span class="keyword1">mod</span> <span class="free">q</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">;</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">p</span><span class="main">*</span><span class="free">q</span> <span class="main">⟧</span>
    <span class="main">⟹</span> <span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> specializedtoprimes1<span class="main">)</span>
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Cryptinverts">
<div class="head">
<h1>Theory Cryptinverts</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      RSAPSS/Cryptinverts.thy
    Author:     Christina Lindenberg, Kai Wirt, Technische Universität Darmstadt
    Copyright:  2005 - Technische Universität Darmstadt 
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Correctness proof for RSA"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Cryptinverts
<span class="keyword2"><span class="keyword">imports</span></span>  <a href="#Crypt">Crypt</a> <a href="#Productdivides">Productdivides</a>  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Number_Theory/Residues.html">HOL-Number_Theory.Residues</a>"</span> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this theory we show, that a RSA encrypted message can be decrypted
›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">pred</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pred</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pred</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1" id="Cryptinverts-pred_unfold"><span class="command">lemma</span></span> pred_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pred <span class="free">n</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  
<span class="keyword1" id="Cryptinverts-fermat"><span class="command">lemma</span></span> fermat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span> <span class="main">^</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fermat_theorem <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_eq_0_iff_dvd<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="free">p</span>›</span></span> prime_gt_1_nat <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cryptinverts-cryptinverts_hilf1"><span class="command">lemma</span></span> cryptinverts_hilf1<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="free">m</span> <span class="main">^</span><span class="main">(</span><span class="free">k</span> <span class="main">*</span> pred <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">=</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_mult_left_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult.commute <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="quoted">"pred <span class="free">p</span>"</span></span><span class="main"><span class="main">]</span></span>
    power_mult mod_mult_right_eq <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span><span class="main">^</span>pred <span class="free">p</span><span class="main">)</span><span class="main">^</span><span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span>"</span></span><span class="main"><span class="main">]</span></span>
    remainderexp <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">^</span>pred <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> fermat <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> power_mult pred_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def mod_mult_right_eq mult.right_neutral power_Suc_0 power_mod<span class="main">)</span>

<span class="keyword1" id="Cryptinverts-cryptinverts_hilf2"><span class="command">lemma</span></span> cryptinverts_hilf2<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span> <span class="main">⟹</span> <span class="free">m</span><span class="main">*</span><span class="main">(</span><span class="free">m</span><span class="main">^</span><span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="main">(</span>pred <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>pred <span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">=</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">*</span> pred <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"pred <span class="free">q</span>"</span></span><span class="main"><span class="main">]</span></span> mult.assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cryptinverts_hilf1 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">p</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">m</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>pred <span class="free"><span class="free">q</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Cryptinverts-cryptinverts_hilf3"><span class="command">lemma</span></span> cryptinverts_hilf3<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">q</span> <span class="main">⟹</span> <span class="free">m</span><span class="main">*</span><span class="main">(</span><span class="free">m</span><span class="main">^</span><span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="main">(</span>pred <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>pred <span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">q</span> <span class="main">=</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> cryptinverts_hilf1<span class="main">)</span>

<span class="keyword1" id="Cryptinverts-cryptinverts_hilf4"><span class="command">lemma</span></span> cryptinverts_hilf4<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">^</span> <span class="free">x</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="main">*</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">mod</span> <span class="main">(</span>pred <span class="free">p</span> <span class="main">*</span> pred <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> that<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">x</span> <span class="keyword1">mod</span> <span class="main">(</span>pred <span class="free">p</span> <span class="main">*</span> pred <span class="free">q</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pred <span class="free">p</span> <span class="main">*</span> pred <span class="free">q</span> <span class="keyword1">dvd</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dvd_minus_mod <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>pred <span class="free">p</span> <span class="main">*</span> pred <span class="free">q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">x</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> pred <span class="free">p</span> <span class="main">*</span> pred <span class="free">q</span> <span class="main">*</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">^</span> Suc <span class="skolem">x</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">=</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">^</span> Suc <span class="skolem">x</span> <span class="keyword1">mod</span> <span class="free">q</span> <span class="main">=</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cryptinverts_hilf2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">,</span> <span class="operator">OF</span> <span class="quoted"><span class="quoted">‹prime <span class="free">p</span>›</span></span><span class="main">]</span>
      cryptinverts_hilf3 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">,</span> <span class="operator">OF</span> <span class="quoted"><span class="quoted">‹prime <span class="free">q</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> that Suc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> specializedtoprimes1a<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cryptinverts-primmultgreater"><span class="command">lemma</span></span> primmultgreater<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> prime <span class="free">p</span><span class="main">;</span> prime <span class="free">q</span><span class="main">;</span> <span class="free">p</span> <span class="main">≠</span> <span class="numeral">2</span><span class="main">;</span> <span class="free">q</span> <span class="main">≠</span> <span class="numeral">2</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_nat_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> mult_le_mono <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">q</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Cryptinverts-primmultgreater2"><span class="command">lemma</span></span> primmultgreater2<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>prime <span class="free">p</span><span class="main">;</span> prime <span class="free">q</span><span class="main">;</span> <span class="free">p</span> <span class="main">≠</span> <span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span>  <span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_nat_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_nat_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> primmultgreater<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Cryptinverts-cryptinverts"><span class="command">lemma</span></span> cryptinverts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> prime <span class="free">p</span><span class="main">;</span> prime <span class="free">q</span><span class="main">;</span> <span class="free">p</span> <span class="main">≠</span> <span class="free">q</span><span class="main">;</span> <span class="free">n</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">;</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">;</span>
    <span class="free">e</span><span class="main">*</span><span class="free">d</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="main">(</span>pred <span class="free">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>pred <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">⟧</span> <span class="main">⟹</span> rsa_crypt <span class="main">(</span>rsa_crypt <span class="free">m</span> <span class="free">e</span> <span class="free">n</span><span class="main">)</span> <span class="free">d</span> <span class="free">n</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> cryptinverts_hilf4 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">q</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">e</span></span><span class="main"><span class="main">*</span></span><span class="free"><span class="free">d</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> cryptcorrect <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">p</span></span><span class="main"><span class="main">*</span></span><span class="free"><span class="free">q</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"rsa_crypt <span class="free"><span class="free">m</span></span> <span class="free"><span class="free">e</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">p</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">q</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">d</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> cryptcorrect <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">p</span></span><span class="main"><span class="main">*</span></span><span class="free"><span class="free">q</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">e</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> primmultgreater2 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">q</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_nat_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cryptcorrect remainderexp <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">^</span><span class="free">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span> <span class="quoted"><span class="free">d</span></span><span class="main"><span class="main">]</span></span> power_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="RSAPSS">
<div class="head">
<h1>Theory RSAPSS</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      RSAPSS/RSAPSS.thy
    Author:     Christina Lindenberg, Kai Wirt, Technische Universität Darmstadt
    Copyright:  2005 - Technische Universität Darmstadt 
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"RSS-PSS encoding and decoding operation"</span></span> 

<span class="keyword1"><span class="command">theory</span></span> RSAPSS
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#EMSAPSS">EMSAPSS</a> <a href="#Cryptinverts">Cryptinverts</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define the RSA-PSS signature and verification operations. Moreover we
  show, that messages signed with RSA-PSS can always be verified
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rsapss_sign_help1</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> bv"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rsapss_sign_help1</span> <span class="free"><span class="bound"><span class="entity">em_nat</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span>
    nat_to_bv_length <span class="main">(</span>rsa_crypt <span class="free"><span class="bound"><span class="entity">em_nat</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rsapss_sign</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> bv"</span></span> <span class="comment1">(* Input: message (an bv), private key, RSA modulus; Output: signature (an bv)*)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rsapss_sign</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span>
   <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>emsapss_encode <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> 
    <span class="keyword1">then</span> <span class="main">[]</span>
    <span class="keyword1">else</span> <span class="main">(</span>rsapss_sign_help1 <span class="main">(</span>bv_to_nat <span class="main">(</span>emsapss_encode <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rsapss_verify</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bv <span class="main">⇒</span> bv <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span> <span class="comment1">(* Input:  Message, Signature to be verified (an bv), public key, RSA modulus; Output: valid or invalid signature *)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rsapss_verify</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span>
   <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">≠</span> length<span class="main">(</span>nat_to_bv <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>
    <span class="keyword1">then</span> False
    <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">em</span> <span class="main">=</span> nat_to_bv_length <span class="main">(</span>rsa_crypt <span class="main">(</span>bv_to_nat <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>roundup <span class="main">(</span>length<span class="main">(</span>nat_to_bv <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="numeral">8</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">8</span><span class="main">)</span> <span class="keyword1">in</span> emsapss_decode <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="bound">em</span> <span class="main">(</span>length<span class="main">(</span>nat_to_bv <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="RSAPSS-length_emsapss_encode"><span class="command">lemma</span></span> length_emsapss_encode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"emsapss_encode <span class="free">m</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> length <span class="main">(</span>emsapss_encode <span class="free">m</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> roundup <span class="free">x</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">atomize</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_encode_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_encode_help1_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_encode_help2_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_encode_help3_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_encode_help4_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_encode_help5_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_encode_help6_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_encode_help7_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_encode_help8_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> maskedDB_zero_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_generate_DB<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sha1len<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bvxor<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_generate_PS<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_bv_prepend<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MGF_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MGF1_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_MGF2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sha1len<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_generate_DB<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_generate_PS<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BC_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> roundup_ge_emBits <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">8</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max.absorb1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RSAPSS-bv_to_nat_emsapss_encode_le"><span class="command">lemma</span></span> bv_to_nat_emsapss_encode_le<span class="main">:</span> <span class="quoted"><span class="quoted">"emsapss_encode <span class="free">m</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> bv_to_nat <span class="main">(</span>emsapss_encode <span class="free">m</span> <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>roundup <span class="free">x</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> length_emsapss_encode <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> bv_to_nat_upper_range <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"emsapss_encode <span class="free"><span class="free">m</span></span> <span class="free"><span class="free">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="RSAPSS-length_helper1"><span class="command">lemma</span></span> length_helper1<span class="main">:</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length
  <span class="main">(</span>bvxor
  <span class="main">(</span>generate_DB
  <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
  <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>length
  <span class="main">(</span>generate_DB
  <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
  <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">@</span>
  sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span> <span class="main">@</span> BC<span class="main">)</span>
  <span class="main">=</span> length 
  <span class="main">(</span>bvxor
  <span class="main">(</span>generate_DB
  <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
  <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>length
  <span class="main">(</span>generate_DB
  <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
  <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">168</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"length BC <span class="main">=</span> <span class="numeral">8</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BC_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">160</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sha1len<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> length <span class="main">(</span><span class="bound">a</span><span class="main">@</span><span class="bound">b</span><span class="main">@</span><span class="bound">c</span><span class="main">)</span> <span class="main">=</span> length <span class="bound">a</span> <span class="main">+</span> length <span class="bound">b</span> <span class="main">+</span> length <span class="bound">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> a <span class="keyword2"><span class="keyword">and</span></span> b <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RSAPSS-MGFLen_helper"><span class="command">lemma</span></span> MGFLen_helper<span class="main">:</span> <span class="quoted"><span class="quoted">"MGF <span class="free">z</span> <span class="free">l</span> <span class="main">~=</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">l</span> <span class="main">&lt;=</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">32</span><span class="main">*</span><span class="main">(</span>length <span class="main">(</span>sha1 <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="numeral">32</span><span class="main">*</span>length <span class="main">(</span>sha1 <span class="free">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">l</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"MGF <span class="free">z</span> <span class="free">l</span> <span class="main">~=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="numeral">32</span> <span class="main">*</span> length <span class="main">(</span>sha1 <span class="free">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">l</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"MGF <span class="free">z</span> <span class="free">l</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"MGF <span class="free">z</span> <span class="free">l</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MGF_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main">~=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">32</span><span class="main">*</span>length<span class="main">(</span>sha1 <span class="free">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"MGF <span class="free">z</span> <span class="free">l</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> MGF_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">32</span> <span class="main">*</span> length <span class="main">(</span>sha1 <span class="free">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">l</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RSAPSS-length_helper2"><span class="command">lemma</span></span> length_helper2<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">q</span>"</span></span> 
                      <span class="keyword2"><span class="keyword">and</span></span> mgf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>length
  <span class="main">(</span>generate_DB
  <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
  <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">~=</span> <span class="main">[]</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>sha1 <span class="free">M</span><span class="main">)</span> <span class="main">+</span> sLen <span class="main">+</span> <span class="numeral">16</span> <span class="main">≤</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length
  <span class="main">(</span>
  <span class="main">(</span>bvxor
  <span class="main">(</span>generate_DB
  <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
  <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>length
  <span class="main">(</span>generate_DB
  <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
  <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">)</span> <span class="main">=</span> <span class="main">(</span>roundup <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="numeral">8</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="numeral">168</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>length
  <span class="main">(</span>generate_DB
  <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
  <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length
  <span class="main">(</span>generate_DB
  <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
  <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span>length
  <span class="main">(</span>generate_DB
  <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
  <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_DB_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length
  <span class="main">(</span>generate_DB
  <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
  <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">32</span> <span class="main">*</span> length <span class="main">(</span>sha1 <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mgf <span class="keyword2"><span class="keyword">and</span></span> MGFLen_helper <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> length_MGF <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>generate_DB
  <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
  <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>roundup <span class="main">(</span><span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="numeral">8</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="numeral">168</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;=</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">&lt;</span><span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_nat_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">&lt;</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_nat_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">&lt;</span><span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">&lt;</span><span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> len_nat_to_bv_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> solve_length_generate_DB <span class="keyword1"><span class="command">using</span></span> len <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>bvxor
    <span class="main">(</span>generate_DB
    <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
    <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>length
    <span class="main">(</span>generate_DB
    <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
    <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    roundup <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="numeral">168</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword2"><span class="keyword">and</span></span> b <span class="keyword2"><span class="keyword">and</span></span> length_bvxor <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RSAPSS-emBits_roundup_cancel"><span class="command">lemma</span></span> emBits_roundup_cancel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">emBits</span> <span class="keyword1">mod</span> <span class="numeral">8</span> <span class="main">~=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span>roundup <span class="free">emBits</span> <span class="numeral">8</span><span class="main">)</span><span class="main">*</span><span class="numeral">8</span> <span class="main">-</span> <span class="free">emBits</span> <span class="main">=</span> <span class="numeral">8</span><span class="main">-</span><span class="main">(</span><span class="free">emBits</span> <span class="keyword1">mod</span> <span class="numeral">8</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> roundup<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">arith</span><span class="main">)</span>

<span class="keyword1" id="RSAPSS-emBits_roundup_cancel2"><span class="command">lemma</span></span> emBits_roundup_cancel2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">emBits</span> <span class="keyword1">mod</span> <span class="numeral">8</span> <span class="main">~=</span><span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span>roundup <span class="free">emBits</span> <span class="numeral">8</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">8</span><span class="main">-</span><span class="main">(</span><span class="free">emBits</span> <span class="keyword1">mod</span> <span class="numeral">8</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">emBits</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> roundup<span class="main">)</span>

<span class="keyword1" id="RSAPSS-length_bound"><span class="command">lemma</span></span> length_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">emBits</span> <span class="keyword1">mod</span> <span class="numeral">8</span> <span class="main">~=</span><span class="main">0</span><span class="main">;</span> <span class="numeral">8</span> <span class="main">&lt;=</span> <span class="main">(</span>length <span class="free">maskedDB</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> length <span class="main">(</span>remzero <span class="main">(</span><span class="main">(</span>maskedDB_zero <span class="free">maskedDB</span> <span class="free">emBits</span><span class="main">)</span><span class="main">@</span><span class="free">a</span><span class="main">@</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;=</span> length <span class="main">(</span><span class="free">maskedDB</span><span class="main">@</span><span class="free">a</span><span class="main">@</span><span class="free">b</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">8</span><span class="main">-</span><span class="main">(</span><span class="free">emBits</span> <span class="keyword1">mod</span> <span class="numeral">8</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">emBits</span> <span class="keyword1">mod</span> <span class="numeral">8</span> <span class="main">~=</span><span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">8</span> <span class="main">&lt;=</span> <span class="main">(</span>length <span class="free">maskedDB</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">⋀</span> <span class="bound">a</span><span class="main">.</span> length <span class="main">(</span>remzero <span class="bound">a</span><span class="main">)</span> <span class="main">&lt;=</span> length <span class="bound">a</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>remzero <span class="skolem">a</span><span class="main">)</span> <span class="main">&lt;=</span> length <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">(</span>remzero <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;=</span> length <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">hd</span> <span class="skolem">tl</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">(</span>remzero <span class="main">(</span><span class="skolem">hd</span><span class="main">#</span><span class="skolem">tl</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;=</span> length <span class="main">(</span><span class="skolem">hd</span><span class="main">#</span><span class="skolem">tl</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">hd</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hd</span><span class="main">=</span><span class="main">𝟬</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"remzero <span class="main">(</span><span class="skolem">hd</span><span class="main">#</span><span class="skolem">tl</span><span class="main">)</span> <span class="main">=</span> remzero <span class="skolem">tl</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hd</span><span class="main">=</span><span class="main">𝟭</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"remzero <span class="main">(</span><span class="skolem">hd</span><span class="main">#</span><span class="skolem">tl</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">hd</span><span class="main">#</span><span class="skolem">tl</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> len <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>remzero <span class="main">(</span>maskedDB_zero <span class="free">maskedDB</span> <span class="free">emBits</span> <span class="main">@</span> <span class="free">a</span> <span class="main">@</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span><span class="free">maskedDB</span> <span class="main">@</span> <span class="free">a</span> <span class="main">@</span> <span class="free">b</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">8</span> <span class="main">-</span> <span class="free">emBits</span> <span class="keyword1">mod</span> <span class="numeral">8</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"remzero<span class="main">(</span>bv_prepend <span class="main">(</span><span class="main">(</span>roundup <span class="free">emBits</span> <span class="numeral">8</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="free">emBits</span><span class="main">)</span>
      <span class="main">𝟬</span> <span class="main">(</span>drop <span class="main">(</span><span class="main">(</span>roundup <span class="free">emBits</span> <span class="numeral">8</span><span class="main">)</span><span class="main">*</span><span class="numeral">8</span> <span class="main">-</span> <span class="free">emBits</span><span class="main">)</span> <span class="free">maskedDB</span><span class="main">)</span><span class="main">@</span><span class="free">a</span><span class="main">@</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> remzero <span class="main">(</span><span class="main">(</span>drop <span class="main">(</span><span class="main">(</span>roundup <span class="free">emBits</span> <span class="numeral">8</span><span class="main">)</span><span class="main">*</span><span class="numeral">8</span> <span class="main">-</span><span class="free">emBits</span><span class="main">)</span> <span class="free">maskedDB</span><span class="main">)</span><span class="main">@</span><span class="free">a</span><span class="main">@</span><span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> remzero_replicate <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_prepend<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> emBits_roundup_cancel <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"roundup <span class="free">emBits</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="free">emBits</span> <span class="main">=</span> <span class="numeral">8</span> <span class="main">-</span> <span class="free">emBits</span> <span class="keyword1">mod</span> <span class="numeral">8</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="main">(</span>drop <span class="main">(</span><span class="numeral">8</span><span class="main">-</span><span class="free">emBits</span> <span class="keyword1">mod</span> <span class="numeral">8</span><span class="main">)</span> <span class="free">maskedDB</span><span class="main">)</span><span class="main">@</span><span class="free">a</span><span class="main">@</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="free">maskedDB</span><span class="main">@</span><span class="free">a</span><span class="main">@</span><span class="free">b</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">8</span><span class="main">-</span><span class="free">emBits</span> <span class="keyword1">mod</span> <span class="numeral">8</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> length_drop<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">8</span><span class="main">-</span><span class="free">emBits</span> <span class="keyword1">mod</span> <span class="numeral">8</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">maskedDB</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;=</span> <span class="free">emBits</span> <span class="keyword1">mod</span> <span class="numeral">8</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">8</span><span class="main">-</span><span class="main">(</span><span class="free">emBits</span> <span class="keyword1">mod</span> <span class="numeral">8</span><span class="main">)</span> <span class="main">&lt;=</span> <span class="numeral">8</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"length <span class="free">maskedDB</span> <span class="main">+</span> <span class="free">emBits</span> <span class="keyword1">mod</span> <span class="numeral">8</span> <span class="main">-</span> <span class="numeral">8</span> <span class="main">+</span> <span class="main">(</span>length <span class="free">a</span> <span class="main">+</span> length <span class="free">b</span><span class="main">)</span> <span class="main">=</span>
          length <span class="free">maskedDB</span> <span class="main">+</span> <span class="main">(</span>length <span class="free">a</span> <span class="main">+</span> length <span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="free">emBits</span> <span class="keyword1">mod</span> <span class="numeral">8</span> <span class="main">-</span> <span class="numeral">8</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>drop <span class="main">(</span><span class="main">(</span>roundup <span class="free">emBits</span> <span class="numeral">8</span><span class="main">)</span><span class="main">*</span><span class="numeral">8</span> <span class="main">-</span> <span class="free">emBits</span><span class="main">)</span> <span class="free">maskedDB</span><span class="main">)</span><span class="main">@</span><span class="free">a</span><span class="main">@</span><span class="free">b</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> maskedDB_zero_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RSAPSS-length_bound2"><span class="command">lemma</span></span> length_bound2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">8</span><span class="main">&lt;=</span>length <span class="main">(</span> <span class="main">(</span>bvxor
  <span class="main">(</span>generate_DB
  <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
  <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>length
  <span class="main">(</span>generate_DB
  <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
  <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">8</span> <span class="main">&lt;=</span> length <span class="main">(</span>generate_DB
  <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
  <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_DB_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> length_bvxor_bound <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RSAPSS-length_helper"><span class="command">lemma</span></span> length_helper<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">8</span> <span class="main">~=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mgf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>length
  <span class="main">(</span>generate_DB
  <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
  <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">~=</span> <span class="main">[]</span>"</span></span>  
  <span class="keyword2"><span class="keyword">and</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>sha1 <span class="free">M</span><span class="main">)</span> <span class="main">+</span> sLen <span class="main">+</span> <span class="numeral">16</span> <span class="main">≤</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length
  <span class="main">(</span>remzero
  <span class="main">(</span>maskedDB_zero
  <span class="main">(</span>bvxor
  <span class="main">(</span>generate_DB
  <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
  <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>length
  <span class="main">(</span>generate_DB
  <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
  <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">@</span>
  sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span> <span class="main">@</span> BC<span class="main">)</span><span class="main">)</span>
  <span class="main">&lt;</span> length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> mgf <span class="keyword1"><span class="command">have</span></span> round<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">168</span> <span class="main">&lt;=</span> roundup <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sha1len sLen_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> len <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">160</span> <span class="main">+</span> sLen <span class="main">+</span><span class="numeral">16</span> <span class="main">≤</span> length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sha1len<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> len1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">176</span> <span class="main">&lt;=</span> length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;=</span> <span class="main">(</span>roundup <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="numeral">8</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">8</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> roundup
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">8</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> len2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">8</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">8</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">8</span> <span class="keyword1">else</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">8</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">=</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">=</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len2
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span>
        <span class="main">≤</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">8</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">8</span> <span class="keyword1">else</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">8</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">8</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> len2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">8</span> <span class="main">~=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">8</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">8</span> <span class="keyword1">else</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">8</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">8</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">8</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;=</span> <span class="main">(</span><span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">8</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="numeral">8</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span>
        <span class="main">≤</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">8</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">8</span> <span class="keyword1">else</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">8</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">8</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">168</span> <span class="main">≤</span> roundup <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"length
    <span class="main">(</span>remzero
    <span class="main">(</span>maskedDB_zero
    <span class="main">(</span>bvxor
    <span class="main">(</span>generate_DB
    <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
    <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>length
    <span class="main">(</span>generate_DB
    <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
    <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">@</span>
    sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span> <span class="main">@</span> BC<span class="main">)</span><span class="main">)</span> <span class="main">&lt;=</span> length <span class="main">(</span><span class="main">(</span>bvxor
    <span class="main">(</span>generate_DB
    <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
    <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>length
    <span class="main">(</span>generate_DB
    <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
    <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span>
    sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span> <span class="main">@</span> BC<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">8</span> <span class="main">-</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">8</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> length_bound <span class="keyword2"><span class="keyword">and</span></span> length_bound2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">" length <span class="main">(</span>bvxor <span class="main">(</span>generate_DB <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">(</span>MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>generate_DB <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span>
            sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span> <span class="main">@</span> BC<span class="main">)</span> <span class="main">=</span>  length <span class="main">(</span>bvxor <span class="main">(</span>generate_DB <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">(</span>MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>generate_DB <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span><span class="numeral">168</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> length_helper1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>bvxor <span class="main">(</span>generate_DB <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">(</span>MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>generate_DB <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
            <span class="main">(</span>roundup <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="numeral">8</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="numeral">168</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p <span class="keyword2"><span class="keyword">and</span></span> q <span class="keyword2"><span class="keyword">and</span></span> length_helper2 <span class="keyword2"><span class="keyword">and</span></span> mgf <span class="keyword2"><span class="keyword">and</span></span> len <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> a <span class="keyword2"><span class="keyword">and</span></span> b <span class="keyword2"><span class="keyword">and</span></span> c <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" length <span class="main">(</span>remzero <span class="main">(</span>maskedDB_zero
                    <span class="main">(</span>bvxor <span class="main">(</span>generate_DB <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">(</span>MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
                        <span class="main">(</span>length <span class="main">(</span>generate_DB <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">@</span>
                   sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span> <span class="main">@</span> BC<span class="main">)</span><span class="main">)</span> <span class="main">&lt;=</span>  roundup <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="numeral">168</span> <span class="main">+</span><span class="numeral">168</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">8</span> <span class="main">-</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">8</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>remzero <span class="main">(</span>maskedDB_zero
                    <span class="main">(</span>bvxor <span class="main">(</span>generate_DB <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">(</span>MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
                        <span class="main">(</span>length <span class="main">(</span>generate_DB <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">@</span>
                   sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span> <span class="main">@</span> BC<span class="main">)</span><span class="main">)</span> <span class="main">&lt;=</span> roundup <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">8</span> <span class="main">-</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">8</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> round <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"  roundup <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">8</span> <span class="main">-</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">8</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">-</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword2"><span class="keyword">and</span></span> emBits_roundup_cancel2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">&lt;</span><span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_nat_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">&lt;</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_nat_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">&lt;</span><span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">&lt;</span><span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> len_nat_to_bv_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RSAPSS-length_emsapss_smaller_pq"><span class="command">lemma</span></span> length_emsapss_smaller_pq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>prime <span class="free">p</span><span class="main">;</span> prime <span class="free">q</span><span class="main">;</span> emsapss_encode <span class="free">m</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">8</span> <span class="main">~=</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span>  length <span class="main">(</span>remzero <span class="main">(</span>emsapss_encode <span class="free">m</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"emsapss_encode <span class="free">m</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">q</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">8</span> <span class="main">~=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">" emsapss_encode <span class="free">m</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">=</span> emsapss_encode_help1 <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span>
    <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> emsapss_encode_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">64</span> <span class="main">≤</span> length <span class="free">m</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">32</span> <span class="main">*</span> <span class="numeral">160</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">then</span> <span class="main">[]</span>
      <span class="keyword1">else</span> <span class="main">(</span>emsapss_encode_help1 <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>emsapss_encode_help1 <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_encode_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>remzero <span class="main">(</span>emsapss_encode_help1 <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> emsapss_encode_help1_def<span class="main">)</span> 
     <span class="keyword1"><span class="command">from</span></span> a <span class="keyword2"><span class="keyword">and</span></span> b <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> <span class="main">+</span> sLen <span class="main">+</span> <span class="numeral">16</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">then</span> <span class="main">[]</span>
      <span class="keyword1">else</span> <span class="main">(</span>emsapss_encode_help2 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span>
      <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>emsapss_encode_help2 <span class="main">(</span><span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span><span class="main">)</span> salt<span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_encode_def emsapss_encode_help1_def<span class="main">)</span>
     <span class="keyword1"><span class="command">from</span></span> d <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> <span class="main">+</span> sLen <span class="main">+</span> <span class="numeral">16</span> <span class="main">&lt;=</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> length <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> <span class="main">+</span> sLen <span class="main">+</span> <span class="numeral">16</span>"</span></span><span class="main">)</span>
       <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> length <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> <span class="main">+</span> sLen <span class="main">+</span> <span class="numeral">16</span>"</span></span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> len1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> length <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> <span class="main">+</span> sLen <span class="main">+</span> <span class="numeral">16</span> <span class="keyword1">then</span> <span class="main">[]</span>
      <span class="keyword1">else</span> emsapss_encode_help2 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
       <span class="keyword3"><span class="command">assume</span></span> len2<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> length <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> <span class="main">+</span> sLen <span class="main">+</span> <span class="numeral">16</span> <span class="keyword1">then</span> <span class="main">[]</span>
      <span class="keyword1">else</span> emsapss_encode_help2 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
     emsapss_encode_help2 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">from</span></span> len1 <span class="keyword2"><span class="keyword">and</span></span> len2 <span class="keyword2"><span class="keyword">and</span></span> a <span class="keyword2"><span class="keyword">and</span></span> b <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> <span class="main">+</span> sLen <span class="main">+</span> <span class="numeral">16</span> <span class="main">≤</span> length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_encode_def emsapss_encode_help1_def<span class="main">)</span>
     <span class="keyword1"><span class="command">next</span></span>
       <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> length <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> <span class="main">+</span> sLen <span class="main">+</span> <span class="numeral">16</span>"</span></span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> <span class="main">+</span> sLen <span class="main">+</span> <span class="numeral">16</span> <span class="main">≤</span> length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>remzero <span class="main">(</span>emsapss_encode_help2 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span>
   <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> emsapss_encode_help2_def<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length
          <span class="main">(</span>remzero
          <span class="main">(</span>emsapss_encode_help3 <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
          <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">&lt;</span> length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_encode_help3_def emsapss_encode_help4_def emsapss_encode_help5_def<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length
            <span class="main">(</span>remzero
            <span class="main">(</span>emsapss_encode_help6
            <span class="main">(</span>generate_DB
            <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
            <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span>MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
            <span class="main">(</span>length
            <span class="main">(</span>generate_DB
            <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
            <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
            <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">&lt;</span> length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> emsapss_encode_help6_def<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> a <span class="keyword2"><span class="keyword">and</span></span> b <span class="keyword2"><span class="keyword">and</span></span> d <span class="keyword1"><span class="command">have</span></span> mgf<span class="main">:</span> <span class="quoted"><span class="quoted">"MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
              <span class="main">(</span>length
              <span class="main">(</span>generate_DB
              <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
              <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">~=</span>
              <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_encode_def emsapss_encode_help1_def emsapss_encode_help2_def emsapss_encode_help3_def emsapss_encode_help4_def emsapss_encode_help5_def emsapss_encode_help6_def<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> a <span class="keyword2"><span class="keyword">and</span></span> b <span class="keyword2"><span class="keyword">and</span></span> d <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
              <span class="main">(</span>length
              <span class="main">(</span>generate_DB
              <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
              <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">[]</span>
              <span class="keyword1">then</span> <span class="main">[]</span>
              <span class="keyword1">else</span> <span class="main">(</span>emsapss_encode_help7
              <span class="main">(</span>bvxor
              <span class="main">(</span>generate_DB
              <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
              <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">(</span>MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
              <span class="main">(</span>length
              <span class="main">(</span>generate_DB
              <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
              <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
              <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>emsapss_encode_help7
              <span class="main">(</span>bvxor
              <span class="main">(</span>generate_DB
              <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
              <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">(</span>MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
              <span class="main">(</span>length
              <span class="main">(</span>generate_DB
              <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
              <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
              <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_encode_def emsapss_encode_help1_def emsapss_encode_help2_def
                emsapss_encode_help3_def emsapss_encode_help4_def emsapss_encode_help5_def
                emsapss_encode_help6_def<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>remzero <span class="main">(</span>emsapss_encode_help7
              <span class="main">(</span>bvxor
              <span class="main">(</span>generate_DB
              <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
              <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">(</span>MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
              <span class="main">(</span>length
              <span class="main">(</span>generate_DB
              <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
              <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emsapss_encode_help7_def emsapss_encode_help8_def<span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> p <span class="keyword2"><span class="keyword">and</span></span> q <span class="keyword2"><span class="keyword">and</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" length
                <span class="main">(</span>remzero
                <span class="main">(</span>maskedDB_zero
                <span class="main">(</span>bvxor
                <span class="main">(</span>generate_DB
                <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
                <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">(</span>MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
                <span class="main">(</span>length
                <span class="main">(</span>generate_DB
                <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
                <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">@</span>
                sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span> <span class="main">@</span> BC<span class="main">)</span><span class="main">)</span>
                <span class="main">&lt;</span> length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"length_helper"</span> <span class="keyword2"><span class="keyword">and</span></span> len <span class="keyword2"><span class="keyword">and</span></span> mgf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length
              <span class="main">(</span>remzero
              <span class="main">(</span><span class="keyword1">if</span> MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
              <span class="main">(</span>length
              <span class="main">(</span>generate_DB
              <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
              <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">[]</span>
              <span class="keyword1">then</span> <span class="main">[]</span>
              <span class="keyword1">else</span> emsapss_encode_help7
              <span class="main">(</span>bvxor
              <span class="main">(</span>generate_DB
              <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
              <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">(</span>MGF <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
              <span class="main">(</span>length
              <span class="main">(</span>generate_DB
              <span class="main">(</span>generate_PS <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
              <span class="main">(</span>length <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">(</span>sha1 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span><span class="main">)</span>
              <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">&lt;</span> length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> d <span class="keyword2"><span class="keyword">and</span></span> e <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length
      <span class="main">(</span>remzero
      <span class="main">(</span><span class="keyword1">if</span> length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> length <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> <span class="main">+</span> sLen <span class="main">+</span> <span class="numeral">16</span>
      <span class="keyword1">then</span> <span class="main">[]</span>
      <span class="keyword1">else</span> emsapss_encode_help2 <span class="main">(</span>generate_M' <span class="main">(</span>sha1 <span class="free">m</span><span class="main">)</span> salt<span class="main">)</span>
      <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">&lt;</span> length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> b <span class="keyword2"><span class="keyword">and</span></span> c <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RSAPSS-bv_to_nat_emsapss_smaller_pq"><span class="command">lemma</span></span> bv_to_nat_emsapss_smaller_pq<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pneq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">~=</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"emsapss_encode <span class="free">m</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="main">(</span>emsapss_encode <span class="free">m</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> a <span class="keyword2"><span class="keyword">and</span></span> b <span class="keyword2"><span class="keyword">and</span></span> c <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="numeral">8</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">8</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>roundup <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> d <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"roundup <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">=</span> length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rnddvd <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">*</span><span class="free">q</span> <span class="main">=</span> bv_to_nat <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_nat_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_nat_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">~=</span> <span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword2"><span class="keyword">and</span></span> b <span class="keyword2"><span class="keyword">and</span></span> prime_equal <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> pneq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">~=</span> <span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> len_lower_bound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> e <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="main">(</span>emsapss_encode <span class="free">m</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>roundup <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="numeral">8</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> bv_to_nat_emsapss_encode_le <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">(</span><span class="numeral">8</span> <span class="keyword1">dvd</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> y <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">(</span><span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">8</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_eq_mod_eq_0<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> remzeroeq <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="main">(</span>emsapss_encode <span class="free">m</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> bv_to_nat <span class="main">(</span>remzero <span class="main">(</span>emsapss_encode <span class="free">m</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> a <span class="keyword2"><span class="keyword">and</span></span> b <span class="keyword2"><span class="keyword">and</span></span> c <span class="keyword2"><span class="keyword">and</span></span> x <span class="keyword2"><span class="keyword">and</span></span> length_emsapss_smaller_pq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="main">(</span>remzero <span class="main">(</span>emsapss_encode <span class="free">m</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> bv_to_nat <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> length_lower<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"remzero <span class="main">(</span>emsapss_encode <span class="free">m</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> prime_hd_non_zero<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bv_to_nat <span class="main">(</span>emsapss_encode <span class="free">m</span> <span class="main">(</span>length <span class="main">(</span>nat_to_bv <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="main">*</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d <span class="keyword2"><span class="keyword">and</span></span> bv_nat_bv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RSAPSS-rsa_pss_verify"><span class="command">lemma</span></span> rsa_pss_verify<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> prime <span class="free">p</span><span class="main">;</span> prime <span class="free">q</span><span class="main">;</span> <span class="free">p</span> <span class="main">≠</span> <span class="free">q</span><span class="main">;</span> <span class="free">n</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">;</span> <span class="free">e</span><span class="main">*</span><span class="free">d</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="main">(</span>pred <span class="free">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>pred <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">;</span> rsapss_sign <span class="free">m</span> <span class="free">e</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> <span class="free">s</span> <span class="main">=</span> rsapss_sign <span class="free">m</span> <span class="free">e</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span> rsapss_verify <span class="free">m</span> <span class="free">s</span> <span class="free">d</span> <span class="free">n</span> <span class="main">=</span> True"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> rsapss_sign_def rsapss_verify_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> rsapss_sign_help1_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_nat_to_bv_length<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bv_to_nat_nat_to_bv_length<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> length_emsapss_encode <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>length <span class="main"><span class="main">(</span></span>nat_to_bv <span class="main"><span class="main">(</span></span><span class="free"><span class="free">p</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">q</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">-</span></span> Suc <span class="main"><span class="main">0</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> bv_to_nat_emsapss_smaller_pq <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">q</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cryptinverts<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> length_emsapss_encode <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>length <span class="main"><span class="main">(</span></span>nat_to_bv <span class="main"><span class="main">(</span></span><span class="free"><span class="free">p</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">q</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">-</span></span> Suc <span class="main"><span class="main">0</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> nat_to_bv_length_bv_to_nat <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"emsapss_encode <span class="free"><span class="free">m</span></span> <span class="main"><span class="main">(</span></span>length <span class="main"><span class="main">(</span></span>nat_to_bv <span class="main"><span class="main">(</span></span><span class="free"><span class="free">p</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">q</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">-</span></span> Suc <span class="main"><span class="main">0</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"roundup <span class="main"><span class="main">(</span></span>length <span class="main"><span class="main">(</span></span>nat_to_bv <span class="main"><span class="main">(</span></span><span class="free"><span class="free">p</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">q</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">-</span></span> Suc <span class="main"><span class="main">0</span></span><span class="main"><span class="main">)</span></span> <span class="numeral"><span class="numeral">8</span></span> <span class="main"><span class="main">*</span></span> <span class="numeral"><span class="numeral">8</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> verify<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div>