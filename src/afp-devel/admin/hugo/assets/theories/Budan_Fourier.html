<div id="BF_Misc">
<div class="head">
<h1>Theory BF_Misc</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:     Wenda Li &lt;wl302@cam.ac.uk / liwenda1990@hotmail.com&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Misc results for polynomials and sign variations"</span></span>

<span class="keyword1"><span class="command">theory</span></span> BF_Misc <span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Computational_Algebra/Polynomial_Factorial.html">HOL-Computational_Algebra.Polynomial_Factorial</a>"</span>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Computational_Algebra/Fundamental_Theorem_Algebra.html">HOL-Computational_Algebra.Fundamental_Theorem_Algebra</a>"</span>
  <a href="../../sturm_tarski/theories/#Sturm_Tarski">Sturm_Tarski.Sturm_Tarski</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Induction on polynomial roots›</span></span>

<span class="comment1">(*adapted from the poly_root_induct in Polynomial.thy.*)</span>
<span class="keyword1" id="BF_Misc-poly_root_induct_alt"><span class="command">lemma</span></span> poly_root_induct_alt <span class="main">[</span><span class="operator">case_names</span> 0 no_proots root<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">p</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">p</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Q</span> <span class="main">0</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">a</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">a</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> pq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dvdE poly_eq_0_iff_dvd<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span><span class="main">&lt;</span>degree <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_mult_eq<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> pq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Misc›</span></span>

<span class="keyword1" id="BF_Misc-lead_coeff_pderiv"><span class="command">lemma</span></span> lead_coeff_pderiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_semiring_1<span class="main">,</span>semiring_no_zero_divisors<span class="main">,</span>semiring_char_0<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">*</span> lead_coeff <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>degree_pderiv coeff_pderiv<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_eq_0<span class="main">)</span>

<span class="keyword1" id="BF_Misc-gcd_degree_le_min"><span class="command">lemma</span></span> gcd_degree_le_min<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>gcd <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> min <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">(</span>degree <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> dvd_imp_degree_le<span class="main">)</span>

<span class="keyword1" id="BF_Misc-lead_coeff_normalize_field"><span class="command">lemma</span></span> lead_coeff_normalize_field<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">,</span>semidom_divide_unit_factor<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>normalize <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms coeff_normalize divide_self_if dvd_field_iff 
      is_unit_unit_factor leading_coeff_0_iff normalize_eq_0_iff normalize_idem<span class="main">)</span>

<span class="keyword1" id="BF_Misc-smult_normalize_field_eq"><span class="command">lemma</span></span> smult_normalize_field_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">,</span>semidom_divide_unit_factor<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> smult <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">(</span>normalize <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unit_factor <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">=</span> lead_coeff <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_field_iff is_unit_unit_factor unit_factor_0<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="skolem">n</span> <span class="main">=</span> coeff <span class="main">(</span>smult <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">(</span>normalize <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BF_Misc-lead_coeff_gcd_field"><span class="command">lemma</span></span> lead_coeff_gcd_field<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field_gcd poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span> <span class="main">∨</span> <span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>gcd <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gcd.normalize_idem gcd_eq_0_iff lead_coeff_normalize_field<span class="main">)</span>

<span class="keyword1" id="BF_Misc-poly_gcd_0_iff"><span class="command">lemma</span></span> poly_gcd_0_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly <span class="main">(</span>gcd <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> poly <span class="free">q</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>poly_eq_0_iff_dvd<span class="main">)</span>

<span class="keyword1" id="BF_Misc-degree_eq_oneE"><span class="command">lemma</span></span> degree_eq_oneE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>zero poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">a</span> <span class="free">b</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[:</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">:]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">≠</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span>pCons <span class="skolem">a</span> <span class="main">(</span>pCons <span class="skolem">b</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> pCons_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">[:</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More results about sign variations (i.e. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">changes</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="BF_Misc-changes_0"><span class="command">lemma</span></span> changes_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"changes <span class="main">(</span><span class="main">0</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> changes <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="BF_Misc-changes_Cons"><span class="command">lemma</span></span> changes_Cons<span class="main">:</span><span class="quoted"><span class="quoted">"changes <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> 
                            <span class="main">0</span> 
                          <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">x</span><span class="main">*</span> hd <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> 
                            <span class="main">1</span> <span class="main">+</span> changes <span class="free">xs</span> 
                          <span class="keyword1">else</span> changes <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="BF_Misc-changes_filter_eq"><span class="command">lemma</span></span> changes_filter_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"changes <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> changes <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>changes_Cons<span class="main">)</span>

<span class="keyword1" id="BF_Misc-changes_filter_empty"><span class="command">lemma</span></span> changes_filter_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes <span class="free">xs</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> changes_0 neq_Nil_conv<span class="main">)</span>

<span class="keyword1" id="BF_Misc-changes_append"><span class="command">lemma</span></span> changes_append<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span><span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">ys</span><span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="main">(</span>last <span class="free">xs</span> <span class="main">=</span> hd <span class="free">ys</span> <span class="main">∧</span> last <span class="free">xs</span><span class="main">≠</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">ys</span><span class="main">)</span> <span class="main">=</span> changes <span class="free">xs</span> <span class="main">+</span> changes <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span><span class="main">=</span><span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that Cons 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span><span class="main">=</span><span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span><span class="main">≠</span><span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">≠</span><span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that Cons 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> filter.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> filter_append snoc_eq_iff_butlast<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> changes <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">+</span> changes <span class="free">ys</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> changes_Cons<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BF_Misc-changes_drop_dup"><span class="command">lemma</span></span> changes_drop_dup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span><span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span><span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> last <span class="free">xs</span><span class="main">=</span>hd <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">ys</span><span class="main">)</span> <span class="main">=</span> changes <span class="main">(</span><span class="free">xs</span><span class="main">@</span> tl <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span><span class="main">=</span><span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span><span class="main">=</span><span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that Cons
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> changes.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list.exhaust_sel not_square_less_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span><span class="main">≠</span><span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ts</span></span> <span class="skolem"><span class="skolem">ts'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span> <span class="main">=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span> <span class="main">=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> tl <span class="free">ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ts</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> <span class="skolem">ts'</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> hd <span class="skolem">ts</span> <span class="main">=</span> hd <span class="skolem">ts'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">xs</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs</span><span class="main">≠</span><span class="main">[]</span>›</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> append_butlast_last_id append_is_Nil_conv 
            filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> filter_append list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">ys</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">ys</span><span class="main">≠</span><span class="main">[]</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs</span><span class="main">≠</span><span class="main">[]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">ys</span> <span class="main">=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>tl <span class="free">ys</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> list.exhaust_sel that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ts_def ts'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ts_def ts'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> changes <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> tl <span class="free">ys</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">ts</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">a</span> <span class="main">*</span> hd <span class="skolem">ts</span> <span class="main">&lt;</span> <span class="main">0</span> 
            <span class="keyword1">then</span> <span class="main">1</span> <span class="main">+</span> changes <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="keyword1">else</span> changes <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> changes_Cons<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="free">ys</span>"</span></span><span class="main">,</span><span class="operator">folded</span> ts_def<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> tl <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">ts'</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">a</span> <span class="main">*</span> hd <span class="skolem">ts'</span> <span class="main">&lt;</span> <span class="main">0</span> 
            <span class="keyword1">then</span> <span class="main">1</span> <span class="main">+</span> changes <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> tl <span class="free">ys</span><span class="main">)</span> <span class="keyword1">else</span> changes <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> tl <span class="free">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> changes_Cons<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> tl <span class="free">ys</span>"</span></span><span class="main">,</span><span class="operator">folded</span> ts'_def<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*
  TODO: the following lemmas contain duplicates of some lemmas in 
          Winding_Number_Eval/Missing_Algebraic.thy
  Will resolve later.  
*)</span>

<span class="keyword1" id="BF_Misc-Im_poly_of_real"><span class="command">lemma</span></span> Im_poly_of_real<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Im <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span>of_real <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> poly <span class="main">(</span>map_poly Im <span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>map_poly_pCons<span class="main">)</span>
 
<span class="keyword1" id="BF_Misc-Re_poly_of_real"><span class="command">lemma</span></span> Re_poly_of_real<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Re <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span>of_real <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> poly <span class="main">(</span>map_poly Re <span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>map_poly_pCons<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">map_poly</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">of_real</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="BF_Misc-of_real_poly_map_pCons"><span class="command">lemma</span></span> of_real_poly_map_pCons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"map_poly of_real <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> pCons <span class="main">(</span>of_real <span class="free">a</span><span class="main">)</span> <span class="main">(</span>map_poly of_real <span class="free">p</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_poly_pCons<span class="main">)</span>    
    
<span class="keyword1" id="BF_Misc-of_real_poly_map_plus"><span class="command">lemma</span></span> of_real_poly_map_plus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map_poly of_real <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> map_poly of_real <span class="free">p</span> <span class="main">+</span>  map_poly of_real <span class="free">q</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> poly_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_map_poly<span class="main">)</span>  
 
<span class="keyword1" id="BF_Misc-of_real_poly_map_smult"><span class="command">lemma</span></span> of_real_poly_map_smult<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"map_poly of_real <span class="main">(</span>smult <span class="free">s</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> smult <span class="main">(</span>of_real <span class="free">s</span><span class="main">)</span> <span class="main">(</span>map_poly of_real <span class="free">p</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> poly_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_map_poly<span class="main">)</span>    

<span class="keyword1" id="BF_Misc-of_real_poly_map_mult"><span class="command">lemma</span></span> of_real_poly_map_mult<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"map_poly of_real <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> map_poly of_real <span class="free">p</span> <span class="main">*</span> map_poly of_real <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">intro</span> poly_eqI<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
    
<span class="keyword1" id="BF_Misc-of_real_poly_map_poly"><span class="command">lemma</span></span> of_real_poly_map_poly<span class="main">:</span>
  <span class="quoted"><span class="quoted">"of_real <span class="main">(</span>poly <span class="free">p</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> poly <span class="main">(</span>map_poly of_real <span class="free">p</span><span class="main">)</span> <span class="main">(</span>of_real <span class="free">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>    

<span class="keyword1" id="BF_Misc-of_real_poly_map_power"><span class="command">lemma</span></span> of_real_poly_map_power<span class="main">:</span><span class="quoted"><span class="quoted">"map_poly of_real <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>map_poly of_real <span class="free">p</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>

<span class="comment1">(*FIXME: not duplicate*)</span>
<span class="keyword1" id="BF_Misc-of_real_poly_eq_iff"><span class="command">lemma</span></span> of_real_poly_eq_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map_poly of_real <span class="free">p</span> <span class="main">=</span> map_poly of_real <span class="free">q</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_eq_iff coeff_map_poly<span class="main">)</span>

<span class="comment1">(*FIXME: not duplicate*)</span>
<span class="keyword1" id="BF_Misc-of_real_poly_eq_0_iff"><span class="command">lemma</span></span> of_real_poly_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map_poly of_real <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_eq_iff coeff_map_poly<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">order</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="BF_Misc-order_multiplicity_eq"><span class="command">lemma</span></span> order_multiplicity_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"order <span class="free">a</span> <span class="free">p</span> <span class="main">=</span> multiplicity <span class="main">[:</span><span class="main">-</span><span class="free">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms multiplicity_eqI order_1 order_2<span class="main">)</span>

<span class="keyword1" id="BF_Misc-order_gcd"><span class="command">lemma</span></span> order_gcd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="main">(</span>gcd <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> min <span class="main">(</span>order <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>order <span class="free">x</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">[:</span><span class="main">-</span> <span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_elem_linear_poly normalize_poly_def  <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>primeI<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pCons_one<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>order_multiplicity_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>multiplicity_gcd<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BF_Misc-order_linear"><span class="command">lemma</span></span> order_linear<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="main">[:</span><span class="main">-</span><span class="free">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span><span class="main">=</span><span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>order_power_n_n<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span> order_0I<span class="main">)</span>
  
<span class="keyword1" id="BF_Misc-map_poly_order_of_real"><span class="command">lemma</span></span> map_poly_order_of_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"order <span class="main">(</span>of_real <span class="free">t</span><span class="main">)</span> <span class="main">(</span>map_poly of_real <span class="free">p</span><span class="main">)</span> <span class="main">=</span> order <span class="free">t</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>poly_root_induct_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>no_proots <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">t</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> order_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>map_poly of_real <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">x</span><span class="main">)</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> of_real_poly_map_poly<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> no_proots order_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="main">(</span>of_real <span class="free">t</span><span class="main">)</span> <span class="main">(</span>map_poly of_real <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> order_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>root <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span><span class="main">=</span><span class="main">[:</span><span class="main">-</span><span class="skolem">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a1</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a1_def <span class="keyword1"><span class="command">using</span></span> root<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="main">(</span>of_real <span class="free">t</span><span class="main">)</span> <span class="main">(</span>map_poly of_real <span class="skolem">a1</span><span class="main">)</span> <span class="main">=</span> order <span class="free">t</span> <span class="skolem">a1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> a1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> a1_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>order_mult root<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BF_Misc-order_pcompose"><span class="command">lemma</span></span> order_pcompose<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pcompose <span class="free">p</span> <span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="main">(</span>pcompose <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> order <span class="free">x</span> <span class="main">(</span><span class="free">q</span><span class="main">-</span><span class="main">[:</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">:]</span><span class="main">)</span> <span class="main">*</span> order <span class="main">(</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">)</span> <span class="free">p</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹pcompose <span class="free">p</span> <span class="free">q</span><span class="main">≠</span><span class="main">0</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>poly_root_induct_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>no_proots <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_0I<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> no_proots <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>poly_pcompose<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="main">(</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_0I<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> no_proots <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>poly_pcompose<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>root <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span><span class="main">=</span><span class="main">[:</span><span class="main">-</span><span class="skolem">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> root<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> a1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> root<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">using</span></span> root<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> a1_def<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>pcompose_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a1</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> order <span class="free">x</span> <span class="main">(</span><span class="skolem">a1</span>  <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main">+</span> order <span class="free">x</span> <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pcompose_mult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> order <span class="free">x</span> <span class="main">(</span><span class="free">q</span><span class="main">-</span><span class="main">[:</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">:]</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>order <span class="main">(</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">a1</span> <span class="main">+</span> order <span class="main">(</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="main">(</span><span class="skolem">a1</span>  <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> order <span class="free">x</span> <span class="main">(</span><span class="free">q</span><span class="main">-</span><span class="main">[:</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">:]</span><span class="main">)</span> <span class="main">*</span> order <span class="main">(</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">a1</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> a1_def 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pcompose_pCons <span class="dynamic"><span class="dynamic">algebra_simps</span></span> diff_conv_add_uminus <span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_0I<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> order <span class="free">x</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="main">[:</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">:]</span><span class="main">)</span> <span class="main">*</span> order <span class="main">(</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> root.hyps<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  order <span class="free">x</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="main">[:</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">:]</span><span class="main">)</span> <span class="main">*</span> order <span class="main">(</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a1</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>order_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a1_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Polynomial roots / zeros›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proots_within</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>comm_semiring_0 poly <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proots_within</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">.</span> poly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">proots</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>comm_semiring_0 poly <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proots</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> proots_within <span class="free"><span class="bound"><span class="entity">p</span></span></span> UNIV"</span></span>

<span class="keyword1" id="BF_Misc-proots_def"><span class="command">lemma</span></span> proots_def<span class="main">:</span> <span class="quoted"><span class="quoted">"proots <span class="free">p</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> proots_within_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="BF_Misc-proots_within_empty"><span class="command">lemma</span></span> proots_within_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"proots_within <span class="free">p</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_within_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="BF_Misc-proots_within_0"><span class="command">lemma</span></span> proots_within_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"proots_within <span class="main">0</span> <span class="free">s</span> <span class="main">=</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_within_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="BF_Misc-proots_withinI"><span class="command">lemma</span></span> proots_withinI<span class="main">[</span><span class="operator">intro</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">∈</span><span class="free">s</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">∈</span>proots_within <span class="free">p</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> proots_within_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="BF_Misc-proots_within_iff"><span class="command">lemma</span></span> proots_within_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span>proots_within <span class="free">p</span> <span class="free">s</span> <span class="main">⟷</span> poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free">x</span><span class="main">∈</span><span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> proots_within_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="BF_Misc-proots_within_union"><span class="command">lemma</span></span> proots_within_union<span class="main">:</span>
  <span class="quoted"><span class="quoted">"proots_within <span class="free">p</span> <span class="free">A</span> <span class="main">∪</span> proots_within <span class="free">p</span> <span class="free">B</span> <span class="main">=</span> proots_within <span class="free">p</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> proots_within_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="BF_Misc-proots_within_times"><span class="command">lemma</span></span> proots_within_times<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_no_zero_divisors<span class="main">,</span>comm_semiring_0<span class="main">}</span> set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> proots_within <span class="free">p</span> <span class="free">s</span> <span class="main">∪</span> proots_within <span class="free">q</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> proots_within_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="BF_Misc-proots_within_gcd"><span class="command">lemma</span></span> proots_within_gcd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>factorial_ring_gcd<span class="main">,</span>semiring_gcd_mult_normalize<span class="main">}</span> set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="main">(</span>gcd <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">s</span><span class="main">=</span> proots_within <span class="free">p</span> <span class="free">s</span> <span class="main">∩</span> proots_within <span class="free">q</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> proots_within_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_eq_0_iff_dvd<span class="main">)</span> 

<span class="keyword1" id="BF_Misc-proots_within_inter"><span class="command">lemma</span></span> proots_within_inter<span class="main">:</span>
  <span class="quoted"><span class="quoted">"NO_MATCH UNIV <span class="free">s</span> <span class="main">⟹</span> proots_within <span class="free">p</span> <span class="free">s</span> <span class="main">=</span> proots <span class="free">p</span> <span class="main">∩</span> <span class="free">s</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> proots_within_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="BF_Misc-proots_within_proots"><span class="command">lemma</span></span> proots_within_proots<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"proots_within <span class="free">p</span> <span class="free">s</span> <span class="main">⊆</span> proots <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> proots_within_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="BF_Misc-finite_proots"><span class="command">lemma</span></span> finite_proots<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>idom poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span> <span class="main">⟹</span> finite <span class="main">(</span>proots_within <span class="free">p</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> proots_within_def <span class="keyword1"><span class="command">using</span></span> poly_roots_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="BF_Misc-proots_within_pCons_1_iff"><span class="command">lemma</span></span> proots_within_pCons_1_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>idom"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="main">[:</span><span class="main">-</span><span class="free">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span><span class="main">∈</span><span class="free">s</span> <span class="keyword1">then</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"proots_within <span class="main">[:</span><span class="free">a</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span><span class="main">∈</span><span class="free">s</span> <span class="keyword1">then</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">s</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="BF_Misc-proots_within_uminus"><span class="command">lemma</span></span> proots_within_uminus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>comm_ring poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="main">(</span><span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> proots_within <span class="free">p</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="BF_Misc-proots_within_smult"><span class="command">lemma</span></span> proots_within_smult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_no_zero_divisors<span class="main">,</span>comm_semiring_0<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="main">(</span>smult <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> proots_within <span class="free">p</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> proots_within_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Polynomial roots counting multiplicities.›</span></span>

<span class="comment1">(*counting the number of proots WITH MULTIPLICITIES within a set*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proots_count</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>idom poly <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proots_count</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">∈</span>proots_within <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">.</span> order <span class="bound">r</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>  

<span class="keyword1" id="BF_Misc-proots_count_emtpy"><span class="command">lemma</span></span> proots_count_emtpy<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="BF_Misc-proots_count_times"><span class="command">lemma</span></span> proots_count_times<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>idom set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> proots_count <span class="free">p</span> <span class="free">s</span> <span class="main">+</span> proots_count <span class="free">q</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pts</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pts</span><span class="main">=</span>proots_within <span class="free">p</span> <span class="free">s</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qts</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qts</span><span class="main">=</span>proots_within <span class="free">q</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">pts</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">qts</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pts_def qts_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">∈</span><span class="skolem">pts</span> <span class="main">∪</span> <span class="skolem">qts</span><span class="main">.</span> order <span class="bound">r</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">∈</span><span class="skolem">pts</span><span class="main">.</span> order <span class="bound">r</span> <span class="free">p</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> comm_monoid_add_class.sum.mono_neutral_cong_right<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">pts</span> <span class="main">∪</span> <span class="skolem">qts</span> <span class="main">-</span> <span class="skolem">pts</span><span class="main">.</span> order <span class="bound">i</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> pts_def qts_def proots_within_def <span class="keyword1"><span class="command">using</span></span> order_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">∈</span><span class="skolem">pts</span> <span class="main">∪</span> <span class="skolem">qts</span><span class="main">.</span> order <span class="bound">r</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">∈</span><span class="skolem">qts</span><span class="main">.</span> order <span class="bound">r</span> <span class="free">q</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> comm_monoid_add_class.sum.mono_neutral_cong_right<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">pts</span> <span class="main">∪</span> <span class="skolem">qts</span> <span class="main">-</span> <span class="skolem">qts</span><span class="main">.</span> order <span class="bound">i</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> pts_def qts_def proots_within_def <span class="keyword1"><span class="command">using</span></span> order_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>proots_within_times order_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span> sum.distrib<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> pts_def qts_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BF_Misc-proots_count_power_n_n"><span class="command">lemma</span></span> proots_count_power_n_n<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="free">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span><span class="main">∈</span><span class="free">s</span> <span class="main">∧</span> <span class="free">n</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="free">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="free">s</span><span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span><span class="main">∈</span><span class="free">s</span> <span class="main">∧</span> <span class="free">n</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proots_within_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def <span class="keyword1"><span class="command">using</span></span> order_power_n_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BF_Misc-degree_proots_count"><span class="command">lemma</span></span> degree_proots_count<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> proots_count <span class="free">p</span> UNIV"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">p</span></span> <span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">[:</span><span class="skolem">c</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_eq_zeroE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>sum.infinite <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>infinite_UNIV_char_0 order_0I<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Fundamental_Theorem_Algebra.fundamental_theorem_of_algebra <span class="quoted"><span class="quoted">‹degree <span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> constant_degree<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">onez</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">onez</span><span class="main">=</span><span class="main">[:</span><span class="main">-</span><span class="skolem">z</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">onez</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">onez</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> onez_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span> <span class="skolem">onez</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> poly_eq_0_iff_dvd <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>›</span></span> dvdE <span class="keyword1"><span class="command">unfolding</span></span> onez_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span>degree <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_mult_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">onez</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">n</span> <span class="main">=</span> degree <span class="skolem">p</span>›</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> q_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">=</span> proots_count <span class="skolem">q</span> UNIV"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" Suc <span class="main">0</span> <span class="main">=</span> proots_count <span class="skolem">onez</span> UNIV"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> onez_def <span class="keyword1"><span class="command">using</span></span> proots_count_power_n_n<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted">UNIV</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">using</span></span> degree_mult_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">onez</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> proots_count_times<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">onez</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted">UNIV</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BF_Misc-proots_count_smult"><span class="command">lemma</span></span> proots_count_smult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_no_zero_divisors<span class="main">,</span>idom<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>smult <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="free">s</span><span class="main">=</span> proots_count <span class="free">p</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def
    <span class="keyword1"><span class="command">using</span></span> order_smult<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> proots_within_smult<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="BF_Misc-proots_count_pCons_1_iff"><span class="command">lemma</span></span> proots_count_pCons_1_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>idom"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">[:</span><span class="main">-</span><span class="free">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span><span class="main">∈</span><span class="free">s</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">s</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>proots_within_pCons_1_iff order_power_n_n<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="BF_Misc-proots_count_uminus"><span class="command">lemma</span></span> proots_count_uminus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span><span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> proots_count <span class="free">p</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="BF_Misc-card_proots_within_leq"><span class="command">lemma</span></span> card_proots_within_leq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="free">s</span> <span class="main">≥</span> card <span class="main">(</span>proots_within <span class="free">p</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>poly_root_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">∈</span></span><span class="free"><span class="free">s</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_within_def proots_count_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>no_roots <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="skolem">p</span> <span class="free">s</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>root <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> 
      <span class="main">≤</span> card <span class="main">(</span>proots_within <span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">s</span><span class="main">)</span><span class="main">+</span>card <span class="main">(</span>proots_within <span class="skolem">p</span> <span class="free">s</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> proots_within_times <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>card_Un_le<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span><span class="main">+</span> proots_count <span class="skolem">p</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">s</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">s</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">s</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">s</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="skolem">p</span> <span class="free">s</span><span class="main">)</span> <span class="main">≤</span> proots_count <span class="skolem">p</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> root.hyps<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> root <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  proots_count <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> proots_count_times<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_eq_0_iff pCons_eq_0_iff root.prems zero_neq_one<span class="main">)</span>  
    <span class="keyword1"><span class="command">using</span></span> root <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>proots_count_pCons_1_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">≤</span> proots_count <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add.inverse_inverse add.inverse_neutral minus_pCons 
        mult_minus_left proots_count_uminus proots_within_uminus<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*FIXME: not duplicate*)</span>
<span class="keyword1" id="BF_Misc-proots_count_0_imp_empty"><span class="command">lemma</span></span> proots_count_0_imp_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="free">s</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="free">p</span> <span class="free">s</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="free">p</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card_proots_within_leq<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹proots_count <span class="free">p</span> <span class="free">s</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>proots_within <span class="free">p</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BF_Misc-proots_count_leq_degree"><span class="command">lemma</span></span> proots_count_leq_degree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="free">s</span><span class="main">≤</span> degree <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>poly_root_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">∈</span></span><span class="free"><span class="free">s</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>no_roots <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="skolem">p</span> <span class="free">s</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>root <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span><span class="main">[:</span><span class="skolem">a</span><span class="main">,</span> <span class="main">-</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> proots_count <span class="main">[:</span><span class="skolem">a</span><span class="main">,</span> <span class="main">-</span> <span class="main">1</span><span class="main">:]</span> <span class="free">s</span> <span class="main">+</span> proots_count <span class="skolem">p</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> proots_count_times<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> root <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> proots_count <span class="skolem">p</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">[:</span><span class="skolem">a</span><span class="main">,</span> <span class="main">-</span> <span class="main">1</span><span class="main">:]</span> <span class="free">s</span>  <span class="main">=</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add.inverse_inverse add.inverse_neutral minus_pCons 
          proots_count_pCons_1_iff proots_count_uminus root.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span>  degree <span class="main">(</span><span class="main">[:</span><span class="skolem">a</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> degree_mult_eq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> root <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> root <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*TODO: not a duplicate*)</span>
<span class="keyword1" id="BF_Misc-proots_count_union_disjoint"><span class="command">lemma</span></span> proots_count_union_disjoint<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> proots_count <span class="free">p</span> <span class="free">A</span> <span class="main">+</span> proots_count <span class="free">p</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> proots_within_union<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="BF_Misc-proots_count_cong"><span class="command">lemma</span></span> proots_count_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> order_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">s</span><span class="main">.</span> order <span class="bound">x</span> <span class="free">p</span> <span class="main">=</span> order <span class="bound">x</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="free">s</span> <span class="main">=</span> proots_count <span class="free">q</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="free">q</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> order_eq that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> order_root<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="free">p</span> <span class="free">s</span> <span class="main">=</span> proots_within <span class="free">q</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> proots_within <span class="free">q</span> <span class="free">s</span> <span class="main">⟹</span> order <span class="bound">x</span> <span class="free">p</span> <span class="main">=</span> order <span class="bound">x</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> order_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BF_Misc-proots_count_of_real"><span class="command">lemma</span></span> proots_count_of_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>map_poly of_real <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>of_real<span class="main">::</span><span class="main">_</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>real_algebra_1<span class="main">,</span>idom<span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">s</span><span class="main">)</span> 
            <span class="main">=</span> proots_count <span class="free">p</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="main">(</span>of_real<span class="main">::</span><span class="main">_</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="main">(</span>map_poly of_real <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">`</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span><span class="skolem">k</span> <span class="main">`</span> <span class="main">(</span>proots_within <span class="free">p</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proots_within_def k_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>of_real_poly_map_poly<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>map_poly of_real <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">`</span> <span class="free">s</span><span class="main">)</span> 
                <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">∈</span><span class="skolem">k</span> <span class="main">`</span> <span class="main">(</span>proots_within <span class="free">p</span> <span class="free">s</span><span class="main">)</span><span class="main">.</span> order <span class="bound">r</span> <span class="main">(</span>map_poly of_real <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> order <span class="bound">r</span> <span class="main">(</span>map_poly of_real <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>proots_within <span class="free">p</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sum.reindex<span class="main">)</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> k_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> proots_count <span class="free">p</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> k_def comp_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>map_poly_order_of_real<span class="main">)</span> 
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> k_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*Is field really necessary here?*)</span>
<span class="keyword1" id="BF_Misc-proots_pcompose"><span class="command">lemma</span></span> proots_pcompose<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span><span class="main">=</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>pcompose <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> proots_count <span class="free">p</span> <span class="main">(</span>poly <span class="free">q</span> <span class="main">`</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">=</span><span class="main">[:</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">:]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">≠</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹degree <span class="free">q</span><span class="main">=</span><span class="main">1</span>›</span></span> degree_eq_oneE <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">/</span><span class="skolem">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> f_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span>poly <span class="free">q</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">∈</span> <span class="skolem">f</span> <span class="main">`</span> proots_within <span class="free">p</span> <span class="main">(</span>poly <span class="free">q</span> <span class="main">`</span> <span class="free">s</span><span class="main">)</span><span class="main">.</span> order <span class="bound">r</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">sum</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>poly_pcompose proots_within_def f_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> f_eq<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> image_eqI mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>proots_within <span class="free">p</span> <span class="main">(</span>poly <span class="free">q</span> <span class="main">`</span> <span class="free">s</span><span class="main">)</span><span class="main">.</span> order <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sum.reindex<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def inj_on_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>proots_within <span class="free">p</span> <span class="main">(</span>poly <span class="free">q</span> <span class="main">`</span> <span class="free">s</span><span class="main">)</span><span class="main">.</span> order <span class="bound">x</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> pcompose_eq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="main">[:</span><span class="skolem">x</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="main">[:</span><span class="skolem">x</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> order <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>smult <span class="skolem">b</span> <span class="main">[:</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">b</span><span class="main">)</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> order_smult<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> order <span class="skolem">x</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> order_pcompose<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> f_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  proots_count <span class="free">p</span> <span class="main">(</span>poly <span class="free">q</span> <span class="main">`</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Composition of a polynomial and a rational function›</span></span>

<span class="comment1">(*composition of a polynomial and a rational function. Maybe a more general version in the future?*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fcompose</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span>field poly <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fcompose</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> fst <span class="main">(</span>fold_coeffs <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span><span class="main">*</span><span class="main">[:</span><span class="bound">a</span><span class="main">:]</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">*</span> <span class="bound">c</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">*</span><span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="BF_Misc-fcompose_0"><span class="command">lemma</span></span> fcompose_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fcompose <span class="main">0</span> <span class="free">q</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fcompose_def<span class="main">)</span>

<span class="keyword1" id="BF_Misc-fcompose_const"><span class="command">lemma</span></span> fcompose_const<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"fcompose <span class="main">[:</span><span class="free">a</span><span class="main">:]</span> <span class="free">q</span> <span class="free">r</span> <span class="main">=</span> <span class="main">[:</span><span class="free">a</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fcompose_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="BF_Misc-fcompose_pCons"><span class="command">lemma</span></span> fcompose_pCons<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fcompose <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span> <span class="main">=</span> smult <span class="free">a</span> <span class="main">(</span><span class="free">q2</span><span class="main">^</span><span class="main">(</span>degree <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">q1</span> <span class="main">*</span> fcompose <span class="free">p</span> <span class="free">q1</span> <span class="free">q2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span> <span class="main">*</span> <span class="main">[:</span><span class="bound">a</span><span class="main">:]</span> <span class="main">+</span> <span class="free">q1</span> <span class="main">*</span> <span class="bound">c</span><span class="main">,</span> <span class="free">q2</span> <span class="main">*</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fc</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fc</span><span class="main">=</span>fold_coeffs <span class="skolem">ff</span> <span class="free">p</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> snd_ff<span class="main">:</span><span class="quoted"><span class="quoted">"snd <span class="skolem">fc</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="free">q2</span><span class="main">^</span><span class="main">(</span>degree <span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fc_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>ff_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits prod.splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fcompose <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span> <span class="main">=</span> fst <span class="main">(</span>fold_coeffs <span class="skolem">ff</span> <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fcompose_def ff_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> fst <span class="main">(</span><span class="skolem">ff</span> <span class="free">a</span> <span class="skolem">fc</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">unfolding</span></span> fc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> snd <span class="skolem">fc</span> <span class="main">*</span> <span class="main">[:</span><span class="free">a</span><span class="main">:]</span> <span class="main">+</span> <span class="free">q1</span> <span class="main">*</span> fst <span class="skolem">fc</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ff_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>prod.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> smult <span class="free">a</span> <span class="main">(</span><span class="free">q2</span><span class="main">^</span><span class="main">(</span>degree <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">q1</span> <span class="main">*</span> fst <span class="skolem">fc</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> snd_ff False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> smult <span class="free">a</span> <span class="main">(</span><span class="free">q2</span><span class="main">^</span><span class="main">(</span>degree <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">q1</span> <span class="main">*</span> fcompose <span class="free">p</span> <span class="free">q1</span> <span class="free">q2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fc_def ff_def fcompose_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="BF_Misc-fcompose_uminus"><span class="command">lemma</span></span> fcompose_uminus<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fcompose <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="free">q</span> <span class="free">r</span> <span class="main">=</span> <span class="main">-</span> fcompose <span class="free">p</span> <span class="free">q</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>fcompose_pCons<span class="main">)</span>

<span class="keyword1" id="BF_Misc-fcompose_add_less"><span class="command">lemma</span></span> fcompose_add_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p1</span> <span class="main">&gt;</span> degree <span class="free">p2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fcompose <span class="main">(</span><span class="free">p1</span><span class="main">+</span><span class="free">p2</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span> 
            <span class="main">=</span> fcompose <span class="free">p1</span> <span class="free">q1</span> <span class="free">q2</span> <span class="main">+</span> <span class="free">q2</span><span class="main">^</span><span class="main">(</span>degree <span class="free">p1</span><span class="main">-</span>degree <span class="free">p2</span><span class="main">)</span> <span class="main">*</span> fcompose <span class="free">p2</span> <span class="free">q1</span> <span class="free">q2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p1</span></span> <span class="quoted"><span class="free">p2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> poly_induct2<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a1</span> <span class="skolem">p1</span> <span class="skolem">a2</span> <span class="skolem">p2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fcompose_pCons smult_add_left<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> degree <span class="skolem">p2</span> <span class="main">&lt;</span> degree <span class="skolem">p1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that pCons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p2</span><span class="main">&lt;</span> degree <span class="skolem">p1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d1</span></span> <span class="skolem"><span class="skolem">d2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d1</span><span class="main">=</span>degree <span class="main">(</span>pCons <span class="skolem">a1</span> <span class="skolem">p1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d2</span><span class="main">=</span>degree <span class="main">(</span>pCons <span class="skolem">a2</span> <span class="skolem">p2</span><span class="main">)</span> "</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fp1</span></span> <span class="skolem"><span class="skolem">fp2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fp1</span><span class="main">=</span> fcompose <span class="skolem">p1</span> <span class="free">q1</span> <span class="free">q2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fp2</span><span class="main">=</span>fcompose <span class="skolem">p2</span> <span class="free">q1</span> <span class="free">q2</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fcompose <span class="main">(</span>pCons <span class="skolem">a1</span> <span class="skolem">p1</span> <span class="main">+</span> pCons <span class="skolem">a2</span> <span class="skolem">p2</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span> 
            <span class="main">=</span> fcompose <span class="main">(</span>pCons <span class="main">(</span><span class="skolem">a1</span><span class="main">+</span><span class="skolem">a2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p1</span><span class="main">+</span><span class="skolem">p2</span><span class="main">)</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> smult <span class="main">(</span><span class="skolem">a1</span> <span class="main">+</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span> <span class="main">^</span> <span class="skolem">d1</span><span class="main">)</span> <span class="main">+</span> <span class="free">q1</span> <span class="main">*</span> fcompose <span class="main">(</span><span class="skolem">p1</span> <span class="main">+</span> <span class="skolem">p2</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>pCons <span class="main">(</span><span class="skolem">a1</span> <span class="main">+</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p1</span> <span class="main">+</span> <span class="skolem">p2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d1</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> d1_def <span class="keyword1"><span class="command">using</span></span> that degree_add_eq_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> fcompose_pCons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> smult <span class="main">(</span><span class="skolem">a1</span> <span class="main">+</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span> <span class="main">^</span> <span class="skolem">d1</span><span class="main">)</span> <span class="main">+</span> <span class="free">q1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">fp1</span> <span class="main">+</span> <span class="free">q2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">-</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">fp2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p1</span> <span class="main">-</span> degree <span class="skolem">p2</span> <span class="main">=</span> <span class="skolem">d1</span> <span class="main">-</span> <span class="skolem">d2</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> d1_def d2_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> pCons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span><span class="operator">folded</span> fp1_def fp2_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> fcompose <span class="main">(</span>pCons <span class="skolem">a1</span> <span class="skolem">p1</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span> <span class="main">+</span> <span class="free">q2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">-</span> <span class="skolem">d2</span><span class="main">)</span> 
                        <span class="main">*</span> fcompose <span class="main">(</span>pCons <span class="skolem">a2</span> <span class="skolem">p2</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d1</span> <span class="main">&gt;</span> <span class="skolem">d2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d1_def d2_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> fcompose_pCons
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> d1_def d2_def fp1_def fp2_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> smult_add_left power_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> d1_def d2_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="BF_Misc-fcompose_add_eq"><span class="command">lemma</span></span> fcompose_add_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p1</span> <span class="main">=</span> degree <span class="free">p2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span><span class="main">^</span><span class="main">(</span>degree <span class="free">p1</span> <span class="main">-</span> degree <span class="main">(</span><span class="free">p1</span><span class="main">+</span><span class="free">p2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> fcompose <span class="main">(</span><span class="free">p1</span><span class="main">+</span><span class="free">p2</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span> 
            <span class="main">=</span> fcompose <span class="free">p1</span> <span class="free">q1</span> <span class="free">q2</span> <span class="main">+</span> fcompose <span class="free">p2</span> <span class="free">q1</span> <span class="free">q2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p1</span></span> <span class="quoted"><span class="free">p2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> poly_induct2<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a1</span> <span class="skolem">p1</span> <span class="skolem">a2</span> <span class="skolem">p2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span><span class="main">+</span><span class="skolem">p2</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span><span class="main">=</span><span class="main">-</span><span class="skolem">p1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fcompose_pCons fcompose_uminus smult_add_left<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span><span class="main">=</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pCons<span class="main">(</span>2<span class="main">)</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span><span class="main">+</span><span class="skolem">p2</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d1</span></span> <span class="skolem"><span class="skolem">d2</span></span> <span class="skolem"><span class="skolem">dp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d1</span><span class="main">=</span>degree <span class="main">(</span>pCons <span class="skolem">a1</span> <span class="skolem">p1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d2</span><span class="main">=</span>degree <span class="main">(</span>pCons <span class="skolem">a2</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span>
                            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dp</span> <span class="main">=</span> degree <span class="skolem">p1</span> <span class="main">-</span> degree <span class="main">(</span><span class="skolem">p1</span><span class="main">+</span><span class="skolem">p2</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fp1</span></span> <span class="skolem"><span class="skolem">fp2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fp1</span><span class="main">=</span> fcompose <span class="skolem">p1</span> <span class="free">q1</span> <span class="free">q2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fp2</span><span class="main">=</span>fcompose <span class="skolem">p2</span> <span class="free">q1</span> <span class="free">q2</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">^</span> <span class="main">(</span>degree <span class="main">(</span>pCons <span class="skolem">a1</span> <span class="skolem">p1</span><span class="main">)</span> <span class="main">-</span> degree <span class="main">(</span>pCons <span class="skolem">a1</span> <span class="skolem">p1</span> <span class="main">+</span> pCons <span class="skolem">a2</span> <span class="skolem">p2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
             fcompose <span class="main">(</span>pCons <span class="skolem">a1</span> <span class="skolem">p1</span> <span class="main">+</span> pCons <span class="skolem">a2</span> <span class="skolem">p2</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span> 
                <span class="main">=</span> <span class="free">q2</span> <span class="main">^</span> <span class="skolem">dp</span> <span class="main">*</span> fcompose <span class="main">(</span>pCons <span class="main">(</span><span class="skolem">a1</span><span class="main">+</span><span class="skolem">a2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p1</span> <span class="main">+</span><span class="skolem">p2</span><span class="main">)</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> dp_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> smult <span class="main">(</span><span class="skolem">a1</span> <span class="main">+</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span> <span class="main">^</span> <span class="skolem">d1</span><span class="main">)</span> <span class="main">+</span> <span class="free">q1</span> <span class="main">*</span> <span class="main">(</span><span class="free">q2</span> <span class="main">^</span> <span class="skolem">dp</span> <span class="main">*</span> fcompose <span class="main">(</span><span class="skolem">p1</span> <span class="main">+</span> <span class="skolem">p2</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p1</span> <span class="main">≥</span> degree <span class="main">(</span><span class="skolem">p1</span> <span class="main">+</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> degree_add_le degree_pCons_eq_if not_less_eq_eq order_refl pCons.prems zero_le<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> fcompose_pCons dp_def d1_def <span class="keyword1"><span class="command">using</span></span> that
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> power_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  smult <span class="main">(</span><span class="skolem">a1</span> <span class="main">+</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span> <span class="main">^</span> <span class="skolem">d1</span><span class="main">)</span> <span class="main">+</span> <span class="free">q1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">fp1</span> <span class="main">+</span> <span class="skolem">fp2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> pCons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">folded</span> dp_def fp1_def fp2_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> degree_pCons_eq_if diff_Suc_Suc diff_zero not_less_eq_eq pCons.prems zero_le<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> fcompose <span class="main">(</span>pCons <span class="skolem">a1</span> <span class="skolem">p1</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span> <span class="main">+</span> fcompose <span class="main">(</span>pCons <span class="skolem">a2</span> <span class="skolem">p2</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d1</span> <span class="main">=</span> degree <span class="main">(</span>pCons <span class="skolem">a2</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> d1_def <span class="keyword1"><span class="command">using</span></span> pCons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> fcompose_pCons
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> d1_def fp1_def fp2_def *<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>smult_add_left <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="BF_Misc-fcompose_add_const"><span class="command">lemma</span></span> fcompose_add_const<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fcompose <span class="main">(</span><span class="main">[:</span><span class="free">a</span><span class="main">:]</span> <span class="main">+</span> <span class="free">p</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span> <span class="main">=</span> smult <span class="free">a</span> <span class="main">(</span><span class="free">q2</span> <span class="main">^</span> degree <span class="free">p</span><span class="main">)</span> <span class="main">+</span> fcompose <span class="free">p</span> <span class="free">q1</span> <span class="free">q2</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fcompose_pCons smult_add_left<span class="main">)</span>

<span class="keyword1" id="BF_Misc-fcompose_smult"><span class="command">lemma</span></span> fcompose_smult<span class="main">:</span> <span class="quoted"><span class="quoted">"fcompose <span class="main">(</span>smult <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span> <span class="main">=</span> smult <span class="free">a</span> <span class="main">(</span>fcompose <span class="free">p</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fcompose_pCons smult_add_right<span class="main">)</span>

<span class="keyword1" id="BF_Misc-fcompose_mult"><span class="command">lemma</span></span> fcompose_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"fcompose <span class="main">(</span><span class="free">p1</span><span class="main">*</span><span class="free">p2</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span> <span class="main">=</span> fcompose <span class="free">p1</span> <span class="free">q1</span> <span class="free">q2</span> <span class="main">*</span> fcompose <span class="free">p2</span> <span class="free">q1</span> <span class="free">q2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p1</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">p2</span><span class="main">=</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fcompose_smult<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p2</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fcompose_pCons pCons<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p2</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fcompose <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p1</span> <span class="main">*</span> <span class="free">p2</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span> 
            <span class="main">=</span> fcompose <span class="main">(</span>pCons <span class="main">0</span> <span class="main">(</span><span class="skolem">p1</span> <span class="main">*</span> <span class="free">p2</span><span class="main">)</span> <span class="main">+</span> smult <span class="skolem">a</span> <span class="free">p2</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  fcompose <span class="main">(</span>pCons <span class="main">0</span> <span class="main">(</span><span class="skolem">p1</span> <span class="main">*</span> <span class="free">p2</span><span class="main">)</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span> 
                        <span class="main">+</span> <span class="free">q2</span> <span class="main">^</span> <span class="main">(</span>degree <span class="skolem">p1</span> <span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> fcompose <span class="main">(</span>smult <span class="skolem">a</span> <span class="free">p2</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>pCons <span class="main">0</span> <span class="main">(</span><span class="skolem">p1</span> <span class="main">*</span> <span class="free">p2</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> degree <span class="main">(</span>smult <span class="skolem">a</span> <span class="free">p2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_mult_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> fcompose_add_less<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">q1</span></span> <span class="quoted"><span class="free">q2</span></span><span class="main">]</span> that 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>degree_mult_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> fcompose <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p1</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span> <span class="main">*</span> fcompose <span class="free">p2</span> <span class="free">q1</span> <span class="free">q2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fcompose_pCons fcompose_smult pCons <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BF_Misc-fcompose_poly"><span class="command">lemma</span></span> fcompose_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q2</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">(</span>poly <span class="free">q1</span> <span class="free">x</span><span class="main">/</span>poly <span class="free">q2</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> poly <span class="main">(</span>fcompose <span class="free">p</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="free">x</span> <span class="main">/</span> poly <span class="main">(</span><span class="free">q2</span><span class="main">^</span><span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fcompose_pCons <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1" id="BF_Misc-poly_fcompose"><span class="command">lemma</span></span> poly_fcompose<span class="main">:</span>
   <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q2</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>fcompose <span class="free">p</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> poly <span class="free">p</span> <span class="main">(</span>poly <span class="free">q1</span> <span class="free">x</span><span class="main">/</span>poly <span class="free">q2</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>poly <span class="free">q2</span> <span class="free">x</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>degree <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fcompose_poly<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1" id="BF_Misc-poly_fcompose_0_denominator"><span class="command">lemma</span></span> poly_fcompose_0_denominator<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q2</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>fcompose <span class="free">p</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> poly <span class="free">q1</span> <span class="free">x</span> <span class="main">^</span> degree <span class="free">p</span> <span class="main">*</span> lead_coeff <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fcompose_pCons<span class="main">)</span>

<span class="keyword1" id="BF_Misc-fcompose_0_denominator"><span class="command">lemma</span></span> fcompose_0_denominator<span class="main">:</span><span class="quoted"><span class="quoted">"fcompose <span class="free">p</span> <span class="free">q1</span> <span class="main">0</span> <span class="main">=</span> smult <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">q1</span><span class="main">^</span>degree <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>fcompose_pCons<span class="main">)</span>

<span class="keyword1" id="BF_Misc-fcompose_nzero"><span class="command">lemma</span></span> fcompose_nzero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nconst<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="free">q1</span> <span class="main">≠</span> smult <span class="bound">c</span> <span class="free">q2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> infi<span class="main">:</span><span class="quoted"><span class="quoted">"infinite <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fcompose <span class="free">p</span> <span class="free">q1</span> <span class="free">q2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>poly_root_induct_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>no_proots <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"fcompose <span class="skolem">p</span> <span class="free">q1</span> <span class="free">q2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q2</span> <span class="skolem">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>proots <span class="free">q2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q2</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q2</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UNIV_I ex_new_if_finite infi proots_withinI<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> poly <span class="free">q1</span> <span class="skolem">x</span> <span class="main">/</span> poly <span class="free">q2</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹fcompose <span class="skolem">p</span> <span class="free">q1</span> <span class="free">q2</span> <span class="main">=</span> <span class="main">0</span>›</span></span> fcompose_poly<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="free">q2</span> <span class="skolem">x</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="free">q1</span></span><span class="main">,</span><span class="operator">folded</span> y_def<span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> no_proots<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>root <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fcompose <span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">q1</span> <span class="free">q2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> fcompose_def <span class="keyword1"><span class="command">using</span></span> nconst<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fcompose <span class="skolem">p</span> <span class="free">q1</span> <span class="free">q2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> root <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> fcompose_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bijection (<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">bij_betw</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>) and the number of polynomial roots›</span></span>

<span class="keyword1" id="BF_Misc-proots_fcompose_bij_eq"><span class="command">lemma</span></span> proots_fcompose_bij_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bij<span class="main">:</span><span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q1</span> <span class="bound">x</span><span class="main">/</span>poly <span class="free">q2</span> <span class="bound">x</span><span class="main">)</span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> nzero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> poly <span class="free">q2</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> max_deg<span class="main">:</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>degree <span class="free">q1</span><span class="main">)</span> <span class="main">(</span>degree <span class="free">q2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> nconst<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="free">q1</span> <span class="main">≠</span> smult <span class="bound">c</span> <span class="free">q2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> infi<span class="main">:</span><span class="quoted"><span class="quoted">"infinite <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="free">B</span> <span class="main">=</span> proots_count <span class="main">(</span>fcompose <span class="free">p</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>poly_root_induct_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>no_proots <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="skolem">p</span> <span class="free">B</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="skolem">p</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> no_proots <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>fcompose <span class="skolem">p</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="main">(</span>fcompose <span class="skolem">p</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> no_proots <span class="keyword1"><span class="command">unfolding</span></span> proots_within_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> div_0 empty_Collect_eq fcompose_poly nzero<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>root <span class="skolem">b</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">B</span> <span class="main">=</span> proots_count <span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">B</span> <span class="main">+</span> proots_count <span class="skolem">p</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> proots_count_times<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> proots_count <span class="main">(</span>fcompose <span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="free">A</span> 
                    <span class="main">+</span> proots_count <span class="main">(</span>fcompose <span class="skolem">p</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="free">A</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q1</span> <span class="bound">x</span><span class="main">/</span>poly <span class="free">q2</span> <span class="bound">x</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">B</span> <span class="main">=</span> proots_count <span class="main">(</span>fcompose <span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">B</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">B</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> proots_count_pCons_1_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>fcompose <span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">=</span><span class="skolem">g</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> bij<span class="main">[</span><span class="operator">folded</span> g_def<span class="main">]</span> True 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betwE bij_betw_the_inv_into f_the_inv_into_f_bij_betw<span class="main">)</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qq</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qq</span><span class="main">=</span><span class="free">q1</span> <span class="main">-</span> smult <span class="skolem">b</span> <span class="free">q2</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> qq_0<span class="main">:</span><span class="quoted"><span class="quoted">"poly <span class="skolem">qq</span> <span class="skolem">a</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qq_deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">qq</span><span class="main">≤</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">qq</span><span class="main">≠</span><span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> qq_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">=</span><span class="skolem">g</span> <span class="skolem">a</span>›</span></span> nzero<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">∈</span><span class="free">A</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> max_deg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_diff_le<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> nconst<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="skolem">qq</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span>proots_within <span class="skolem">qq</span> <span class="free">A</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> qq_0 <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">∈</span><span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="skolem">qq</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>proots_within <span class="skolem">qq</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">qq</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="skolem">qq</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">∈</span>proots_within <span class="skolem">qq</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="skolem">qq</span> <span class="free">A</span><span class="main">)</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="skolem">qq</span> <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">qq</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> card_proots_within_leq le_trans proots_count_leq_degree qq_deg<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_1_singletonE singletonD<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">a</span> <span class="skolem">qq</span><span class="main">=</span><span class="main">1</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def <span class="quoted"><span class="quoted">‹<span class="skolem">qq</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> le_antisym le_zero_eq not_less_eq_eq order_degree
                order_root qq_0 qq_deg<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> fcompose_def proots_count_def qq_def  
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">B</span>  <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> proots_count_pCons_1_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>fcompose <span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="main">(</span>fcompose <span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="main">(</span>fcompose <span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q1</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">*</span> poly <span class="free">q2</span> <span class="skolem">a</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> fcompose_def proots_within_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">g</span> <span class="skolem">a</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> nzero<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">∈</span><span class="free">A</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">∈</span><span class="free">A</span>›</span></span> bij<span class="main">[</span><span class="operator">folded</span> g_def<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> bij_betwE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>  
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>      
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="skolem">p</span> <span class="free">B</span> <span class="main">=</span> proots_count <span class="main">(</span>fcompose <span class="skolem">p</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="free">A</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> root.hyps<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> mult_eq_0_iff root.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> proots_count <span class="main">(</span>fcompose <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fcompose <span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">q1</span> <span class="free">q2</span> <span class="main">≠</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> nconst<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> fcompose_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fcompose <span class="skolem">p</span> <span class="free">q1</span> <span class="free">q2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> fcompose_nzero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ nconst infi<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> nzero False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> fcompose_mult
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> proots_count_times<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BF_Misc-proots_card_fcompose_bij_eq"><span class="command">lemma</span></span> proots_card_fcompose_bij_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bij<span class="main">:</span><span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q1</span> <span class="bound">x</span><span class="main">/</span>poly <span class="free">q2</span> <span class="bound">x</span><span class="main">)</span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> nzero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> poly <span class="free">q2</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> max_deg<span class="main">:</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>degree <span class="free">q1</span><span class="main">)</span> <span class="main">(</span>degree <span class="free">q2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> nconst<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="free">q1</span> <span class="main">≠</span> smult <span class="bound">c</span> <span class="free">q2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> infi<span class="main">:</span><span class="quoted"><span class="quoted">"infinite <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="free">p</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="main">(</span>fcompose <span class="free">p</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>poly_root_induct_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>no_proots <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="skolem">p</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> no_proots <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="main">(</span>fcompose <span class="skolem">p</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> no_proots fcompose_poly 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Collect_empty_eq divide_eq_0_iff nzero proots_within_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>root <span class="skolem">b</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∉</span><span class="free">B</span> <span class="main">∨</span> poly <span class="skolem">p</span> <span class="skolem">b</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">B</span> <span class="main">=</span> proots_within <span class="skolem">p</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="main">(</span>fcompose <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="free">A</span> 
        <span class="main">=</span> proots_within <span class="main">(</span>fcompose <span class="skolem">p</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that nzero <span class="keyword1"><span class="command">unfolding</span></span> fcompose_mult proots_within_times 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_fcompose<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> bij bij_betwE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> root <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">b</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bb</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bb</span><span class="main">=</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="main">(</span><span class="skolem">bb</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> card <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="main">+</span> card <span class="main">(</span>proots_within <span class="skolem">p</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="skolem">bb</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> bb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_within_times
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> card_Un_disjoint<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">use</span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> card <span class="main">(</span>proots_within <span class="main">(</span>fcompose <span class="skolem">p</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> root.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="main">(</span>fcompose <span class="main">(</span><span class="skolem">bb</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> proots_within_times fcompose_mult
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> card_Un_disjoint<span class="main">)</span> 
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> b_poly<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">=</span>poly <span class="free">q1</span> <span class="skolem">a</span> <span class="main">/</span> poly <span class="free">q2</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">A</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> bij bij_betwE bij_betw_the_inv_into 
            f_the_inv_into_f_bij_betw<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bbq</span></span> <span class="skolem"><span class="skolem">pq</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bbq</span><span class="main">=</span>fcompose <span class="skolem">bb</span> <span class="free">q1</span> <span class="free">q2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pq</span><span class="main">=</span>fcompose <span class="skolem">p</span> <span class="free">q1</span> <span class="free">q2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> bbq_0<span class="main">:</span><span class="quoted"><span class="quoted">"poly <span class="skolem">bbq</span> <span class="skolem">a</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bbq_deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">bbq</span><span class="main">≤</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bbq</span><span class="main">≠</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> bbq_def bb_def 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> b_poly nzero poly_fcompose <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> degree_add_le degree_pCons_eq_if degree_smult_le 
           dual_order.trans fcompose_const fcompose_pCons max.boundedE max_deg mult_cancel_left2 
           one_neq_zero one_poly_eq_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> power.simps<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="main">(</span>fcompose <span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>›</span></span> fcompose_nzero infi 
                  nconst nzero one_neq_zero pCons_eq_0_iff<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>proots_within <span class="skolem">bbq</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">bbq</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>proots_within <span class="skolem">pq</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pq_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> fcompose_nzero finite_proots infi nconst nzero poly_0 pq_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> bbq_a<span class="main">:</span><span class="quoted"><span class="quoted">"proots_within <span class="skolem">bbq</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span>proots_within <span class="skolem">bbq</span> <span class="free">A</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> bbq_0<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="skolem">bbq</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="skolem">bbq</span> <span class="free">A</span><span class="main">)</span> <span class="main">≠</span><span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">∈</span>proots_within <span class="skolem">bbq</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>proots_within <span class="skolem">bbq</span> <span class="free">A</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="skolem">bbq</span> <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">bbq</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> card_proots_within_leq le_trans proots_count_leq_degree bbq_deg<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_1_singletonE singletonD<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="main">(</span><span class="skolem">bbq</span><span class="main">)</span> <span class="free">A</span> <span class="main">∩</span> proots_within <span class="main">(</span><span class="skolem">pq</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> b_poly bbq_a fcompose_poly nzero pq_def that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> card <span class="main">(</span>proots_within <span class="skolem">pq</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="skolem">bbq</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span>proots_within <span class="skolem">pq</span> <span class="free">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> bbq_a <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> bb_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="BF_Misc-proots_pcompose_bij_eq"><span class="command">lemma</span></span> proots_pcompose_bij_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>idom poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bij<span class="main">:</span><span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span><span class="main">)</span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> q_deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="free">B</span> <span class="main">=</span> proots_count <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>poly_root_induct_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>no_proots <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="skolem">p</span> <span class="free">B</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="skolem">p</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> no_proots <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> no_proots <span class="keyword1"><span class="command">unfolding</span></span> proots_within_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>poly_pcompose<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>root <span class="skolem">b</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">B</span> <span class="main">=</span> proots_count <span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">B</span> <span class="main">+</span> proots_count <span class="skolem">p</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> proots_count_times<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> proots_count <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">A</span> <span class="main">+</span> proots_count <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">B</span> <span class="main">=</span> proots_count <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">B</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">B</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> proots_count_pCons_1_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">=</span>poly <span class="free">q</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> True bij <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betwE bij_betw_the_inv_into f_the_inv_into_f_bij_betw<span class="main">)</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qq</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qq</span><span class="main">=</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">:]</span> <span class="main">+</span> <span class="free">q</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> qq_0<span class="main">:</span><span class="quoted"><span class="quoted">"poly <span class="skolem">qq</span> <span class="skolem">a</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qq_deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">qq</span><span class="main">≤</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">qq</span><span class="main">≠</span><span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> qq_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">=</span>poly <span class="free">q</span> <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> q_deg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_add_le<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> q_deg add.inverse_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="skolem">qq</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span>proots_within <span class="skolem">qq</span> <span class="free">A</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> qq_0 <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">∈</span><span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="skolem">qq</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>proots_within <span class="skolem">qq</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">qq</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="skolem">qq</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">∈</span>proots_within <span class="skolem">qq</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="skolem">qq</span> <span class="free">A</span><span class="main">)</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="skolem">qq</span> <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">qq</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> card_proots_within_leq le_trans proots_count_leq_degree qq_deg<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_1_singletonE singletonD<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">a</span> <span class="skolem">qq</span><span class="main">=</span><span class="main">1</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def <span class="quoted"><span class="quoted">‹<span class="skolem">qq</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> le_antisym le_zero_eq not_less_eq_eq order_degree
                order_root qq_0 qq_deg<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> pcompose_def proots_count_def qq_def  
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">B</span>  <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> proots_count_pCons_1_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> pcompose_def 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">using</span></span> False bij bij_betwE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>      
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="skolem">p</span> <span class="free">B</span> <span class="main">=</span> proots_count <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> root.hyps<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> proots_count <span class="main">(</span><span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pcompose_mult
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> proots_count_times<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> One_nat_def add.right_neutral degree_0 degree_mult_eq
      degree_pCons_eq_if degree_pcompose mult_eq_0_iff one_neq_zero one_pCons pcompose_mult
      q_deg root.prems<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BF_Misc-proots_card_pcompose_bij_eq"><span class="command">lemma</span></span> proots_card_pcompose_bij_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>idom poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bij<span class="main">:</span><span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span><span class="main">)</span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> q_deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="free">p</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>poly_root_induct_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>no_proots <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="skolem">p</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> no_proots <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> no_proots 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_pcompose proots_within_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>root <span class="skolem">b</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∉</span><span class="free">B</span> <span class="main">∨</span> poly <span class="skolem">p</span> <span class="skolem">b</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">B</span> <span class="main">=</span> proots_within <span class="skolem">p</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="main">(</span><span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> proots_within <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> pcompose_mult proots_within_times
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_pcompose<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> bij bij_betwE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> root.hyps<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">b</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bb</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bb</span><span class="main">=</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="main">(</span><span class="skolem">bb</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> card <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="main">+</span> card <span class="main">(</span>proots_within <span class="skolem">p</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="skolem">bb</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> bb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_within_times
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> card_Un_disjoint<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">use</span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> card <span class="main">(</span>proots_within <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> root.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="main">(</span><span class="main">(</span><span class="skolem">bb</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> proots_within_times pcompose_mult
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> card_Un_disjoint<span class="main">)</span> 
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">=</span>poly <span class="free">q</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">A</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> bij bij_betwE bij_betw_the_inv_into f_the_inv_into_f_bij_betw<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bbq</span></span> <span class="skolem"><span class="skolem">pq</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bbq</span><span class="main">=</span><span class="skolem">bb</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pq</span><span class="main">=</span><span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> bbq_0<span class="main">:</span><span class="quoted"><span class="quoted">"poly <span class="skolem">bbq</span> <span class="skolem">a</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bbq_deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">bbq</span><span class="main">≤</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bbq</span><span class="main">≠</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> bbq_def bb_def poly_pcompose
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">=</span>poly <span class="free">q</span> <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> q_deg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_add_le degree_pcompose<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> pcompose_eq_0 q_deg <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>proots_within <span class="skolem">bbq</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">bbq</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>proots_within <span class="skolem">pq</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pq_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> finite_proots pcompose_eq_0 q_deg zero_less_one<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> bbq_a<span class="main">:</span><span class="quoted"><span class="quoted">"proots_within <span class="skolem">bbq</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span>proots_within <span class="skolem">bbq</span> <span class="free">A</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> bb_def proots_within_def poly_pcompose bbq_def 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">=</span>poly <span class="free">q</span> <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">∈</span><span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="skolem">bbq</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="skolem">bbq</span> <span class="free">A</span><span class="main">)</span> <span class="main">≠</span><span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">∈</span>proots_within <span class="skolem">bbq</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>proots_within <span class="skolem">bbq</span> <span class="free">A</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="skolem">bbq</span> <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">bbq</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> card_proots_within_leq le_trans proots_count_leq_degree bbq_deg<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_1_singletonE singletonD<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="main">(</span><span class="skolem">bbq</span><span class="main">)</span> <span class="free">A</span> <span class="main">∩</span> proots_within <span class="main">(</span><span class="skolem">pq</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> bbq_a <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> poly <span class="free">q</span> <span class="skolem">a</span>›</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> pq_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>poly_pcompose<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> card <span class="main">(</span>proots_within <span class="skolem">pq</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="skolem">bbq</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span>proots_within <span class="skolem">pq</span> <span class="free">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> bbq_a <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> bb_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Budan_Fourier">
<div class="head">
<h1>Theory Budan_Fourier</h1>
</div>
<pre class="source"><span class="comment1">(*
    Title:      Budan-Fourier theorem
    Author:     Wenda Li &lt;wl302@cam.ac.uk / liwenda1990@hotmail.com&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Budan-Fourier theorem›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Budan_Fourier <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#BF_Misc">BF_Misc</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The Budan-Fourier theorem is a classic result in real algebraic geometry to over-approximate
real roots of a polynomial (counting multiplicity) within an interval. When all roots of the 
the polynomial are known to be real, the over-approximation becomes tight -- the number of 
roots are counted exactly. Also note that Descartes' rule of sign is a direct consequence of
the Budan-Fourier theorem.

The proof mainly follows Theorem 2.35 in
  Basu, S., Pollack, R., Roy, M.-F.: Algorithms in Real Algebraic Geometry. 
  Springer Berlin Heidelberg, Berlin, Heidelberg (2006).
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More results related to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">sign_r_pos</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Budan_Fourier-sign_r_pos_nzero_right"><span class="command">lemma</span></span> sign_r_pos_nzero_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nzero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≤</span><span class="free">d</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&lt;</span><span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> sign_r_pos <span class="free">p</span> <span class="free">c</span> <span class="keyword1">then</span> poly <span class="free">p</span> <span class="free">d</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">else</span> poly <span class="free">p</span> <span class="free">d</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="free">p</span> <span class="free">c</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span><span class="main">&gt;</span><span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d'_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">&gt;</span><span class="free">c</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="skolem">d'</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">p</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def eventually_at_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poly <span class="free">p</span> <span class="free">d</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">&gt;</span><span class="main">(</span><span class="free">c</span> <span class="main">+</span> min <span class="free">d</span> <span class="skolem">d'</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> poly_IVT_neg<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d'</span><span class="main">&gt;</span><span class="free">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="free">d</span>›</span></span> that nzero<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">d</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>d'_pos<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> nzero <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&lt;</span> <span class="skolem">d'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="free">c</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> sign_r_pos_minus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> nzero<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">d</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="free">d</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span><span class="main">&gt;</span><span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d'_neg<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">&gt;</span><span class="free">c</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="skolem">d'</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&gt;</span> poly <span class="free">p</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def eventually_at_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poly <span class="free">p</span> <span class="free">d</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">&gt;</span><span class="main">(</span><span class="free">c</span> <span class="main">+</span> min <span class="free">d</span> <span class="skolem">d'</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> poly_IVT_pos<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d'</span><span class="main">&gt;</span><span class="free">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="free">d</span>›</span></span> that nzero<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">d</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>d'_neg<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> nzero <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&lt;</span> <span class="skolem">d'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="Budan_Fourier-sign_r_pos_at_left"><span class="command">lemma</span></span> sign_r_pos_at_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> even <span class="main">(</span>order <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span>sign_r_pos <span class="free">p</span> <span class="free">c</span> <span class="keyword1">then</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">c</span><span class="main">)</span>
         <span class="keyword1">else</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">&lt;</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>poly_root_induct_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>no_proots <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"order <span class="free">c</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> order_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">c</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="keyword1">at</span> <span class="free">c</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="skolem">p</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> less_linear no_proots.hyps not_eventuallyD 
          poly_IVT_neg poly_IVT_pos<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="skolem">p</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eventually_at_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="skolem">p</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sign_r_pos_rec<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">c</span> <span class="main">&lt;</span><span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="keyword1">at</span> <span class="free">c</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> less_linear no_proots.hyps not_eventuallyD 
          poly_IVT_neg poly_IVT_pos<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> eventually_at_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sign_r_pos <span class="skolem">p</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sign_r_pos_rec<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> no_proots<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>root <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">aa</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">=</span><span class="main">[:</span><span class="main">-</span><span class="skolem">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> aa_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&gt;</span><span class="skolem">a</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="main">(</span>order <span class="free">c</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> sign_r_pos <span class="skolem">p</span> <span class="free">c</span> 
            <span class="keyword1">then</span> <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="main">(</span><span class="skolem">aa</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">x</span>
            <span class="keyword1">else</span> <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> poly <span class="main">(</span><span class="skolem">aa</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">c</span> <span class="skolem">aa</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> aa_def <span class="keyword1"><span class="command">using</span></span> order_0I that <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>order <span class="free">c</span> <span class="main">(</span><span class="skolem">aa</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> even <span class="main">(</span>order <span class="free">c</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> order_mult<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="skolem">aa</span> <span class="free">c</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> aa_def <span class="keyword1"><span class="command">using</span></span> that 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sign_r_pos_rec<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span><span class="skolem">aa</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> sign_r_pos <span class="skolem">p</span> <span class="free">c</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sign_r_pos_mult<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> aa_def<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="main">(</span>order <span class="free">c</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> sign_r_pos <span class="skolem">p</span> <span class="free">c</span> 
            <span class="keyword1">then</span> <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="skolem">p</span> <span class="bound">x</span>
            <span class="keyword1">else</span> <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="skolem">aa</span> <span class="bound">x</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>aa_def<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> that eventually_at_left_field <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="main">(</span><span class="skolem">aa</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> <span class="main">0</span> <span class="main">&gt;</span> poly <span class="main">(</span><span class="skolem">aa</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> <span class="main">0</span> <span class="main">&gt;</span> poly <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> eventually_elim2<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_less_mult_iff mult_less_0_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> root.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&lt;</span><span class="skolem">a</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="main">(</span>order <span class="free">c</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> sign_r_pos <span class="skolem">p</span> <span class="free">c</span> 
            <span class="keyword1">then</span> <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> poly <span class="main">(</span><span class="skolem">aa</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">0</span>
            <span class="keyword1">else</span> <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="main">(</span><span class="skolem">aa</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> "</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">c</span> <span class="skolem">aa</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> aa_def <span class="keyword1"><span class="command">using</span></span> order_0I that <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>order <span class="free">c</span> <span class="main">(</span><span class="skolem">aa</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> even <span class="main">(</span>order <span class="free">c</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> order_mult<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sign_r_pos <span class="skolem">aa</span> <span class="free">c</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> aa_def <span class="keyword1"><span class="command">using</span></span> that 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sign_r_pos_rec<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span><span class="skolem">aa</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> sign_r_pos <span class="skolem">p</span> <span class="free">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sign_r_pos_mult<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> aa_def<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="main">(</span>order <span class="free">c</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> sign_r_pos <span class="skolem">p</span> <span class="free">c</span> 
            <span class="keyword1">then</span> <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="skolem">p</span> <span class="bound">x</span>
            <span class="keyword1">else</span> <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> poly <span class="skolem">aa</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>aa_def<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> that eventually_at_filter <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="main">(</span><span class="skolem">aa</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> <span class="main">0</span> <span class="main">&gt;</span> poly <span class="main">(</span><span class="skolem">aa</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> eventually_elim2<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_less_mult_iff mult_less_0_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> root.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">=</span><span class="skolem">a</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="main">(</span>order <span class="free">c</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> sign_r_pos <span class="skolem">p</span> <span class="free">c</span> 
            <span class="keyword1">then</span> <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> <span class="main">0</span> <span class="main">&gt;</span> poly <span class="main">(</span><span class="skolem">aa</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">x</span>
            <span class="keyword1">else</span> <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> poly <span class="main">(</span><span class="skolem">aa</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">c</span> <span class="skolem">aa</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> aa_def <span class="keyword1"><span class="command">using</span></span> that 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order_power_n_n power_one_right<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>order <span class="free">c</span> <span class="main">(</span><span class="skolem">aa</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> odd <span class="main">(</span>order <span class="free">c</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> order_mult<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="skolem">aa</span> <span class="free">c</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> aa_def <span class="keyword1"><span class="command">using</span></span> that 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sign_r_pos_rec pderiv_pCons<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span><span class="skolem">aa</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> sign_r_pos <span class="skolem">p</span> <span class="free">c</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sign_r_pos_mult<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> aa_def<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="main">(</span>order <span class="free">c</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> sign_r_pos <span class="skolem">p</span> <span class="free">c</span> 
            <span class="keyword1">then</span> <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="skolem">p</span> <span class="bound">x</span>
            <span class="keyword1">else</span> <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> <span class="main">0</span> <span class="main">&gt;</span> poly <span class="skolem">aa</span> <span class="bound">x</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>aa_def<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_at_filter<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="main">(</span><span class="skolem">aa</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> <span class="main">0</span> <span class="main">&gt;</span> poly <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> <span class="main">0</span> <span class="main">&gt;</span> poly <span class="main">(</span><span class="skolem">aa</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">c</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> eventually_elim2<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_less_mult_iff mult_less_0_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> root.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="Budan_Fourier-sign_r_pos_nzero_left"><span class="command">lemma</span></span> sign_r_pos_nzero_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nzero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">d</span><span class="main">≤</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">c</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span><span class="main">&lt;</span><span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> even <span class="main">(</span>order <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span>sign_r_pos <span class="free">p</span> <span class="free">c</span> <span class="keyword1">then</span> poly <span class="free">p</span> <span class="free">d</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">else</span> poly <span class="free">p</span> <span class="free">d</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>order <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span>sign_r_pos <span class="free">p</span> <span class="free">c</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nzero<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">d</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">d</span><span class="main">&lt;</span><span class="free">c</span>›</span></span> sign_r_pos_at_left 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_root<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span><span class="main">&lt;</span><span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d'_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">&gt;</span><span class="skolem">d'</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">p</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poly <span class="free">p</span> <span class="free">d</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">&gt;</span><span class="free">d</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">c</span> <span class="main">+</span> max <span class="free">d</span> <span class="skolem">d'</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> poly_IVT_pos<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d'</span><span class="main">&lt;</span><span class="free">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&gt;</span><span class="free">d</span>›</span></span> that nzero<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">d</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>d'_pos<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> nzero <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&gt;</span> <span class="skolem">d'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">&lt;</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nzero<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">d</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">d</span><span class="main">&lt;</span><span class="free">c</span>›</span></span> sign_r_pos_at_left 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_root<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span><span class="main">&lt;</span><span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d'_neg<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">&gt;</span><span class="skolem">d'</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&gt;</span> poly <span class="free">p</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poly <span class="free">p</span> <span class="free">d</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">&gt;</span><span class="free">d</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">c</span> <span class="main">+</span> max <span class="free">d</span> <span class="skolem">d'</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> poly_IVT_neg<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d'</span><span class="main">&lt;</span><span class="free">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&gt;</span><span class="free">d</span>›</span></span> that nzero<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">d</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>d'_neg<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> nzero <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&gt;</span> <span class="skolem">d'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Fourier sequences›</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">pders</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> real poly list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pders</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span> Cons <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free">pders</span> <span class="main">(</span>pderiv <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">termination</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">p</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> degree <span class="bound">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>degree_pderiv pderiv_eq_0_iff<span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> pders.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1" id="Budan_Fourier-set_pders_nzero"><span class="command">lemma</span></span> set_pders_nzero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">∈</span>set <span class="main">(</span>pders <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>pders.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">p</span> <span class="main">#</span> pders <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pders.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">=</span><span class="skolem">p</span> <span class="main">∨</span> <span class="free">q</span><span class="main">∈</span>set <span class="main">(</span>pders <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">=</span><span class="skolem">p</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">∈</span>set <span class="main">(</span>pders <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 pders.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Sign variations for Fourier sequences›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">changes_itv_der</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span>real poly <span class="main">⇒</span>  int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">changes_itv_der</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ps</span><span class="main">=</span> pders <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">in</span> changes_poly_at <span class="bound">ps</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">-</span> changes_poly_at <span class="bound">ps</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">changes_gt_der</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span>real poly <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">changes_gt_der</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">=</span> changes_poly_at <span class="main">(</span>pders <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">changes_le_der</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span>real poly <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">changes_le_der</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">=</span> <span class="main">(</span>degree <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">-</span> changes_poly_at <span class="main">(</span>pders <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Budan_Fourier-changes_poly_pos_inf_pders"><span class="command">lemma</span></span> changes_poly_pos_inf_pders<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"changes_poly_pos_inf <span class="main">(</span>pders <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_eq_zeroE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>changes_poly_pos_inf_def pders.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pderiv_eq_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">=</span>pders <span class="main">(</span>pderiv <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ps<span class="main">:</span><span class="quoted"><span class="quoted">"pders <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">#</span> pderiv <span class="skolem">p</span> <span class="main">#</span><span class="skolem">ps</span>"</span></span> <span class="quoted"><span class="quoted">"pders <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> pderiv <span class="skolem">p</span><span class="main">#</span><span class="skolem">ps</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ps_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹pderiv <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> pders.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> hyps<span class="main">:</span><span class="quoted"><span class="quoted">"changes_poly_pos_inf <span class="main">(</span>pders <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Suc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">x</span> <span class="main">=</span> degree <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> degree_pderiv diff_Suc_1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn_pos_inf <span class="skolem">p</span> <span class="main">*</span> sgn_pos_inf <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> sgn_pos_inf_def lead_coeff_pderiv
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> sgn_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> Suc.hyps<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_pos_inf_def ps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Budan_Fourier-changes_poly_neg_inf_pders"><span class="command">lemma</span></span> changes_poly_neg_inf_pders<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"changes_poly_neg_inf <span class="main">(</span>pders <span class="free">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_eq_zeroE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_neg_inf_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pders.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pderiv_eq_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_neg_inf <span class="main">(</span>pders <span class="skolem">p</span><span class="main">)</span>   
                  <span class="main">=</span> changes_poly_neg_inf <span class="main">(</span><span class="skolem">p</span> <span class="main">#</span> pderiv <span class="skolem">p</span><span class="main">#</span>pders <span class="main">(</span>pderiv <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>pders.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span>  changes_poly_neg_inf <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">#</span>pders <span class="main">(</span>pderiv <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn_neg_inf <span class="skolem">p</span> <span class="main">*</span> sgn_neg_inf <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> sgn_neg_inf_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹pderiv <span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lead_coeff_pderiv degree_pderiv coeff_pderiv sgn_mult pderiv_eq_0_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_neg_inf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span>  changes_poly_neg_inf <span class="main">(</span>pders <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹pderiv <span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>pders.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> degree <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Suc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_pderiv<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> degree <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> degree_pderiv diff_Suc_1 plus_1_eq_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Budan_Fourier-pders_coeffs_sgn_eq"><span class="command">lemma</span></span> pders_coeffs_sgn_eq<span class="main">:</span><span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> sgn<span class="main">(</span>poly <span class="bound">p</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pders <span class="free">p</span><span class="main">)</span> <span class="main">=</span> map sgn <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_eq_zeroE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pders.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pderiv_eq_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pders <span class="skolem">p</span><span class="main">)</span>  
          <span class="main">=</span> sgn <span class="main">(</span>poly <span class="skolem">p</span> <span class="main">0</span><span class="main">)</span><span class="main">#</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pders <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> pders.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sgn <span class="main">(</span>coeff <span class="skolem">p</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> map sgn <span class="main">(</span>coeffs <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="skolem">p</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>coeff <span class="skolem">p</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_0_coeff_0<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Suc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> degree_pderiv diff_Suc_1<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  map sgn <span class="main">(</span>coeffs <span class="skolem">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> p_length<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span>sgn <span class="main">(</span>coeff <span class="skolem">p</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> map sgn <span class="main">(</span>coeffs <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">=</span> length <span class="main">(</span>map sgn <span class="main">(</span>coeffs <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹pderiv <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> degree_pderiv diff_Suc_1 length_Cons 
          length_coeffs_degree length_map<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sgn <span class="main">(</span>coeff <span class="skolem">p</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> map sgn <span class="main">(</span>coeffs <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> map sgn <span class="main">(</span>coeffs <span class="skolem">p</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>sgn <span class="main">(</span>coeff <span class="skolem">p</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> map sgn <span class="main">(</span>coeffs <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sgn <span class="main">(</span>coeff <span class="skolem">p</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> map sgn <span class="main">(</span>coeffs <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> map sgn <span class="main">(</span>coeffs <span class="skolem">p</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 0
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> coeffs_nth<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i'</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> that p_length
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> coeffs_nth<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹pderiv <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> length_coeffs_degree coeff_pderiv sgn_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Budan_Fourier-changes_poly_at_pders_0"><span class="command">lemma</span></span> changes_poly_at_pders_0<span class="main">:</span><span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span>pders <span class="free">p</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> changes <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_at_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> changes_map_sgn_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>pders_coeffs_sgn_eq comp_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Budan-Fourier theorem›</span></span>

<span class="keyword1" id="Budan_Fourier-budan_fourier_aux_right"><span class="command">lemma</span></span> budan_fourier_aux_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&lt;</span><span class="free">d2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">&lt;</span><span class="bound">x</span><span class="main">∧</span> <span class="bound">x</span><span class="main">≤</span><span class="free">d2</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">q</span><span class="main">∈</span>set <span class="main">(</span>pders <span class="free">p</span><span class="main">)</span><span class="main">.</span> poly <span class="bound">q</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span><span class="main">)</span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes_itv_der <span class="free">c</span> <span class="free">d2</span> <span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2-3<span class="main">)</span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> degree_eq_zeroE pCons_0_0<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>changes_itv_der_def pders.simps <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>order_0I<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"pderiv <span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nat.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> pderiv_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> nzero<span class="main">=</span><span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">d2</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">q</span><span class="main">∈</span>set <span class="main">(</span>pders <span class="skolem">p</span><span class="main">)</span><span class="main">.</span> poly <span class="bound">q</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>›</span></span>

  <span class="keyword1"><span class="command">have</span></span> hyps<span class="main">:</span><span class="quoted"><span class="quoted">"changes_itv_der <span class="free">c</span> <span class="free">d2</span> <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Suc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> degree_pderiv diff_Suc_1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> pders.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> nzero pders.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> pders_changes_c<span class="main">:</span><span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span><span class="skolem">r</span><span class="main">#</span> pders <span class="skolem">q</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sign_r_pos <span class="skolem">q</span> <span class="free">c</span> <span class="main">⟷</span> poly <span class="skolem">r</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>
          <span class="keyword1">then</span> changes_poly_at <span class="main">(</span>pders <span class="skolem">q</span><span class="main">)</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">+</span>changes_poly_at <span class="main">(</span>pders <span class="skolem">q</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">r</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span> <span class="skolem">r</span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>pders.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">q</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="skolem">q</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that pderiv_eq_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">=</span><span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> degree_eq_zeroE pCons_0_0<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">r</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sign_r_pos_rec changes_poly_at_def mult_less_0_iff pders.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs<span class="main">:</span><span class="quoted"><span class="quoted">"pders <span class="skolem">q</span><span class="main">=</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">qs</span>"</span></span> <span class="quoted"><span class="quoted">"pders <span class="main">(</span>pderiv <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">qs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>pders.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span><span class="skolem">r</span> <span class="main">#</span> <span class="skolem">qs</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sign_r_pos <span class="main">(</span>pderiv <span class="skolem">q</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> poly <span class="skolem">r</span> <span class="free">c</span><span class="main">)</span> 
              <span class="keyword1">then</span> changes_poly_at <span class="skolem">qs</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">+</span> changes_poly_at <span class="skolem">qs</span> <span class="free">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="quoted"><span class="quoted">‹pderiv <span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> qs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> qs
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="free">c</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_at_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sign_r_pos_rec<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_at_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">r</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sign_r_pos_rec<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="main">]</span></span> mult_less_0_iff<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> pders_changes_d2<span class="main">:</span><span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span><span class="skolem">r</span><span class="main">#</span> pders <span class="skolem">q</span><span class="main">)</span> <span class="free">d2</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sign_r_pos <span class="skolem">q</span> <span class="free">c</span> <span class="main">⟷</span> poly <span class="skolem">r</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>
          <span class="keyword1">then</span> changes_poly_at <span class="main">(</span>pders <span class="skolem">q</span><span class="main">)</span> <span class="free">d2</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">+</span>changes_poly_at <span class="main">(</span>pders <span class="skolem">q</span><span class="main">)</span> <span class="free">d2</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">r</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qr_nzero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">d2</span> <span class="main">⟶</span> poly <span class="skolem">r</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="skolem">q</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span> <span class="skolem">r</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> poly_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs<span class="main">:</span><span class="quoted"><span class="quoted">"pders <span class="skolem">q</span><span class="main">=</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">qs</span>"</span></span> <span class="quoted"><span class="quoted">"pders <span class="main">(</span>pderiv <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">qs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>pders.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> sign_r_pos <span class="skolem">r</span> <span class="free">c</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="skolem">r</span> <span class="free">d2</span> <span class="keyword1">else</span> poly <span class="skolem">r</span> <span class="free">d2</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> sign_r_pos <span class="skolem">q</span> <span class="free">c</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="skolem">q</span> <span class="free">d2</span> <span class="keyword1">else</span> poly <span class="skolem">q</span> <span class="free">d2</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sign_r_pos_nzero_right<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">d2</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">r</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> qr_nzero <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="free">d2</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sign_r_pos_nzero_right<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">d2</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">q</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> qr_nzero <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="free">d2</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> qs changes_poly_at_def
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">r</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>mult_less_0_iff sign_r_pos_rec<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span>  d2c_nzero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≤</span><span class="free">d2</span> <span class="main">⟶</span> poly <span class="skolem">p</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> poly <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≠</span><span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p_cons<span class="main">:</span><span class="quoted"><span class="quoted">"pders <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">#</span>pders<span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nzero Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> pders.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> pders.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">c</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">=</span>pders <span class="main">(</span>pderiv <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> ps_cons<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">#</span>pderiv <span class="skolem">p</span><span class="main">#</span><span class="skolem">ps</span> <span class="main">=</span> pders <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="skolem">p</span><span class="main">#</span><span class="skolem">ps</span><span class="main">=</span>pders <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ps_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>pders.simps<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span><span class="skolem">p</span> <span class="main">#</span> pderiv <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>  changes_poly_at <span class="main">(</span>pderiv <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span> <span class="free">c</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_at_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span><span class="skolem">p</span> <span class="main">#</span> pderiv <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span> <span class="free">d2</span> <span class="main">=</span> changes_poly_at <span class="main">(</span>pderiv <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span> <span class="free">d2</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> sign_r_pos <span class="skolem">p</span> <span class="free">c</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="skolem">p</span> <span class="free">d2</span> <span class="keyword1">else</span> poly <span class="skolem">p</span> <span class="free">d2</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sign_r_pos_nzero_right<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="free">d2</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> nzero<span class="main">[</span><span class="operator">folded</span> ps_cons<span class="main">]</span> assms<span class="main">(</span>1-2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> sign_r_pos <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="free">c</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="free">d2</span> 
                     <span class="keyword1">else</span> poly <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="free">d2</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sign_r_pos_nzero_right<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="free">d2</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> nzero<span class="main">[</span><span class="operator">folded</span> ps_cons<span class="main">]</span> assms<span class="main">(</span>1-2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">d2</span> <span class="main">*</span> poly <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="free">d2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> zero_less_mult_iff sign_r_pos_rec<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">c</span><span class="main">=</span><span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_at_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hyps <span class="keyword1"><span class="command">unfolding</span></span> changes_itv_der_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> ps_cons<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="free">c</span> <span class="main">⟷</span> poly <span class="skolem">p</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span>pders <span class="skolem">p</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> changes_poly_at <span class="main">(</span>pders <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="free">c</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> p_cons
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> pders_changes_c<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span>pders <span class="skolem">p</span><span class="main">)</span> <span class="free">d2</span> <span class="main">=</span> changes_poly_at <span class="main">(</span>pders <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="free">d2</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> p_cons
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> pders_changes_d2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> _ d2c_nzero<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hyps <span class="keyword1"><span class="command">unfolding</span></span> changes_itv_der_def Let_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sign_r_pos <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="free">c</span> <span class="main">⟷</span> poly <span class="skolem">p</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span>pders <span class="skolem">p</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> changes_poly_at <span class="main">(</span>pders <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="free">c</span> <span class="main">+</span><span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> p_cons
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> pders_changes_c<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span>pders <span class="skolem">p</span><span class="main">)</span> <span class="free">d2</span> <span class="main">=</span> changes_poly_at <span class="main">(</span>pders <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="free">d2</span> <span class="main">+</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> p_cons
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> pders_changes_d2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> _ d2c_nzero<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hyps <span class="keyword1"><span class="command">unfolding</span></span> changes_itv_der_def Let_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Budan_Fourier-budan_fourier_aux_left'"><span class="command">lemma</span></span> budan_fourier_aux_left'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">d1</span><span class="main">&lt;</span><span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">d1</span><span class="main">≤</span><span class="bound">x</span><span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">c</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">q</span><span class="main">∈</span>set <span class="main">(</span>pders <span class="free">p</span><span class="main">)</span><span class="main">.</span> poly <span class="bound">q</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes_itv_der <span class="free">d1</span> <span class="free">c</span> <span class="free">p</span> <span class="main">≥</span> order <span class="free">c</span> <span class="free">p</span> <span class="main">∧</span> even <span class="main">(</span>changes_itv_der <span class="free">d1</span> <span class="free">c</span> <span class="free">p</span> <span class="main">-</span> order <span class="free">c</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2-3<span class="main">)</span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> degree_eq_zeroE pCons_0_0<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>changes_itv_der_def pders.simps <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>order_0I<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.right_neutral dvd_0_right mult_zero_right order_root poly_pCons<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"pderiv <span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nat.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> pderiv_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> nzero<span class="main">=</span><span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">d1</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">q</span><span class="main">∈</span>set <span class="main">(</span>pders <span class="skolem">p</span><span class="main">)</span><span class="main">.</span> poly <span class="bound">q</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span>order <span class="free">c</span> <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> hyps<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≤</span> changes_itv_der <span class="free">d1</span> <span class="free">c</span> <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="main">∧</span> even <span class="main">(</span>changes_itv_der <span class="free">d1</span> <span class="free">c</span> <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> v_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Suc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> degree_pderiv diff_Suc_1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> pders.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> nzero pders.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> pders_changes_c<span class="main">:</span><span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span><span class="skolem">r</span><span class="main">#</span> pders <span class="skolem">q</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sign_r_pos <span class="skolem">q</span> <span class="free">c</span> <span class="main">⟷</span> poly <span class="skolem">r</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>
          <span class="keyword1">then</span> changes_poly_at <span class="main">(</span>pders <span class="skolem">q</span><span class="main">)</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">+</span>changes_poly_at <span class="main">(</span>pders <span class="skolem">q</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">r</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span> <span class="skolem">r</span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>pders.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">q</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="skolem">q</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that pderiv_eq_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">=</span><span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> degree_eq_zeroE pCons_0_0<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">r</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sign_r_pos_rec changes_poly_at_def mult_less_0_iff pders.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs<span class="main">:</span><span class="quoted"><span class="quoted">"pders <span class="skolem">q</span><span class="main">=</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">qs</span>"</span></span> <span class="quoted"><span class="quoted">"pders <span class="main">(</span>pderiv <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">qs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>pders.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span><span class="skolem">r</span> <span class="main">#</span> <span class="skolem">qs</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sign_r_pos <span class="main">(</span>pderiv <span class="skolem">q</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> poly <span class="skolem">r</span> <span class="free">c</span><span class="main">)</span> 
              <span class="keyword1">then</span> changes_poly_at <span class="skolem">qs</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">+</span> changes_poly_at <span class="skolem">qs</span> <span class="free">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="quoted"><span class="quoted">‹pderiv <span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> qs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> qs
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="free">c</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_at_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sign_r_pos_rec<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_at_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">r</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sign_r_pos_rec<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="main">]</span></span> mult_less_0_iff<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> pders_changes_d1<span class="main">:</span><span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span><span class="skolem">r</span><span class="main">#</span> pders <span class="skolem">q</span><span class="main">)</span> <span class="free">d1</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="main">(</span>order <span class="free">c</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">⟷</span> sign_r_pos <span class="skolem">q</span> <span class="free">c</span> <span class="main">⟷</span> poly <span class="skolem">r</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>
          <span class="keyword1">then</span> changes_poly_at <span class="main">(</span>pders <span class="skolem">q</span><span class="main">)</span> <span class="free">d1</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">+</span>changes_poly_at <span class="main">(</span>pders <span class="skolem">q</span><span class="main">)</span> <span class="free">d1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">r</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qr_nzero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">d1</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">⟶</span> poly <span class="skolem">r</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="skolem">q</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span> <span class="skolem">r</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> poly_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs<span class="main">:</span><span class="quoted"><span class="quoted">"pders <span class="skolem">q</span><span class="main">=</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">qs</span>"</span></span> <span class="quoted"><span class="quoted">"pders <span class="main">(</span>pderiv <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">qs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>pders.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> even <span class="main">(</span>order <span class="free">c</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> sign_r_pos <span class="skolem">r</span> <span class="free">c</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="skolem">r</span> <span class="free">d1</span> <span class="keyword1">else</span> poly <span class="skolem">r</span> <span class="free">d1</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> even <span class="main">(</span>order <span class="free">c</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> sign_r_pos <span class="skolem">q</span> <span class="free">c</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="skolem">q</span> <span class="free">d1</span> <span class="keyword1">else</span> poly <span class="skolem">q</span> <span class="free">d1</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sign_r_pos_nzero_left<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">d1</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">r</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> qr_nzero <span class="quoted"><span class="quoted">‹<span class="free">d1</span><span class="main">&lt;</span><span class="free">c</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sign_r_pos_nzero_left<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">d1</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">q</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> qr_nzero <span class="quoted"><span class="quoted">‹<span class="free">d1</span><span class="main">&lt;</span><span class="free">c</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">c</span> <span class="skolem">r</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_0I that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> qs changes_poly_at_def
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">r</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>mult_less_0_iff sign_r_pos_rec<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> d1c_nzero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">d1</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">⟶</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p_cons<span class="main">:</span><span class="quoted"><span class="quoted">"pders <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">#</span>pders<span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nzero Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> pders.simps<span class="main">)</span>     

  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">c</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">=</span>pders <span class="main">(</span>pderiv <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> ps_cons<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">#</span>pderiv <span class="skolem">p</span><span class="main">#</span><span class="skolem">ps</span> <span class="main">=</span> pders <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="skolem">p</span><span class="main">#</span><span class="skolem">ps</span><span class="main">=</span>pders <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ps_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>pders.simps<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> p_order<span class="main">:</span><span class="quoted"><span class="quoted">"order <span class="free">c</span> <span class="skolem">p</span> <span class="main">=</span> Suc <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> order_pderiv<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>1<span class="main">)</span> order_root that <span class="keyword1"><span class="command">unfolding</span></span> v_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span><span class="skolem">p</span><span class="main">#</span>pderiv <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span> <span class="free">d1</span> <span class="main">=</span> changes_poly_at <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">#</span><span class="skolem">ps</span><span class="main">)</span> <span class="free">d1</span> <span class="main">+</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> even <span class="main">(</span>order <span class="free">c</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> sign_r_pos <span class="skolem">p</span> <span class="free">c</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="skolem">p</span> <span class="free">d1</span> <span class="keyword1">else</span> poly <span class="skolem">p</span> <span class="free">d1</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sign_r_pos_nzero_left<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="free">d1</span><span class="main">&lt;</span><span class="free">c</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> nzero<span class="main">[</span><span class="operator">folded</span> ps_cons<span class="main">]</span> assms<span class="main">(</span>1-2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> even <span class="skolem">v</span> <span class="main">=</span> sign_r_pos <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="free">c</span> 
                      <span class="keyword1">then</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="free">d1</span> <span class="keyword1">else</span> poly <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="free">d1</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> v_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sign_r_pos_nzero_left<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="free">d1</span><span class="main">&lt;</span><span class="free">c</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> nzero<span class="main">[</span><span class="operator">folded</span> ps_cons<span class="main">]</span> assms<span class="main">(</span>1-2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">d1</span> <span class="main">*</span> poly <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="free">d1</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> mult_less_0_iff sign_r_pos_rec<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">c</span><span class="main">=</span><span class="main">0</span>›</span></span> p_order
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_at_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span><span class="skolem">p</span> <span class="main">#</span> pderiv <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>  changes_poly_at <span class="main">(</span>pderiv <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span> <span class="free">c</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_at_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hyps <span class="keyword1"><span class="command">unfolding</span></span> changes_itv_der_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> ps_cons<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="free">c</span> <span class="main">⟷</span> poly <span class="skolem">p</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">c</span> <span class="skolem">p</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_0I that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span>pders <span class="skolem">p</span><span class="main">)</span> <span class="free">d1</span> <span class="main">=</span> changes_poly_at <span class="main">(</span>pders <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="free">d1</span> <span class="main">+</span><span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> p_cons
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> pders_changes_d1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> _ d1c_nzero<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> v_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span>pders <span class="skolem">p</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> changes_poly_at <span class="main">(</span>pders <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="free">c</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> p_cons
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> pders_changes_c<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> v_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hyps <span class="quoted"><span class="quoted">‹odd <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_itv_der_def Let_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sign_r_pos <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="free">c</span> <span class="main">⟷</span> poly <span class="skolem">p</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">≥</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹odd <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> not_less_eq_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">c</span> <span class="skolem">p</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_0I that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span>pders <span class="skolem">p</span><span class="main">)</span> <span class="free">d1</span> <span class="main">=</span> changes_poly_at <span class="main">(</span>pders <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="free">d1</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> p_cons
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> pders_changes_d1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> _ d1c_nzero<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> v_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span>pders <span class="skolem">p</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> changes_poly_at <span class="main">(</span>pders <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="free">c</span> <span class="main">+</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> p_cons
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> pders_changes_c<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> v_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hyps <span class="quoted"><span class="quoted">‹odd <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_itv_der_def Let_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="free">c</span> <span class="main">⟷</span> poly <span class="skolem">p</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">c</span> <span class="skolem">p</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_0I that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span>pders <span class="skolem">p</span><span class="main">)</span> <span class="free">d1</span> <span class="main">=</span> changes_poly_at <span class="main">(</span>pders <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="free">d1</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> p_cons
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> pders_changes_d1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> _ d1c_nzero<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> v_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span>pders <span class="skolem">p</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> changes_poly_at <span class="main">(</span>pders <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="free">c</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> p_cons
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> pders_changes_c<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> v_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hyps <span class="quoted"><span class="quoted">‹even <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_itv_der_def Let_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sign_r_pos <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="free">c</span> <span class="main">⟷</span> poly <span class="skolem">p</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">c</span> <span class="skolem">p</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_0I that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span>pders <span class="skolem">p</span><span class="main">)</span> <span class="free">d1</span> <span class="main">=</span> changes_poly_at <span class="main">(</span>pders <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="free">d1</span> <span class="main">+</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> p_cons
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> pders_changes_d1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> _ d1c_nzero<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> v_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span>pders <span class="skolem">p</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> changes_poly_at <span class="main">(</span>pders <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="free">c</span> <span class="main">+</span><span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> p_cons
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> pders_changes_c<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> v_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hyps <span class="quoted"><span class="quoted">‹even <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_itv_der_def Let_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Budan_Fourier-budan_fourier_aux_left"><span class="command">lemma</span></span> budan_fourier_aux_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">d1</span><span class="main">&lt;</span><span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nzero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">d1</span><span class="main">&lt;</span><span class="bound">x</span><span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">c</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">q</span><span class="main">∈</span>set <span class="main">(</span>pders <span class="free">p</span><span class="main">)</span><span class="main">.</span> poly <span class="bound">q</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes_itv_der <span class="free">d1</span> <span class="free">c</span> <span class="free">p</span> <span class="main">≥</span> order <span class="free">c</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>changes_itv_der <span class="free">d1</span> <span class="free">c</span> <span class="free">p</span> <span class="main">-</span> order <span class="free">c</span> <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span><span class="main">(</span><span class="free">d1</span><span class="main">+</span><span class="free">c</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d1</span><span class="main">&lt;</span><span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">&lt;</span><span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d1</span><span class="main">&lt;</span><span class="free">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_itv_der <span class="free">d1</span> <span class="skolem">d</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> budan_fourier_aux_right<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">d1</span><span class="main">&lt;</span><span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> nzero <span class="quoted"><span class="quoted">‹<span class="free">d1</span><span class="main">&lt;</span><span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span><span class="main">&lt;</span><span class="free">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">c</span> <span class="free">p</span> <span class="main">≤</span> changes_itv_der <span class="skolem">d</span> <span class="free">c</span> <span class="free">p</span> <span class="main">∧</span> even <span class="main">(</span>changes_itv_der <span class="skolem">d</span> <span class="free">c</span> <span class="free">p</span> <span class="main">-</span> order <span class="free">c</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> budan_fourier_aux_left'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span><span class="main">&lt;</span><span class="free">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> nzero <span class="quoted"><span class="quoted">‹<span class="free">d1</span><span class="main">&lt;</span><span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span><span class="main">&lt;</span><span class="free">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"changes_itv_der <span class="free">d1</span> <span class="free">c</span> <span class="free">p</span> <span class="main">≥</span> order <span class="free">c</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>changes_itv_der <span class="free">d1</span> <span class="free">c</span> <span class="free">p</span> <span class="main">-</span> order <span class="free">c</span> <span class="free">p</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> changes_itv_der_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> budan_fourier_interval<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes_itv_der <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">≥</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≤</span> <span class="free">b</span><span class="main">}</span> <span class="main">∧</span> 
          even <span class="main">(</span>changes_itv_der <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">-</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≤</span> <span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">∈</span>set <span class="main">(</span>pders <span class="free">p</span><span class="main">)</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">b</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">have</span></span> nzero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="skolem">b</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">q</span><span class="main">∈</span>set <span class="main">(</span>pders <span class="free">p</span><span class="main">)</span><span class="main">.</span> poly <span class="bound">q</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">=</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">∈</span>set <span class="main">(</span>pders <span class="free">p</span><span class="main">)</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span><span class="main">∈</span>set <span class="main">(</span>pders <span class="free">p</span><span class="main">)</span><span class="main">.</span> proots <span class="bound">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span><span class="main">∈</span>set <span class="main">(</span>pders <span class="free">p</span><span class="main">)</span><span class="main">.</span> proots <span class="bound">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> finite_UN<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> set_pders_nzero<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">S</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="skolem">b</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> pders.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> budan_fourier_aux_left<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">a</span></span><span class="main"><span class="main">&lt;</span></span><span class="skolem"><span class="skolem">b</span></span>›</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">p</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span> this<span class="main">]</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">b</span> <span class="free">p</span> <span class="main">≤</span> changes_itv_der <span class="free">a</span> <span class="skolem">b</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>changes_itv_der <span class="free">a</span> <span class="skolem">b</span> <span class="free">p</span> <span class="main">-</span> order <span class="skolem">b</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≤</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">=</span> order <span class="skolem">b</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> p_cons<span class="main">:</span><span class="quoted"><span class="quoted">"pders <span class="free">p</span><span class="main">=</span><span class="free">p</span><span class="main">#</span>pders <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> pders.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="skolem">b</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nzero <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_cons
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">using</span></span> not_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def <span class="keyword1"><span class="command">using</span></span> order_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">∈</span>set <span class="main">(</span>pders <span class="free">p</span><span class="main">)</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span><span class="main">=</span>Max <span class="main">(</span><span class="skolem">S</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> f_S<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">S</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="skolem">x</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span><span class="main">∈</span>set <span class="main">(</span>pders <span class="free">p</span><span class="main">)</span><span class="main">.</span> proots <span class="bound">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> S_def P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span><span class="main">∈</span>set <span class="main">(</span>pders <span class="free">p</span><span class="main">)</span><span class="main">.</span> proots <span class="bound">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> finite_UN<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> set_pders_nzero<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span><span class="main">∈</span><span class="skolem">S</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> b'_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Max_in<span class="main"><span class="main">[</span></span><span class="operator">OF</span> f_S<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> S_def P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="skolem">b'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span><span class="main">&lt;</span><span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> b'_nzero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">b'</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="skolem">b</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">q</span><span class="main">∈</span>set <span class="main">(</span>pders <span class="free">p</span><span class="main">)</span><span class="main">.</span> poly <span class="bound">q</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">b'</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">b</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">q</span><span class="main">∈</span>set <span class="main">(</span>pders <span class="free">p</span><span class="main">)</span><span class="main">.</span> poly <span class="bound">q</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bb</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">bb</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span><span class="main">&lt;</span><span class="skolem">bb</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bb</span><span class="main">&lt;</span><span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bb</span><span class="main">∈</span><span class="skolem">S</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="skolem">b'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span><span class="main">&lt;</span><span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Max_ge<span class="main">[</span><span class="operator">OF</span> f_S this<span class="main">,</span> <span class="operator">folded</span> b'_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bb</span> <span class="main">≤</span> <span class="skolem">b'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span><span class="main">&lt;</span><span class="skolem">bb</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> hyps<span class="main">:</span><span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b'</span><span class="main">}</span> <span class="main">≤</span> changes_itv_der <span class="free">a</span> <span class="skolem">b'</span> <span class="free">p</span> <span class="main">∧</span>
                even <span class="main">(</span>changes_itv_der <span class="free">a</span> <span class="skolem">b'</span> <span class="free">p</span> <span class="main">-</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b'</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Suc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="skolem">b'</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="skolem">b</span><span class="main">=</span> <span class="main">{</span><span class="skolem">b'</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">S</span> <span class="skolem">b'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">b'</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> b'_nzero <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span><span class="main">∧</span> <span class="skolem">b'</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">b'</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span><span class="main">∈</span><span class="skolem">S</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="skolem">b</span><span class="main">=</span> <span class="skolem">S</span> <span class="skolem">b'</span> <span class="main">∪</span>  <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">b'</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="skolem">b'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span><span class="main">&lt;</span><span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">=</span> card <span class="main">(</span><span class="skolem">S</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> S_def P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span><span class="main">∉</span><span class="skolem">S</span> <span class="skolem">b'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span>card <span class="main">(</span><span class="skolem">S</span> <span class="skolem">b'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f_S <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">∈</span>set <span class="main">(</span>pders <span class="free">p</span><span class="main">)</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">b'</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> S_def P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span><span class="main">}</span> 
                    <span class="main">=</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b'</span><span class="main">}</span> <span class="main">+</span> order <span class="skolem">b</span> <span class="free">p</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> p_cons<span class="main">:</span><span class="quoted"><span class="quoted">"pders <span class="free">p</span><span class="main">=</span><span class="free">p</span><span class="main">#</span>pders <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> pders.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">b'</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="skolem">b</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b'_nzero <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">&lt;</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_cons
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">using</span></span> not_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">b'</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">=</span> order <span class="skolem">b</span> <span class="free">p</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def <span class="keyword1"><span class="command">using</span></span> order_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">=</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b'</span><span class="main">}</span> <span class="main">+</span>
            proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">b'</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> proots_count_union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="skolem">b'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span><span class="main">&lt;</span><span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>arg_cong2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">proots_count</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> budan_fourier_aux_left<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">b'</span></span><span class="main"><span class="main">&lt;</span></span><span class="skolem"><span class="skolem">b</span></span>›</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">p</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span> b'_nzero<span class="main">]</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_itv_der_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">theorem</span></span> budan_fourier_gt<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes_gt_der <span class="free">a</span> <span class="free">p</span> <span class="main">≥</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span> <span class="main">∧</span> 
          even <span class="main">(</span>changes_gt_der <span class="free">a</span> <span class="free">p</span> <span class="main">-</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">=</span>pders <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub</span></span> <span class="keyword2"><span class="keyword">where</span></span> ub_root<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">ub</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ub_sgn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">ub</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_pos_inf <span class="bound">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="skolem">ub</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> root_list_ub<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ps</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> set_pders_nzero<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">folded</span> ps_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">ub</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ps_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms pders.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> proots_within <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≤</span><span class="skolem">ub</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ub_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_gt_der <span class="free">a</span> <span class="free">p</span> <span class="main">=</span> changes_itv_der <span class="free">a</span> <span class="skolem">ub</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>sgn <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> poly <span class="bound">p</span> <span class="skolem">ub</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ps</span> <span class="main">=</span> map sgn_pos_inf <span class="skolem">ps</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ub_sgn<span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ub</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> comp_def list.map_cong0<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="skolem">ps</span> <span class="skolem">ub</span><span class="main">=</span>changes_poly_pos_inf <span class="skolem">ps</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_pos_inf_def changes_poly_at_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> changes_map_sgn_eq<span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> map_map<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="skolem">ps</span> <span class="skolem">ub</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ps_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_gt_der_def changes_itv_der_def ps_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">ub</span><span class="main">}</span> <span class="main">≤</span> changes_itv_der <span class="free">a</span> <span class="skolem">ub</span> <span class="free">p</span> <span class="main">∧</span>
      even <span class="main">(</span>changes_itv_der <span class="free">a</span> <span class="skolem">ub</span> <span class="free">p</span> <span class="main">-</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">ub</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> budan_fourier_interval<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="skolem">ub</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Descartes' rule of signs is a direct consequence of the Budan-Fourier theorem›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> descartes_sign<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" changes <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">≥</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span> <span class="main">∧</span> 
          even <span class="main">(</span>changes <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">-</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> budan_fourier_gt<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> changes_gt_der_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>changes_poly_at_pders_0<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> budan_fourier_le<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes_le_der <span class="free">b</span> <span class="free">p</span> <span class="main">≥</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span><span class="free">b</span><span class="main">}</span> <span class="main">∧</span> 
          even <span class="main">(</span>changes_le_der <span class="free">b</span> <span class="free">p</span> <span class="main">-</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">=</span>pders <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lb</span></span> <span class="keyword2"><span class="keyword">where</span></span> lb_root<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="skolem">lb</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> lb_sgn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≤</span><span class="skolem">lb</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_neg_inf <span class="bound">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lb</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> root_list_lb<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ps</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> set_pders_nzero<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">folded</span> ps_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">lb</span><span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ps_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms pders.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> proots_within <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">lb</span><span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≤</span><span class="free">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lb_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_le_der <span class="free">b</span> <span class="free">p</span> <span class="main">=</span> changes_itv_der <span class="skolem">lb</span> <span class="free">b</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>sgn <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> poly <span class="bound">p</span> <span class="skolem">lb</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ps</span> <span class="main">=</span> map sgn_neg_inf <span class="skolem">ps</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lb_sgn<span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">lb</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> comp_def list.map_cong0<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="skolem">ps</span> <span class="skolem">lb</span><span class="main">=</span>changes_poly_neg_inf <span class="skolem">ps</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_neg_inf_def changes_poly_at_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> changes_map_sgn_eq<span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> map_map<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="skolem">ps</span> <span class="skolem">lb</span><span class="main">=</span>degree <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ps_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_le_der_def changes_itv_der_def ps_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">lb</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span><span class="main">}</span> <span class="main">≤</span> changes_itv_der <span class="skolem">lb</span> <span class="free">b</span> <span class="free">p</span> <span class="main">∧</span>
      even <span class="main">(</span>changes_itv_der <span class="skolem">lb</span> <span class="free">b</span> <span class="free">p</span> <span class="main">-</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">lb</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> budan_fourier_interval<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">lb</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Count exactly when all roots are real›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">all_roots_real</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> bool "</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">all_roots_real</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span><span class="main">∈</span>proots <span class="main">(</span>map_poly of_real <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">.</span> Im <span class="bound">r</span><span class="main">=</span><span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Budan_Fourier-all_roots_real_mult"><span class="command">lemma</span></span> all_roots_real_mult<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"all_roots_real <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">⟷</span> all_roots_real <span class="free">p</span> <span class="main">∧</span> all_roots_real <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> all_roots_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Budan_Fourier-all_roots_real_const_iff"><span class="command">lemma</span></span> all_roots_real_const_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> all_real<span class="main">:</span><span class="quoted"><span class="quoted">"all_roots_real <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span><span class="main">≠</span><span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span><span class="main">=</span>map_poly complex_of_real <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">pp</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">pp</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">pp</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> all_real<span class="main">[</span><span class="operator">unfolded</span> all_roots_real_def<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">,</span><span class="operator">folded</span> pp_def<span class="main">]</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">pp</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>›</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">pp</span> <span class="main">(</span>of_real <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_is_Real_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> pp_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Re_complex_of_real of_real_poly_map_poly zero_complex.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span><span class="main">=</span><span class="main">[:</span>of_real <span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹degree <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> constant_degree degree_map_poly 
            fundamental_theorem_of_algebra of_real_eq_0_iff pp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pp_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> map_poly_0 map_poly_pCons of_real_0 of_real_poly_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UNIV_I all_roots_real_def assms degree_pCons_eq_if 
        imaginary_unit.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> map_poly_0 nat.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> order_root pCons_eq_0_iff 
        proots_within_iff synthetic_div_eq_0_iff synthetic_div_pCons zero_neq_one<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Budan_Fourier-all_roots_real_degree"><span class="command">lemma</span></span> all_roots_real_degree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"all_roots_real <span class="free">p</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> UNIV <span class="main">=</span>degree <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>poly_root_induct_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> imaginary_unit.sel<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> all_roots_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>no_proots <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> all_roots_real_const_iff<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> this<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> degree_eq_zeroE no_proots.hyps poly_const_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots <span class="skolem">p</span><span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">=</span><span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>proots_count_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>root <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span><span class="main">=</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> root.prems 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">using</span></span> imaginary_unit.sel<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> all_roots_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span><span class="skolem">a1</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> UNIV <span class="main">=</span> proots_count <span class="skolem">a1</span> UNIV <span class="main">+</span> proots_count <span class="skolem">p</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a1</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> proots_count_times<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> degree <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="skolem">a1</span> UNIV <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proots_count_pCons_1_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> hyps<span class="main">:</span><span class="quoted"><span class="quoted">"proots_count <span class="skolem">p</span> UNIV <span class="main">=</span> degree <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> root.hyps<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> root.prems<span class="main">[</span><span class="operator">folded</span> a1_def<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> all_roots_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> degree <span class="main">(</span><span class="skolem">a1</span><span class="main">*</span><span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> degree_mult_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a1</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a1_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Budan_Fourier-all_real_roots_mobius"><span class="command">lemma</span></span> all_real_roots_mobius<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span><span class="main">::</span><span class="quoted">real</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"all_roots_real <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"all_roots_real <span class="main">(</span>fcompose <span class="free">p</span> <span class="main">[:</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">:]</span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>poly_root_induct_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>no_proots <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> all_roots_real_const_iff<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> this<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> degree_eq_zeroE no_proots.hyps poly_const_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>all_roots_real_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>root <span class="skolem">x</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">=</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fx</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fx</span><span class="main">=</span>fcompose <span class="skolem">x1</span> <span class="main">[:</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">:]</span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"all_roots_real <span class="skolem">fx</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">b</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fx</span> <span class="main">=</span> <span class="main">[:</span><span class="free">a</span><span class="main">-</span><span class="skolem">x</span><span class="main">:]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> fx_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fcompose_def smult_add_right x1_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots <span class="main">(</span>map_poly complex_of_real <span class="skolem">fx</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> all_roots_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fx</span> <span class="main">=</span> <span class="main">[:</span><span class="free">a</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span><span class="free">b</span><span class="main">-</span><span class="skolem">x</span><span class="main">:]</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> fx_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fcompose_def smult_add_right x1_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots <span class="main">(</span>map_poly complex_of_real <span class="skolem">fx</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>of_real <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> all_roots_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"all_roots_real <span class="main">(</span>fcompose <span class="skolem">p</span> <span class="main">[:</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">:]</span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> root<span class="main">[</span><span class="operator">folded</span> x1_def<span class="main">]</span> all_roots_real_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> x1_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fcompose_mult fx_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If all roots are real, we can use the 
      Budan-Fourier theorem to EXACTLY count the number of real roots.›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> budan_fourier_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"all_roots_real <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span><span class="free">a</span><span class="main">}</span> <span class="main">=</span> changes_le_der <span class="free">a</span> <span class="free">p</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span> <span class="main">⟹</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> changes_itv_der <span class="free">a</span> <span class="free">b</span> <span class="free">p</span>"</span></span>
        <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">b</span> <span class="main">&lt;</span><span class="bound">x</span><span class="main">}</span> <span class="main">=</span> changes_gt_der <span class="free">b</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span><span class="skolem">a</span><span class="main">}</span> <span class="main">=</span> changes_le_der <span class="skolem">a</span> <span class="free">p</span>
        <span class="main">∧</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span><span class="skolem">b</span><span class="main">}</span> <span class="main">=</span> changes_itv_der <span class="skolem">a</span> <span class="skolem">b</span> <span class="free">p</span>
        <span class="main">∧</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">&lt;</span><span class="bound">x</span><span class="main">}</span> <span class="main">=</span> changes_gt_der <span class="skolem">b</span> <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="skolem"><span class="skolem">c3</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">=</span>changes_le_der <span class="skolem">a</span> <span class="free">p</span> <span class="main">-</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span><span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">c2</span><span class="main">=</span>changes_itv_der <span class="skolem">a</span> <span class="skolem">b</span> <span class="free">p</span> <span class="main">-</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">c3</span><span class="main">=</span>changes_gt_der <span class="skolem">b</span> <span class="free">p</span> <span class="main">-</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">&lt;</span><span class="bound">x</span><span class="main">}</span>"</span></span> 

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c3</span><span class="main">≥</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> budan_fourier_interval<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> budan_fourier_gt<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span>
          budan_fourier_le<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">unfolding</span></span> c1_def c2_def c3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">+</span><span class="skolem">c2</span><span class="main">+</span><span class="skolem">c3</span><span class="main">=</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> proots_deg<span class="main">:</span><span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> UNIV <span class="main">=</span>degree <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> all_roots_real_degree<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹all_roots_real <span class="free">p</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_le_der <span class="skolem">a</span> <span class="free">p</span> <span class="main">+</span> changes_itv_der <span class="skolem">a</span> <span class="skolem">b</span> <span class="free">p</span> <span class="main">+</span> changes_gt_der <span class="skolem">b</span> <span class="free">p</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> changes_le_der_def changes_itv_der_def changes_gt_der_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Let_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span><span class="skolem">a</span><span class="main">}</span> <span class="main">+</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span><span class="skolem">b</span><span class="main">}</span> 
          <span class="main">+</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">&lt;</span><span class="bound">x</span><span class="main">}</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">b</span>›</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> proots_count_union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> proots_deg<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>arg_cong2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">proots_count</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c1_def c2_def c3_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c3</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c1_def c2_def c3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span><span class="free">a</span><span class="main">}</span> <span class="main">=</span> changes_le_der <span class="free">a</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> changes_itv_der <span class="free">a</span> <span class="free">b</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">b</span> <span class="main">&lt;</span><span class="bound">x</span><span class="main">}</span> <span class="main">=</span> changes_gt_der <span class="free">b</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Similarly, Descartes' rule of sign counts exactly when all roots are real.›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> descartes_sign_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">a</span> <span class="free">b</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"all_roots_real <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> changes <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> budan_fourier_real<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹all_roots_real <span class="free">p</span>›</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">unfolding</span></span> changes_gt_der_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>changes_poly_at_pders_0<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Sturm_Multiple_Roots">
<div class="head">
<h1>Theory Sturm_Multiple_Roots</h1>
</div>
<pre class="source"><span class="comment1">(*
    Title:      Extension of Sturm's theorem for multiple roots
    Author:     Wenda Li &lt;wl302@cam.ac.uk / liwenda1990@hotmail.com&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Extension of Sturm's theorem for multiple roots›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Sturm_Multiple_Roots 
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="#BF_Misc">BF_Misc</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The classic Sturm's theorem is used to count real roots WITHOUT multiplicity of a polynomial within 
  an interval. Surprisingly, we can also extend Sturm's theorem to count real roots WITH 
  multiplicity by modifying the signed remainder sequence, which seems to be overlooked by many
  textbooks. 

  Our formal proof is inspired by Theorem 10.5.6 in 
    Rahman, Q.I., Schmeisser, G.: Analytic Theory of Polynomials. Oxford University Press (2002).
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More results for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">smods</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Sturm_Multiple_Roots-last_smods_gcd"><span class="command">lemma</span></span> last_smods_gcd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">pp</span> <span class="main">≡</span> last <span class="main">(</span>smods <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">pp</span> <span class="main">=</span> smult <span class="main">(</span>lead_coeff <span class="free">pp</span><span class="main">)</span> <span class="main">(</span>gcd <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pp_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"smods <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>length_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that smult_normalize_field_eq <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">mod</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> smods_cons<span class="main">:</span><span class="quoted"><span class="quoted">"smods <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">#</span> smods <span class="skolem">q</span> <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>smods <span class="skolem">q</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> smult <span class="main">(</span>lead_coeff <span class="main">(</span>last <span class="main">(</span>smods <span class="skolem">q</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>gcd <span class="skolem">q</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"smods <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">r</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">q</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">r</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> smods_cons <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">=</span> gcd <span class="skolem">q</span> <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gcd.commute that<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> smods_cons <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sturm_Multiple_Roots-last_smods_nzero"><span class="command">lemma</span></span> last_smods_nzero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>smods <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms last_in_set no_0_in_smods smods_nil_eq<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Alternative signed remainder sequences›</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">smods_ext</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> real poly <span class="main">⇒</span> real poly list"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">smods_ext</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span>
                      <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≠</span> <span class="main">0</span>  
                        <span class="keyword1">then</span> Cons <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free">smods_ext</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                        <span class="keyword1">else</span> Cons <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free">smods_ext</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span>pderiv <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">termination</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">q</span><span class="main">)</span><span class="main">.</span><span class="keyword1">if</span> <span class="bound">p</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">q</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="numeral">2</span><span class="main">+</span>degree <span class="bound">q</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> degree_mod_less <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>degree_pderiv pderiv_eq_0_iff<span class="main">)</span>

<span class="keyword1" id="Sturm_Multiple_Roots-smods_ext_prefix"><span class="command">lemma</span></span> smods_ext_prefix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">pp</span> <span class="main">≡</span> last <span class="main">(</span>smods <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"smods_ext <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> smods <span class="free">p</span> <span class="free">q</span> <span class="main">@</span> tl <span class="main">(</span>smods_ext <span class="free">pp</span> <span class="main">(</span>pderiv <span class="free">pp</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> pp_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"smods_ext <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>length_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">mod</span> <span class="skolem">q</span> <span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span><span class="main">=</span>last <span class="main">(</span>smods <span class="skolem">q</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">mod</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> smods_cons<span class="main">:</span><span class="quoted"><span class="quoted">"smods <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">#</span> smods <span class="skolem">q</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">mod</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> pp_last<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">pp</span><span class="main">=</span>last <span class="main">(</span>smods <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pp_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"1.prems"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> pp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> smods_ext_cons<span class="main">:</span><span class="quoted"><span class="quoted">"smods_ext <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">#</span> smods_ext <span class="skolem">q</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">mod</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smods_ext <span class="skolem">q</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">mod</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> smods <span class="skolem">q</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">mod</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> tl <span class="main">(</span>smods_ext <span class="skolem">pp</span> <span class="main">(</span>pderiv <span class="skolem">pp</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"smods_ext <span class="skolem"><span class="skolem">q</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">-</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">p</span></span> <span class="keyword1"><span class="keyword1">mod</span></span> <span class="skolem"><span class="skolem">q</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">q</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">-</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">p</span></span> <span class="keyword1"><span class="keyword1">mod</span></span> <span class="skolem"><span class="skolem">q</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">,</span></span><span class="operator">folded</span> pp_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> smods_ext_cons <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> pp_last
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> smods_cons<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> smods_ext_cons<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">mod</span> <span class="skolem">q</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smods <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smods_ext <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">mod</span> <span class="skolem">q</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> smods_cons<span class="main">:</span><span class="quoted"><span class="quoted">"smods <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> smods_ext_cons<span class="main">:</span><span class="quoted"><span class="quoted">"smods_ext <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">#</span>smods_ext <span class="skolem">q</span> <span class="main">(</span>pderiv <span class="skolem">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> smods_cons smods_ext_cons
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>smods_ext.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"1.prems"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sturm_Multiple_Roots-no_0_in_smods_ext"><span class="command">lemma</span></span> no_0_in_smods_ext<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">∉</span>set <span class="main">(</span>smods_ext <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"smods_ext <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.inject set_ConsD smods_ext.simps<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Sign variations on the alternative signed remainder sequences›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">changes_itv_smods_ext</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span>real poly <span class="main">⇒</span> real poly <span class="main">⇒</span>  int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">changes_itv_smods_ext</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ps</span><span class="main">=</span> smods_ext <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">in</span> changes_poly_at <span class="bound">ps</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> 
        <span class="main">-</span> changes_poly_at <span class="bound">ps</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">changes_gt_smods_ext</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span>real poly <span class="main">⇒</span> real poly <span class="main">⇒</span>  int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">changes_gt_smods_ext</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ps</span><span class="main">=</span> smods_ext <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">in</span> changes_poly_at <span class="bound">ps</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> 
        <span class="main">-</span> changes_poly_pos_inf <span class="bound">ps</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">changes_le_smods_ext</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span>real poly <span class="main">⇒</span> real poly <span class="main">⇒</span>  int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">changes_le_smods_ext</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ps</span><span class="main">=</span> smods_ext <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">in</span> changes_poly_neg_inf <span class="bound">ps</span> 
        <span class="main">-</span> changes_poly_at <span class="bound">ps</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">changes_R_smods_ext</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> real poly <span class="main">⇒</span>  int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">changes_R_smods_ext</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ps</span><span class="main">=</span> smods_ext <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">in</span> changes_poly_neg_inf <span class="bound">ps</span> 
        <span class="main">-</span> changes_poly_pos_inf <span class="bound">ps</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Extension of Sturm's theorem for multiple roots›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> sturm_ext_interval<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> changes_itv_smods_ext <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"smods_ext <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>length_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="skolem">p</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">[:</span><span class="skolem">c</span><span class="main">:]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹pderiv <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>›</span></span> pderiv_iszero <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="skolem">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_itv_smods_ext <span class="free">a</span> <span class="free">b</span> <span class="skolem">p</span> <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> changes_itv_smods_ext_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">=</span><span class="main">[:</span><span class="skolem">c</span><span class="main">:]</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span> <span class="main">=</span> last <span class="main">(</span>smods <span class="skolem">p</span> <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lp</span> <span class="main">=</span> lead_coeff <span class="skolem">pp</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">=</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span> <span class="free">b</span><span class="main">}</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> prefix<span class="main">:</span><span class="quoted"><span class="quoted">"smods_ext <span class="skolem">p</span> <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> smods <span class="skolem">p</span> <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="main">@</span> tl <span class="main">(</span>smods_ext <span class="skolem">pp</span> <span class="main">(</span>pderiv <span class="skolem">pp</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> smods_ext_prefix<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹pderiv <span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">folded</span> pp_def<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> pp_gcd<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">pp</span> <span class="main">=</span> smult <span class="skolem">lp</span> <span class="main">(</span>gcd <span class="skolem">p</span> <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> last_smods_gcd<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pderiv <span class="skolem">p</span>"</span></span><span class="main">,</span><span class="operator">folded</span> pp_def lp_def<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lp</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pp_def lp_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> last_smods_nzero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹last <span class="main">(</span>smods <span class="skolem">p</span> <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">pp</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">pp</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> pp_gcd <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">lp</span><span class="main">≠</span><span class="main">0</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>poly_gcd_0_iff<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="skolem">pp</span> <span class="skolem">S</span> <span class="main">=</span> changes_itv_smods_ext <span class="free">a</span> <span class="free">b</span> <span class="skolem">pp</span> <span class="main">(</span>pderiv <span class="skolem">pp</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"smods_ext <span class="skolem"><span class="skolem">pp</span></span> <span class="main"><span class="main">(</span></span>pderiv <span class="skolem"><span class="skolem">pp</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">pp</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>smods_ext <span class="skolem">pp</span> <span class="main">(</span>pderiv <span class="skolem">pp</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>smods_ext <span class="skolem">p</span> <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> prefix <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> that<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">pp</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">pp</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="skolem">p</span> <span class="skolem">S</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="skolem">p</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">+</span> proots_count <span class="skolem">pp</span> <span class="skolem">S</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">∈</span>proots_within <span class="skolem">p</span> <span class="skolem">S</span><span class="main">.</span> order <span class="bound">r</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">∈</span> proots_within <span class="skolem">p</span> <span class="skolem">S</span><span class="main">.</span> order <span class="bound">r</span> <span class="skolem">pp</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> proots_within <span class="skolem">p</span> <span class="skolem">S</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="skolem">pp</span> <span class="main">=</span> order <span class="skolem">x</span> <span class="main">(</span>gcd <span class="skolem">p</span> <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> pp_gcd <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">lp</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>order_smult<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> min <span class="main">(</span>order <span class="skolem">x</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>order <span class="skolem">x</span> <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> order_gcd<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹pderiv <span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> order <span class="skolem">x</span> <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> order_pderiv<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹pderiv <span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> proots_within <span class="skolem">p</span> <span class="skolem">S</span>›</span></span> order_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="skolem">pp</span> <span class="main">=</span> order <span class="skolem">x</span> <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="skolem">p</span> <span class="main">=</span> order <span class="skolem">x</span> <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> order_pderiv<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹pderiv <span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> proots_within <span class="skolem">p</span> <span class="skolem">S</span>›</span></span> order_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="skolem">p</span> <span class="main">=</span> order <span class="skolem">x</span> <span class="skolem">pp</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="skolem">p</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">∈</span> proots_within <span class="skolem">p</span> <span class="skolem">S</span><span class="main">.</span> order <span class="bound">r</span> <span class="skolem">pp</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sum.distrib<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="skolem">p</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">∈</span> proots_within <span class="skolem">pp</span> <span class="skolem">S</span><span class="main">.</span> order <span class="bound">r</span> <span class="skolem">pp</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">∈</span>proots_within <span class="skolem">p</span> <span class="skolem">S</span><span class="main">.</span> order <span class="bound">r</span> <span class="skolem">pp</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">∈</span>proots_within <span class="skolem">pp</span> <span class="skolem">S</span><span class="main">.</span> order <span class="bound">r</span> <span class="skolem">pp</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.mono_neutral_right<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> pp_gcd <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">lp</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>poly_gcd_0_iff<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> pp_gcd <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">lp</span><span class="main">≠</span><span class="main">0</span>›</span></span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>poly_gcd_0_iff order_smult<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> order_gcd<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_root<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="skolem">p</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">=</span> changes_itv_smods <span class="free">a</span> <span class="free">b</span> <span class="skolem">p</span> <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> sturm_interval<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">symmetric</span><span class="main">]</span> 
      <span class="keyword1"><span class="command">unfolding</span></span> S_def proots_within_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">card</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_itv_smods_ext <span class="free">a</span> <span class="free">b</span> <span class="skolem">p</span> <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> 
            <span class="main">=</span> changes_itv_smods <span class="free">a</span> <span class="free">b</span> <span class="skolem">p</span> <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="main">+</span> changes_itv_smods_ext <span class="free">a</span> <span class="free">b</span> <span class="skolem">pp</span> <span class="main">(</span>pderiv <span class="skolem">pp</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span><span class="main">=</span>smods <span class="skolem">p</span> <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span><span class="main">=</span>smods_ext <span class="skolem">pp</span> <span class="main">(</span>pderiv <span class="skolem">pp</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> xys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">xs</span><span class="main">=</span>hd <span class="skolem">ys</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>last <span class="skolem">xs</span><span class="main">)</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>last <span class="skolem">xs</span><span class="main">)</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> xs_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ys_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pp</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pp</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xs_def ys_def 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> pp_def<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">pp</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pp_def xs_def <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">pp</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pp_def xs_def <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> tl <span class="skolem">ys</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> changes_poly_at <span class="skolem">xs</span> <span class="free">a</span> <span class="main">+</span> changes_poly_at <span class="skolem">ys</span> <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> tl <span class="skolem">ys</span><span class="main">)</span> <span class="free">a</span>  <span class="main">=</span> changes_poly_at <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">)</span> <span class="free">a</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_at_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>map_tl<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> changes_drop_dup<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> that xys <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hd_map last_map<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> changes_poly_at <span class="skolem">xs</span> <span class="free">a</span> <span class="main">+</span> changes_poly_at <span class="skolem">ys</span> <span class="free">a</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_at_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> changes_append<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> xys <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hd_map last_map<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> tl <span class="skolem">ys</span><span class="main">)</span> <span class="free">b</span> <span class="main">=</span> changes_poly_at <span class="skolem">xs</span> <span class="free">b</span> <span class="main">+</span> changes_poly_at <span class="skolem">ys</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> tl <span class="skolem">ys</span><span class="main">)</span> <span class="free">b</span>  <span class="main">=</span> changes_poly_at <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">)</span> <span class="free">b</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_at_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>map_tl<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> changes_drop_dup<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> that xys <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hd_map last_map<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> changes_poly_at <span class="skolem">xs</span> <span class="free">b</span> <span class="main">+</span> changes_poly_at <span class="skolem">ys</span> <span class="free">b</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_at_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> changes_append<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> xys <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hd_map last_map<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_itv_smods_ext_def changes_itv_smods_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> xs_def ys_def<span class="main"><span class="keyword3">,</span></span><span class="operator">unfold</span> prefix<span class="main"><span class="main">[</span></span><span class="operator">folded</span> xs_def ys_def<span class="main"><span class="main">]</span></span> Let_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="skolem">p</span> <span class="skolem">S</span> <span class="main">=</span> changes_itv_smods_ext <span class="free">a</span> <span class="free">b</span> <span class="skolem">p</span> <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> sturm_ext_above<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span><span class="main">}</span> <span class="main">=</span> changes_gt_smods_ext <span class="free">a</span> <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">≡</span>smods_ext <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> ps_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub</span></span> <span class="keyword2"><span class="keyword">where</span></span> ub<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">&lt;</span><span class="skolem">ub</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ub_sgn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">ub</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_pos_inf <span class="bound">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ub</span><span class="main">&gt;</span><span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> root_list_ub<span class="main">[</span><span class="operator">OF</span> no_0_in_smods_ext<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">p</span>"</span></span><span class="main">,</span><span class="operator">folded</span> ps_def<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span><span class="main">}</span> <span class="main">=</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="skolem">ub</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">use</span> ub <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_gt_smods_ext <span class="free">a</span> <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="main">=</span> changes_itv_smods_ext <span class="free">a</span> <span class="skolem">ub</span> <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>sgn <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> poly <span class="bound">p</span> <span class="skolem">ub</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ps</span> <span class="main">=</span> map sgn_pos_inf <span class="skolem">ps</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ub_sgn<span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ub</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> comp_def list.map_cong0<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="skolem">ps</span> <span class="skolem">ub</span><span class="main">=</span>changes_poly_pos_inf <span class="skolem">ps</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_pos_inf_def changes_poly_at_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> changes_map_sgn_eq<span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> map_map<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_gt_smods_ext_def changes_itv_smods_ext_def ps_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">ub</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ub <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sturm_ext_interval<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ub</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> sturm_ext_below<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> changes_le_smods_ext <span class="free">b</span> <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">≡</span>smods_ext <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>›</span></span> ps_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lb</span></span> <span class="keyword2"><span class="keyword">where</span></span> lb<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">&gt;</span><span class="skolem">lb</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> lb_sgn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≤</span><span class="skolem">lb</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_neg_inf <span class="bound">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lb</span><span class="main">&lt;</span><span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> root_list_lb<span class="main">[</span><span class="operator">OF</span> no_0_in_smods_ext<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">p</span>"</span></span><span class="main">,</span><span class="operator">folded</span> ps_def<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">lb</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span><span class="operator">insert</span> lb <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>›</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_le_smods_ext <span class="free">b</span> <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="main">=</span> changes_itv_smods_ext <span class="skolem">lb</span> <span class="free">b</span> <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>sgn <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> poly <span class="bound">p</span> <span class="skolem">lb</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ps</span> <span class="main">=</span> map sgn_neg_inf <span class="skolem">ps</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lb_sgn<span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">lb</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> comp_def list.map_cong0<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="skolem">ps</span> <span class="skolem">lb</span><span class="main">=</span>changes_poly_neg_inf <span class="skolem">ps</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_neg_inf_def changes_poly_at_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> changes_map_sgn_eq<span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> map_map<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_le_smods_ext_def changes_itv_smods_ext_def ps_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">lb</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lb <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sturm_ext_interval<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">lb</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> _ assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> sturm_ext_R<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> UNIV <span class="main">=</span> changes_R_smods_ext <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">≡</span>smods_ext <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ps_def <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lb</span></span> <span class="keyword2"><span class="keyword">where</span></span> lb<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">&gt;</span><span class="skolem">lb</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> lb_sgn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≤</span><span class="skolem">lb</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_neg_inf <span class="bound">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lb</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> root_list_lb<span class="main">[</span><span class="operator">OF</span> no_0_in_smods_ext<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">p</span>"</span></span><span class="main">,</span><span class="operator">folded</span> ps_def<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub</span></span> <span class="keyword2"><span class="keyword">where</span></span> ub<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">&lt;</span><span class="skolem">ub</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ub_sgn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">ub</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_pos_inf <span class="bound">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ub</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> root_list_ub<span class="main">[</span><span class="operator">OF</span> no_0_in_smods_ext<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">p</span>"</span></span><span class="main">,</span><span class="operator">folded</span> ps_def<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> UNIV <span class="main">=</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">lb</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="skolem">ub</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span><span class="operator">insert</span> lb ub <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>›</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_R_smods_ext <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="main">=</span> changes_itv_smods_ext <span class="skolem">lb</span> <span class="skolem">ub</span> <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>sgn <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> poly <span class="bound">p</span> <span class="skolem">lb</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ps</span> <span class="main">=</span> map sgn_neg_inf <span class="skolem">ps</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>sgn <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> poly <span class="bound">p</span> <span class="skolem">ub</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ps</span> <span class="main">=</span> map sgn_pos_inf <span class="skolem">ps</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lb_sgn<span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">lb</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> ub_sgn<span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ub</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> comp_def list.map_cong0<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="skolem">ps</span> <span class="skolem">lb</span><span class="main">=</span>changes_poly_neg_inf <span class="skolem">ps</span>
          <span class="main">∧</span> changes_poly_at <span class="skolem">ps</span> <span class="skolem">ub</span><span class="main">=</span>changes_poly_pos_inf <span class="skolem">ps</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_neg_inf_def changes_poly_at_def changes_poly_pos_inf_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 3<span class="main"><span class="main">)</span></span>  changes_map_sgn_eq<span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> map_map<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_R_smods_ext_def changes_itv_smods_ext_def ps_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">lb</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">ub</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lb ub <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lb</span><span class="main">&lt;</span><span class="skolem">ub</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">lb</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">ub</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sturm_ext_interval <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Descartes_Roots_Test">
<div class="head">
<h1>Theory Descartes_Roots_Test</h1>
</div>
<pre class="source"><span class="comment1">(*
    Title:      Descartes Roots Test
    Author:     Wenda Li &lt;wl302@cam.ac.uk / liwenda1990@hotmail.com&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Descartes Roots Test›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Descartes_Roots_Test <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Budan_Fourier">Budan_Fourier</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The Descartes roots test is a consequence of Descartes' rule of signs:
  through counting sign variations on coefficients of a base-transformed (i.e. Taylor shifted) 
  polynomial, it can over-approximate the number of real roots (counting multiplicity) 
  within an interval. Its ability is similar to the Budan-Fourier theorem, but is far more 
  efficient in practice. Therefore, this test is widely used in modern root isolation procedures. 

  More information can be found in the wiki page about Vincent's theorem:
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">url</span></span> "https://en.wikipedia.org/wiki/Vincent%27s_theorem"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  and Collins and Akritas's classic paper of root isolation:
    Collins, G.E., Akritas, A.G.: Polynomial real root isolation using Descarte's rule of signs. SYMSACC. 272--275 (1976).
  A more modern treatment is available from a recent implementation of isolating real roots:
    Kobel, A., Rouillier, F., Sagraloff, M.: Computing Real Roots of Real Polynomials ... and now For Real! 
    Proceedings of ISSAC '16, New York, New York, USA (2016).
›</span></span>

<span class="keyword1" id="Descartes_Roots_Test-bij_betw_pos_interval"><span class="command">lemma</span></span> bij_betw_pos_interval<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="free">b</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">&gt;</span><span class="main">0</span><span class="main">}</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_imageI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms crossproduct_noteq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rev_image_eqI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">x</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">a</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">/</span></span><span class="main"><span class="main">(</span></span><span class="free"><span class="free">b</span></span><span class="main"><span class="main">-</span></span><span class="skolem"><span class="skolem">x</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bx</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bx</span><span class="main">=</span><span class="free">b</span><span class="main">-</span><span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">b</span><span class="main">-</span><span class="skolem">bx</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bx_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bx</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">&gt;</span><span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bx_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> bx_def<span class="main"><span class="keyword3">,</span></span><span class="operator">unfold</span> x<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Descartes_Roots_Test-proots_sphere_pos_interval"><span class="command">lemma</span></span> proots_sphere_pos_interval<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">q1</span><span class="main">≡</span><span class="main">[:</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">:]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span><span class="main">≡</span><span class="main">[:</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> proots_count <span class="main">(</span>fcompose <span class="free">p</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> proots_fcompose_bij_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> q1_def q2_def <span class="keyword1"><span class="command">using</span></span> bij_betw_pos_interval<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> infinite_UNIV_char_0<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">descartes_roots_test</span><span class="main">::</span><span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real poly <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">descartes_roots_test</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> nat <span class="main">(</span>changes <span class="main">(</span>coeffs <span class="main">(</span>fcompose <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">[:</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">:]</span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">theorem</span></span> descartes_roots_test<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">≤</span> descartes_roots_test <span class="free">a</span> <span class="free">b</span> <span class="free">p</span>  <span class="main">∧</span> 
          even <span class="main">(</span>descartes_roots_test <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">-</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">=</span>fcompose <span class="free">p</span> <span class="main">[:</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">:]</span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> q_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> fcompose_nzero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> infinite_UNIV_char_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> proots_count <span class="skolem">q</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> proots_sphere_pos_interval<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span><span class="main">,</span><span class="operator">folded</span> q_def<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>proots_count <span class="skolem">q</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">≤</span> changes <span class="main">(</span>coeffs <span class="skolem">q</span><span class="main">)</span> <span class="main">∧</span>
          even <span class="main">(</span>changes <span class="main">(</span>coeffs <span class="skolem">q</span><span class="main">)</span> <span class="main">-</span> int <span class="main">(</span>proots_count <span class="skolem">q</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> descartes_sign<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="skolem">q</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span> <span class="main">≤</span> nat <span class="main">(</span>changes <span class="main">(</span>coeffs <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
          even <span class="main">(</span>nat <span class="main">(</span>changes <span class="main">(</span>coeffs <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> proots_count <span class="skolem">q</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> even_nat_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> descartes_roots_test_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> q_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The roots test <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">descartes_roots_test</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is exact if its result is 0 or 1.›</span></span>

<span class="keyword1"><span class="command">corollary</span></span> descartes_roots_test_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"descartes_roots_test <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> descartes_roots_test<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> proots_count_0_imp_empty<span class="main">[</span><span class="operator">OF</span> this <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> descartes_roots_test_one<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"descartes_roots_test <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> descartes_roots_test<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹descartes_roots_test <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>›</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_diffD even_zero le_neq_implies_less less_one odd_one<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Similar to the Budan-Fourier theorem, the Descartes roots test result is exact when all roots 
      are real.›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> descartes_roots_test_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"all_roots_real <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> descartes_roots_test <span class="free">a</span> <span class="free">b</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">=</span>fcompose <span class="free">p</span> <span class="main">[:</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">:]</span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> q_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> fcompose_nzero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> infinite_UNIV_char_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> proots_count <span class="skolem">q</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> proots_sphere_pos_interval<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span><span class="main">,</span><span class="operator">folded</span> q_def<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>proots_count <span class="skolem">q</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> changes <span class="main">(</span>coeffs <span class="skolem">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> descartes_sign_real<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> all_real_roots_mobius<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹all_roots_real <span class="free">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="skolem">q</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> nat <span class="main">(</span>changes <span class="main">(</span>coeffs <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> descartes_roots_test_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> q_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>