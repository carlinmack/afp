<div id="RingModuleFacts">
<div class="head">
<h1>Theory RingModuleFacts</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Basic facts about rings and modules›</span></span>

<span class="keyword1"><span class="command">theory</span></span> RingModuleFacts
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Algebra/Module.html">HOL-Algebra.Module</a>"</span>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Algebra/Coset.html">HOL-Algebra.Coset</a>"</span>
  <span class="comment1">(*MonoidSums*)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic facts›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In a field, every nonzero element has an inverse.›</span></span> <span class="comment1">(* Add to Ring.*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> field<span class="main">)</span> inverse_exists <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span>carrier <span class="free">R</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="free">a</span><span class="main">∈</span> carrier <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"Units <span class="free">R</span> <span class="main">=</span> carrier <span class="free">R</span> <span class="main">-</span> <span class="main">{</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">}</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> field_Units<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h1 h2 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Multiplication by 0 in $R$ gives 0. (Note that this fact encompasses smult-l-null 
as this is for module while that is for algebra, so smult-l-null is redundant.)›</span></span>
<span class="comment1">(*Add to Module. *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> lmult_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">∈</span>carrier <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">m</span><span class="main">=</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">m</span><span class="main">∈</span>carrier <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">m</span><span class="main">=</span><span class="main">(</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">m</span><span class="main">)</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">m</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_trace</span><span class="main">,</span> <span class="operator">simp_trace_depth_limit</span><span class="main"><span class="main">=</span></span>3<span class="main">]</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smult_l_distr <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> R.add.r_one R.add.l_one<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 2 3 <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">m</span> <span class="main">=</span><span class="main">(</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">m</span><span class="main">)</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 0 4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> M.l_neg M.r_neg1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Multiplication by 0 in $M$ gives 0.›</span></span> <span class="comment1">(*Add to Module.*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> rmult_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">∈</span>carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="main">=</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> M.zero_closed R.zero_closed assms lmult_0 r_null smult_assoc1<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Multiplication by $-1$ is the same as negation. May be useful as a simp rule.›</span></span>
<span class="comment1">(*Add to module.*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> smult_minus_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span>carrier <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">v</span><span class="main">=</span> <span class="main">(</span><span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span>  <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="comment1">(*(simp add: M.l_neg)*)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> 0 <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> 0 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">v</span><span class="main">=</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>R.l_neg<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 0 <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">v</span><span class="main">=</span><span class="main">(</span><span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">v</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smult_l_distr<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> M.minus_equality R.add.inv_closed 
    a0 assms one_closed smult_closed<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The version with equality reversed.›</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span>  smult_minus_1_back <span class="main">=</span> smult_minus_1<span class="main">[</span><span class="operator">THEN</span> sym<span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹-1 is not 0›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> field<span class="main">)</span> neg_1_not_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="main">≠</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_minus minus_zero one_closed zero_not_one<span class="main">)</span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Note smult-assoc1 is the wrong way around for simplification.
This is the reverse of smult-assoc1.›</span></span><span class="comment1">(*Add to Module. *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> smult_assoc_simp<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">a</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> carrier <span class="free">M</span> <span class="main">|]</span> <span class="main">==&gt;</span>
      <span class="free">a</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">b</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">⊗</span> <span class="free">b</span><span class="main">)</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">x</span> "</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smult_assoc1<span class="main">)</span>
  
<span class="comment1">(* Add to Ring? *)</span>
<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> abelian_group<span class="main">)</span> show_r_zero<span class="main">=</span> add.l_cancel_one
<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> abelian_group<span class="main">)</span> show_l_zero<span class="main">=</span> add.r_cancel_one

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A nontrivial ring has $0\neq 1$.›</span></span><span class="comment1">(*Add to Ring.*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ring<span class="main">)</span> nontrivial_ring <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"carrier <span class="free">R</span><span class="main">≠</span><span class="main">{</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">≠</span><span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">≠</span><span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span>
    <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">∈</span>carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="skolem">r</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 2 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Use as simp rule. To show $a-b=0$, it suffices to show $a=b$.›</span></span><span class="comment1">(*Add to Ring.*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> abelian_group<span class="main">)</span> minus_other_side <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">a</span><span class="main">∈</span>carrier <span class="free">G</span><span class="main">;</span> <span class="free">b</span><span class="main">∈</span>carrier <span class="free">G</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span><span class="free">b</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">=</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_minus_def add.inv_closed add.m_comm r_neg r_neg2<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Units group›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Define the units group $R^{\times}$ and show it is actually a group.›</span></span><span class="comment1">(* Add to Ring.*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">units_group</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> ring_scheme <span class="main">⇒</span> <span class="tfree">'a</span> monoid"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">units_group</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">=</span> <span class="main">⦇</span>carrier <span class="main">=</span> Units <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">,</span> mult <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span><span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">R</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">y</span><span class="main">)</span><span class="main">,</span> one <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">R</span></span></span></sub><span class="hidden">⇙</span><span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The units form a group.›</span></span><span class="comment1">(*Add to Ring.*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ring<span class="main">)</span> units_form_group<span class="main">:</span> <span class="quoted"><span class="quoted">"group <span class="main">(</span>units_group <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> groupI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> units_group_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> m_assoc<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Units_def<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The units of a <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>cring›</span></span></span></span> form a commutative group.›</span></span><span class="comment1">(* Add to Ring.*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cring<span class="main">)</span> units_form_cgroup<span class="main">:</span> <span class="quoted"><span class="quoted">"comm_group <span class="main">(</span>units_group <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> comm_groupI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> units_group_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> m_assoc<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Units_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> m_comm<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="FunctionLemmas">
<div class="head">
<h1>Theory FunctionLemmas</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Basic lemmas about functions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> FunctionLemmas

<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/FuncSet.html">HOL-Library.FuncSet</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹These are used in simplification. Note that the difference from Pi-mem is that the statement
about the function comes first, so Isabelle can more easily figure out what $S$ is.›</span></span>

<span class="keyword1" id="FunctionLemmas-PiE_mem2"><span class="command">lemma</span></span> PiE_mem2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">S</span><span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">T</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> PiE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1" id="FunctionLemmas-Pi_mem2"><span class="command">lemma</span></span> Pi_mem2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">S</span><span class="main">→</span> <span class="free">T</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Pi_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="MonoidSums">
<div class="head">
<h1>Theory MonoidSums</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Sums in monoids›</span></span>

<span class="keyword1"><span class="command">theory</span></span> MonoidSums

<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Algebra/Module.html">HOL-Algebra.Module</a>"</span>
  <a href="#RingModuleFacts">RingModuleFacts</a>
  <a href="#FunctionLemmas">FunctionLemmas</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We build on the finite product simplifications in FiniteProduct.thy and the analogous ones
for finite sums (see "lemmas" in Ring.thy).›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Use as an intro rule›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_monoid<span class="main">)</span> factors_equal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">a</span><span class="main">=</span><span class="free">b</span><span class="main">;</span> <span class="free">c</span><span class="main">=</span><span class="free">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span><span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span><span class="free">c</span> <span class="main">=</span>  <span class="free">b</span><span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span><span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_monoid<span class="main">)</span> extend_prod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">A</span> <span class="free">S</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span><span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">A</span><span class="main">→</span>carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨂</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">then</span> <span class="free">a</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨂</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">a</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨂</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="var">?b</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨂</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">a</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> subset <span class="keyword1"><span class="command">have</span></span> uni<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="free">A</span> <span class="main">∪</span> <span class="main">(</span><span class="free">S</span><span class="main">-</span><span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms subset <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> uni<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> finprod_Un_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> finprod_cong if_cong <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> finite_subset <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Pi_def finite_subset<span class="main">)</span>
<span class="comment1">(*Pi_def is key for automation here*)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Scalar multiplication distributes over scalar multiplication (on left).›</span></span><span class="comment1">(*Add to module.*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> finsum_smult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">c</span><span class="main">∈</span> carrier <span class="free">R</span><span class="main">;</span> <span class="free">g</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> carrier <span class="free">M</span> <span class="main">|]</span> <span class="main">==&gt;</span>
   <span class="main">(</span><span class="free">c</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> finsum <span class="free">M</span> <span class="free">g</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> finsum <span class="free">M</span> <span class="main">(</span><span class="main">%</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="free">A</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> insert.hyps insert.prems <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"finsum <span class="free">M</span> <span class="free">g</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">a</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> finsum <span class="free">M</span> <span class="free">g</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finsum_insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> insert.hyps insert.prems <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">x</span><span class="main">∈</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">.</span> <span class="free">c</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">g</span> <span class="skolem">a</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="free">c</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finsum_insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> insert.hyps insert.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>1 2 smult_r_distr<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Scalar multiplication distributes over scalar multiplication (on right).›</span></span><span class="comment1">(*Add to module.*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> finsum_smult_r<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">v</span><span class="main">∈</span> carrier <span class="free">M</span><span class="main">;</span> <span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> carrier <span class="free">R</span> <span class="main">|]</span> <span class="main">==&gt;</span>
   <span class="main">(</span>finsum <span class="free">R</span> <span class="free">f</span> <span class="free">A</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> finsum <span class="free">M</span> <span class="main">(</span><span class="main">%</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">v</span><span class="main">)</span> <span class="free">A</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> insert.hyps insert.prems <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"finsum <span class="free">R</span> <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">a</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> finsum <span class="free">R</span> <span class="free">f</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> R.finsum_insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> insert.hyps insert.prems <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">x</span><span class="main">∈</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">a</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">v</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">v</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finsum_insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> insert.hyps insert.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>1 2 smult_l_distr<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A sequence of lemmas that shows that the product does not depend on the ambient group. 
Note I had to dig back into the definitions of foldSet to show this.›</span></span>
<span class="comment1">(*Add the following 2 lemmas to Group.*)</span>
<span class="keyword1" id="MonoidSums-foldSet_not_depend"><span class="command">lemma</span></span> foldSet_not_depend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">E</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span><span class="main">⊆</span><span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="main">⊆</span>foldSetD <span class="free">E</span> <span class="free">f</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x1</span> <span class="bound">x2</span><span class="main">.</span> <span class="main">(</span><span class="bound">x1</span><span class="main">,</span><span class="bound">x2</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">x1</span><span class="main">,</span> <span class="bound">x2</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">E</span> <span class="free">f</span> <span class="free">e</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x1</span> <span class="skolem">x2</span> 
    <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> h1 2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="skolem">x1</span> <span class="skolem">x2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> foldSetD.induct<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?D</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">D</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?f</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?e</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">e</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?x1.0</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">x1</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?x2.0</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">x2</span></span>"</span></span></span>
        <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?P</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x1</span></span> <span class="bound"><span class="bound">x2</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x1</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">x2</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">∈</span></span> foldSetD <span class="free"><span class="free">E</span></span> <span class="free"><span class="free">f</span></span> <span class="free"><span class="free">e</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> emptyI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> insertI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="MonoidSums-foldD_not_depend"><span class="command">lemma</span></span> foldD_not_depend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">D</span> <span class="free">E</span> <span class="free">B</span> <span class="free">f</span> <span class="free">e</span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"LCD <span class="free">B</span> <span class="free">D</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"LCD <span class="free">B</span> <span class="free">E</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span><span class="main">⊆</span><span class="free">E</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">∈</span><span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span><span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"foldD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="free">A</span> <span class="main">=</span> foldD <span class="free">E</span> <span class="free">f</span> <span class="free">e</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span>foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> finite_imp_foldSetD<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> finite_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> LCD_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">∈</span>foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms 2 <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"foldD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="free">A</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> LCD.foldD_equality<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">B</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h3 <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="main">⊆</span> foldSetD <span class="free">E</span> <span class="free">f</span> <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> foldSet_not_depend<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 2 4 <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">∈</span>foldSetD <span class="free">E</span> <span class="free">f</span> <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms 5 <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"foldD <span class="free">E</span> <span class="free">f</span> <span class="free">e</span> <span class="free">A</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> LCD.foldD_equality<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">B</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="comment1">(*(A,y)∈f*)</span>
  <span class="keyword1"><span class="command">from</span></span> 3 6 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_monoid<span class="main">)</span> finprod_all1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> all1<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">⟹</span><span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨂</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span>"</span></span>
<span class="comment1">(*  "[| ⋀a. a∈A⟹f a = 𝟭<span class="hidden">⇘</span><sub>G</sub><span class="hidden">⇙</span> |] ==&gt; (⨂<span class="hidden">⇘</span><sub>G</sub><span class="hidden">⇙</span> a∈A. f a) = 𝟭<span class="hidden">⇘</span><sub>G</sub><span class="hidden">⇙</span>" won't work with proof - *)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> finprod_cong<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> abelian_monoid
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> summands_equal <span class="main">=</span> add.factors_equal
<span class="keyword1"><span class="command">lemmas</span></span> extend_sum <span class="main">=</span> add.extend_prod
<span class="keyword1"><span class="command">lemmas</span></span> finsum_all0 <span class="main">=</span> add.finprod_all1
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="LinearCombinations">
<div class="head">
<h1>Theory LinearCombinations</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Linear Combinations›</span></span>

<span class="keyword1"><span class="command">theory</span></span> LinearCombinations
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Algebra/Module.html">HOL-Algebra.Module</a>"</span>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Algebra/Coset.html">HOL-Algebra.Coset</a>"</span>
  <a href="#RingModuleFacts">RingModuleFacts</a>
  <a href="#MonoidSums">MonoidSums</a>
  <a href="#FunctionLemmas">FunctionLemmas</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lemmas for simplification›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following are helpful in certain simplifications (esp. congruence rules). Warning: arbitrary
use leads to looping.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ring<span class="main">)</span> coeff_in_ring<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">a</span><span class="main">∈</span><span class="free">A</span><span class="main">→</span>carrier <span class="free">R</span><span class="main">;</span> <span class="free">x</span><span class="main">∈</span><span class="free">A</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="free">x</span> <span class="main">∈</span>carrier <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Pi_mem<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ring<span class="main">)</span> coeff_in_ring2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span><span class="main">∈</span><span class="free">A</span><span class="main">;</span><span class="free">a</span><span class="main">∈</span><span class="free">A</span><span class="main">→</span>carrier <span class="free">R</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="free">x</span> <span class="main">∈</span>carrier <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Pi_mem<span class="main">)</span>

<span class="keyword1" id="LinearCombinations-ring_subset_carrier"><span class="command">lemma</span></span> ring_subset_carrier<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">∈</span><span class="free">A</span><span class="main">;</span> <span class="free">A</span><span class="main">⊆</span>carrier <span class="free">R</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span>carrier <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="LinearCombinations-disj_if"><span class="command">lemma</span></span> disj_if<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">A</span><span class="main">∩</span><span class="free">B</span><span class="main">=</span><span class="main">{}</span><span class="main">;</span> <span class="free">x</span><span class="main">∈</span> <span class="free">B</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">g</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> sum_simp <span class="main">=</span> ring_subset_carrier

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Linear combinations›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A linear combination is $\sum_{v\in A} a_v v$. $(a_v)_{v\in S}$ is a function 
$A\to K$, where $A\subseteq K$.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> <span class="entity">lincomb</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'c</span> set<span class="main">]</span><span class="main">⇒</span> <span class="tfree">'c</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">lincomb</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span>  <span class="bound">v</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> summands_valid<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">a</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span> carrier <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="main">(</span><span class="free">A</span><span class="main">→</span>carrier <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">v</span><span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span><span class="main">∈</span> carrier <span class="free">M</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> lincomb_closed <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="free">a</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">⊆</span> carrier <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="main">(</span><span class="free">S</span><span class="main">→</span>carrier <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="free">a</span> <span class="free">S</span> <span class="main">∈</span> carrier <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h2 h3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> lincomb_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>finsum_closed<span class="main">)</span>
<span class="comment1">(*doesn't work with simp*)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_monoid<span class="main">)</span> finprod_cong2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span><span class="main">;</span> 
      <span class="main">!!</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">==&gt;</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">i</span><span class="main">;</span> <span class="free">f</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">→</span> carrier <span class="free">G</span><span class="main">|]</span> <span class="main">==&gt;</span> 
finprod <span class="free">G</span> <span class="free">f</span> <span class="free">A</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="free">g</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> abelian_monoid<span class="main">)</span> finsum_cong2 <span class="main">=</span> add.finprod_cong2

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> lincomb_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">M</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟹</span> <span class="free">a</span> <span class="bound">v</span> <span class="main">=</span> <span class="free">b</span> <span class="bound">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span> <span class="free">B</span><span class="main">→</span>carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="free">a</span> <span class="free">A</span> <span class="main">=</span> lincomb <span class="free">b</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> finsum_cong2 <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lincomb_def summands_valid ring_subset_carrier<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> lincomb_union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">A</span> <span class="free">B</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">A</span><span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∪</span><span class="free">B</span> <span class="main">⊆</span> carrier <span class="free">M</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∩</span><span class="free">B</span><span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="main">(</span><span class="free">A</span><span class="main">∪</span><span class="free">B</span><span class="main">→</span>carrier <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="free">a</span> <span class="main">(</span><span class="free">A</span><span class="main">∪</span><span class="free">B</span><span class="main">)</span> <span class="main">=</span> lincomb <span class="free">a</span> <span class="free">A</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> lincomb <span class="free">a</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> finsum_cong2 <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lincomb_def finsum_Un_disjoint summands_valid ring_subset_carrier<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This is useful as a simp rule sometimes, for combining linear combinations.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> lincomb_union2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="free">A</span> <span class="free">B</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">A</span><span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∪</span><span class="free">B</span> <span class="main">⊆</span> carrier <span class="free">M</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∩</span><span class="free">B</span><span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">A</span><span class="main">→</span>carrier <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">B</span><span class="main">→</span>carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="free">a</span> <span class="free">A</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> lincomb <span class="free">b</span> <span class="free">B</span> <span class="main">=</span> lincomb <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span><span class="bound">v</span><span class="main">∈</span><span class="free">A</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">a</span> <span class="bound">v</span> <span class="keyword1">else</span> <span class="free">b</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">∪</span><span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="free">a</span> <span class="free">A</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> lincomb <span class="free">b</span> <span class="free">B</span> <span class="main">=</span> lincomb <span class="var">?c</span> <span class="main">(</span><span class="free">A</span><span class="main">∪</span><span class="free">B</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> finsum_cong2 
        <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lincomb_def finsum_Un_disjoint summands_valid ring_subset_carrier disj_if<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> lincomb_del2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="free">a</span> <span class="free">v</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">⊆</span> carrier <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="main">(</span><span class="free">S</span><span class="main">→</span>carrier <span class="free">R</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span><span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="free">a</span> <span class="free">S</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="free">v</span><span class="main">)</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">v</span><span class="main">)</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> lincomb <span class="free">a</span> <span class="main">(</span><span class="free">S</span><span class="main">-</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h4 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">=</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">∪</span><span class="main">(</span><span class="free">S</span><span class="main">-</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_Diff insert_is_Un<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> 1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_union<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> lincomb_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_in_ring<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*alternate form of the above*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> lincomb_insert<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="free">a</span> <span class="free">v</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">⊆</span> carrier <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="main">(</span><span class="free">S</span><span class="main">∪</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">→</span>carrier <span class="free">R</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∉</span><span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
h5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span> carrier <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="free">a</span> <span class="main">(</span><span class="free">S</span><span class="main">∪</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="free">v</span><span class="main">)</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">v</span><span class="main">)</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> lincomb <span class="free">a</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> finsum_cong2 
        <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lincomb_def finsum_Un_disjoint summands_valid ring_subset_carrier disj_if<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> lincomb_elim_if <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b</span> <span class="free">c</span> <span class="free">S</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> carrier <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">⟹</span> <span class="main">¬</span><span class="free">P</span> <span class="bound">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">∈</span><span class="free">S</span><span class="main">→</span>carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">P</span> <span class="bound">w</span> <span class="keyword1">then</span> <span class="free">b</span> <span class="bound">w</span> <span class="keyword1">else</span> <span class="free">c</span> <span class="bound">w</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> lincomb <span class="free">c</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> finsum_cong2 
        <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lincomb_def finsum_Un_disjoint summands_valid ring_subset_carrier disj_if<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> lincomb_smult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">c</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span>carrier <span class="free">M</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">A</span><span class="main">→</span>carrier <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">∈</span>carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="free">c</span><span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="free">a</span> <span class="bound">w</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="free">c</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span>lincomb <span class="free">a</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> finsum_cong2 
        <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lincomb_def finsum_Un_disjoint finsum_smult ring_subset_carrier disj_if smult_assoc1 coeff_in_ring<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Linear dependence and independence.›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A set $S$ in a module/vectorspace is linearly dependent if there is a finite set $A \subseteq S$
 and coefficients $(a_v)_{v\in A}$ such that $sum_{v\in A} a_vv=0$ and for some $v$, $a_v\neq 0$.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> <span class="entity">lin_dep</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lin_dep</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">A</span> <span class="bound">a</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span>finite <span class="bound">A</span> <span class="main">∧</span> <span class="bound">A</span><span class="main">⊆</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="bound">a</span><span class="main">∈</span> <span class="main">(</span><span class="bound">A</span><span class="main">→</span>carrier <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>lincomb <span class="bound">a</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v</span><span class="main">∈</span><span class="bound">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">a</span> <span class="bound">v</span><span class="main">≠</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="comment1">(*shows "∃a. (a∈ (S→carrier K)) ∧ (lincomb a S = 𝟬<span class="hidden">⇘</span><sub>V</sub><span class="hidden">⇙</span>) ∧ (∃v∈S. a v≠ 𝟬<span class="hidden">⇘</span><sub>K</sub><span class="hidden">⇙</span>)"*)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> <span class="entity">lin_indpt</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">lin_indpt</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">¬</span>lin_dep <span class="free"><span class="bound"><span class="entity">S</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the finite case, we can take $A=S$. This may be more convenient (e.g., when adding two
linear combinations.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> finite_lin_dep<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finS<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ld<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_dep <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> inC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">⊆</span>carrier <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">∈</span> <span class="main">(</span><span class="free">S</span><span class="main">→</span>carrier <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>lincomb <span class="bound">a</span> <span class="free">S</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">a</span> <span class="bound">v</span><span class="main">≠</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> ld <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">A</span><span class="main">⊆</span><span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">a</span><span class="main">∈</span> <span class="main">(</span><span class="skolem">A</span><span class="main">→</span>carrier <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>lincomb <span class="skolem">a</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v</span><span class="main">∈</span><span class="skolem">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">a</span> <span class="skolem">v</span><span class="main">≠</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> lin_dep_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">w</span><span class="main">∈</span><span class="skolem">A</span> <span class="keyword1">then</span> <span class="skolem">a</span> <span class="bound">w</span> <span class="keyword1">else</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span>"</span></span> <span class="comment1">(*extend the coefficients to be 0 outside of A*)</span>
  <span class="keyword1"><span class="command">from</span></span> finS inC A <span class="keyword1"><span class="command">have</span></span> if_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">v</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="keyword1">then</span> <span class="skolem">a</span> <span class="bound">v</span> <span class="keyword1">else</span> <span class="main">𝟬</span><span class="main">)</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">v</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="keyword1">then</span> <span class="skolem">a</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span> <span class="keyword1">else</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> finsum_cong'<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_in_ring<span class="main">)</span>  <span class="comment1">(*massage the sum*)</span>
  <span class="keyword1"><span class="command">from</span></span> finS inC A <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="var">?b</span> <span class="free">S</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> lincomb_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> if_in<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> extend_sum<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> A b <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Criteria of linear dependency in a easy format to apply: apply (rule lin-dep-crit)›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> lin_dep_crit<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">S</span> <span class="free">a</span> <span class="free">v</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span><span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">∈</span> <span class="main">(</span><span class="free">A</span><span class="main">→</span>carrier <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span> <span class="free">A</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">v</span><span class="main">≠</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lincomb <span class="free">a</span> <span class="free">A</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lin_dep <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> lin_dep_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If $\sum_{v\in A} a_vv=0$ implies $a_v=0$ for all $v\in S$, then $A$ is linearly independent.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> finite_lin_indpt2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A_fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> AinC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span>carrier <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    lc0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span> <span class="main">(</span><span class="free">A</span><span class="main">→</span>carrier <span class="free">R</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>lincomb <span class="bound">a</span> <span class="free">A</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">a</span> <span class="bound">v</span><span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lin_indpt <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lin_indpt <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> A_fin AinC this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> av<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">∈</span> <span class="main">(</span><span class="free">A</span><span class="main">→</span>carrier <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>lincomb <span class="skolem">a</span> <span class="free">A</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v</span><span class="main">∈</span><span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">a</span> <span class="skolem">v</span><span class="main">≠</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_lin_dep<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> av lc0 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Any set containing 0 is linearly dependent.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> zero_lin_dep<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"carrier <span class="free">R</span> <span class="main">≠</span> <span class="main">{</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lin_dep <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> nonzero <span class="keyword1"><span class="command">have</span></span> zero_not_one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="main">≠</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nontrivial_ring<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 0 zero_not_one <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> lin_dep_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> lincomb_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> zero_nin_lin_indpt<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">⊆</span>carrier <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> li<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>lin_dep <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"carrier <span class="free">R</span> <span class="main">≠</span> <span class="main">{</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">∉</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">∉</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> a2 nonzero <span class="keyword1"><span class="command">have</span></span> ld<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_dep <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zero_lin_dep<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> li ld <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>span›</span></span></span></span> of $S$ is the set of linear combinations with $A \subseteq S$.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> <span class="entity">span</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set <span class="main">⇒</span><span class="tfree">'c</span> set"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">span</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">{</span>lincomb <span class="bound">a</span> <span class="bound">A</span> <span class="main">|</span> <span class="bound">a</span> <span class="bound">A</span><span class="main">.</span> finite <span class="bound">A</span> <span class="main">∧</span> <span class="bound">A</span><span class="main">⊆</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="bound">a</span><span class="main">∈</span> <span class="main">(</span><span class="bound">A</span><span class="main">→</span>carrier <span class="free">R</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>span›</span></span></span></span> interpreted as a module or vectorspace.›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> <span class="entity">span_vs</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'c</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> module_scheme"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">span_vs</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="free">M</span> <span class="main">⦇</span>carrier <span class="main">:=</span> span <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the finite case, we can take $A=S$ without loss of generality.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> finite_span<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> inC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">⊆</span>carrier <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"span <span class="free">S</span> <span class="main">=</span> <span class="main">{</span>lincomb <span class="bound">a</span> <span class="free">S</span> <span class="main">|</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span> <span class="main">(</span><span class="free">S</span><span class="main">→</span>carrier <span class="free">R</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main">)</span> 
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>   a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">→</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">v</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="keyword1">then</span> <span class="skolem">a</span> <span class="bound">v</span> <span class="keyword1">else</span> <span class="main">𝟬</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> fin inC subset a <span class="keyword1"><span class="command">have</span></span> if_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="var">?b</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">v</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="keyword1">then</span> <span class="skolem">a</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span> <span class="keyword1">else</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> finsum_cong'<span class="main">)</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_in_ring<span class="main">)</span>  <span class="comment1">(*massage the sum*)</span>
    <span class="keyword1"><span class="command">from</span></span> fin inC subset a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> lincomb <span class="skolem">a</span> <span class="skolem">A</span> <span class="main">=</span> lincomb <span class="bound">b</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">→</span> carrier <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> lincomb_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> if_in<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> extend_sum<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"span <span class="free">S</span> <span class="main">⊆</span> <span class="main">{</span>lincomb <span class="bound">a</span> <span class="free">S</span> <span class="main">|</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">→</span> carrier <span class="free">R</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> span_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> fin <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>lincomb <span class="bound">a</span> <span class="free">S</span> <span class="main">|</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">→</span> carrier <span class="free">R</span><span class="main">}</span> <span class="main">⊆</span> span <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> span_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If $v\in \text{span S}$, then we can find a linear combination. This is in an easy to apply
format (e.g. obtain a A where\ldots)›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> in_span<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="free">v</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span>span <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">A</span><span class="main">⊆</span><span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">a</span><span class="main">∈</span><span class="bound">A</span><span class="main">→</span>carrier <span class="free">R</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>lincomb <span class="bound">a</span> <span class="bound">A</span><span class="main">=</span><span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h2 h3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> span_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the finite case, we can take $A=S$.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> finite_in_span<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="free">v</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">⊆</span>carrier <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span>span <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">∈</span><span class="free">S</span><span class="main">→</span>carrier <span class="free">R</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>lincomb <span class="bound">a</span> <span class="free">S</span><span class="main">=</span><span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> fin h2 <span class="keyword1"><span class="command">have</span></span> fin_span<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="free">S</span> <span class="main">=</span> <span class="main">{</span>lincomb <span class="bound">a</span> <span class="free">S</span> <span class="main">|</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">→</span> carrier <span class="free">R</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_span<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h3 fin_span <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If a subset is linearly independent, then any linear combination that is 0 must have a 
nonzero coefficient outside that set.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> lincomb_must_include<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">S</span> <span class="free">T</span> <span class="free">b</span> <span class="free">v</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  inC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span><span class="main">⊆</span>carrier <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> li<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Ssub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">⊆</span><span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Ssub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span><span class="free">T</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">A</span><span class="main">→</span>carrier <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lc<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="free">b</span> <span class="free">A</span><span class="main">=</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span><span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> nz_coeff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="free">v</span><span class="main">≠</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span><span class="main">∈</span><span class="free">A</span><span class="main">-</span><span class="free">S</span><span class="main">.</span> <span class="free">b</span> <span class="bound">w</span><span class="main">≠</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span> 
  <span class="comment1">(*we may assume B doesn't intersect A.*)</span>
  <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span> <span class="bound">w</span><span class="main">∈</span><span class="free">A</span><span class="main">-</span><span class="free">S</span><span class="main">.</span> <span class="free">b</span> <span class="bound">w</span><span class="main">≠</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> 0 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span><span class="main">∈</span><span class="free">A</span><span class="main">-</span><span class="free">S</span><span class="main">⟹</span> <span class="free">b</span> <span class="bound">w</span><span class="main">=</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> Auni<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">(</span><span class="free">S</span><span class="main">∩</span><span class="free">A</span><span class="main">)</span> <span class="main">∪</span><span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> fin b Ssub inC 1 <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="free">b</span> <span class="free">A</span> <span class="main">=</span> lincomb <span class="free">b</span> <span class="main">(</span><span class="free">S</span><span class="main">∩</span><span class="free">A</span><span class="main">)</span>"</span></span><span class="comment1">(* ⊕<span class="hidden">⇘</span><sub>M</sub><span class="hidden">⇙</span> lincomb b ((-S)∩A)*)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Auni<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_union<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="comment1">(*apply (intro r_zero)*)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> lincomb_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> finsum_all0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> show_r_zero<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> finsum_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1 2 assms <span class="keyword1"><span class="command">have</span></span> ld<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_dep <span class="free">S</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> lin_dep_crit<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?A</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">S</span></span><span class="main"><span class="main">∩</span></span><span class="free"><span class="free">A</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?a</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">b</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?v</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">v</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> ld li <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A generating set is a set such that the span of $S$ is all of $M$.›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> <span class="entity">gen_set</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">gen_set</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">(</span>span <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> carrier <span class="free">M</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Submodules›</span></span>

<span class="keyword1" id="LinearCombinations-module_criteria"><span class="command">lemma</span></span> module_criteria<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">R</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">M</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> cring<span class="main">:</span> <span class="quoted"><span class="quoted">"cring <span class="free">R</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="main">∈</span> carrier <span class="free">M</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span>carrier <span class="free">M</span> <span class="main">∧</span> <span class="bound">w</span><span class="main">∈</span>carrier <span class="free">M</span><span class="main">⟶</span> <span class="bound">v</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">w</span><span class="main">∈</span> carrier <span class="free">M</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>carrier <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">neg_v</span><span class="main">∈</span>carrier <span class="free">M</span><span class="main">.</span> <span class="bound">v</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">neg_v</span><span class="main">=</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> smult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">c</span><span class="main">∈</span> carrier <span class="free">R</span> <span class="main">∧</span> <span class="bound">v</span><span class="main">∈</span>carrier <span class="free">M</span><span class="main">⟶</span> <span class="bound">c</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span> <span class="main">∈</span> carrier <span class="free">M</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span>carrier <span class="free">M</span> <span class="main">∧</span> <span class="bound">w</span><span class="main">∈</span>carrier <span class="free">M</span><span class="main">⟶</span> <span class="bound">v</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">w</span><span class="main">=</span><span class="bound">w</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="bound">w</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span>carrier <span class="free">M</span> <span class="main">∧</span> <span class="bound">w</span><span class="main">∈</span>carrier <span class="free">M</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∈</span>carrier <span class="free">M</span><span class="main">⟶</span> <span class="main">(</span><span class="bound">v</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">w</span><span class="main">)</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">x</span><span class="main">=</span> <span class="bound">v</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="bound">w</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> add_id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>carrier <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">=</span><span class="bound">v</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> compat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span> carrier <span class="free">R</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">∈</span> carrier <span class="free">R</span> <span class="main">∧</span> <span class="bound">v</span><span class="main">∈</span>carrier <span class="free">M</span><span class="main">⟶</span> <span class="main">(</span><span class="bound">a</span><span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="bound">b</span><span class="main">)</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span> <span class="main">=</span><span class="bound">a</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="bound">b</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> smult_id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>carrier <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span> <span class="main">=</span><span class="bound">v</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> dist_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span> carrier <span class="free">R</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">∈</span> carrier <span class="free">R</span> <span class="main">∧</span> <span class="bound">v</span><span class="main">∈</span>carrier <span class="free">M</span><span class="main">⟶</span> <span class="main">(</span><span class="bound">a</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="bound">b</span><span class="main">)</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span> <span class="main">=</span><span class="main">(</span><span class="bound">a</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="bound">b</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> dist_add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span> carrier <span class="free">R</span> <span class="main">∧</span> <span class="bound">v</span><span class="main">∈</span>carrier <span class="free">M</span> <span class="main">∧</span> <span class="bound">w</span><span class="main">∈</span>carrier <span class="free">M</span><span class="main">⟶</span> <span class="bound">a</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="bound">v</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">w</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span><span class="bound">a</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="bound">a</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">w</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"module <span class="free">R</span> <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"abelian_group <span class="free">M</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> abelian_groupI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"module_axioms <span class="free">R</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> module_axioms_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 2 3 cring <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> module_def module_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A submodule is $N\subseteq M$ that is closed under addition and scalar multiplication, and
contains 0 (so is not empty).›</span></span>
<span class="keyword1"><span class="command">locale</span></span> submodule <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">R</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">N</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">M</span> <span class="main">(</span><span class="keyword2"><span class="keyword">structure</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> module<span class="main">:</span> <span class="quoted"><span class="quoted">"module <span class="free">R</span> <span class="free">M</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">⊆</span> carrier <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> m_closed <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">v</span> <span class="main">∈</span> <span class="free">N</span><span class="main">;</span> <span class="free">w</span> <span class="main">∈</span> <span class="free">N</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">⊕</span> <span class="free">w</span> <span class="main">∈</span> <span class="free">N</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> zero_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟬</span> <span class="main">∈</span> <span class="free">N</span>"</span></span> <span class="comment1">(*prevents N from being the empty set*)</span>
    <span class="keyword2"><span class="keyword">and</span></span> smult_closed <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">c</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">N</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">c</span><span class="main">⊙</span><span class="free">v</span> <span class="main">∈</span> <span class="free">N</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> <span class="entity">md</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> module_scheme"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">md</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">≡</span> <span class="free">M</span><span class="main">⦇</span>carrier <span class="main">:=</span><span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> carrier_vs_is_self <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"carrier <span class="main">(</span>md <span class="free">N</span><span class="main">)</span> <span class="main">=</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> submodule_is_module<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">N</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="free">N</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"module <span class="free">R</span> <span class="main">(</span>md <span class="free">N</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>  <span class="main">(</span><span class="operator">unfold</span> module_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"cring <span class="free">R</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"abelian_group <span class="main">(</span>md <span class="free">N</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> submodule_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> abelian_groupI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> M.add.m_assoc contra_subsetD<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> M.add.m_comm contra_subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> v<span class="main">)</span>
    <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹The inverse of $v$ under addition is $-v$›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="improper">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> M.l_neg contra_subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> R.add.inv_closed one_closed smult_minus_1 subset_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"module_axioms <span class="free">R</span> <span class="main">(</span>md <span class="free">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> module_axioms_def submodule_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> smult_l_distr contra_subsetD<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> smult_r_distr contra_subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> smult_assoc1 contra_subsetD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹$N_1+N_2=\{x+y | x\in N_1,y\in N_2\}$›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> <span class="entity">submodule_sum</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'c</span> set<span class="main">,</span> <span class="tfree">'c</span> set<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'c</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">submodule_sum</span> <span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">y</span><span class="main">)</span> <span class="main">`</span><span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>  <span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="main">∧</span> <span class="bound">y</span><span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span><span class="main">}</span>"</span></span>
<span class="comment1">(*This only depends on the carriers, actually, so it could be defined on that level if desired.*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A module homomorphism $M\to N$ preserves addition and scalar multiplication.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">module_hom</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'c0</span><span class="main">)</span> ring_scheme<span class="main">,</span> 
  <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b1</span><span class="main">,</span><span class="tfree">'c1</span><span class="main">)</span> module_scheme<span class="main">,</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b2</span><span class="main">,</span><span class="tfree">'c2</span><span class="main">)</span> module_scheme<span class="main">]</span> <span class="main">⇒</span><span class="main">(</span><span class="tfree">'b1</span><span class="main">⇒</span><span class="tfree">'b2</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">module_hom</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> 
    <span class="main">(</span><span class="main">(</span><span class="bound">f</span><span class="main">∈</span> carrier <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">→</span> carrier <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m1</span> <span class="bound">m2</span><span class="main">.</span> <span class="bound">m1</span><span class="main">∈</span>carrier <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">∧</span> <span class="bound">m2</span><span class="main">∈</span>carrier <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">⟶</span> <span class="bound">f</span> <span class="main">(</span><span class="bound">m1</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">M</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">m2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">m1</span><span class="main">)</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">N</span></span></span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">m2</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">r</span><span class="main">∈</span>carrier <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">∧</span> <span class="bound">m</span><span class="main">∈</span>carrier <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">⟶</span><span class="bound">f</span> <span class="main">(</span><span class="bound">r</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">M</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">N</span></span></span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="LinearCombinations-module_hom_closed"><span class="command">lemma</span></span> module_hom_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">∈</span> module_hom <span class="free">R</span> <span class="free">M</span> <span class="free">N</span> <span class="main">⟹</span> <span class="free">f</span><span class="main">∈</span> carrier <span class="free">M</span> <span class="main">→</span> carrier <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> module_hom_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="LinearCombinations-module_hom_add"><span class="command">lemma</span></span> module_hom_add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">f</span><span class="main">∈</span> module_hom <span class="free">R</span> <span class="free">M</span> <span class="free">N</span><span class="main">;</span> <span class="free">m1</span><span class="main">∈</span>carrier <span class="free">M</span><span class="main">;</span> <span class="free">m2</span><span class="main">∈</span>carrier <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">m1</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">m2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="free">m1</span><span class="main">)</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">N</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">f</span> <span class="free">m2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> module_hom_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="LinearCombinations-module_hom_smult"><span class="command">lemma</span></span> module_hom_smult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">f</span><span class="main">∈</span> module_hom <span class="free">R</span> <span class="free">M</span> <span class="free">N</span><span class="main">;</span> <span class="free">r</span><span class="main">∈</span>carrier <span class="free">R</span><span class="main">;</span> <span class="free">m</span><span class="main">∈</span>carrier <span class="free">M</span> <span class="main">⟧</span>  <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">r</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">N</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">f</span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> module_hom_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> mod_hom <span class="main">=</span> 
  M<span class="main">?</span><span class="main">:</span> module <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">M</span></span> <span class="main">+</span> N<span class="main">?</span><span class="main">:</span> module <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">N</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="free">R</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">M</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">N</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_hom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> module_hom <span class="free">R</span> <span class="free">M</span> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">notes</span></span> f_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> module_hom_add <span class="main">[</span><span class="operator">OF</span> f_hom<span class="main">]</span>
    <span class="keyword2"><span class="keyword">and</span></span> f_smult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> module_hom_smult <span class="main">[</span><span class="operator">OF</span> f_hom<span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some basic simplification rules for module homomorphisms.›</span></span>
<span class="keyword1"><span class="command">context</span></span> mod_hom
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="LinearCombinations-f_im"><span class="command">lemma</span></span> f_im <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> carrier <span class="free">M</span>"</span></span> <span class="comment1">(*doesn't work if ⟹*)</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">v</span> <span class="main">∈</span> carrier <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"mod_hom <span class="free">R</span> <span class="free">M</span> <span class="free">N</span> <span class="free">f</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> 0 assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> mod_hom_def module_hom_def mod_hom_axioms_def Pi_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">im</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'e</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">im</span> <span class="main">=</span> <span class="free">f</span><span class="main">`</span><span class="main">(</span>carrier <span class="free">M</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ker</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ker</span> <span class="main">=</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> carrier <span class="free">M</span> <span class="main">&amp;</span> <span class="free">f</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">N</span></sub><span class="hidden">⇙</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="LinearCombinations-f0_is_0"><span class="command">lemma</span></span> f0_is_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="main">=</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">N</span></sub><span class="hidden">⇙</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">N</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> M.M.zero_closed N.lmult_0 R.zero_closed f_im f_smult <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LinearCombinations-f_neg"><span class="command">lemma</span></span> f_neg <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> carrier <span class="free">M</span><span class="main">⟹</span><span class="free">f</span> <span class="main">(</span><span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">N</span></sub><span class="hidden">⇙</span> <span class="free">f</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> M.smult_minus_1 N.smult_minus_1<span class="main">)</span>

<span class="keyword1" id="LinearCombinations-f_minus"><span class="command">lemma</span></span> f_minus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">v</span><span class="main">∈</span>carrier <span class="free">M</span><span class="main">;</span> <span class="free">w</span><span class="main">∈</span>carrier <span class="free">M</span><span class="main">⟧</span><span class="main">⟹</span><span class="free">f</span> <span class="main">(</span><span class="free">v</span><span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">v</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">N</span></sub><span class="hidden">⇙</span> <span class="free">f</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_minus_def<span class="main">)</span>

<span class="keyword1" id="LinearCombinations-ker_is_submodule"><span class="command">lemma</span></span> ker_is_submodule<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> ker <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"mod_hom <span class="free">R</span> <span class="free">M</span> <span class="free">N</span> <span class="free">f</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> 0 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"module <span class="free">R</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> mod_hom_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">rule</span> submodule.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ker_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> 1<span class="main">)</span> <span class="comment1">(*rmult_0*)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LinearCombinations-im_is_submodule"><span class="command">lemma</span></span> im_is_submodule<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> im <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"im <span class="main">⊆</span> carrier <span class="free">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> im_def image_def mod_hom_def module_hom_def f_im<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w1</span> <span class="bound">w2</span><span class="main">.</span><span class="main">⟦</span><span class="bound">w1</span> <span class="main">∈</span> im<span class="main">;</span> <span class="bound">w2</span> <span class="main">∈</span> im<span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">w1</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">N</span></sub><span class="hidden">⇙</span> <span class="bound">w2</span> <span class="main">∈</span> im"</span></span> <span class="comment1">(*it can't auto convert ⋀ and w/ o*)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w1</span> <span class="skolem">w2</span>
    <span class="keyword3"><span class="command">assume</span></span> w1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span> <span class="main">∈</span> im"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w2</span><span class="main">∈</span> im"</span></span>
    <span class="keyword1"><span class="command">from</span></span> w1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">where</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">∈</span> carrier <span class="free">M</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">v1</span> <span class="main">=</span> <span class="skolem">w1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> im_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> w2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span><span class="main">∈</span> carrier <span class="free">M</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">v2</span> <span class="main">=</span> <span class="skolem">w2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> im_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 3 4 <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">v1</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="skolem">v2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">w1</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">N</span></sub><span class="hidden">⇙</span> <span class="skolem">w2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 3 4 <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="skolem">v2</span><span class="main">∈</span> carrier <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 5 6 <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>carrier <span class="free">M</span><span class="main">.</span> <span class="skolem">w1</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">N</span></sub><span class="hidden">⇙</span> <span class="skolem">w2</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> 7 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="skolem">w1</span> <span class="skolem">w2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> im_def image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">N</span></sub><span class="hidden">⇙</span> <span class="main">∈</span> im"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">N</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="main">∈</span>carrier <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 8 <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>carrier <span class="free">M</span><span class="main">.</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">N</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> 9 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> im_def image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span> <span class="bound">w</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">c</span> <span class="main">∈</span> carrier <span class="free">R</span><span class="main">;</span> <span class="bound">w</span> <span class="main">∈</span> im<span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">c</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">N</span></sub><span class="hidden">⇙</span> <span class="bound">w</span> <span class="main">∈</span> im"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">w</span>
    <span class="keyword3"><span class="command">assume</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> im"</span></span>
    <span class="keyword1"><span class="command">from</span></span> w <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span> carrier <span class="free">M</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> im_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> c 10 <span class="keyword1"><span class="command">have</span></span> 11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">c</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">N</span></sub><span class="hidden">⇙</span> <span class="skolem">w</span><span class="main">∧</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span><span class="main">∈</span>carrier <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 11 <span class="keyword1"><span class="command">have</span></span> 12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v1</span><span class="main">∈</span>carrier <span class="free">M</span><span class="main">.</span>  <span class="skolem">c</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">N</span></sub><span class="hidden">⇙</span> <span class="skolem">w</span><span class="main">=</span><span class="free">f</span> <span class="bound">v1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
    <span class="keyword1"><span class="command">from</span></span> 12 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="skolem">c</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> im_def image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="comment1">(*sensitive to ordering*)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> 1 2 3 4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> mod_hom<span class="main">)</span> f_ker<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span>ker <span class="main">⟹</span> <span class="free">f</span> <span class="free">v</span><span class="main">=</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">N</span></sub><span class="hidden">⇙</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> ker_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We will show that for any set $S$, the space of functions $S\to K$ forms a vector space.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ring<span class="main">)</span> <span class="entity">func_space</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'z</span> set<span class="main">⇒</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="main">(</span><span class="tfree">'z</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> module"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">func_space</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">⦇</span>carrier <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span>carrier <span class="free">R</span><span class="main">,</span> 
                  mult <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> restrict <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">,</span>
                  one <span class="main">=</span>  restrict <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span>
                  zero <span class="main">=</span> restrict <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span>
                  add <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> restrict <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">v</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="bound">g</span> <span class="bound">v</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">,</span>
                  smult <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">c</span> <span class="bound">f</span><span class="main">.</span> restrict <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="bound">c</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="bound">f</span> <span class="bound">v</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cring<span class="main">)</span> func_space_is_module<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"module <span class="free">R</span> <span class="main">(</span>func_space <span class="free">S</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"cring <span class="free">R</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">from</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> module_criteria <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> func_space_def<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> module_def<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> f<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"restrict <span class="main">(</span><span class="main">λ</span><span class="bound">v'</span><span class="main">.</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="improper">f</span> <span class="bound">v'</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>restrict_def <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_ac PiE_mem2 r_neg<span class="main">)</span> <span class="comment1">(*intro: ext*)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> PiE_def extensional_def Pi_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m_assoc l_distr r_distr<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Note: one can define $M^n$ from this.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A linear combination is a module homomorphism from the space of coefficients to the module,
 $(a_v)\mapsto \sum_{v\in S} a_vv$.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> lincomb_is_mod_hom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">⊆</span>carrier <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mod_hom <span class="free">R</span> <span class="main">(</span>func_space <span class="free">S</span><span class="main">)</span> <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> lincomb <span class="bound">a</span> <span class="free">S</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"module <span class="free">R</span> <span class="free">M</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">{</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m1</span> <span class="skolem">m2</span>
    <span class="keyword3"><span class="command">assume</span></span> m1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">∈</span> <span class="free">S</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> carrier <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span> <span class="main">∈</span> <span class="free">S</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> h h2 m1 m2 <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">m1</span> <span class="bound">v</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="skolem">m2</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">m1</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="skolem">m2</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finsum_cong'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smult_l_distr PiE_mem2<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> h h2 m1 m2 <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">m1</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="skolem">m2</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">m1</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">m2</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finsum_addf<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> a1 a2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">m1</span> <span class="bound">v</span> <span class="main">⊕</span> <span class="skolem">m2</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">m1</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">m2</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m1</span> <span class="bound">m2</span><span class="main">.</span>
       <span class="bound">m1</span> <span class="main">∈</span> <span class="free">S</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> carrier <span class="free">R</span> <span class="main">⟹</span>
       <span class="bound">m2</span> <span class="main">∈</span> <span class="free">S</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="bound">m1</span> <span class="bound">v</span> <span class="main">⊕</span> <span class="bound">m2</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="bound">m1</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="bound">m2</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">m</span>
    <span class="keyword3"><span class="command">assume</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> carrier <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="free">S</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> h h2 r m <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">m</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">r</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="skolem">m</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finsum_smult<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> h h2 r m <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">r</span> <span class="main">⊗</span> <span class="skolem">m</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">m</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> b1<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> finsum_cong'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> smult_assoc1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span>
           <span class="bound">m</span> <span class="main">∈</span> <span class="free">S</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="bound">r</span> <span class="main">⊗</span> <span class="bound">m</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="bound">m</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> h h2 0 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> mod_hom_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> func_space_is_module<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> mod_hom_axioms_def module_hom_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> lincomb_closed<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> func_space_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> lincomb_def<span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*These are not really used.*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> lincomb_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A_fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> AinC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span>carrier <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">A</span><span class="main">→</span>carrier <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    b_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">A</span><span class="main">→</span>carrier <span class="free">R</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="free">a</span> <span class="bound">v</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="free">b</span> <span class="bound">v</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> lincomb <span class="free">a</span> <span class="free">A</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> lincomb <span class="free">b</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> A_fin AinC <span class="keyword1"><span class="command">interpret</span></span> mh<span class="main">:</span> mod_hom <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"func_space <span class="free">A</span>"</span></span> <span class="quoted"><span class="free">M</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> lincomb <span class="bound">a</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 
    lincomb_is_mod_hom<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"restrict <span class="free">a</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"restrict <span class="free">b</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a_fun b_fun A_fin AinC
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"LinearCombinations.module.lincomb <span class="free">M</span> <span class="main">(</span><span class="var">?a</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="main">(</span>LinearCombinations.ring.func_space <span class="free">R</span> <span class="free">A</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="var">?b</span><span class="main">)</span> <span class="free">A</span>
    <span class="main">=</span> LinearCombinations.module.lincomb <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span>  <span class="free">a</span> <span class="bound">x</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="free">b</span> <span class="bound">x</span><span class="main">)</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> func_space_def Pi_iff restrict_apply' <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> lincomb_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a_fun b_fun A_fin AinC
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"LinearCombinations.module.lincomb <span class="free">M</span> <span class="var">?a</span> <span class="free">A</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> 
      LinearCombinations.module.lincomb <span class="free">M</span> <span class="var">?b</span> <span class="free">A</span> <span class="main">=</span> LinearCombinations.module.lincomb <span class="free">M</span> <span class="free">a</span> <span class="free">A</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> 
      LinearCombinations.module.lincomb <span class="free">M</span> <span class="free">b</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_simp <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> lincomb_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a_fun b_fun <span class="keyword1"><span class="command">have</span></span> ainC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?a</span><span class="main">∈</span>carrier <span class="main">(</span>LinearCombinations.ring.func_space <span class="free">R</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> binC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?b</span><span class="main">∈</span>carrier <span class="main">(</span>LinearCombinations.ring.func_space <span class="free">R</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> func_space_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ainC binC <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"LinearCombinations.module.lincomb <span class="free">M</span> <span class="main">(</span><span class="var">?a</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="main">(</span>LinearCombinations.ring.func_space <span class="free">R</span> <span class="free">A</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="var">?b</span><span class="main">)</span> <span class="free">A</span>
    <span class="main">=</span> LinearCombinations.module.lincomb <span class="free">M</span> <span class="var">?a</span> <span class="free">A</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> 
      LinearCombinations.module.lincomb <span class="free">M</span> <span class="var">?b</span> <span class="free">A</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> lincomb_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The negative of a function is just pointwise negation.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cring<span class="main">)</span> func_space_neg<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">∈</span> carrier <span class="main">(</span>func_space <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span><span class="hidden">⇘</span><sub>func_space <span class="free">S</span></sub><span class="hidden">⇙</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">v</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span><span class="bound">v</span><span class="main">∈</span><span class="free">S</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="free">f</span> <span class="bound">v</span> <span class="keyword1">else</span> undefined<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">interpret</span></span> fs<span class="main">:</span> module <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"func_space <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> func_space_is_module<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> fs.minus_equality<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> func_space_def PiE_def extensional_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> restrict_ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_neg coeff_in_ring<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Ditto for subtraction. Note the above is really a special case, when a is the 0 function.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> lincomb_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A_fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> AinC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span>carrier <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">A</span><span class="main">→</span>carrier <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    b_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">A</span><span class="main">→</span>carrier <span class="free">R</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="free">a</span> <span class="bound">v</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="free">b</span> <span class="bound">v</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> lincomb <span class="free">a</span> <span class="free">A</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> lincomb <span class="free">b</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> A_fin AinC <span class="keyword1"><span class="command">interpret</span></span> mh<span class="main">:</span> mod_hom <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"func_space <span class="free">A</span>"</span></span> <span class="quoted"><span class="free">M</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> lincomb <span class="bound">a</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 
    lincomb_is_mod_hom<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"restrict <span class="free">a</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"restrict <span class="free">b</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a_fun b_fun <span class="keyword1"><span class="command">have</span></span> ainC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?a</span><span class="main">∈</span>carrier <span class="main">(</span>LinearCombinations.ring.func_space <span class="free">R</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> binC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?b</span><span class="main">∈</span>carrier <span class="main">(</span>LinearCombinations.ring.func_space <span class="free">R</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> func_space_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a_fun b_fun ainC binC A_fin AinC
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"LinearCombinations.module.lincomb <span class="free">M</span> <span class="main">(</span><span class="var">?a</span><span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="main">(</span>func_space <span class="free">A</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="var">?b</span><span class="main">)</span> <span class="free">A</span>
    <span class="main">=</span> LinearCombinations.module.lincomb <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span>  <span class="free">a</span> <span class="bound">x</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="free">b</span> <span class="bound">x</span><span class="main">)</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mh.M.M.minus_eq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> lincomb_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> func_space_neg<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_def func_space_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> R.minus_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a_fun b_fun A_fin AinC
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"LinearCombinations.module.lincomb <span class="free">M</span> <span class="var">?a</span> <span class="free">A</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> 
      LinearCombinations.module.lincomb <span class="free">M</span> <span class="var">?b</span> <span class="free">A</span> <span class="main">=</span> LinearCombinations.module.lincomb <span class="free">M</span> <span class="free">a</span> <span class="free">A</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> 
      LinearCombinations.module.lincomb <span class="free">M</span> <span class="free">b</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> lincomb_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ainC binC <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"LinearCombinations.module.lincomb <span class="free">M</span> <span class="main">(</span><span class="var">?a</span><span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="main">(</span>LinearCombinations.ring.func_space <span class="free">R</span> <span class="free">A</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="var">?b</span><span class="main">)</span> <span class="free">A</span>
    <span class="main">=</span> LinearCombinations.module.lincomb <span class="free">M</span> <span class="var">?a</span> <span class="free">A</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> 
      LinearCombinations.module.lincomb <span class="free">M</span> <span class="var">?b</span> <span class="free">A</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> lincomb_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The union of nested submodules is a submodule. We will use this to show that span of any
set is a submodule.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> nested_union_vs<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">I</span> <span class="free">N</span> <span class="free">N'</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">⟹</span> submodule <span class="free">R</span> <span class="main">(</span><span class="free">N</span> <span class="bound">i</span><span class="main">)</span> <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> max_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">⟹</span><span class="bound">j</span><span class="main">∈</span><span class="free">I</span><span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span><span class="main">∈</span><span class="free">I</span> <span class="main">∧</span> <span class="free">N</span> <span class="bound">i</span><span class="main">⊆</span><span class="free">N</span> <span class="bound">k</span> <span class="main">∧</span> <span class="free">N</span> <span class="bound">j</span> <span class="main">⊆</span><span class="free">N</span> <span class="bound">k</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> uni<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N'</span><span class="main">=</span><span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">N</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span><span class="main">≠</span><span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="free">N'</span> <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"module <span class="free">R</span> <span class="free">M</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> subm <span class="keyword1"><span class="command">have</span></span> all_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">⟹</span> <span class="free">N</span> <span class="bound">i</span> <span class="main">⊆</span> carrier <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> submodule_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> uni all_in <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">N'</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> carrier <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> uni <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">N'</span> <span class="main">⟹</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">N'</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">N'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">w</span>
    <span class="keyword3"><span class="command">assume</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">N'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="free">N'</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> uni v w <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="free">I</span><span class="main">∧</span> <span class="skolem">v</span><span class="main">∈</span> <span class="free">N</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">∈</span><span class="free">I</span><span class="main">∧</span> <span class="skolem">w</span><span class="main">∈</span> <span class="free">N</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> max_exists i j <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">∈</span><span class="free">I</span> <span class="main">∧</span> <span class="free">N</span> <span class="skolem">i</span> <span class="main">⊆</span> <span class="free">N</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="free">N</span> <span class="skolem">j</span> <span class="main">⊆</span> <span class="free">N</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">from</span></span> v w i j k <span class="keyword1"><span class="command">have</span></span> v2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span><span class="free">N</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">∈</span> <span class="free">N</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> v2 w2 k subm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> vw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="skolem">w</span> <span class="main">∈</span> <span class="free">N</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> submodule_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> k vw uni <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="skolem">v</span> <span class="skolem">w</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">∈</span> <span class="free">N'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword1"><span class="command">from</span></span> ne <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> i subm <span class="keyword1"><span class="command">have</span></span> zi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="main">∈</span><span class="free">N</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> submodule_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> i zi uni <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> uni subm <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> carrier <span class="free">R</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">N'</span> <span class="main">⟹</span> <span class="bound">c</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">N'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> submodule_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1 2 3 4 5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> submodule_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> span_is_monotone<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="free">T</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">⊆</span><span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"span <span class="free">S</span> <span class="main">⊆</span> span <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> subs <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> span_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> span_is_submodule<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">⊆</span>carrier <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="main">(</span>span <span class="free">S</span><span class="main">)</span> <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"module <span class="free">R</span> <span class="free">M</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> submodule_def span_def lincomb_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nested_union_vs<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?I</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="bound"><span class="bound">F</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">F</span></span><span class="main"><span class="main">⊆</span></span><span class="free"><span class="free">S</span></span> <span class="main"><span class="main">∧</span></span> finite <span class="bound"><span class="bound">F</span></span><span class="main"><span class="main">}</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?N</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">F</span></span><span class="main"><span class="main">.</span></span> span <span class="bound"><span class="bound">F</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?N'</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"span <span class="free"><span class="free">S</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">⋀</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> finite <span class="bound">F</span><span class="main">}</span> <span class="main">⟹</span> submodule <span class="free">R</span> <span class="main">(</span>span <span class="bound">F</span><span class="main">)</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">F</span>
      <span class="keyword3"><span class="command">assume</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> finite <span class="bound">F</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> F <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> F h2 <span class="keyword1"><span class="command">have</span></span> inC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">⊆</span>carrier <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> h1 inC <span class="keyword1"><span class="command">interpret</span></span> mh<span class="main">:</span> mod_hom <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>func_space <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> lincomb <span class="bound">a</span> <span class="skolem">F</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lincomb_is_mod_hom<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> h1 inC <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"mh.im <span class="main">=</span> span <span class="skolem">F</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> mh.im_def<span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> func_space_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> finite_span<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"restrict <span class="improper">a</span> <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> lincomb_cong<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="main">(</span>span <span class="skolem">F</span><span class="main">)</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mh.im_is_submodule<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> finite <span class="bound">F</span><span class="main">}</span> <span class="main">⟹</span>
           <span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> finite <span class="bound">F</span><span class="main">}</span> <span class="main">⟹</span>
           <span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> finite <span class="bound">F</span><span class="main">}</span> <span class="main">∧</span> span <span class="bound">i</span> <span class="main">⊆</span> span <span class="bound">k</span> <span class="main">∧</span> span <span class="bound">j</span> <span class="main">⊆</span> span <span class="bound">k</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> 
      <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> finite <span class="bound">F</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> finite <span class="bound">F</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> i j <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="skolem">i</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∪</span><span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> subsetI<span class="main">)</span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> span_is_monotone<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> subsetI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"span <span class="free">S</span><span class="main">=</span><span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> finite <span class="bound">F</span><span class="main">}</span><span class="main">.</span> span <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> span_def<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword1"><span class="command">have</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">from</span></span> ne <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> finite <span class="bound">F</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A finite sum does not depend on the ambient module. This can be done for monoid, but 
"submonoid" isn't currently defined. (It can be copied, however, for groups\ldots)
This lemma requires a somewhat annoying lemma foldD-not-depend. Then we show that linear combinations, 
linear independence, span do not depend on the ambient module.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> finsum_not_depend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">A</span> <span class="free">N</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span><span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="free">N</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span><span class="free">A</span><span class="main">→</span><span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="main">(</span>md <span class="free">N</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1 h2 h3 h4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> finsum_def finprod_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> foldD_not_depend<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?B</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">A</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> submodule_def LCD_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> M.add.m_lcomm PiE subsetCE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> lincomb_not_depend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">A</span> <span class="free">N</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span><span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="free">N</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span><span class="free">A</span><span class="main">→</span>carrier <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="free">a</span> <span class="free">A</span> <span class="main">=</span> module.lincomb <span class="main">(</span>md <span class="free">N</span><span class="main">)</span> <span class="free">a</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h3 <span class="keyword1"><span class="command">interpret</span></span> N<span class="main">:</span> module <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>md <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> submodule_is_module<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span><span class="main">=</span>carrier <span class="main">(</span>md <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>smult <span class="free">M</span> <span class="main">)</span> <span class="main">=</span> <span class="main">(</span>smult <span class="main">(</span>md <span class="free">N</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 h2 h3 h4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="main">(</span>md <span class="free">N</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">a</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">a</span> <span class="bound">v</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> finsum_not_depend<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> N.summands_valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> lincomb_def N.lincomb_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> span_li_not_depend<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="free">N</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">⊆</span><span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  h3<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="free">N</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"module.span <span class="free">R</span> <span class="main">(</span>md <span class="free">N</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> module.span <span class="free">R</span> <span class="free">M</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"module.lin_dep <span class="free">R</span> <span class="main">(</span>md <span class="free">N</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> module.lin_dep <span class="free">R</span> <span class="free">M</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h3 <span class="keyword1"><span class="command">interpret</span></span> w<span class="main">:</span> module <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>md <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> submodule_is_module<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="main">(</span>module.span <span class="free">R</span> <span class="main">(</span>md <span class="free">N</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>md <span class="free">N</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> w.span_is_submodule<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span>finite <span class="bound">A</span> <span class="main">∧</span> <span class="bound">A</span><span class="main">⊆</span><span class="free">S</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">A</span> <span class="main">→</span> carrier <span class="free">R</span> <span class="main">⟹</span> 
    module.lincomb <span class="free">M</span> <span class="bound">a</span> <span class="bound">A</span> <span class="main">=</span> module.lincomb <span class="main">(</span>md <span class="free">N</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">A</span>
    <span class="keyword3"><span class="command">assume</span></span> 31<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span> <span class="main">∧</span> <span class="skolem">A</span><span class="main">⊆</span><span class="free">S</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">→</span> carrier <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms 31 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="skolem">a</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> lincomb_not_depend<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword3"><span class="command">show</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"module.span <span class="free">R</span> <span class="main">(</span>md <span class="free">N</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> module.span <span class="free">R</span> <span class="free">M</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> span_def w.span_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> zeros<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟬</span><span class="hidden">⇘</span><sub>md <span class="free">N</span></sub><span class="hidden">⇙</span><span class="main">=</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms 3 <span class="keyword3"><span class="command">show</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"module.lin_dep <span class="free">R</span> <span class="main">(</span>md <span class="free">N</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> module.lin_dep <span class="free">R</span> <span class="free">M</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> lin_dep_def w.lin_dep_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> zeros<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> span_is_subset<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="free">N</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">⊆</span><span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  h3<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="free">N</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"span <span class="free">S</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
  <span class="keyword1"><span class="command">from</span></span> h3 <span class="keyword1"><span class="command">interpret</span></span> w<span class="main">:</span> module <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>md <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> submodule_is_module<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="main">(</span>module.span <span class="free">R</span> <span class="main">(</span>md <span class="free">N</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>md <span class="free">N</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> w.span_is_submodule<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"module.span <span class="free">R</span> <span class="main">(</span>md <span class="free">N</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> module.span <span class="free">R</span> <span class="free">M</span> <span class="free">S</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> span_li_not_depend<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1 4 <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="main">(</span>module.span <span class="free">R</span> <span class="free">M</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>md <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> submodule_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> span_is_subset2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">⊆</span>carrier <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"span <span class="free">S</span> <span class="main">⊆</span> carrier <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"module <span class="free">R</span> <span class="free">M</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> 0 <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="main">(</span>carrier <span class="free">M</span><span class="main">)</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> submodule_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h2 h3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> span_is_subset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> in_own_span<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  inC<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">⊆</span>carrier <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> span <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> inC <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> span_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> v<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">w</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span><span class="bound">w</span><span class="main">=</span><span class="improper">v</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span> <span class="keyword1">else</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="improper">v</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> lincomb_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> supset_ld_is_ld<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ld<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_dep <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lin_dep <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> ld <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>finite <span class="skolem">A'</span> <span class="main">∧</span> <span class="skolem">A'</span><span class="main">⊆</span><span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">a</span><span class="main">∈</span> <span class="main">(</span><span class="skolem">A'</span><span class="main">→</span>carrier <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>lincomb <span class="skolem">a</span> <span class="skolem">A'</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v</span><span class="main">∈</span><span class="skolem">A'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">a</span> <span class="skolem">v</span><span class="main">≠</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">R</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> lin_dep_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1 sub <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> lin_dep_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">A'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> subset_li_is_li<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> li<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lin_indpt <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> ld<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lin_indpt <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> ld sub <span class="keyword1"><span class="command">have</span></span> ldA<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_dep <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> supset_ld_is_ld<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> li ldA <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> mod_hom<span class="main">)</span> hom_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span> <span class="free">g</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span>carrier <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span><span class="main">:</span><span class="free">A</span><span class="main">→</span>carrier <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">g</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">N</span></sub><span class="hidden">⇙</span> <span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>   
  <span class="keyword1"><span class="command">from</span></span> h2 h3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="comment1">(*doesn't work on outside?*)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">N</span></sub><span class="hidden">⇙</span><span class="bound">a</span><span class="main">∈</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">N</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub><span class="free">N</span></sub><span class="hidden">⇙</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finsum_insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> insert.prems insert.hyps <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SumSpaces">
<div class="head">
<h1>Theory SumSpaces</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The direct sum of modules.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> SumSpaces
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Algebra/Module.html">HOL-Algebra.Module</a>"</span>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Algebra/Coset.html">HOL-Algebra.Coset</a>"</span>
  <a href="#RingModuleFacts">RingModuleFacts</a>
  <a href="#MonoidSums">MonoidSums</a>
  <a href="#FunctionLemmas">FunctionLemmas</a>
  <a href="#LinearCombinations">LinearCombinations</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define the direct sum $M_1\oplus M_2$ of 2 vector spaces as the set $M_1\times M_2$ under
componentwise addition and scalar multiplication.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">direct_sum</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> module_scheme <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">,</span> <span class="tfree">'e</span><span class="main">)</span> module_scheme <span class="main">⇒</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">×</span><span class="tfree">'c</span><span class="main">)</span><span class="main">)</span> module"</span></span> <span class="comment1">(*(infixl "(⊕)" 50)*)</span>
  <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">direct_sum</span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="main">=</span> <span class="main">⦇</span>carrier <span class="main">=</span> carrier <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="main">×</span> carrier <span class="free"><span class="bound"><span class="entity">M2</span></span></span><span class="main">,</span> 
                  mult <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> <span class="main">(</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">M1</span></span></span></sub><span class="hidden">⇙</span><span class="main">,</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">M2</span></span></span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                  one <span class="main">=</span>  <span class="main">(</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">M1</span></span></span></sub><span class="hidden">⇙</span><span class="main">,</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">M2</span></span></span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">,</span>
                  zero <span class="main">=</span> <span class="main">(</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">M1</span></span></span></sub><span class="hidden">⇙</span><span class="main">,</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">M2</span></span></span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">,</span>
                  add <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> <span class="main">(</span>fst <span class="bound">v</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">M1</span></span></span></sub><span class="hidden">⇙</span> fst <span class="bound">w</span><span class="main">,</span> snd <span class="bound">v</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">M2</span></span></span></sub><span class="hidden">⇙</span> snd <span class="bound">w</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                  smult <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">c</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="bound">c</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">M1</span></span></span></sub><span class="hidden">⇙</span> fst <span class="bound">v</span><span class="main">,</span> <span class="bound">c</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">M2</span></span></span></sub><span class="hidden">⇙</span> snd <span class="bound">v</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span>"</span></span>

<span class="keyword1" id="SumSpaces-direct_sum_is_module"><span class="command">lemma</span></span> direct_sum_is_module<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">R</span> <span class="free">M1</span> <span class="free">M2</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"module <span class="free">R</span> <span class="free">M1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"module <span class="free">R</span> <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"module <span class="free">R</span> <span class="main">(</span>direct_sum <span class="free">M1</span> <span class="free">M2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"cring <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> module_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">interpret</span></span> v1<span class="main">:</span> module <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">interpret</span></span> v2<span class="main">:</span> module <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> h1 h2 <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"abelian_group <span class="main">(</span>direct_sum <span class="free">M1</span> <span class="free">M2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> abelian_groupI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> direct_sum_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v1.a_ac v2.a_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h1 h2 assms <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"module_axioms <span class="free">R</span> <span class="main">(</span>direct_sum <span class="free">M1</span> <span class="free">M2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> module_axioms_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> direct_sum_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v1.smult_l_distr v2.smult_l_distr v1.smult_r_distr v2.smult_r_distr
      v1.smult_assoc1 v2.smult_assoc1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1 2 3  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> module_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">inj1</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> module <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> module <span class="main">⇒</span><span class="main">(</span><span class="tfree">'b</span><span class="main">⇒</span><span class="main">(</span><span class="tfree">'b</span><span class="main">×</span><span class="tfree">'c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">inj1</span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">M2</span></span></span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">inj2</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> module <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> module <span class="main">⇒</span><span class="main">(</span><span class="tfree">'c</span><span class="main">⇒</span><span class="main">(</span><span class="tfree">'b</span><span class="main">×</span><span class="tfree">'c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">inj2</span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">M1</span></span></span></sub><span class="hidden">⇙</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SumSpaces-inj1_hom"><span class="command">lemma</span></span> inj1_hom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">R</span> <span class="free">M1</span> <span class="free">M2</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"module <span class="free">R</span> <span class="free">M1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"module <span class="free">R</span> <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mod_hom <span class="free">R</span> <span class="free">M1</span> <span class="main">(</span>direct_sum <span class="free">M1</span> <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>inj1 <span class="free">M1</span> <span class="free">M2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">interpret</span></span> v1<span class="main">:</span>module <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">interpret</span></span> v2<span class="main">:</span>module <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> h1 h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> mod_hom_def module_hom_def mod_hom_axioms_def inj1_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> direct_sum_is_module<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> direct_sum_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SumSpaces-inj2_hom"><span class="command">lemma</span></span> inj2_hom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">R</span> <span class="free">M1</span> <span class="free">M2</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"module <span class="free">R</span> <span class="free">M1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"module <span class="free">R</span> <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mod_hom <span class="free">R</span> <span class="free">M2</span> <span class="main">(</span>direct_sum <span class="free">M1</span> <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>inj2 <span class="free">M1</span> <span class="free">M2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">interpret</span></span> v1<span class="main">:</span>module <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">interpret</span></span> v2<span class="main">:</span>module <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> h1 h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> mod_hom_def module_hom_def mod_hom_axioms_def inj2_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> direct_sum_is_module<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> direct_sum_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For submodules $M_1,M_2\subseteq M$, the map $M_1\oplus M_2\to M$ given by $(m_1,m_2)\mapsto 
m_1+m_2$ is linear.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> sum_map_hom<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M1</span> <span class="free">M2</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="free">M1</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="free">M2</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mod_hom <span class="free">R</span> <span class="main">(</span>direct_sum <span class="main">(</span>md <span class="free">M1</span><span class="main">)</span> <span class="main">(</span>md <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="free">M</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span>fst <span class="bound">v</span><span class="main">)</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span>snd <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"module <span class="free">R</span> <span class="free">M</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"module <span class="free">R</span> <span class="main">(</span>md <span class="free">M1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> submodule_is_module<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"module <span class="free">R</span> <span class="main">(</span>md <span class="free">M2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> submodule_is_module<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">interpret</span></span> w1<span class="main">:</span> module <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>md <span class="free">M1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> submodule_is_module<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">interpret</span></span> w2<span class="main">:</span> module <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>md <span class="free">M2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> submodule_is_module<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 0 h1 h2 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> mod_hom_def mod_hom_axioms_def module_hom_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> direct_sum_is_module<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> direct_sum_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> submodule_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_ac smult_r_distr ring_subset_carrier<span class="main">)</span> 
      <span class="comment1">(*key is a_ac, permutative rewrite rule*)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> sum_is_submodule<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">N1</span> <span class="free">N2</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="free">N1</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="free">N2</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="main">(</span>submodule_sum <span class="free">N1</span> <span class="free">N2</span><span class="main">)</span> <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1 h2 <span class="keyword1"><span class="command">interpret</span></span> l<span class="main">:</span> mod_hom <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>direct_sum <span class="main">(</span>md <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>md <span class="free">N2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span>fst <span class="bound">v</span><span class="main">)</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="main">(</span>snd <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_map_hom<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"l.im <span class="main">=</span>submodule_sum <span class="free">N1</span> <span class="free">N2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> l.im_def submodule_sum_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> direct_sum_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="main">(</span>l.im<span class="main">)</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> l.im_is_submodule<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> in_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">N1</span> <span class="free">N2</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="free">N1</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="free">N2</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="main">⊆</span> submodule_sum <span class="free">N1</span> <span class="free">N2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1 h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> submodule_sum_def image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> v<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> submodule_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> msum_comm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">N1</span> <span class="free">N2</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="free">N1</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="free">N2</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>submodule_sum <span class="free">N1</span> <span class="free">N2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>submodule_sum <span class="free">N2</span> <span class="free">N1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="comment1">(*have 0: "module R M"..*)</span>
  <span class="keyword1"><span class="command">from</span></span> h1 h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> submodule_sum_def image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> submodule_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> v w<span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> M.add.m_comm subsetD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="comment1">(* Alternatively, apply (rule_tac x="w" in bexI, rule_tac x="v" in bexI,
      auto simp add: ring_subset_carrier M.a_ac)+ *)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If $M_1,M_2\subseteq M$ are submodules, then $M_1+M_2$ is the minimal subspace such that 
both $M_1\subseteq M$ and $M_2\subseteq M$.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> sum_is_minimal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">N</span> <span class="free">N1</span> <span class="free">N2</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="free">N1</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="free">N2</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="free">N</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>submodule_sum <span class="free">N1</span> <span class="free">N2</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">⟷</span> <span class="free">N1</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">∧</span> <span class="free">N2</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>submodule_sum <span class="free">N1</span> <span class="free">N2</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">⟹</span> <span class="free">N1</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">∧</span> <span class="free">N2</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>submodule_sum <span class="free">N1</span> <span class="free">N2</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> h1 h2 <span class="keyword1"><span class="command">have</span></span> 11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N1</span><span class="main">⊆</span>submodule_sum <span class="free">N1</span> <span class="free">N2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> h2 h1 <span class="keyword1"><span class="command">have</span></span> 12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N2</span><span class="main">⊆</span>submodule_sum <span class="free">N2</span> <span class="free">N1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 12 h1 h2 <span class="keyword1"><span class="command">have</span></span> 13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N2</span><span class="main">⊆</span>submodule_sum <span class="free">N1</span> <span class="free">N2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> msum_comm<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 10 11 13 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">∧</span> <span class="free">N2</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">⟹</span> <span class="main">(</span>submodule_sum <span class="free">N1</span> <span class="free">N2</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> 19<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">∧</span> <span class="free">N2</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span>  
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> 20<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span>submodule_sum <span class="free">N1</span> <span class="free">N2</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> 20 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w1</span></span> <span class="skolem"><span class="skolem">w2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 21<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span><span class="main">∈</span><span class="free">N1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 22<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w2</span><span class="main">∈</span><span class="free">N2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 23<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="skolem">w1</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">M</span></sub><span class="hidden">⇙</span> <span class="skolem">w2</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> submodule_sum_def image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 19 21 22 23 h3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">N</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> submodule_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>poly_guards_query<span class="main"><span class="main">)</span></span>  contra_subsetD<span class="main">)</span>
<span class="comment1">(*how is an obtain goal rep'd?*)</span> 
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹$\text{span} A\cup B = \text{span} A + \text{span} B$›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> span_union_is_sum<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span>carrier <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">⊆</span>carrier <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"span <span class="main">(</span><span class="free">A</span><span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> submodule_sum <span class="main">(</span>span <span class="free">A</span><span class="main">)</span> <span class="main">(</span>span <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?AplusB</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"submodule_sum <span class="main">(</span>span <span class="free">A</span><span class="main">)</span> <span class="main">(</span>span <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span>  h2 <span class="keyword1"><span class="command">have</span></span> s0<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="main">(</span>span <span class="free">A</span><span class="main">)</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> span_is_submodule<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span>  h3 <span class="keyword1"><span class="command">have</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="main">(</span>span <span class="free">B</span><span class="main">)</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> span_is_submodule<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> s0 <span class="keyword1"><span class="command">have</span></span> s0_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>span <span class="free">A</span><span class="main">)</span><span class="main">⊆</span>carrier <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> submodule_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> s1 <span class="keyword1"><span class="command">have</span></span> s1_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>span <span class="free">B</span><span class="main">)</span><span class="main">⊆</span>carrier <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> submodule_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h2 h3 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∪</span><span class="free">B</span><span class="main">⊆</span>carrier <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span>  1 <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="main">(</span>span <span class="main">(</span><span class="free">A</span><span class="main">∪</span><span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> span_is_submodule<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> s0 s1 <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">R</span> <span class="var">?AplusB</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_is_submodule<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span><span class="free">A</span><span class="main">∪</span><span class="free">B</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?AplusB</span>"</span></span>
<span class="comment1">(*span(A∪B) ⊆ span(A) + span(B) *)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span>  h2 <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span>span <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_own_span<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> s0 s1 <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="free">A</span> <span class="main">⊆</span> <span class="var">?AplusB</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_sum<span class="main">)</span> <span class="comment1">(*M⊆M+N*)</span>
    <span class="keyword1"><span class="command">from</span></span> a1 a2 <span class="keyword1"><span class="command">have</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span> <span class="var">?AplusB</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="comment1">(*similarly*)</span>
    <span class="keyword1"><span class="command">from</span></span>  h3 <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">⊆</span>span <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_own_span<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> s1 s0 <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="free">B</span> <span class="main">⊆</span> <span class="var">?AplusB</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_sum msum_comm<span class="main">)</span> <span class="comment1">(*M⊆M+N*)</span>
    <span class="keyword1"><span class="command">from</span></span> b1 b2 <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">⊆</span> <span class="var">?AplusB</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> a3 b3 <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∪</span><span class="free">B</span><span class="main">⊆</span> <span class="var">?AplusB</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="comment1">(*by default simp *)</span>
    <span class="keyword1"><span class="command">from</span></span> 5 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> span_is_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?AplusB</span> <span class="main">⊆</span> span <span class="main">(</span><span class="free">A</span><span class="main">∪</span><span class="free">B</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword1"><span class="command">have</span></span> 11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span><span class="free">A</span><span class="main">∪</span><span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">⊆</span><span class="free">A</span><span class="main">∪</span><span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span>  11 <span class="keyword1"><span class="command">have</span></span> 21<span class="main">:</span><span class="quoted"><span class="quoted">"span <span class="free">A</span> <span class="main">⊆</span>span <span class="main">(</span><span class="free">A</span><span class="main">∪</span><span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> span_is_monotone<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span>  12 <span class="keyword1"><span class="command">have</span></span> 22<span class="main">:</span><span class="quoted"><span class="quoted">"span <span class="free">B</span> <span class="main">⊆</span>span <span class="main">(</span><span class="free">A</span><span class="main">∪</span><span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> span_is_monotone<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> s0 s1 2 21 22 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_is_minimal<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> c1 c2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="VectorSpace">
<div class="head">
<h1>Theory VectorSpace</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Basic theory of vector spaces, using locales›</span></span>

<span class="keyword1"><span class="command">theory</span></span> VectorSpace
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Algebra/Module.html">HOL-Algebra.Module</a>"</span>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Algebra/Coset.html">HOL-Algebra.Coset</a>"</span>
  <a href="#RingModuleFacts">RingModuleFacts</a>
  <a href="#MonoidSums">MonoidSums</a>
  <a href="#LinearCombinations">LinearCombinations</a>
  <a href="#SumSpaces">SumSpaces</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic definitions and facts carried over from modules›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>vectorspace›</span></span></span></span> is a module where the ring is a field. 
Note that we switch notation from $(R, M)$ to $(K, V)$.›</span></span>
<span class="keyword1"><span class="command">locale</span></span> vectorspace <span class="main">=</span> 
  module<span class="main">?</span><span class="main">:</span> module <span class="quoted"><span class="free">K</span></span> <span class="quoted"><span class="free">V</span></span> <span class="main">+</span> field<span class="main">?</span><span class="main">:</span> field <span class="quoted"><span class="free">K</span></span>  
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">K</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">V</span>

<span class="comment1">(*
Use sets for bases, and functions from the sets to carrier K 
represent the coefficients. 
*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>subspace›</span></span></span></span> of a vectorspace is a nonempty subset 
that is closed under addition and scalar multiplication. These properties
have already been defined in submodule. Caution: W is a set, while V is 
a module record. To get W as a vectorspace, write vs W.›</span></span>
<span class="keyword1"><span class="command">locale</span></span> subspace <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">K</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">W</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">V</span> <span class="main">(</span><span class="keyword2"><span class="keyword">structure</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"vectorspace <span class="free">K</span> <span class="free">V</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> submod<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">K</span> <span class="free">W</span> <span class="free">V</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> is_module<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"subspace <span class="free">K</span> <span class="free">W</span> <span class="free">V</span><span class="main">⟹</span>submodule <span class="free">K</span> <span class="free">W</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> subspace_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We introduce some basic facts and definitions copied from module.
We introduce some abbreviations, to match convention.›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> <span class="entity">vs</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> module_scheme"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">≡</span> <span class="free">V</span><span class="main">⦇</span>carrier <span class="main">:=</span><span class="free"><span class="bound"><span class="entity">W</span></span></span><span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> carrier_vs_is_self <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"carrier <span class="main">(</span>vs <span class="free">W</span><span class="main">)</span> <span class="main">=</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> subspace_is_vs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">W</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"subspace <span class="free">K</span> <span class="free">W</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vectorspace <span class="free">K</span> <span class="main">(</span>vs <span class="free">W</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> vectorspace_def subspace_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> submodule_is_module<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> module<span class="main">)</span> <span class="entity">subspace_sum</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'c</span> set<span class="main">,</span> <span class="tfree">'c</span> set<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'c</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">subspace_sum</span> <span class="free"><span class="bound"><span class="entity">W1</span></span></span> <span class="free"><span class="bound"><span class="entity">W2</span></span></span> <span class="main">≡</span>submodule_sum <span class="free"><span class="bound"><span class="entity">W1</span></span></span> <span class="free"><span class="bound"><span class="entity">W2</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> vs_zero_lin_dep<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="main">∉</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"vectorspace <span class="free">K</span> <span class="free">V</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> vs <span class="keyword1"><span class="command">have</span></span> nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"carrier <span class="free">K</span> <span class="main">≠</span><span class="main">{</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> one_zeroI zero_not_one<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h2 h3 nonzero <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zero_nin_lin_indpt<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>linear_map›</span></span></span></span> is a module homomorphism between 2 vectorspaces
over the same field.›</span></span>
<span class="keyword1"><span class="command">locale</span></span> linear_map <span class="main">=</span> 
  V<span class="main">?</span><span class="main">:</span> vectorspace <span class="quoted"><span class="free">K</span></span> <span class="quoted"><span class="free">V</span></span> <span class="main">+</span> W<span class="main">?</span><span class="main">:</span> vectorspace <span class="quoted"><span class="free">K</span></span> <span class="quoted"><span class="free">W</span></span>
  <span class="main">+</span> mod_hom<span class="main">?</span><span class="main">:</span> mod_hom <span class="quoted"><span class="free">K</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">W</span></span> <span class="quoted"><span class="free">T</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="free">K</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">V</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">W</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">T</span>

<span class="keyword1"><span class="command">context</span></span> linear_map
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> T_hom <span class="main">=</span> f_hom
<span class="keyword1"><span class="command">lemmas</span></span> T_add <span class="main">=</span> f_add
<span class="keyword1"><span class="command">lemmas</span></span> T_smult <span class="main">=</span> f_smult
<span class="keyword1"><span class="command">lemmas</span></span> T_im <span class="main">=</span> f_im
<span class="keyword1"><span class="command">lemmas</span></span> T_neg <span class="main">=</span> f_neg
<span class="keyword1"><span class="command">lemmas</span></span> T_minus <span class="main">=</span> f_minus
<span class="keyword1"><span class="command">lemmas</span></span> T_ker <span class="main">=</span> f_ker

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">imT</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'e</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">imT</span> <span class="main">≡</span> mod_hom.im"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">kerT</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">kerT</span> <span class="main">≡</span> mod_hom.ker"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> T0_is_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> f0_is_0

<span class="keyword1" id="VectorSpace-kerT_is_subspace"><span class="command">lemma</span></span> kerT_is_subspace<span class="main">:</span> <span class="quoted"><span class="quoted">"subspace <span class="free">K</span> ker <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"vectorspace <span class="free">K</span> <span class="free">V</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> vs <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> subspace_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ker_is_submodule<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VectorSpace-imT_is_subspace"><span class="command">lemma</span></span> imT_is_subspace<span class="main">:</span> <span class="quoted"><span class="quoted">"subspace <span class="free">K</span> imT <span class="free">W</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"vectorspace <span class="free">K</span> <span class="free">W</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> vs <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> subspace_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> im_is_submodule<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="VectorSpace-vs_criteria"><span class="command">lemma</span></span> vs_criteria<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">K</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">V</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> field<span class="main">:</span> <span class="quoted"><span class="quoted">"field <span class="free">K</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span><span class="main">∈</span> carrier <span class="free">V</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span>carrier <span class="free">V</span> <span class="main">∧</span> <span class="bound">w</span><span class="main">∈</span>carrier <span class="free">V</span><span class="main">⟶</span> <span class="bound">v</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="bound">w</span><span class="main">∈</span> carrier <span class="free">V</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>carrier <span class="free">V</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">neg_v</span><span class="main">∈</span>carrier <span class="free">V</span><span class="main">.</span> <span class="bound">v</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span><span class="bound">neg_v</span><span class="main">=</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> smult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">c</span><span class="main">∈</span> carrier <span class="free">K</span> <span class="main">∧</span> <span class="bound">v</span><span class="main">∈</span>carrier <span class="free">V</span><span class="main">⟶</span> <span class="bound">c</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="bound">v</span> <span class="main">∈</span> carrier <span class="free">V</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span>carrier <span class="free">V</span> <span class="main">∧</span> <span class="bound">w</span><span class="main">∈</span>carrier <span class="free">V</span><span class="main">⟶</span> <span class="bound">v</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="bound">w</span><span class="main">=</span><span class="bound">w</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="bound">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="bound">w</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span>carrier <span class="free">V</span> <span class="main">∧</span> <span class="bound">w</span><span class="main">∈</span>carrier <span class="free">V</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∈</span>carrier <span class="free">V</span><span class="main">⟶</span> <span class="main">(</span><span class="bound">v</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="bound">w</span><span class="main">)</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="bound">x</span><span class="main">=</span> <span class="bound">v</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="bound">w</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> add_id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>carrier <span class="free">V</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="main">=</span><span class="bound">v</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> compat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span> carrier <span class="free">K</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">∈</span> carrier <span class="free">K</span> <span class="main">∧</span> <span class="bound">v</span><span class="main">∈</span>carrier <span class="free">V</span><span class="main">⟶</span> <span class="main">(</span><span class="bound">a</span><span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="bound">b</span><span class="main">)</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="bound">v</span> <span class="main">=</span><span class="bound">a</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="bound">b</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> smult_id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>carrier <span class="free">V</span><span class="main">.</span> <span class="main">(</span><span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="bound">v</span> <span class="main">=</span><span class="bound">v</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> dist_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span> carrier <span class="free">K</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">∈</span> carrier <span class="free">K</span> <span class="main">∧</span> <span class="bound">v</span><span class="main">∈</span>carrier <span class="free">V</span><span class="main">⟶</span> <span class="main">(</span><span class="bound">a</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="bound">b</span><span class="main">)</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="bound">v</span> <span class="main">=</span><span class="main">(</span><span class="bound">a</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="bound">b</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> dist_add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span> carrier <span class="free">K</span> <span class="main">∧</span> <span class="bound">v</span><span class="main">∈</span>carrier <span class="free">V</span> <span class="main">∧</span> <span class="bound">w</span><span class="main">∈</span>carrier <span class="free">V</span><span class="main">⟶</span> <span class="bound">a</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="bound">v</span><span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="bound">w</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span><span class="bound">a</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="bound">a</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="bound">w</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vectorspace <span class="free">K</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> field <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"cring <span class="free">K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> field_def domain_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms 1 <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"module <span class="free">K</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> module_criteria<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> field 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> vectorspace_def module_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For any set $S$, the space of functions $S\to K$ forms a vector space.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> func_space_is_vs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vectorspace <span class="free">K</span> <span class="main">(</span>func_space <span class="free">S</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"field <span class="free">K</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"module <span class="free">K</span> <span class="main">(</span>func_space <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> func_space_is_module<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 0 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> vectorspace_def module_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="VectorSpace-direct_sum_is_vs"><span class="command">lemma</span></span> direct_sum_is_vs<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">K</span> <span class="free">V1</span> <span class="free">V2</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"vectorspace <span class="free">K</span> <span class="free">V1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"vectorspace <span class="free">K</span> <span class="free">V2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vectorspace <span class="free">K</span> <span class="main">(</span>direct_sum <span class="free">V1</span> <span class="free">V2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1 h2 <span class="keyword1"><span class="command">have</span></span> mod<span class="main">:</span> <span class="quoted"><span class="quoted">"module <span class="free">K</span> <span class="main">(</span>direct_sum <span class="free">V1</span> <span class="free">V2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> vectorspace_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> direct_sum_is_module<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> mod h1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> vectorspace_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VectorSpace-inj1_linear"><span class="command">lemma</span></span> inj1_linear<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">K</span> <span class="free">V1</span> <span class="free">V2</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"vectorspace <span class="free">K</span> <span class="free">V1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"vectorspace <span class="free">K</span> <span class="free">V2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"linear_map <span class="free">K</span> <span class="free">V1</span> <span class="main">(</span>direct_sum <span class="free">V1</span> <span class="free">V2</span><span class="main">)</span> <span class="main">(</span>inj1 <span class="free">V1</span> <span class="free">V2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 h2 <span class="keyword1"><span class="command">have</span></span> mod<span class="main">:</span> <span class="quoted"><span class="quoted">"mod_hom <span class="free">K</span> <span class="free">V1</span> <span class="main">(</span>direct_sum <span class="free">V1</span> <span class="free">V2</span><span class="main">)</span> <span class="main">(</span>inj1 <span class="free">V1</span> <span class="free">V2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> vectorspace_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> inj1_hom<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> mod h1 h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> linear_map_def vectorspace_def <span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> direct_sum_is_module<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="VectorSpace-inj2_linear"><span class="command">lemma</span></span> inj2_linear<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">K</span> <span class="free">V1</span> <span class="free">V2</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"vectorspace <span class="free">K</span> <span class="free">V1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"vectorspace <span class="free">K</span> <span class="free">V2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"linear_map <span class="free">K</span> <span class="free">V2</span> <span class="main">(</span>direct_sum <span class="free">V1</span> <span class="free">V2</span><span class="main">)</span> <span class="main">(</span>inj2 <span class="free">V1</span> <span class="free">V2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 h2 <span class="keyword1"><span class="command">have</span></span> mod<span class="main">:</span> <span class="quoted"><span class="quoted">"mod_hom <span class="free">K</span> <span class="free">V2</span> <span class="main">(</span>direct_sum <span class="free">V1</span> <span class="free">V2</span><span class="main">)</span> <span class="main">(</span>inj2 <span class="free">V1</span> <span class="free">V2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> vectorspace_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> inj2_hom<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> mod h1 h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> linear_map_def vectorspace_def <span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> direct_sum_is_module<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For subspaces $V_1,V_2\subseteq V$, the map $V_1\oplus V_2\to V$ given by $(v_1,v_2)\mapsto 
v_1+v_2$ is linear.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> sum_map_linear<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">V1</span> <span class="free">V2</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"subspace <span class="free">K</span> <span class="free">V1</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"subspace <span class="free">K</span> <span class="free">V2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"linear_map <span class="free">K</span> <span class="main">(</span>direct_sum <span class="main">(</span>vs <span class="free">V1</span><span class="main">)</span> <span class="main">(</span>vs <span class="free">V2</span><span class="main">)</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span>fst <span class="bound">v</span><span class="main">)</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="main">(</span>snd <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 h2 <span class="keyword1"><span class="command">have</span></span> mod<span class="main">:</span> <span class="quoted"><span class="quoted">"mod_hom <span class="free">K</span> <span class="main">(</span>direct_sum <span class="main">(</span>vs <span class="free">V1</span><span class="main">)</span> <span class="main">(</span>vs <span class="free">V2</span><span class="main">)</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span>fst <span class="bound">v</span><span class="main">)</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="main">(</span>snd <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span> <span class="operator">intro</span> sum_map_hom<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> subspace_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> mod h1 h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> linear_map_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> direct_sum_is_vs subspace_is_vs<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="keyword1"><span class="command">..</span></span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> sum_is_subspace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">W1</span> <span class="free">W2</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"subspace <span class="free">K</span> <span class="free">W1</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"subspace <span class="free">K</span> <span class="free">W2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subspace <span class="free">K</span> <span class="main">(</span>subspace_sum <span class="free">W1</span> <span class="free">W2</span><span class="main">)</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1 h2 <span class="keyword1"><span class="command">have</span></span> mod<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">K</span> <span class="main">(</span>submodule_sum <span class="free">W1</span> <span class="free">W2</span><span class="main">)</span> <span class="free">V</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span> <span class="operator">intro</span> sum_is_submodule<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> subspace_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> mod h1 h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> subspace_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If $W_1,W_2\subseteq V$ are subspaces, $W_1\subseteq W_1 + W_2$›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> in_sum_vs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">W1</span> <span class="free">W2</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"subspace <span class="free">K</span> <span class="free">W1</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"subspace <span class="free">K</span> <span class="free">W2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">W1</span> <span class="main">⊆</span> subspace_sum <span class="free">W1</span> <span class="free">W2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1 h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> in_sum<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> subspace_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> vsum_comm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">W1</span> <span class="free">W2</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"subspace <span class="free">K</span> <span class="free">W1</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"subspace <span class="free">K</span> <span class="free">W2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subspace_sum <span class="free">W1</span> <span class="free">W2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>subspace_sum <span class="free">W2</span> <span class="free">W1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> msum_comm<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> subspace_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If $W_1,W_2\subseteq V$ are subspaces, then $W_1+W_2$ is the minimal subspace such that 
both $W_1\subseteq W$ and $W_2\subseteq W$.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> vsum_is_minimal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">W</span> <span class="free">W1</span> <span class="free">W2</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"subspace <span class="free">K</span> <span class="free">W1</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"subspace <span class="free">K</span> <span class="free">W2</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"subspace <span class="free">K</span> <span class="free">W</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subspace_sum <span class="free">W1</span> <span class="free">W2</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">W</span> <span class="main">⟷</span> <span class="free">W1</span> <span class="main">⊆</span> <span class="free">W</span> <span class="main">∧</span> <span class="free">W2</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 h2 h3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_is_minimal<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> subspace_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> span_is_subspace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subspace <span class="free">K</span> <span class="main">(</span>span <span class="free">S</span><span class="main">)</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"vectorspace <span class="free">K</span> <span class="free">V</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">K</span> <span class="main">(</span>span <span class="free">S</span><span class="main">)</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> span_is_submodule<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 0 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> subspace_def mod_hom_def linear_map_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Facts specific to vector spaces›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If $av = w$ and $a\neq 0$, $v=a^{-1}w$.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> mult_inverse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span>carrier <span class="free">K</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span>carrier <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="free">v</span> <span class="main">=</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="free">a</span> <span class="main">)</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1 h2 h3 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main">∈</span>carrier <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> h3 1 <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="free">a</span> <span class="main">)</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">a</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span><span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="free">a</span> <span class="main">)</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span><span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> h1 h4 <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="free">a</span><span class="main">∈</span>carrier <span class="free">K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">interpret</span></span> g<span class="main">:</span> group <span class="quoted"><span class="quoted">"<span class="main">(</span>units_group <span class="free">K</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> units_form_group<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"field <span class="free">K</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> f h1 h4 <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span>Units <span class="free">K</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> field_def field_axioms_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 4 h1 h4 <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Units_l_inv<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 5 <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="free">a</span> <span class="main">)</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">a</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword1"><span class="command">from</span></span> h1 h2 h4 <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="free">a</span> <span class="main">)</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="free">a</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span><span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="free">a</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="free">a</span><span class="main">)</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smult_assoc1<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 5 h2 <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="free">a</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="free">a</span><span class="main">)</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 7 8 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> 2 6 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If $w\in S$ and $\sum_{w\in S} a_ww=0$, we have $v=\sum_{w\not\in S}a_v^{-1}a_ww$›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> lincomb_isolate<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">v</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">A</span><span class="main">→</span>carrier <span class="free">K</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span><span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">v</span> <span class="main">≠</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="free">a</span> <span class="free">A</span><span class="main">=</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">=</span>lincomb <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">a</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="free">a</span> <span class="bound">w</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span> span <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1 h2 h3 h4 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="free">a</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="free">v</span><span class="main">)</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="free">v</span><span class="main">)</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> lincomb <span class="free">a</span> <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lincomb_del2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span><span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="free">v</span><span class="main">)</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="free">v</span><span class="main">)</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> lincomb <span class="free">a</span> <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h6<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h1 h2 h3 <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="free">a</span> <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span>carrier <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="comment1">(*intro lincomb_closed*)</span>
  <span class="keyword1"><span class="command">from</span></span> 2 h1 h2 h3 h4 <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> lincomb <span class="free">a</span> <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="free">v</span><span class="main">)</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="free">v</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> M.minus_equality<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">a</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> lincomb <span class="free">a</span> <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword1"><span class="command">from</span></span> h2 h3 h4 h5 3 <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">a</span> <span class="free">v</span><span class="main">)</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> lincomb <span class="free">a</span> <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_inverse<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">a</span> <span class="free">v</span><span class="main">)</span><span class="main">∈</span>carrier <span class="free">K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms 5 8 <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">a</span> <span class="free">v</span><span class="main">)</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> lincomb <span class="free">a</span> <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">=</span> <span class="main">(</span><span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">a</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> lincomb <span class="free">a</span> <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smult_assoc_simp smult_minus_1_back r_minus<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 7 9 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 11 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">a</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∈</span> carrier <span class="free">K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 12<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">a</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="free">a</span> <span class="bound">w</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">a</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> lincomb <span class="free">a</span> <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> lincomb_smult<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 6 12 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">=</span>lincomb <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="main">(</span><span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">a</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="free">a</span> <span class="bound">w</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span> span <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> span_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 11 ring_subset_carrier<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The map $(S\to K)\mapsto V$ given by $(a_v)_{v\in S}\mapsto \sum_{v\in S} a_v v$ is linear.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> lincomb_is_linear<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"linear_map <span class="free">K</span> <span class="main">(</span>func_space <span class="free">S</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> lincomb <span class="bound">a</span> <span class="free">S</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"vectorspace <span class="free">K</span> <span class="free">V</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> h h2 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"mod_hom <span class="free">K</span> <span class="main">(</span>func_space <span class="free">S</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> lincomb <span class="bound">a</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lincomb_is_mod_hom<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 0 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> vectorspace_def mod_hom_def linear_map_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic facts about span and linear independence›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If $S$ is linearly independent, then $v\in \text{span}S$ iff $S\cup \{v\}$ is linearly 
dependent.›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> lin_dep_iff_in_span<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">v</span> <span class="free">S</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> carrier <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span> carrier <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∉</span><span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span> span <span class="free">S</span> <span class="main">⟷</span> lin_dep <span class="main">(</span><span class="free">S</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span><span class="var">?T</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> h1 h3 <span class="keyword1"><span class="command">have</span></span> h1_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="main">⊆</span> carrier <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"lin_dep <span class="var">?T</span> <span class="main">⟹</span> <span class="free">v</span><span class="main">∈</span> span <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword3"><span class="command">assume</span></span> a11<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_dep <span class="var">?T</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> a11 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>finite <span class="skolem">A</span> <span class="main">∧</span> <span class="skolem">A</span><span class="main">⊆</span><span class="var">?T</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">a</span><span class="main">∈</span> <span class="main">(</span><span class="skolem">A</span><span class="main">→</span>carrier <span class="free">K</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>lincomb <span class="skolem">a</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">w</span><span class="main">∈</span><span class="skolem">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">a</span> <span class="skolem">w</span><span class="main">≠</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lin_dep_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms a <span class="keyword1"><span class="command">have</span></span> nz2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">∈</span><span class="skolem">A</span><span class="main">-</span><span class="free">S</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">v</span><span class="main">≠</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> lincomb_must_include<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?v</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">w</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?T</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">S</span></span></span><span class="main"><span class="main"><span class="main">∪</span></span></span><span class="main"><span class="main"><span class="main">{</span></span></span><span class="free"><span class="free"><span class="free">v</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> a nz2 <span class="keyword1"><span class="command">have</span></span> singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">=</span><span class="skolem">A</span><span class="main">-</span><span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> singleton nz2 <span class="keyword1"><span class="command">have</span></span> nz3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="free">v</span><span class="main">≠</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="comment1">(*Can modularize this whole section out. "solving for one variable"*)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">a</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">a</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> singleton <span class="keyword1"><span class="command">have</span></span> Ains<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">A</span><span class="main">∩</span><span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">A</span><span class="main">-</span><span class="main">{</span><span class="free">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms a singleton nz3 <span class="keyword1"><span class="command">have</span></span> a31<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">=</span> lincomb <span class="var">?b</span> <span class="main">(</span><span class="skolem">A</span><span class="main">∩</span><span class="free">S</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Ains<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> lincomb_isolate<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> a a31 nz3 singleton <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> span_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">∩</span><span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> m_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span> <span class="main">(</span>span <span class="free">S</span><span class="main">)</span> <span class="main">⟹</span> lin_dep <span class="var">?T</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword3"><span class="command">assume</span></span> inspan<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span> <span class="main">(</span>span <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> inspan <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">⊆</span><span class="free">S</span> <span class="main">∧</span> finite <span class="skolem">A</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span> <span class="main">=</span> lincomb <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">→</span>carrier <span class="free">K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> span_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">w</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span><span class="bound">w</span><span class="main">=</span><span class="free">v</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="keyword1">else</span> <span class="skolem">a</span> <span class="bound">w</span>"</span></span> <span class="comment1">(*consider -v + \sum a_w w*)</span>
    <span class="keyword1"><span class="command">have</span></span> lc0<span class="main">:</span> <span class="quoted"><span class="quoted">" lincomb <span class="var">?b</span> <span class="main">(</span><span class="skolem">A</span><span class="main">∪</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span><span class="main">=</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
      <span class="keyword1"><span class="command">from</span></span> assms a <span class="keyword1"><span class="command">have</span></span> lc_ins<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="var">?b</span> <span class="main">(</span><span class="skolem">A</span><span class="main">∪</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="var">?b</span> <span class="free">v</span><span class="main">)</span> <span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="free">v</span><span class="main">)</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> lincomb <span class="var">?b</span> <span class="skolem">A</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> lincomb_insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> assms a <span class="keyword1"><span class="command">have</span></span> lc_elim<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="var">?b</span> <span class="skolem">A</span><span class="main">=</span>lincomb <span class="skolem">a</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> lincomb_elim_if<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> assms lc_ins lc_elim a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M.l_neg smult_minus_1<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span>  a lc0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> lin_dep_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">∪</span><span class="main">{</span><span class="free">v</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> a1 a2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If $v\in \text{span} A$ then $\text{span}A =\text{span}(A\cup \{v\})$›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> already_in_span<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  inC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> inspan<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span>span <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"span <span class="free">A</span><span class="main">=</span> span <span class="main">(</span><span class="free">A</span><span class="main">∪</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> inC inspan <span class="keyword1"><span class="command">have</span></span> dir1<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="free">A</span> <span class="main">⊆</span> span <span class="main">(</span><span class="free">A</span><span class="main">∪</span><span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> span_is_monotone<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> inC <span class="keyword1"><span class="command">have</span></span> inown<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span>span <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_own_span<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> inC <span class="keyword1"><span class="command">have</span></span> subm<span class="main">:</span> <span class="quoted"><span class="quoted">"submodule <span class="free">K</span> <span class="main">(</span>span <span class="free">A</span><span class="main">)</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> span_is_submodule<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> inown inspan subm <span class="keyword1"><span class="command">have</span></span> dir2<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> span <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> span_is_subset<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 

  <span class="keyword1"><span class="command">from</span></span> dir1 dir2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Replacement Theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If $A,B\subseteq V$ are finite, $A$ is linearly independent, $B$ generates $W$, 
and $A\subseteq W$, then there exists $C\subseteq V$ disjoint from $A$ such that
$\text{span}(A\cup C) = W$ and $|C|\le |B|-|A|$. In other words, we can complete
any linearly independent set to a generating set of $W$ by adding at most $|B|-|A|$ more elements.›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> replacement<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span> <span class="comment1">(*A B are lists of vectors (colloquially we refer to them as sets)*)</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="free">A</span>"</span></span> <span class="comment1">(*A is linearly independent*)</span>
      <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span>span <span class="free">B</span>"</span></span> <span class="comment1">(*All entries of A are in K*)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> finite <span class="bound">C</span> <span class="main">∧</span> <span class="bound">C</span><span class="main">⊆</span>carrier <span class="free">V</span> <span class="main">∧</span> <span class="bound">C</span><span class="main">⊆</span>span <span class="free">B</span> <span class="main">∧</span> <span class="bound">C</span><span class="main">∩</span><span class="free">A</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> int <span class="main">(</span>card <span class="bound">C</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>int <span class="main">(</span>card <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>int <span class="main">(</span>card <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>span <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="bound">C</span><span class="main">)</span> <span class="main">=</span> span <span class="free">B</span><span class="main">)</span>"</span></span> 
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="var">?P</span> <span class="free">A</span> <span class="free">B</span> <span class="bound">C</span>"</span></span><span class="main">)</span>
  <span class="comment1">(*There is a set C of cardinality |B| - |A| such that A∪C generates V*)</span>
<span class="keyword1"><span class="command">using</span></span> h1 h2 h3 h4 h5 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"card <span class="free">A</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"0.prems"</span><span class="main">(</span>1<span class="main">)</span> <span class="quoted">"0.hyps"</span> <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"0.prems"</span><span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span><span class="main">⊆</span>span <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_own_span<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a0 a3 <span class="quoted">"0.prems"</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?W</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"span <span class="skolem">B</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> Suc.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> BinC<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="skolem">B</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> span_is_subset2<span class="main">)</span>
  <span class="comment1">(*everything you want to know about A*)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc.prems Suc.hyps BinC <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"lin_indpt <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">⊆</span>span <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">m</span> <span class="main">=</span> card <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="comment1">(*everything you want to know about B*)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc.prems <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="comment1">(*A B are lists of vectors (colloquially we refer to them as sets)*)</span> 
  <span class="keyword1"><span class="command">from</span></span> Suc.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span><span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A'</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">-</span><span class="main">{</span><span class="skolem">v</span><span class="main">}</span>"</span></span>
  <span class="comment1">(*?A' is linearly independent because it is the subset of a linearly independent set, A.*)</span>
  <span class="keyword1"><span class="command">from</span></span> A<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> liA'<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="var">?A'</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> subset_li_is_li<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">A</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?A'</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> v liA' Suc.prems Suc.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C'</span><span class="main">.</span> <span class="var">?P</span> <span class="var">?A'</span> <span class="skolem">B</span> <span class="bound">C'</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> Suc.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C'</span></span> <span class="keyword2"><span class="keyword">where</span></span> C'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?A'</span> <span class="skolem">B</span> <span class="skolem">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span> <span class="skolem">C'</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> vinC'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span><span class="skolem">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">from</span></span> vinC' v <span class="keyword1"><span class="command">have</span></span> seteq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">C'</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">C'</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> C' seteq <span class="keyword1"><span class="command">have</span></span> spaneq<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">C'</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> span <span class="main">(</span><span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
    <span class="keyword1"><span class="command">from</span></span> Suc.prems Suc.hyps C' vinC' v spaneq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">C'</span><span class="main">-</span><span class="main">{</span><span class="skolem">v</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"card <span class="skolem">C'</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∉</span><span class="skolem">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">from</span></span> A v C' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span><span class="main">(</span><span class="var">?A'</span><span class="main">∪</span><span class="skolem">C'</span><span class="main">)</span><span class="main">→</span>carrier <span class="free">K</span> <span class="main">∧</span>  lincomb <span class="bound">a</span> <span class="main">(</span><span class="var">?A'</span> <span class="main">∪</span> <span class="skolem">C'</span><span class="main">)</span> <span class="main">=</span><span class="skolem">v</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_in_span<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="main">(</span><span class="var">?A'</span><span class="main">∪</span><span class="skolem">C'</span><span class="main">)</span><span class="main">→</span>carrier <span class="free">K</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">=</span> lincomb <span class="skolem">a</span> <span class="main">(</span><span class="var">?A'</span> <span class="main">∪</span> <span class="skolem">C'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">w</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span><span class="bound">w</span><span class="main">=</span><span class="skolem">v</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="keyword1">else</span> <span class="skolem">a</span> <span class="bound">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?b</span><span class="main">∈</span><span class="skolem">A</span><span class="main">∪</span><span class="skolem">C'</span><span class="main">→</span>carrier <span class="free">K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> v <span class="keyword1"><span class="command">have</span></span> rewrite_ins<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">∪</span><span class="skolem">C'</span><span class="main">=</span><span class="main">(</span><span class="var">?A'</span><span class="main">∪</span><span class="skolem">C'</span><span class="main">)</span><span class="main">∪</span><span class="main">{</span><span class="skolem">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> f <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∉</span><span class="var">?A'</span><span class="main">∪</span><span class="skolem">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this A C' v a f <span class="keyword1"><span class="command">have</span></span> lcb<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="var">?b</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="skolem">C'</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rewrite_ins<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_insert<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_subset_carrier coeff_in_ring<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_elim_if<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smult_minus_1 l_neg ring_subset_carrier<span class="main">)</span>
<span class="comment1">(*NOTE: l_neg got deleted from the simp rules, but it is very useful.*)</span>
    <span class="keyword1"><span class="command">from</span></span> C' f <span class="keyword1"><span class="command">have</span></span> rewrite_minus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C'</span><span class="main">=</span><span class="main">(</span><span class="skolem">A</span><span class="main">∪</span><span class="skolem">C'</span><span class="main">)</span><span class="main">-</span><span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> A C' b lcb v <span class="keyword1"><span class="command">have</span></span> exw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span><span class="main">∈</span> <span class="skolem">C'</span><span class="main">.</span> <span class="var">?b</span> <span class="bound">w</span><span class="main">≠</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rewrite_minus<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> lincomb_must_include<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?T</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">A</span></span><span class="main"><span class="main">∪</span></span><span class="skolem"><span class="skolem">C'</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?v</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">v</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> exw <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">∈</span> <span class="skolem">C'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="skolem">w</span><span class="main">≠</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> A C' w f b lcb <span class="keyword1"><span class="command">have</span></span> w_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">∈</span>span <span class="main">(</span><span class="main">(</span><span class="skolem">A</span><span class="main">∪</span> <span class="skolem">C'</span><span class="main">)</span> <span class="main">-</span><span class="main">{</span><span class="skolem">w</span><span class="main">}</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> lincomb_isolate<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var"><span class="var"><span class="var">?b</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> spaneq2<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span><span class="skolem">A</span><span class="main">∪</span><span class="main">(</span><span class="skolem">C'</span><span class="main">-</span><span class="main">{</span><span class="skolem">w</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> span <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span><span class="var">?A'</span><span class="main">∪</span><span class="skolem">C'</span><span class="main">)</span> <span class="main">=</span> span <span class="main">(</span><span class="skolem">A</span><span class="main">∪</span> <span class="skolem">C'</span><span class="main">)</span>"</span></span> <span class="comment1">(*adding v doesn't change the span*)</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
          <span class="keyword1"><span class="command">from</span></span> A C' v <span class="keyword1"><span class="command">have</span></span> m1<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span><span class="var">?A'</span><span class="main">∪</span><span class="skolem">C'</span><span class="main">)</span> <span class="main">=</span> span <span class="main">(</span><span class="main">(</span><span class="var">?A'</span><span class="main">∪</span> <span class="skolem">C'</span><span class="main">)</span><span class="main">∪</span><span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> already_in_span<span class="main">)</span> 
             <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> f m1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rewrite_ins<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span><span class="skolem">A</span><span class="main">∪</span> <span class="main">(</span><span class="skolem">C'</span><span class="main">-</span><span class="main">{</span><span class="skolem">w</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> span <span class="main">(</span><span class="skolem">A</span><span class="main">∪</span> <span class="skolem">C'</span><span class="main">)</span>"</span></span> <span class="comment1">(*removing w doesn't change the span*)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
        <span class="keyword1"><span class="command">from</span></span> C' w<span class="main">(</span>1<span class="main">)</span> f <span class="keyword1"><span class="command">have</span></span> b60<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">∪</span> <span class="main">(</span><span class="skolem">C'</span><span class="main">-</span><span class="main">{</span><span class="skolem">w</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A</span><span class="main">∪</span> <span class="skolem">C'</span><span class="main">)</span> <span class="main">-</span><span class="main">{</span><span class="skolem">w</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span>  w<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> b61<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">∪</span> <span class="skolem">C'</span><span class="main">=</span> <span class="main">(</span><span class="skolem">A</span><span class="main">∪</span> <span class="skolem">C'</span> <span class="main">-</span><span class="main">{</span><span class="skolem">w</span><span class="main">}</span><span class="main">)</span><span class="main">∪</span><span class="main">{</span><span class="skolem">w</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> A C'  w_in <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> b61<span class="main">)</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> b60<span class="main">)</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> already_in_span<span class="main">)</span> 
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> C' 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span><span class="comment1">(* "span (A∪(C'-{w})) = span B"*)</span>
    <span class="keyword1"><span class="command">from</span></span> A C' w f v spaneq2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">C'</span><span class="main">-</span><span class="main">{</span><span class="skolem">w</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"card <span class="skolem">C'</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Defining dimension and bases.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finite dimensional is defined as having a finite generating set.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> <span class="entity">fin_dim</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fin_dim</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>finite <span class="bound">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">A</span> <span class="main">⊆</span> carrier <span class="free">V</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>gen_set <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The dimension is the size of the smallest generating set. For equivalent
characterizations see below.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> <span class="entity">dim</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">dim</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>finite <span class="bound">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>card <span class="bound">A</span> <span class="main">=</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">A</span> <span class="main">⊆</span> carrier <span class="free">V</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>gen_set <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>basis›</span></span></span></span> is a linearly independent generating set.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> <span class="entity">basis</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">basis</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>lin_indpt <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>gen_set <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">⊆</span>carrier <span class="free">V</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹From the replacement theorem, any linearly independent set is smaller than any generating set.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> li_smaller_than_gen<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_set <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≤</span> card <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h3 h6 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span>span <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span>  <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> h1 h2 h4 h5 1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">C</span> <span class="main">∧</span> <span class="skolem">C</span><span class="main">⊆</span>carrier <span class="free">V</span> <span class="main">∧</span> <span class="skolem">C</span><span class="main">⊆</span>span <span class="free">B</span> <span class="main">∧</span> <span class="skolem">C</span><span class="main">∩</span><span class="free">A</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> int <span class="main">(</span>card <span class="skolem">C</span><span class="main">)</span> <span class="main">≤</span> int <span class="main">(</span>card <span class="free">B</span><span class="main">)</span> <span class="main">-</span> int <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>span <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">=</span> span <span class="free">B</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> replacement<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The dimension is the cardinality of any basis. (In particular, all bases are the same size.)›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> dim_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span>  fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"basis <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dim <span class="main">=</span> card <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">B</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>finite <span class="bound">B</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>card <span class="bound">B</span> <span class="main">=</span> <span class="bound">m</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">B</span> <span class="main">⊆</span> carrier <span class="free">V</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>gen_set <span class="bound">B</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> card <span class="free">A</span> <span class="main">≤</span> <span class="bound">m</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span> <span class="skolem">m</span> 
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>finite <span class="skolem">B</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>card <span class="skolem">B</span> <span class="main">=</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">B</span> <span class="main">⊆</span> carrier <span class="free">V</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>gen_set <span class="skolem">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> 1 fin h2 <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≤</span> card <span class="skolem">B</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> basis_def<span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> li_smaller_than_gen<span class="main">)</span> 
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="skolem">B</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> fin h2 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> dim_def basis_def<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> Least_equality<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*can define more generally with posets*)</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>maximal›</span></span></span></span> set with respect to $P$ is such that if $B\supseteq A$ and $P$ is also 
satisfied for $B$, then $B=A$.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">maximal</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">maximal</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span><span class="main">⊇</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">B</span> <span class="main">⟶</span> <span class="bound">B</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>minimal›</span></span></span></span> set with respect to $P$ is such that if $B\subseteq A$ and $P$ is also 
satisfied for $B$, then $B=A$.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">minimal</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">minimal</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span><span class="main">⊆</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">B</span> <span class="main">⟶</span> <span class="bound">B</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
 
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A maximal linearly independent set is a generating set.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> max_li_is_gen<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"maximal <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span><span class="main">⊆</span>carrier <span class="free">V</span> <span class="main">∧</span> lin_indpt <span class="bound">S</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gen_set <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>gen_set <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">A</span><span class="main">⊆</span> carrier <span class="free">V</span> <span class="main">∧</span> lin_indpt <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> maximal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> span_is_subset2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 0 1 2 <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span>carrier <span class="free">V</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∉</span> <span class="main">(</span>span <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span>carrier <span class="free">V</span> <span class="main">∧</span> <span class="skolem">v</span> <span class="main">∉</span> <span class="main">(</span>span <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∉</span><span class="free">A</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword1"><span class="command">from</span></span> h1 1 <span class="keyword1"><span class="command">have</span></span> 51<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span>span <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> in_own_span<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 4 51 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> lin_dep_iff_in_span <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">S</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">S</span> <span class="main">⊆</span> carrier <span class="free">V</span><span class="main">∧</span> lin_indpt <span class="bound">S</span> <span class="main">∧</span> <span class="bound">v</span><span class="main">∈</span> carrier <span class="free">V</span> <span class="main">∧</span> <span class="bound">v</span><span class="main">∉</span><span class="bound">S</span>
    <span class="main">∧</span> <span class="bound">v</span><span class="main">∉</span> span <span class="bound">S</span> <span class="main">⟹</span>  <span class="main">(</span>lin_indpt <span class="main">(</span><span class="bound">S</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">v</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 1 4 5 <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> 6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="comment1">(*  assumes h0:"finite S" and h1: "S ⊆ carrier V" and h2: "lin_indpt S" and h3: "v∈ carrier V" and h4: "v∉S"
  shows "v∈ span S ⟷  ¬ (lin_indpt (S ∪ {v}))"*)</span>
  <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>maximal <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span><span class="main">⊆</span>carrier <span class="free">V</span> <span class="main">∧</span> lin_indpt <span class="bound">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword1"><span class="command">from</span></span> 1 4 5 7 <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="free">A</span> <span class="main">⊆</span> <span class="bound">B</span>  <span class="main">∧</span> <span class="bound">B</span> <span class="main">⊆</span> carrier <span class="free">V</span> <span class="main">∧</span> lin_indpt <span class="bound">B</span> <span class="main">∧</span> <span class="bound">B</span> <span class="main">≠</span> <span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∪</span><span class="main">{</span><span class="skolem">v</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
    <span class="keyword1"><span class="command">from</span></span> 8 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> maximal_def<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> h1 9 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A minimal generating set is linearly independent.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> min_gen_is_li<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"minimal <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span><span class="main">⊆</span>carrier <span class="free">V</span> <span class="main">∧</span> gen_set <span class="bound">S</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lin_indpt <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lin_indpt <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">A</span><span class="main">⊆</span> carrier <span class="free">V</span> <span class="main">∧</span> gen_set <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> minimal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="free">A</span> <span class="main">=</span> carrier <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 0 1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    3<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A'</span> <span class="main">∧</span> <span class="skolem">A'</span><span class="main">⊆</span><span class="free">A</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A'</span> <span class="main">→</span> carrier <span class="free">K</span> <span class="main">∧</span> LinearCombinations.module.lincomb <span class="free">V</span> <span class="skolem">a</span> <span class="skolem">A'</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="main">∧</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">A'</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="skolem">v</span> <span class="main">≠</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> lin_dep_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_set <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword1"><span class="command">from</span></span> 1 3 <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span>span <span class="main">(</span><span class="skolem">A'</span><span class="main">-</span><span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> lincomb_isolate<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">a</span></span></span></span>"</span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> v<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">v</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 3 5 <span class="keyword1"><span class="command">have</span></span> 51<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span>span <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> subsetD<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?A</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"span <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">A'</span></span><span class="main"><span class="main">-</span></span><span class="main"><span class="main">{</span></span><span class="skolem"><span class="skolem">v</span></span><span class="main"><span class="main">}</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?B</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"span <span class="main"><span class="main">(</span></span><span class="free"><span class="free">A</span></span><span class="main"><span class="main">-</span></span><span class="main"><span class="main">{</span></span><span class="skolem"><span class="skolem">v</span></span><span class="main"><span class="main">}</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?c</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">v</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> span_is_monotone<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span>span <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> in_own_span<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 1 51 <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> span <span class="main">(</span><span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">)</span><span class="main">∪</span><span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> already_in_span<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span>  <span class="main">(</span><span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">)</span><span class="main">∪</span><span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 2 7 8 <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span><span class="quoted"><span class="quoted">"span <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> carrier <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="comment1">(*can't use 3 directly :( *)</span>
    <span class="keyword1"><span class="command">from</span></span> 9 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>minimal <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span><span class="main">⊆</span>carrier <span class="free">V</span> <span class="main">∧</span> gen_set <span class="bound">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword1"><span class="command">from</span></span> 1 3 4 <span class="keyword1"><span class="command">have</span></span> 11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="free">A</span> <span class="main">⊇</span> <span class="bound">B</span> <span class="main">∧</span> <span class="bound">B</span> <span class="main">⊆</span> carrier <span class="free">V</span> <span class="main">∧</span> gen_set <span class="bound">B</span> <span class="main">∧</span> <span class="bound">B</span> <span class="main">≠</span> <span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="skolem">v</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 11 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> minimal_def<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> h1 10 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Given that some finite set satisfies $P$, there is a minimal set that satisfies $P$.›</span></span>
<span class="keyword1" id="VectorSpace-minimal_exists"><span class="command">lemma</span></span> minimal_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">P</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span><span class="main">⊆</span><span class="free">A</span> <span class="main">∧</span> minimal <span class="bound">B</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> h1 h2 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"card <span class="free">A</span>"</span></span>  <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"card <span class="skolem">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>  
  <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> True less.hyps less.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> minimal_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span>  <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"minimal <span class="skolem">A</span> <span class="free">P</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>minimal <span class="skolem">A</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">from</span></span> less.prems 2 <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="free">P</span> <span class="bound">B</span> <span class="main">∧</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="skolem">A</span> <span class="main">∧</span> <span class="bound">B</span><span class="main">≠</span><span class="skolem">A</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> minimal_def<span class="main">)</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">B</span> <span class="main">∧</span> <span class="skolem">B</span> <span class="main">⊂</span> <span class="skolem">A</span> <span class="main">∧</span> <span class="skolem">B</span><span class="main">≠</span><span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> 4 <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">B</span> <span class="main">&lt;</span> card <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> psubset_card_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> less.hyps less.prems 3 4 5 <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">C</span></span><span class="main">⊆</span><span class="skolem">B</span><span class="main">.</span> minimal <span class="bound">C</span> <span class="free">P</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> less.hyps<span class="main">)</span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rev_finite_subset<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> 6 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span><span class="main">⊆</span><span class="skolem">B</span> <span class="main">∧</span> minimal <span class="skolem">C</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> 4 7 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> minimal_def<span class="main">)</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If $V$ is finite-dimensional, then any linearly independent set is finite.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> fin_dim_li_fin<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fd<span class="main">:</span> <span class="quoted"><span class="quoted">"fin_dim"</span></span> <span class="keyword2"><span class="keyword">and</span></span> li<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> inC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> fd <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">C</span> <span class="main">∧</span> <span class="skolem">C</span><span class="main">⊆</span>carrier <span class="free">V</span> <span class="main">∧</span> gen_set <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> fin_dim_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> A <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span><span class="main">⊆</span><span class="free">A</span><span class="main">∧</span> finite <span class="skolem">B</span> <span class="main">∧</span> card <span class="skolem">B</span> <span class="main">=</span> card <span class="skolem">C</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> infinite_arbitrarily_large<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> B li <span class="keyword1"><span class="command">have</span></span> liB<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="skolem">B</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subset_li_is_li<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?A</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">A</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?B</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">B</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> B C liB inC <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">B</span> <span class="main">≤</span> card <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> li_smaller_than_gen<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> this B <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If $V$ is finite-dimensional (has a finite generating set), then a finite basis exists.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> finite_basis_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"fin_dim"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">β</span><span class="main">.</span> finite <span class="bound">β</span> <span class="main">∧</span> basis <span class="bound">β</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span> <span class="main">∧</span> <span class="skolem">A</span><span class="main">⊆</span>carrier <span class="free">V</span> <span class="main">∧</span> gen_set <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fin_dim_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">β</span><span class="main">.</span> <span class="bound">β</span><span class="main">⊆</span><span class="skolem">A</span> <span class="main">∧</span> minimal <span class="bound">β</span> <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span><span class="main">⊆</span>carrier <span class="free">V</span> <span class="main">∧</span> gen_set <span class="bound">S</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> minimal_exists<span class="main">)</span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">β</span></span> <span class="keyword2"><span class="keyword">where</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span><span class="main">⊆</span><span class="skolem">A</span> <span class="main">∧</span> minimal <span class="skolem">β</span> <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span><span class="main">⊆</span>carrier <span class="free">V</span> <span class="main">∧</span> gen_set <span class="bound">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="skolem">β</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> min_gen_is_li<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_set <span class="skolem">β</span> <span class="main">∧</span> <span class="skolem">β</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> minimal_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 1 3 <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">β</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> basis_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The proof is as follows.
\begin{enumerate}
\item Because $V$ is finite-dimensional, there is a finite generating set 
(we took this as our definition of finite-dimensional).
\item Hence, there is a minimal $\beta \subseteq A$ such that $\beta$ generates $V$.
\item $\beta$ is linearly independent because a minimal generating set is linearly independent.
\end{enumerate}
Finally, $\beta$ is a basis because it is both generating and linearly independent.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Any linearly independent set has cardinality at most equal to the dimension.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> li_le_dim<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fd<span class="main">:</span> <span class="quoted"><span class="quoted">"fin_dim"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≤</span> dim"</span></span>
<span class="keyword1"><span class="command">proof</span></span>  <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> fd c l <span class="keyword3"><span class="command">show</span></span> fa<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fin_dim_li_fin<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> fd <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">β</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">β</span> <span class="main">∧</span> basis <span class="skolem">β</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_basis_exists<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms fa 1 <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≤</span> card <span class="skolem">β</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> li_smaller_than_gen<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> basis_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms 1 <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"dim <span class="main">=</span> card <span class="skolem">β</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dim_basis<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 2 3 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≤</span> dim"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Any generating set has cardinality at least equal to the dimension.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> gen_ge_dim<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fa<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_set <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≥</span> dim"</span></span>
<span class="keyword1"><span class="command">proof</span></span>  <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> fd<span class="main">:</span> <span class="quoted"><span class="quoted">"fin_dim"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> fin_dim_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> fd <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">β</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">β</span> <span class="main">∧</span> basis <span class="skolem">β</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_basis_exists<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms 1 <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≥</span> card <span class="skolem">β</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> li_smaller_than_gen<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> basis_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms 1 <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"dim <span class="main">=</span> card <span class="skolem">β</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dim_basis<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 2 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If there is an upper bound on the cardinality of sets satisfying $P$, then there is a maximal
set satisfying $P$.›</span></span>
<span class="keyword1" id="VectorSpace-maximal_exists"><span class="command">lemma</span></span> maximal_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="free">B</span> <span class="free">N</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> maxc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">A</span> <span class="main">⟹</span> finite <span class="bound">A</span> <span class="main">∧</span> <span class="main">(</span>card <span class="bound">A</span> <span class="main">≤</span><span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">A</span><span class="main">.</span> finite <span class="bound">A</span> <span class="main">∧</span> maximal <span class="bound">A</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="comment1">(*take the maximal*)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">{</span>card <span class="bound">A</span><span class="main">|</span> <span class="bound">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">A</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"Max <span class="var">?S</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> maxc <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="var">?S</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_nat_set_iff_bounded_le<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?n</span><span class="main">∈</span><span class="var">?S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Collect_empty_eq Max_in b<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> assms 2 <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">A</span> <span class="main">∧</span> finite <span class="bound">A</span> <span class="main">∧</span> card <span class="bound">A</span> <span class="main">=</span> <span class="var">?n</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">A</span> <span class="main">∧</span> finite <span class="skolem">A</span> <span class="main">∧</span> card <span class="skolem">A</span> <span class="main">=</span> <span class="var">?n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 1 maxc <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">A</span> <span class="main">⟹</span> finite <span class="bound">A</span> <span class="main">∧</span> <span class="main">(</span>card <span class="bound">A</span> <span class="main">≤</span><span class="var">?n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Max.coboundedI mem_Collect_eq<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> 4 5 <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"maximal <span class="skolem">A</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> maximal_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_seteq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 4 6 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Any maximal linearly independent set is a basis.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> max_li_is_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"maximal <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span><span class="main">⊆</span>carrier <span class="free">V</span> <span class="main">∧</span> lin_indpt <span class="bound">S</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"basis <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_set <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> max_li_is_gen<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> basis_def maximal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Any minimal linearly independent set is a generating set.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> min_gen_is_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"minimal <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span><span class="main">⊆</span>carrier <span class="free">V</span> <span class="main">∧</span> gen_set <span class="bound">S</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"basis <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> min_gen_is_li<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> basis_def minimal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Any linearly independent set with cardinality at least the dimension is a basis.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> dim_li_is_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fd<span class="main">:</span> <span class="quoted"><span class="quoted">"fin_dim"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fa<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ca<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> li<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="free">A</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≥</span> dim"</span></span> <span class="comment1">(*≥*)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"basis <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> fd <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span><span class="main">⊆</span>carrier <span class="free">V</span> <span class="main">∧</span> lin_indpt <span class="bound">S</span> <span class="main">⟹</span> finite <span class="bound">S</span> <span class="main">∧</span> card <span class="bound">S</span> <span class="main">≤</span>dim"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> li_le_dim<span class="main">)</span>
<span class="comment1">(*fin_dim_li_fin*)</span>
  <span class="keyword1"><span class="command">from</span></span> 0 assms <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span>  <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">∧</span> maximal <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span>  <span class="bound">S</span><span class="main">⊆</span>carrier <span class="free">V</span> <span class="main">∧</span> lin_indpt <span class="bound">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> maximal_def<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_seteq eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> max_li_is_basis<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Any generating set with cardinality at most the dimension is a basis.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> dim_gen_is_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fa<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ca<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> li<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_set <span class="free">A</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≤</span> dim"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"basis <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">S</span><span class="main">.</span> finite <span class="bound">S</span><span class="main">∧</span> <span class="bound">S</span><span class="main">⊆</span>carrier <span class="free">V</span> <span class="main">∧</span> gen_set <span class="bound">S</span> <span class="main">⟹</span> card <span class="bound">S</span> <span class="main">≥</span>dim"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> gen_ge_dim<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="comment1">(*li_le_dim*)</span>
  <span class="keyword1"><span class="command">from</span></span> 0 assms <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span>  <span class="quoted"><span class="quoted">"minimal <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> finite <span class="bound">S</span> <span class="main">∧</span> <span class="bound">S</span><span class="main">⊆</span>carrier <span class="free">V</span> <span class="main">∧</span> gen_set <span class="bound">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> minimal_def<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_seteq eq_iff<span class="main">)</span>
  <span class="comment1">(*slightly annoying: we have to get rid of "finite S" inside.*)</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">B</span> <span class="main">⊆</span> carrier <span class="free">V</span> <span class="main">∧</span> LinearCombinations.module.gen_set <span class="free">K</span> <span class="free">V</span> <span class="bound">B</span> <span class="main">⟹</span> <span class="bound">B</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">B</span> <span class="main">⊆</span> carrier <span class="free">V</span> <span class="main">∧</span> LinearCombinations.module.gen_set <span class="free">K</span> <span class="free">V</span> <span class="skolem">B</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> asm h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> minimal_def<span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> finite_subset<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?A</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">B</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?B</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">A</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> h1 asm this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> minimal_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> h1 h <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"minimal <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span><span class="main">⊆</span>carrier <span class="free">V</span> <span class="main">∧</span> gen_set <span class="bound">S</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> minimal_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> min_gen_is_basis<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹$\beta$ is a basis iff for all $v\in V$, there exists a unique $(a_v)_{v\in S}$ such that
$\sum_{v\in S} a_v v=v$.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vectorspace<span class="main">)</span> basis_criterion<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A_fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> AinC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"basis <span class="free">A</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span> carrier <span class="free">V</span> <span class="main">⟶</span><span class="main">(</span><span class="main">∃!</span> <span class="bound">a</span><span class="main">.</span>  <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> carrier <span class="free">K</span> <span class="main">∧</span> lincomb <span class="bound">a</span> <span class="free">A</span> <span class="main">=</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span>  <span class="bound">v</span><span class="main">∈</span> carrier <span class="free">V</span> <span class="main">⟶</span><span class="main">(</span><span class="main">∃!</span> <span class="bound">a</span><span class="main">.</span>  <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> carrier <span class="free">K</span> <span class="main">∧</span> lincomb <span class="bound">a</span> <span class="free">A</span> <span class="main">=</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span>basis <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span>  <span class="bound">v</span><span class="main">∈</span> carrier <span class="free">V</span> <span class="main">⟶</span><span class="main">(</span><span class="main">∃!</span> <span class="bound">a</span><span class="main">.</span>  <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> carrier <span class="free">K</span> <span class="main">∧</span> lincomb <span class="bound">a</span> <span class="free">A</span> <span class="main">=</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span> carrier <span class="free">V</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃!</span> <span class="bound">a</span><span class="main">.</span>  <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> carrier <span class="free">K</span> <span class="main">∧</span> lincomb <span class="bound">a</span> <span class="free">A</span> <span class="main">=</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="comment1">(*either there is more than 1 rep, or no reps*)</span>
    <span class="keyword1"><span class="command">from</span></span> v <span class="keyword1"><span class="command">have</span></span> vinC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span>carrier <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> v <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span> <span class="bound">a</span><span class="main">.</span>  <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> carrier <span class="free">K</span> <span class="main">∧</span> lincomb <span class="bound">a</span> <span class="free">A</span> <span class="main">=</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∨</span>  <span class="main">(</span><span class="main">∃</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> 
      <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> carrier <span class="free">K</span> <span class="main">∧</span> lincomb <span class="bound">a</span> <span class="free">A</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> carrier <span class="free">K</span> <span class="main">∧</span> lincomb <span class="bound">b</span> <span class="free">A</span> <span class="main">=</span> <span class="skolem">v</span> 
      <span class="main">∧</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span> <span class="bound">a</span><span class="main">.</span>  <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> carrier <span class="free">K</span> <span class="main">∧</span> lincomb <span class="bound">a</span> <span class="free">A</span> <span class="main">=</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> A_fin AinC <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="main">→</span> carrier <span class="free">K</span> <span class="main">⟹</span> lincomb <span class="bound">a</span> <span class="free">A</span> <span class="main">=</span> lincomb <span class="main">(</span>restrict <span class="bound">a</span> <span class="free">A</span><span class="main">)</span> <span class="free">A</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> lincomb_def restrict_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> finsum_cong <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_subset_carrier coeff_in_ring<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span> <span class="bound">a</span><span class="main">.</span>  <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="main">→</span> carrier <span class="free">K</span> <span class="main">∧</span> lincomb <span class="bound">a</span> <span class="free">A</span> <span class="main">=</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> A_fin AinC <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∉</span>span <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> finite_in_span <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">with</span></span> AinC v <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>basis <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> basis_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> 
        <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> carrier <span class="free">K</span> <span class="main">∧</span> lincomb <span class="bound">a</span> <span class="free">A</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> carrier <span class="free">K</span> <span class="main">∧</span> lincomb <span class="bound">b</span> <span class="free">A</span> <span class="main">=</span> <span class="skolem">v</span> 
        <span class="main">∧</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> carrier <span class="free">K</span> <span class="main">∧</span> lincomb <span class="skolem">a</span> <span class="free">A</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> carrier <span class="free">K</span> <span class="main">∧</span> lincomb <span class="skolem">b</span> <span class="free">A</span> <span class="main">=</span> <span class="skolem">v</span> 
        <span class="main">∧</span> <span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">from</span></span> ab <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">∈</span><span class="free">A</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="skolem">w</span> <span class="main">≠</span> <span class="skolem">b</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> PiE_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> extensionalityI<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">b</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> ab <span class="keyword1"><span class="command">have</span></span> a_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">A</span> <span class="main">→</span> carrier <span class="free">K</span>"</span></span> 
               <span class="keyword2"><span class="keyword">and</span></span> b_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">A</span> <span class="main">→</span> carrier <span class="free">K</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> PiE_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> w a_fun b_fun <span class="keyword1"><span class="command">have</span></span> abinC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">w</span> <span class="main">∈</span>carrier <span class="free">K</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">w</span> <span class="main">∈</span>carrier <span class="free">K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">from</span></span> abinC w <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">w</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="skolem">b</span> <span class="skolem">w</span> <span class="main">≠</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="comment1">(*uses M.minus_other_side*)</span>
      <span class="keyword1"><span class="command">from</span></span> A_fin AinC a_fun b_fun ab vinC <span class="keyword1"><span class="command">have</span></span> a_b<span class="main">:</span>
      <span class="quoted"><span class="quoted">"LinearCombinations.module.lincomb <span class="free">V</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="skolem">a</span> <span class="bound">x</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="skolem">b</span> <span class="bound">x</span> <span class="keyword1">else</span> undefined<span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> lincomb_cong <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_in_ring lincomb_diff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> A_fin AinC ab w v nz a_b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lin_dep <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> lin_dep_crit<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?A</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">A</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?a</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?c</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?v</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">w</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PiE_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>basis <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> basis_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span> carrier <span class="free">V</span> <span class="main">⟶</span><span class="main">(</span><span class="main">∃!</span> <span class="bound">a</span><span class="main">.</span>  <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> carrier <span class="free">K</span> <span class="main">∧</span> lincomb <span class="bound">a</span> <span class="free">A</span> <span class="main">=</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> basis <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span> carrier <span class="free">V</span> <span class="main">⟶</span><span class="main">(</span><span class="main">∃!</span> <span class="bound">a</span><span class="main">.</span>  <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> carrier <span class="free">K</span> <span class="main">∧</span> lincomb <span class="bound">a</span> <span class="free">A</span> <span class="main">=</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span> carrier <span class="free">V</span> <span class="main">⟶</span><span class="main">(</span><span class="main">∃!</span> <span class="bound">a</span><span class="main">.</span>  <span class="var">?Q</span> <span class="bound">a</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> b1 <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span>  <span class="bound">v</span><span class="main">∈</span> carrier <span class="free">V</span> <span class="main">⟶</span><span class="main">(</span><span class="main">∃</span> <span class="bound">a</span><span class="main">.</span>  <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="main">→</span> carrier <span class="free">K</span> <span class="main">∧</span> lincomb <span class="bound">a</span> <span class="free">A</span> <span class="main">=</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> PiE_def<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">from</span></span> A_fin AinC b2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gen_set <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> span_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> b1 <span class="keyword1"><span class="command">have</span></span> A_li<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="keyword1">else</span> undefined<span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">from</span></span> A_fin AinC <span class="keyword1"><span class="command">have</span></span> zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="var">?z</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> PiE_def extensional_def lincomb_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_subset_carrier<span class="main">)</span>
        <span class="comment1">(*uses finsum_all0*)</span>
      <span class="keyword1"><span class="command">from</span></span> A_fin AinC <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_lin_indpt2<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
        <span class="keyword3"><span class="command">assume</span></span> a_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> carrier <span class="free">K</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          lc_a<span class="main">:</span> <span class="quoted"><span class="quoted">"LinearCombinations.module.lincomb <span class="free">V</span> <span class="skolem">a</span> <span class="free">A</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> a_fun <span class="keyword1"><span class="command">have</span></span> a_res<span class="main">:</span> <span class="quoted"><span class="quoted">"restrict <span class="skolem">a</span> <span class="free">A</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> carrier <span class="free">K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> a_fun A_fin AinC lc_a <span class="keyword1"><span class="command">have</span></span> 
          lc_a_res<span class="main">:</span> <span class="quoted"><span class="quoted">"LinearCombinations.module.lincomb <span class="free">V</span> <span class="main">(</span>restrict <span class="skolem">a</span> <span class="free">A</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> lincomb_def restrict_def<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> finsum_cong2 <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_in_ring ring_subset_carrier<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> a_fun a_res lc_a_res zero b1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="skolem">a</span> <span class="free">A</span> <span class="main">=</span> <span class="var">?z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> restrict_def<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> A_gen<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_set <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
      <span class="keyword1"><span class="command">from</span></span> AinC <span class="keyword1"><span class="command">have</span></span> dir1<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="free">A</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> span_is_subset2<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> dir2<span class="main">:</span> <span class="quoted"><span class="quoted">"carrier <span class="free">V</span><span class="main">⊆</span>span <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
        <span class="keyword3"><span class="command">assume</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span>carrier <span class="free">V</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> v b2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">A</span> <span class="main">→</span> carrier <span class="free">K</span> <span class="main">∧</span> lincomb <span class="skolem">a</span> <span class="free">A</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this A_fin AinC <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span>span <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> finite_span<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> dir1 dir2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> A_li A_gen AinC <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"basis <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> basis_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">satx</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> linear_map<span class="main">)</span> surj_imp_imT_carrier<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> surj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span><span class="main">`</span> <span class="main">(</span>carrier <span class="free">V</span><span class="main">)</span> <span class="main">=</span> carrier <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>imT<span class="main">)</span> <span class="main">=</span> carrier <span class="free">W</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> surj im_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The rank-nullity (dimension) theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If $V$ is finite-dimensional and $T:V\to W$ is a linear map, then $\text{dim}(\text{im}(T))+
\text{dim}(\text{ker}(T)) = \text{dim} V$. Moreover, we prove that if $T$ is surjective 
  linear-map between $V$ and $W$, where $V$ is finite-dimensional, then also $W$ is finite-dimensional.›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> linear_map<span class="main">)</span> rank_nullity_main<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> fd<span class="main">:</span> <span class="quoted"><span class="quoted">"V.fin_dim"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vectorspace.dim <span class="free">K</span> <span class="main">(</span>W.vs imT<span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>vectorspace.dim <span class="free">K</span> <span class="main">(</span>V.vs kerT<span class="main">)</span><span class="main">)</span> <span class="main">=</span> V.dim"</span></span>       
    <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="main">(</span>carrier <span class="free">V</span><span class="main">)</span> <span class="main">=</span> carrier <span class="free">W</span> <span class="main">⟹</span> W.fin_dim"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="comment1">― ‹First interpret kerT, imT as vectorspaces›</span>
  <span class="keyword1"><span class="command">have</span></span> subs_ker<span class="main">:</span> <span class="quoted"><span class="quoted">"subspace <span class="free">K</span> kerT <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> kerT_is_subspace<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> subs_ker <span class="keyword1"><span class="command">have</span></span> vs_ker<span class="main">:</span> <span class="quoted"><span class="quoted">"vectorspace <span class="free">K</span> <span class="main">(</span>V.vs kerT<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> V.subspace_is_vs<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> vs_ker <span class="keyword1"><span class="command">interpret</span></span> ker<span class="main">:</span> vectorspace <span class="quoted"><span class="free">K</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>V.vs kerT<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> kerInC<span class="main">:</span> <span class="quoted"><span class="quoted">"kerT<span class="main">⊆</span>carrier <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> ker_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> subs_im<span class="main">:</span> <span class="quoted"><span class="quoted">"subspace <span class="free">K</span> imT <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> imT_is_subspace<span class="main">)</span>  
  <span class="keyword1"><span class="command">from</span></span> subs_im <span class="keyword1"><span class="command">have</span></span> vs_im<span class="main">:</span> <span class="quoted"><span class="quoted">"vectorspace <span class="free">K</span> <span class="main">(</span>W.vs imT<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> W.subspace_is_vs<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> vs_im <span class="keyword1"><span class="command">interpret</span></span> im<span class="main">:</span> vectorspace <span class="quoted"><span class="free">K</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>W.vs imT<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> imInC<span class="main">:</span> <span class="quoted"><span class="quoted">"imT<span class="main">⊆</span>carrier <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> im_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="comment1">(* obvious fact *)</span>
  <span class="keyword1"><span class="command">have</span></span> zero_same<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟬</span><span class="hidden">⇘</span><sub>V.vs kerT</sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ker_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="comment1">― ‹Show ker T has a finite basis. This is not obvious. Show that any linearly independent set 
has size at most that of V. There exists a maximal linearly independent set, which is the basis.›</span>
  <span class="keyword1"><span class="command">have</span></span> every_li_small<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">A</span> <span class="main">⊆</span> kerT<span class="main">)</span><span class="main">∧</span> ker.lin_indpt <span class="bound">A</span> <span class="main">⟹</span> 
    finite <span class="bound">A</span> <span class="main">∧</span> card <span class="bound">A</span> <span class="main">≤</span> V.dim"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span>
    <span class="keyword3"><span class="command">assume</span></span> eli_asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">A</span> <span class="main">⊆</span> kerT<span class="main">)</span><span class="main">∧</span> ker.lin_indpt <span class="skolem">A</span>"</span></span>
    <span class="comment1">(*annoying: I can't just use subst V.module.span_li_not_depend(2) in the show ?thesis 
    statement because it doesn't appear in the conclusion.*)</span>
    <span class="keyword1"><span class="command">note</span></span> V.module.span_li_not_depend<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?N</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"kerT"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="var">?S</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">A</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">from</span></span> this subs_ker fd eli_asm kerInC <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="skolem">A</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> V.li_le_dim<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> every_li_small <span class="keyword1"><span class="command">have</span></span> exA<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">A</span><span class="main">.</span> finite <span class="bound">A</span> <span class="main">∧</span> maximal <span class="bound">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span><span class="main">⊆</span>carrier <span class="main">(</span>V.vs kerT<span class="main">)</span> <span class="main">∧</span> ker.lin_indpt <span class="bound">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> maximal_exists<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?N</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"V.dim"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?B</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> ker.lin_dep_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> exA <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">" finite <span class="skolem">A</span> <span class="main">∧</span> maximal <span class="skolem">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span><span class="main">⊆</span>carrier <span class="main">(</span>V.vs kerT<span class="main">)</span> <span class="main">∧</span> ker.lin_indpt <span class="bound">S</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> finA<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Ainker<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">⊆</span>carrier <span class="main">(</span>V.vs kerT<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> AinC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> maximal_def ker_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="comment1">― ‹We obtain the basis A of kerT. It is also linearly independent when considered in V rather
than kerT›</span>
  <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> Abasis<span class="main">:</span> <span class="quoted"><span class="quoted">"ker.basis <span class="skolem">A</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ker.max_li_is_basis<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> subs_ker Abasis <span class="keyword1"><span class="command">have</span></span> spanA<span class="main">:</span> <span class="quoted"><span class="quoted">"V.module.span <span class="skolem">A</span> <span class="main">=</span> kerT"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ker.basis_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sym<span class="main"><span class="main">[</span></span><span class="operator">OF</span> V.module.span_li_not_depend<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?N</span><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"kerT"</span></span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Abasis <span class="keyword1"><span class="command">have</span></span> Akerli<span class="main">:</span> <span class="quoted"><span class="quoted">"ker.lin_indpt <span class="skolem">A</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ker.basis_def<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> subs_ker Ainker Akerli <span class="keyword1"><span class="command">have</span></span> Ali<span class="main">:</span> <span class="quoted"><span class="quoted">"V.module.lin_indpt <span class="skolem">A</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> V.module.span_li_not_depend<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">txt</span></span><span class="quoted"><span class="plain_text">‹Use the replacement theorem to find C such that $A\cup C$ is a basis of V.›</span></span>
  <span class="keyword1"><span class="command">from</span></span> fd <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span><span class="main">∧</span> V.basis <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> V.finite_basis_exists<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> B <span class="keyword1"><span class="command">have</span></span> Bfin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Bbasis<span class="main">:</span><span class="quoted"><span class="quoted">"V.basis <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> B <span class="keyword1"><span class="command">have</span></span> Bcard<span class="main">:</span> <span class="quoted"><span class="quoted">"V.dim <span class="main">=</span> card <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> V.dim_basis<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> Bbasis <span class="keyword1"><span class="command">have</span></span> 62<span class="main">:</span> <span class="quoted"><span class="quoted">"V.module.span <span class="skolem">B</span> <span class="main">=</span> carrier <span class="free">V</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> V.basis_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> A Abasis Ali B vs_ker <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> finite <span class="bound">C</span> <span class="main">∧</span> <span class="bound">C</span><span class="main">⊆</span>carrier <span class="free">V</span> <span class="main">∧</span> <span class="bound">C</span><span class="main">⊆</span> V.module.span <span class="skolem">B</span> <span class="main">∧</span> <span class="bound">C</span><span class="main">∩</span><span class="skolem">A</span><span class="main">=</span><span class="main">{}</span> 
      <span class="main">∧</span> int <span class="main">(</span>card <span class="bound">C</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>int <span class="main">(</span>card <span class="skolem">B</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>int <span class="main">(</span>card <span class="skolem">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>V.module.span <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="bound">C</span><span class="main">)</span> <span class="main">=</span> V.module.span <span class="skolem">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> V.replacement<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> vectorspace.basis_def V.basis_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> ker_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹From replacement we got $|C|\leq |B|-|A|$. Equality must actually hold, because no generating set
can be smaller than $B$. Now $A\cup C$ is a maximal generating set, hence a basis; its cardinality
equals the dimension.›</span></span>
  <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹We claim that $T(C)$ is basis for $\text{im}(T)$.›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">C</span> <span class="main">∧</span> <span class="skolem">C</span><span class="main">⊆</span>carrier <span class="free">V</span> <span class="main">∧</span> <span class="skolem">C</span><span class="main">⊆</span> V.module.span <span class="skolem">B</span> <span class="main">∧</span> <span class="skolem">C</span><span class="main">∩</span><span class="skolem">A</span><span class="main">=</span><span class="main">{}</span> 
    <span class="main">∧</span> int <span class="main">(</span>card <span class="skolem">C</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>int <span class="main">(</span>card <span class="skolem">B</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>int <span class="main">(</span>card <span class="skolem">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>V.module.span <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">=</span> V.module.span <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> Cfin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> CinC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> CinspanB<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">C</span><span class="main">⊆</span>V.module.span <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> CAdis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span><span class="main">∩</span><span class="skolem">A</span><span class="main">=</span><span class="main">{}</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> Ccard<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>card <span class="skolem">C</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>int <span class="main">(</span>card <span class="skolem">B</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>int <span class="main">(</span>card <span class="skolem">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ACspanB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>V.module.span <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">=</span> V.module.span <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> C <span class="keyword1"><span class="command">have</span></span> cardLe<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">A</span> <span class="main">+</span> card <span class="skolem">C</span> <span class="main">≤</span> card <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> B C <span class="keyword1"><span class="command">have</span></span> ACgen<span class="main">:</span> <span class="quoted"><span class="quoted">"V.module.gen_set <span class="main">(</span><span class="skolem">A</span><span class="main">∪</span><span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> V.basis_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> finA C ACgen AinC B <span class="keyword1"><span class="command">have</span></span> cardGe<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">A</span><span class="main">∪</span><span class="skolem">C</span><span class="main">)</span> <span class="main">≥</span> card <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> V.li_smaller_than_gen<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> V.basis_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> finA C <span class="keyword1"><span class="command">have</span></span> cardUn<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">A</span><span class="main">∪</span><span class="skolem">C</span><span class="main">)</span><span class="main">≤</span>  card <span class="skolem">A</span> <span class="main">+</span> card <span class="skolem">C</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_commute card_Un_disjoint le_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> cardLe cardUn cardGe Bcard <span class="keyword1"><span class="command">have</span></span> cardEq<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">A</span><span class="main">∪</span><span class="skolem">C</span><span class="main">)</span> <span class="main">=</span> card <span class="skolem">A</span> <span class="main">+</span> card <span class="skolem">C</span>"</span></span> 
    <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">A</span><span class="main">∪</span><span class="skolem">C</span><span class="main">)</span> <span class="main">=</span> card <span class="skolem">B</span>"</span></span> 
    <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">A</span><span class="main">∪</span><span class="skolem">C</span><span class="main">)</span> <span class="main">=</span> V.dim"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Abasis C cardEq <span class="keyword1"><span class="command">have</span></span> disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">∩</span><span class="skolem">C</span><span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> finA AinC C cardEq 62 <span class="keyword1"><span class="command">have</span></span> ACfin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">A</span><span class="main">∪</span><span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ACbasis<span class="main">:</span> <span class="quoted"><span class="quoted">"V.basis <span class="main">(</span><span class="skolem">A</span><span class="main">∪</span><span class="skolem">C</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> V.dim_gen_is_basis<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> lm<span class="main">:</span> <span class="quoted"><span class="quoted">"linear_map <span class="free">K</span> <span class="free">V</span> <span class="free">W</span> <span class="free">T</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Let $C'$ be the image of $C$ under $T$. We will show $C'$ is a basis for $\text{im}(T)$.›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">T</span><span class="main">`</span><span class="skolem">C</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> Cfin <span class="keyword1"><span class="command">have</span></span> C'fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> AinC C <span class="keyword1"><span class="command">have</span></span> cim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?C'</span><span class="main">⊆</span>imT"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> im_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹"There is a subtle detail: we first have to show $T$ is injective on $C$.›</span></span>
  <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹We establish that no nontrivial linear combination of $C$ can have image 0 under $T$, 
because that would mean it is a linear combination of $A$, giving that $A\cup C$ is linearly dependent, 
contradiction. We use this result in 2 ways: (1) if $T$ is not injective on $C$, then we obtain $v$, $w\in C$ 
such that $v-w$ is in the kernel, contradiction, (2) if $T(C)$ is linearly dependent, 
taking the inverse image of that linear combination gives a linear combination of $C$ in the kernel, 
contradiction. Hence $T$ is injective on $C$ and $T(C)$ is linearly independent.›</span></span>
  <span class="keyword1"><span class="command">have</span></span> lc_in_ker<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">d</span> <span class="bound">D</span> <span class="bound">v</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">D</span><span class="main">⊆</span><span class="skolem">C</span><span class="main">;</span> <span class="bound">d</span><span class="main">∈</span><span class="bound">D</span><span class="main">→</span>carrier <span class="free">K</span><span class="main">;</span> <span class="free">T</span> <span class="main">(</span>V.module.lincomb <span class="bound">d</span> <span class="bound">D</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">W</span></sub><span class="hidden">⇙</span><span class="main">;</span> 
    <span class="bound">v</span><span class="main">∈</span><span class="bound">D</span><span class="main">;</span> <span class="bound">d</span> <span class="bound">v</span> <span class="main">≠</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="main">⟧</span><span class="main">⟹</span>False"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="skolem">D</span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span><span class="main">⊆</span><span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">∈</span><span class="skolem">D</span><span class="main">→</span>carrier <span class="free">K</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> T0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">(</span>V.module.lincomb <span class="skolem">d</span> <span class="skolem">D</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">W</span></sub><span class="hidden">⇙</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span><span class="skolem">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dvnz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="skolem">v</span> <span class="main">≠</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> D Cfin <span class="keyword1"><span class="command">have</span></span> Dfin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">D</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> D CinC <span class="keyword1"><span class="command">have</span></span> DinC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> T0 d Dfin DinC <span class="keyword1"><span class="command">have</span></span> lc_d<span class="main">:</span> <span class="quoted"><span class="quoted">"V.module.lincomb <span class="skolem">d</span> <span class="skolem">D</span><span class="main">∈</span>kerT"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> ker_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> lc_d spanA AinC <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a'</span> <span class="bound">A'</span><span class="main">.</span> <span class="bound">A'</span><span class="main">⊆</span><span class="skolem">A</span> <span class="main">∧</span> <span class="bound">a'</span><span class="main">∈</span><span class="bound">A'</span><span class="main">→</span>carrier <span class="free">K</span> <span class="main">∧</span>
       V.module.lincomb <span class="bound">a'</span> <span class="bound">A'</span><span class="main">=</span> V.module.lincomb <span class="skolem">d</span> <span class="skolem">D</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> V.module.in_span<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> a'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span><span class="main">⊆</span><span class="skolem">A</span> <span class="main">∧</span> <span class="skolem">a'</span><span class="main">∈</span><span class="skolem">A'</span><span class="main">→</span>carrier <span class="free">K</span> <span class="main">∧</span>
      V.module.lincomb <span class="skolem">d</span> <span class="skolem">D</span> <span class="main">=</span> V.module.lincomb <span class="skolem">a'</span> <span class="skolem">A'</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">hence</span></span>  A'sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span><span class="main">⊆</span><span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a'fun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span><span class="main">∈</span><span class="skolem">A'</span><span class="main">→</span>carrier <span class="free">K</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> a'_lc<span class="main">:</span><span class="quoted"><span class="quoted">"V.module.lincomb <span class="skolem">d</span> <span class="skolem">D</span> <span class="main">=</span> V.module.lincomb <span class="skolem">a'</span> <span class="skolem">A'</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> a' finA Dfin <span class="keyword1"><span class="command">have</span></span> A'fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">A'</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> AinC A'sub <span class="keyword1"><span class="command">have</span></span> A'inC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span><span class="main">⊆</span>carrier <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">v</span> <span class="main">∈</span> <span class="skolem">A'</span> <span class="keyword1">then</span> <span class="skolem">a'</span> <span class="bound">v</span> <span class="keyword1">else</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="skolem">d</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> a'fun d <span class="keyword1"><span class="command">have</span></span> e_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?e</span> <span class="main">∈</span> <span class="skolem">A'</span> <span class="main">∪</span> <span class="skolem">D</span> <span class="main">→</span> carrier <span class="free">K</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Pi_def<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span>
      A'fin Dfin <span class="comment1">(*finiteness*)</span>
      A'inC DinC <span class="comment1">(*in carrier*)</span>
      a'fun d e_fun <span class="comment1">(*coefficients valid*)</span>
      disj D A'sub <span class="comment1">(*A and C disjoint*)</span>
    <span class="keyword1"><span class="command">have</span></span> lccomp1<span class="main">:</span>
      <span class="quoted"><span class="quoted">"V.module.lincomb <span class="skolem">a'</span> <span class="skolem">A'</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> V.module.lincomb <span class="skolem">d</span> <span class="skolem">D</span> <span class="main">=</span> 
        V.module.lincomb <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">v</span><span class="main">∈</span><span class="skolem">A'</span> <span class="keyword1">then</span> <span class="skolem">a'</span> <span class="bound">v</span> <span class="keyword1">else</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="skolem">d</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A'</span><span class="main">∪</span><span class="skolem">D</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sym<span class="main"><span class="main">[</span></span><span class="operator">OF</span> V.module.lincomb_smult<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> V.module.lincomb_union2<span class="main">)</span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span>
      A'fin <span class="comment1">(*finiteness*)</span>
      A'inC <span class="comment1">(*in carrier*)</span>
      a'fun <span class="comment1">(*coefficients valid*)</span>
    <span class="keyword1"><span class="command">have</span></span> lccomp2<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"V.module.lincomb <span class="skolem">a'</span> <span class="skolem">A'</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="main">⊙</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span> V.module.lincomb <span class="skolem">d</span> <span class="skolem">D</span> <span class="main">=</span> 
      <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a'_lc 
        V.module.smult_minus_1  V.module.M.r_neg<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> lccomp1 lccomp2 <span class="keyword1"><span class="command">have</span></span> lc0<span class="main">:</span> <span class="quoted"><span class="quoted">"V.module.lincomb <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">v</span><span class="main">∈</span><span class="skolem">A'</span> <span class="keyword1">then</span> <span class="skolem">a'</span> <span class="bound">v</span> <span class="keyword1">else</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span> <span class="skolem">d</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A'</span><span class="main">∪</span><span class="skolem">D</span><span class="main">)</span>
      <span class="main">=</span><span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> disj a' v D <span class="keyword1"><span class="command">have</span></span> v_nin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∉</span><span class="skolem">A'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> A'fin Dfin <span class="comment1">(*finiteness*)</span>
      A'inC DinC <span class="comment1">(*in carrier*)</span>
      e_fun d <span class="comment1">(*coefficients valid*)</span>
      A'sub D disj <span class="comment1">(*A' D are disjoint subsets*)</span>
      v dvnz <span class="comment1">(*d v is nonzero coefficient*)</span>
      lc0
    <span class="keyword1"><span class="command">have</span></span> AC_ld<span class="main">:</span> <span class="quoted"><span class="quoted">"V.module.lin_dep <span class="main">(</span><span class="skolem">A</span><span class="main">∪</span><span class="skolem">C</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> V.module.lin_dep_crit<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?A</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">A'</span></span><span class="main"><span class="main">∪</span></span><span class="skolem"><span class="skolem">D</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> 
        <span class="var">?S</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">A</span></span><span class="main"><span class="main">∪</span></span><span class="skolem"><span class="skolem">C</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?a</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">v</span></span><span class="main"><span class="main">.</span></span> <span class="keyword1"><span class="keyword1">if</span></span> <span class="bound"><span class="bound">v</span></span><span class="main"><span class="main">∈</span></span><span class="skolem"><span class="skolem">A'</span></span> <span class="keyword1"><span class="keyword1">then</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="bound"><span class="bound">v</span></span> <span class="keyword1"><span class="keyword1">else</span></span> <span class="main"><span class="main">⊖</span></span><span class="hidden">⇘</span><sub><span class="free"><span class="free">K</span></span></sub><span class="hidden">⇙</span><span class="main"><span class="main">𝟭</span></span><span class="hidden">⇘</span><sub><span class="free"><span class="free">K</span></span></sub><span class="hidden">⇙</span><span class="main"><span class="main">⊗</span></span><span class="hidden">⇘</span><sub><span class="free"><span class="free">K</span></span></sub><span class="hidden">⇙</span> <span class="skolem"><span class="skolem">d</span></span> <span class="bound"><span class="bound">v</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?v</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">v</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> integral<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> AC_ld ACbasis <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> V.basis_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> C'_card<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="free">T</span> <span class="skolem">C</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">C</span> <span class="main">=</span> card <span class="var">?C'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">T</span> <span class="skolem">C</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>inj_on <span class="free">T</span> <span class="skolem">C</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span><span class="skolem">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">∈</span><span class="skolem">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">≠</span><span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="skolem">v</span> <span class="main">=</span> <span class="free">T</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> inj_on_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> this CinC <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> lc_in_ker<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?D1</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="skolem"><span class="skolem">v</span></span><span class="main"><span class="main">,</span></span><span class="skolem"><span class="skolem">w</span></span><span class="main"><span class="main">}</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?d1</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="keyword1"><span class="keyword1">if</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">=</span></span><span class="skolem"><span class="skolem">v</span></span> <span class="keyword1"><span class="keyword1">then</span></span> <span class="main"><span class="main">𝟭</span></span><span class="hidden">⇘</span><sub><span class="free"><span class="free">K</span></span></sub><span class="hidden">⇙</span> <span class="keyword1"><span class="keyword1">else</span></span> <span class="main"><span class="main">⊖</span></span><span class="hidden">⇘</span><sub><span class="free"><span class="free">K</span></span></sub><span class="hidden">⇙</span><span class="main"><span class="main">𝟭</span></span><span class="hidden">⇘</span><sub><span class="free"><span class="free">K</span></span></sub><span class="hidden">⇙</span>"</span></span></span>
          <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?v1</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">v</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> V.module.lincomb_def hom_sum ring_subset_carrier 
              W.module.smult_minus_1 r_neg T_im<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this Cfin <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">C</span> <span class="main">=</span> card <span class="var">?C'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_image<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"the_inv_into <span class="skolem">C</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="skolem">C</span> <span class="main">⟹</span> <span class="var">?f</span> <span class="main">(</span><span class="free">T</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">∈</span><span class="var">?C'</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> C'_card<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> the_inv_into_f_f<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f_the_inv_into_f<span class="main">)</span>
<span class="comment1">(*We show C' is a basis for the image. First we show it is linearly independent.*)</span>
  <span class="keyword1"><span class="command">have</span></span> C'_li<span class="main">:</span> <span class="quoted"><span class="quoted">"im.lin_indpt <span class="var">?C'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> Cld<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>im.lin_indpt <span class="var">?C'</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> Cld cim subs_im <span class="keyword1"><span class="command">have</span></span> CldW<span class="main">:</span> <span class="quoted"><span class="quoted">"W.module.lin_dep <span class="var">?C'</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sym<span class="main"><span class="main">[</span></span><span class="operator">OF</span> W.module.span_li_not_depend<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?S</span><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">T</span></span><span class="main"><span class="main">`</span></span><span class="skolem"><span class="skolem">C</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span></span> <span class="var">?N</span><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"imT"</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> C CldW <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c'</span> <span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">c'</span><span class="main">∈</span> <span class="main">(</span><span class="var">?C'</span><span class="main">→</span>carrier <span class="free">K</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>W.module.lincomb <span class="bound">c'</span> <span class="var">?C'</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">W</span></sub><span class="hidden">⇙</span><span class="main">)</span> 
      <span class="main">∧</span> <span class="main">(</span><span class="bound">v'</span><span class="main">∈</span><span class="var">?C'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c'</span> <span class="bound">v'</span><span class="main">≠</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> W.module.finite_lin_dep<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c'</span><span class="main">∈</span> <span class="main">(</span><span class="var">?C'</span><span class="main">→</span>carrier <span class="free">K</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>W.module.lincomb <span class="skolem">c'</span> <span class="var">?C'</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">W</span></sub><span class="hidden">⇙</span><span class="main">)</span> 
      <span class="main">∧</span> <span class="main">(</span><span class="skolem">v'</span><span class="main">∈</span><span class="var">?C'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span> <span class="skolem">v'</span><span class="main">≠</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> c'fun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c'</span><span class="main">∈</span> <span class="main">(</span><span class="var">?C'</span><span class="main">→</span>carrier <span class="free">K</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'lc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>W.module.lincomb <span class="skolem">c'</span> <span class="var">?C'</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">W</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      v'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'</span><span class="main">∈</span><span class="var">?C'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cvnz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c'</span> <span class="skolem">v'</span><span class="main">≠</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">K</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="comment1">(*can't get c' directly with metis/auto with W.module.finite_lin_dep*)</span>
    <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹We take the inverse image of $C'$ under $T$ to get a linear combination of $C$ that is 
in the kernel and hence a linear combination of $A$. This contradicts $A\cup C$ being linearly
independent.›</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">c'</span> <span class="main">(</span><span class="free">T</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> c'fun <span class="keyword1"><span class="command">have</span></span> c_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span><span class="main">∈</span> <span class="skolem">C</span><span class="main">→</span>carrier <span class="free">K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Cfin <span class="comment1">(*C finite*)</span>
      c_fun c'fun <span class="comment1">(*coefficients valid*)</span>
      C'_card <span class="comment1">(*bijective*)</span>
      CinC <span class="comment1">(*C in carrier*)</span>
      f <span class="comment1">(*inverse to T*)</span> 
      c'lc <span class="comment1">(*lc c' = 0*)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">(</span>V.module.lincomb <span class="var">?c</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub><span class="free">W</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> V.module.lincomb_def W.module.lincomb_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> hom_sum<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> finsum_cong <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_subset_carrier coeff_in_ring<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> finsum_reindex<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?f</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">w</span></span><span class="main"><span class="main">.</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="bound"><span class="bound">w</span></span> <span class="main"><span class="main">⊙</span></span><span class="hidden">⇘</span><sub><span class="free"><span class="free">W</span></span></sub><span class="hidden">⇙</span> <span class="bound"><span class="bound">w</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?h</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">T</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?A</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">C</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> f c'fun cvnz v' <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> lc_in_ker<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?D1</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">C</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?d1</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var"><span class="var">?c</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?v1</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var"><span class="var">?f</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">v'</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> C'_gen<span class="main">:</span> <span class="quoted"><span class="quoted">"im.gen_set <span class="var">?C'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword1"><span class="command">have</span></span> C'_span<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="var">?C'</span> <span class="main">=</span> imT"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> cim subs_im <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"W.module.span <span class="var">?C'</span> <span class="main">⊆</span> imT"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> span_is_subset<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> subspace_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"imT<span class="main">⊆</span>W.module.span <span class="var">?C'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
        <span class="keyword3"><span class="command">assume</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">∈</span>imT"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this finA Cfin AinC CinC <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v_inC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span>carrier <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w_eq_T_v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">=</span> <span class="free">T</span> <span class="skolem">v</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> im_def image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> finA Cfin AinC CinC v_inC ACgen <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span>  <span class="bound">a</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">∪</span><span class="skolem">C</span> <span class="main">→</span> carrier <span class="free">K</span><span class="main">∧</span> V.module.lincomb <span class="bound">a</span> <span class="main">(</span><span class="skolem">A</span><span class="main">∪</span><span class="skolem">C</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> V.module.finite_in_span<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
          a_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">∪</span><span class="skolem">C</span> <span class="main">→</span> carrier <span class="free">K</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          lc_a_v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span> V.module.lincomb <span class="skolem">a</span> <span class="main">(</span><span class="skolem">A</span><span class="main">∪</span><span class="skolem">C</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a'</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> finA Cfin AinC CinC a_fun disj Ainker f C'_card <span class="keyword1"><span class="command">have</span></span> Tv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="skolem">v</span> <span class="main">=</span> W.module.lincomb <span class="var">?a'</span> <span class="var">?C'</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lc_a_v<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> V.module.lincomb_union<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="comment1">(*Break up the union A∪C*)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> lincomb_def V.module.lincomb_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> hom_sum<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="comment1">(*Take T inside the sum over A*)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsetD coeff_in_ring
            hom_sum <span class="comment1">(*Take T inside the sum over C*)</span>
            T_ker <span class="comment1">(*all terms become 0 because the vectors are in the kernel.*)</span>
            <span class="main">)</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> finsum_reindex<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?h</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">T</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?f</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">v</span></span><span class="main"><span class="main">.</span></span> <span class="var"><span class="var">?a'</span></span> <span class="bound"><span class="bound">v</span></span><span class="main"><span class="main">⊙</span></span><span class="hidden">⇘</span><sub><span class="free"><span class="free">W</span></span></sub><span class="hidden">⇙</span> <span class="bound"><span class="bound">v</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> finsum_cong <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_in_ring ring_subset_carrier<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> a_fun f <span class="keyword1"><span class="command">have</span></span> a'_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?a'</span><span class="main">∈</span><span class="var">?C'</span> <span class="main">→</span> carrier <span class="free">K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> C'fin CinC this w_eq_T_v a'_fun Tv <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> LinearCombinations.module.span <span class="free">K</span> <span class="free">W</span> <span class="main">(</span><span class="free">T</span> <span class="main">`</span> <span class="skolem">C</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> finite_span<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this subs_im CinC <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> span_li_not_depend<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> im_def subspace_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> C'_li C'_gen C cim <span class="keyword1"><span class="command">have</span></span> C'_basis<span class="main">:</span> <span class="quoted"><span class="quoted">"im.basis  <span class="main">(</span><span class="free">T</span><span class="main">`</span><span class="skolem">C</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> im.basis_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> C_card_im<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">C</span> <span class="main">=</span> <span class="main">(</span>vectorspace.dim <span class="free">K</span> <span class="main">(</span>W.vs imT<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C'_basis C'_card<span class="main">(</span>2<span class="main">)</span> C'fin im.dim_basis <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> finA Abasis <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"ker.dim <span class="main">=</span> card <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ker.dim_basis<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this C_card_im cardEq 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vectorspace.dim <span class="free">K</span> <span class="main">(</span>W.vs imT<span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>vectorspace.dim <span class="free">K</span> <span class="main">(</span>V.vs kerT<span class="main">)</span><span class="main">)</span> <span class="main">=</span> V.dim"</span></span>  <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span><span class="main">`</span> <span class="main">(</span>carrier <span class="free">V</span><span class="main">)</span> <span class="main">=</span> carrier <span class="free">W</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> * surj_imp_imT_carrier<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"W.fin_dim"</span></span> <span class="keyword1"><span class="command">using</span></span> C'_basis C'fin <span class="keyword1"><span class="command">unfolding</span></span> W.fin_dim_def im.basis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> linear_map<span class="main">)</span> rank_nullity<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> fd<span class="main">:</span> <span class="quoted"><span class="quoted">"V.fin_dim"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vectorspace.dim <span class="free">K</span> <span class="main">(</span>W.vs imT<span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>vectorspace.dim <span class="free">K</span> <span class="main">(</span>V.vs kerT<span class="main">)</span><span class="main">)</span> <span class="main">=</span> V.dim"</span></span>       
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rank_nullity_main<span class="main"><span class="main">[</span></span><span class="operator">OF</span> fd<span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div>