<div id="Furstenberg_Topology">
<div class="head">
<h1>Theory Furstenberg_Topology</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:     Furstenberg_Topology.thy
  Author:   Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Furstenberg's topology and his proof of the infinitude of primes›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Furstenberg_Topology
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Real_Asymp/Real_Asymp.html">HOL-Real_Asymp.Real_Asymp</a>"</span> 
    <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Analysis/Analysis.html">HOL-Analysis.Analysis</a>"</span> 
    <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Number_Theory/Number_Theory.html">HOL-Number_Theory.Number_Theory</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This article gives a formal version of Furstenberg's topological proof of the infinitude of
  primes~\cite{furstenberg}. He defines a topology on the integers based on arithmetic progressions
  (or, equivalently, residue classes).

  Apart from yielding a short proof of the infinitude of primes, this topology is also fairly
  `nice' in general: it is second countable, metrizable, and perfect. All of these (well-known)
  facts will be formally proven below.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Arithmetic progressions of integers›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We first define `bidirectional infinite arithmetic progressions' on <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ℤ›</span></span></span></span> in the sense that 
  to an integer <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>a›</span></span></span></span> and a positive integer <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>b›</span></span></span></span>, we associate all the integers <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> such that
  $x \equiv a\ (\text{mod}\ b)$, or, equivalently, $\{a + nb\mid n\in\mathbb{Z}\}$.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">arith_prog</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> nat <span class="main">⇒</span> int set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">arith_prog</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">[</span><span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> int <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Furstenberg_Topology-arith_prog_0_right"><span class="command">lemma</span></span> arith_prog_0_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"arith_prog <span class="free">a</span> <span class="main">0</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arith_prog_def<span class="main">)</span>

<span class="keyword1" id="Furstenberg_Topology-arith_prog_Suc_0_right"><span class="command">lemma</span></span> arith_prog_Suc_0_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"arith_prog <span class="free">a</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arith_prog_def<span class="main">)</span>

<span class="keyword1" id="Furstenberg_Topology-in_arith_progI"><span class="command">lemma</span></span> in_arith_progI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span> <span class="main">=</span> <span class="free">a</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> arith_prog <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arith_prog_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Two arithmetic progressions with the same period and noncongruent starting points are
  disjoint.
›</span></span>
<span class="keyword1" id="Furstenberg_Topology-arith_prog_disjoint"><span class="command">lemma</span></span> arith_prog_disjoint<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">a</span> <span class="main">≠</span> <span class="free">a'</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> int <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"arith_prog <span class="free">a</span> <span class="free">b</span> <span class="main">∩</span> arith_prog <span class="free">a'</span> <span class="free">b</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arith_prog_def cong_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Multiplying the period gives us a subset of the original progression.
›</span></span>
<span class="keyword1" id="Furstenberg_Topology-arith_prog_dvd_mono"><span class="command">lemma</span></span> arith_prog_dvd_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">b'</span> <span class="main">⟹</span> arith_prog <span class="free">a</span> <span class="free">b'</span> <span class="main">⊆</span> arith_prog <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arith_prog_def cong_dvd_modulus<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following proves the alternative definition mentioned above.
›</span></span>
<span class="keyword1" id="Furstenberg_Topology-bij_betw_arith_prog"><span class="command">lemma</span></span> bij_betw_arith_prog<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="main">+</span> int <span class="free">b</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span> UNIV <span class="main">(</span>arith_prog <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betwI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">a</span></span><span class="main"><span class="main">)</span></span> <span class="keyword1"><span class="keyword1">div</span></span> int <span class="free"><span class="free">b</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arith_prog_def cong_add_lcancel_0 cong_mult_self_right mult_of_nat_commute<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 4
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arith_prog_def cong_iff_lin<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> arith_prog_def›</span><span class="main">)</span>

<span class="keyword1" id="Furstenberg_Topology-arith_prog_altdef"><span class="command">lemma</span></span> arith_prog_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"arith_prog <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="main">+</span> int <span class="free">b</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_betw_arith_prog<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A simple corollary from this is also that any such arithmetic progression is infinite.
›</span></span>
<span class="keyword1" id="Furstenberg_Topology-infinite_arith_prog"><span class="command">lemma</span></span> infinite_arith_prog<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> infinite <span class="main">(</span>arith_prog <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bij_betw_finite<span class="main">[</span><span class="operator">OF</span> bij_betw_arith_prog<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Furstenberg topology on <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ℤ›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The typeclass-based topology is somewhat nicer to use in Isabelle/HOL, but the integers, 
  of course, already have a topology associated to them. We therefore need to introduce a type
  copy of the integers and furnish them with the new topology. We can easily convert between
  them and the `proper' integers using Lifting and Transfer.
›</span></span>
<span class="keyword1"><span class="command">typedef</span></span> fbint <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> int set"</span></span>
  <span class="keyword2"><span class="keyword">morphisms</span></span> int_of_fbint fbint <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_fbint

<span class="keyword1"><span class="command">lift_definition</span></span> arith_prog_fb <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> nat <span class="main">⇒</span> fbint set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"arith_prog"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> fbint <span class="main">::</span> <span class="quoted">topological_space</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Furstenberg defined the topology as the one generated by all arithmetic progressions.
  We use a slightly more explicit equivalent formulation that exploits the fact that
  the intersection of two arithmetic progressions is again an arithmetic progression (or empty).
›</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">open_fbint</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fbint set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">b</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> arith_prog <span class="bound">x</span> <span class="bound">b</span> <span class="main">⊆</span> <span class="bound">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now prove that this indeed forms a topology.
›</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"open <span class="main">(</span>UNIV <span class="main">::</span> fbint set<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span> <span class="skolem">V</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fbint set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">V</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"open <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹open <span class="skolem">U</span>›</span></span> <span class="quoted"><span class="quoted">‹open <span class="skolem">V</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span> <span class="skolem">V</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">int</span>
    <span class="keyword3"><span class="command">assume</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">b</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> arith_prog <span class="bound">x</span> <span class="bound">b</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">V</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">b</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> arith_prog <span class="bound">x</span> <span class="bound">b</span> <span class="main">⊆</span> <span class="skolem">V</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">V</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> U x <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b1</span></span> <span class="keyword2"><span class="keyword">where</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">x</span> <span class="skolem">b1</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> V x <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b2</span></span> <span class="keyword2"><span class="keyword">where</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">x</span> <span class="skolem">b2</span> <span class="main">⊆</span> <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> b1 b2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lcm <span class="skolem">b1</span> <span class="skolem">b2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">x</span> <span class="main">(</span>lcm <span class="skolem">b1</span> <span class="skolem">b2</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> arith_prog_dvd_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b1</span></span> <span class="quoted"><span class="quoted">"lcm <span class="skolem">b1</span> <span class="skolem">b2</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> arith_prog_dvd_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b2</span></span> <span class="quoted"><span class="quoted">"lcm <span class="skolem">b1</span> <span class="skolem">b2</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lcm_pos_nat<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">b</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> arith_prog <span class="skolem">x</span> <span class="bound">b</span> <span class="main">⊆</span> <span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fbint set set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">U</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> open <span class="bound">U</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"open <span class="main">(</span><span class="main">⋃</span><span class="skolem">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">use</span> * <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">U</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">int</span>
    <span class="keyword3"><span class="command">assume</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">U</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">b</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> arith_prog <span class="bound">x</span> <span class="bound">b</span> <span class="main">⊆</span> <span class="bound">U</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> F <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">x</span> <span class="skolem">b</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">∈</span> <span class="skolem">F</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">b</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> arith_prog <span class="skolem">x</span> <span class="bound">b</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="skolem">F</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Since any non-empty open set contains an arithmetic progression and arithmetic progressions
  are infinite, we obtain that all nonempty open sets are infinite.
›</span></span>
<span class="keyword1" id="Furstenberg_Topology-open_fbint_imp_infinite"><span class="command">lemma</span></span> open_fbint_imp_infinite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">U</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fbint set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"open <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"infinite <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">transfer</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">b</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> arith_prog <span class="bound">x</span> <span class="bound">b</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">x</span> <span class="skolem">b</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>arith_prog <span class="skolem">x</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> infinite_arith_prog <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> b <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Furstenberg_Topology-not_open_finite_fbint"><span class="command">lemma</span></span> not_open_finite_fbint <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">U</span> <span class="main">::</span> fbint set<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span>open <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> open_fbint_imp_infinite assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  More or less by definition, any arithmetic progression is open.
›</span></span>
<span class="keyword1" id="Furstenberg_Topology-open_arith_prog_fb"><span class="command">lemma</span></span> open_arith_prog_fb <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"open <span class="main">(</span>arith_prog_fb <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">transfer</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>arith_prog <span class="skolem">a</span> <span class="skolem">b</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">b'</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> arith_prog <span class="bound">x</span> <span class="bound">b'</span> <span class="main">⊆</span> arith_prog <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">b</span></span></span></span><span class="main"><span class="main">]</span></span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> arith_prog <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">x</span> <span class="skolem">b</span> <span class="main">⊆</span> arith_prog <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cong_trans <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arith_prog_def <span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Slightly less obviously, any arithmetic progression is also closed.
  This can be seen by realising that for a period <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>b›</span></span></span></span>, we can partition the integers
  into <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>b›</span></span></span></span> congruence classes and then the complement of each congruence class is the 
  union of the other <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>b - 1›</span></span></span></span> classes, and unions of open sets are open.
›</span></span>
<span class="keyword1" id="Furstenberg_Topology-closed_arith_prog_fb"><span class="command">lemma</span></span> closed_arith_prog_fb <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"closed <span class="main">(</span>arith_prog_fb <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"open <span class="main">(</span><span class="main">-</span>arith_prog_fb <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>arith_prog_fb <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span><span class="main">.</span> arith_prog_fb <span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="bound">i</span><span class="main">)</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted">int</span>
      <span class="keyword1"><span class="command">have</span></span> disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> arith_prog <span class="skolem">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> arith_prog <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">i</span><span class="main">)</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">i</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> int <span class="free">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">i</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> int <span class="free">b</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">i</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> int <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span> <span class="main">=</span> int <span class="skolem">i</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> int <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> cong_add_lcancel<span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cong_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> arith_prog_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">have</span></span> covering<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> arith_prog <span class="skolem">a</span> <span class="free">b</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span><span class="main">.</span> arith_prog <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> int <span class="bound">i</span><span class="main">)</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> nat <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>int <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">mod</span> int <span class="free">b</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> int <span class="free">b</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> i_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">mod</span> int <span class="free">b</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> int <span class="free">b</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cong_add<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">i</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> int <span class="free">b</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_sym_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> arith_prog <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> int <span class="skolem">i</span><span class="main">)</span> <span class="free">b</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arith_prog_def<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_def nat_less_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">from</span></span> disjoint <span class="keyword2"><span class="keyword">and</span></span> covering <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> arith_prog <span class="skolem">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span><span class="main">.</span> arith_prog <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> int <span class="bound">i</span><span class="main">)</span> <span class="free">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"open <span class="main">…</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> closed_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The infinitude of primes›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The infinite of the primes now follows quite obviously: The multiples of any prime form a
  closed set, so if there were only finitely many primes, the union of all of these would also
  be open. However, since any number other than <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>±1›</span></span></span></span> has a prime divisor, the union of all these
  sets is simply <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ℤ∖{±1}›</span></span></span></span>, which is obviously <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹not›</span></span> closed since the finite set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>{±1}›</span></span></span></span> is not
  open.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">p</span><span class="main">::</span>nat<span class="main">.</span> prime <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>  
  <span class="keyword3"><span class="command">assume</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">p</span><span class="main">::</span>nat<span class="main">.</span> prime <span class="bound">p</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">::</span>nat<span class="main">.</span> prime <span class="bound">p</span><span class="main">}</span><span class="main">.</span> arith_prog_fb <span class="main">0</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> A_def <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> closed_Union<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"open <span class="main">(</span><span class="main">-</span><span class="skolem">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> closed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">-</span><span class="main">{</span>fbint <span class="main">1</span><span class="main">,</span> fbint <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> A_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">transfer</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">::</span>nat<span class="main">.</span> prime <span class="bound">p</span><span class="main">}</span><span class="main">.</span> arith_prog <span class="main">0</span> <span class="bound">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> equalityI subsetI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">-</span><span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">::</span>nat<span class="main">.</span> prime <span class="bound">p</span><span class="main">}</span><span class="main">.</span> arith_prog <span class="main">0</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> False
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> prime_divisor_exists<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">≠</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> arith_prog <span class="main">0</span> <span class="main">(</span>nat <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prime_gt_0_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arith_prog_def cong_0_iff<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> p
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"nat <span class="skolem">p</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A_def arith_prog_def cong_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="main">{</span>fbint <span class="main">1</span><span class="main">,</span> fbint <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>fbint <span class="main">1</span><span class="main">,</span> fbint <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"open <span class="main">{</span>fbint <span class="main">1</span><span class="main">,</span> fbint <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Additional topological properties›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Just for fun, let us also show a few more properties of Furstenberg's topology.
  First, we show the equivalence to the above to Furstenberg's original definition
  (the topology generated by all arithmetic progressions).
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> topological_basis_fbint<span class="main">:</span> <span class="quoted"><span class="quoted">"topological_basis <span class="main">{</span>arith_prog_fb <span class="bound">a</span> <span class="bound">b</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> topological_basis_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"open <span class="main">(</span>arith_prog_fb <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fbint set"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> arith_prog_fb <span class="main">(</span>int_of_fbint <span class="bound">x</span><span class="main">)</span> <span class="bound">b</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> arith_prog_fb <span class="main">(</span>int_of_fbint <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> bchoice_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> arith_prog_fb <span class="main">(</span>int_of_fbint <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> arith_prog_fb <span class="main">(</span>int_of_fbint <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="main">{</span>arith_prog_fb <span class="bound">a</span> <span class="bound">b</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="skolem">B</span> <span class="main">=</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> arith_prog_fb <span class="main">(</span>int_of_fbint <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⋃</span><span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> f <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> B_def›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">B'</span></span><span class="main">⊆</span><span class="main">{</span>arith_prog_fb <span class="bound">a</span> <span class="bound">b</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">b</span><span class="main">}</span><span class="main">.</span> <span class="main">⋃</span> <span class="bound">B'</span> <span class="main">=</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1" id="Furstenberg_Topology-open_fbint_altdef"><span class="command">lemma</span></span> open_fbint_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"open <span class="main">=</span> generate_topology <span class="main">{</span>arith_prog_fb <span class="bound">a</span> <span class="bound">b</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> topological_basis_imp_subbasis<span class="main">[</span><span class="operator">OF</span> topological_basis_fbint<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  From this, we can immediately see that it is second countable:
›</span></span>
<span class="keyword1"><span class="command">instance</span></span> fbint <span class="main">::</span> <span class="quoted">second_countable_topology</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> arith_prog_fb <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>UNIV <span class="main">×</span> <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> countable_image<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span>arith_prog_fb <span class="bound">a</span> <span class="bound">b</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">::</span>fbint set set<span class="main">.</span> countable <span class="bound">B</span> <span class="main">∧</span> open <span class="main">=</span> generate_topology <span class="bound">B</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> open_fbint_altdef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A trivial consequence of the fact that nonempty open sets in this topology are infinite
  is that it is a perfect space:
›</span></span>
<span class="keyword1"><span class="command">instance</span></span> fbint <span class="main">::</span> <span class="quoted">perfect_space</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  It is also Hausdorff, since given any two distinct integers, we can easily
  construct two non-overlapping arithmetic progressions that each contain one of them.
  We do not <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹really›</span></span> have to prove this since we will get it for free later on when we
  show that it is a metric space, but here is the proof anyway:
›</span></span>
<span class="keyword1"><span class="command">instance</span></span> fbint <span class="main">::</span> <span class="quoted">t2_space</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">fbint</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> nat <span class="main">¦</span>int_of_fbint <span class="skolem">x</span> <span class="main">-</span> int_of_fbint <span class="skolem">y</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> arith_prog_fb <span class="main">(</span>int_of_fbint <span class="skolem">x</span><span class="main">)</span> <span class="skolem">d</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> arith_prog_fb <span class="main">(</span>int_of_fbint <span class="skolem">y</span><span class="main">)</span> <span class="skolem">d</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> U_def V_def d_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> arith_prog_disjoint<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">int</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> int <span class="main">(</span>nat <span class="main">¦</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> int <span class="main">(</span>nat <span class="main">¦</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span> <span class="keyword1">dvd</span> <span class="main">¦</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cong_iff_dvd_diff <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zdvd_imp_le<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">V</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> U_def V_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> U_def V_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> open <span class="bound">U</span> <span class="main">∧</span> open <span class="bound">V</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">U</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="bound">V</span> <span class="main">∧</span> <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* TODO Move? *)</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Next, we need a small lemma: Given an additional assumption, a $T_2$ space is also $T_3$:
›</span></span>
<span class="keyword1" id="Furstenberg_Topology-t2_space_t3_spaceI"><span class="command">lemma</span></span> t2_space_t3_spaceI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="main">(</span><span class="bound">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> t2_space<span class="main">)</span> <span class="bound">U</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">U</span> <span class="main">⟹</span> open <span class="bound">U</span> <span class="main">⟹</span>
             <span class="main">∃</span><span class="bound">V</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">V</span> <span class="main">∧</span> open <span class="bound">V</span> <span class="main">∧</span> closure <span class="bound">V</span> <span class="main">⊆</span> <span class="bound">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="keyword1">OFCLASS</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> t3_space_class<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">z</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">assume</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"closed <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="skolem">X</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">X</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="keyword2"><span class="keyword">where</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"closure <span class="skolem">V</span> <span class="main">⊆</span> <span class="main">-</span><span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> open <span class="bound">U</span> <span class="main">∧</span> open <span class="bound">V</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="main">∈</span> <span class="bound">U</span> <span class="main">∧</span> <span class="skolem">X</span> <span class="main">⊆</span> <span class="bound">V</span> <span class="main">∧</span> <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">V</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">-</span></span></span>closure <span class="skolem"><span class="skolem"><span class="skolem">V</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">use</span> X V closure_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">V</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Since the Furstenberg topology is $T_2$ and every arithmetic progression is also closed,
  we can now easily show that it is also $T_3$ (i.\,e.\ regular). 
  Again, we do not really need this proof, but here it is:
›</span></span>
<span class="keyword1"><span class="command">instance</span></span> fbint <span class="main">::</span> <span class="quoted">t3_space</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> t2_space_t3_spaceI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">fbint</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">U</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fbint set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"arith_prog_fb <span class="main">(</span>int_of_fbint <span class="skolem">x</span><span class="main">)</span> <span class="skolem">b</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> arith_prog_fb <span class="main">(</span>int_of_fbint <span class="skolem">x</span><span class="main">)</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">V</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> V_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"closed <span class="skolem">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> V_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">V</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">V</span> <span class="main">∧</span> open <span class="bound">V</span> <span class="main">∧</span> closure <span class="bound">V</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">V</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> V_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Metrizability›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The metrizability of Furstenberg's topology (i.\,e.\ that it is induced by some metric) can
  be shown from the fact that it is second countable and $T_3$ using Urysohn's Metrization Theorem, 
  but this is not available in Isabelle yet. Let us therefore give an <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹explicit›</span></span> metric, 
  as described by Zulfeqarr~\cite{zulfeqarr}. We follow the exposition by Dirmeier~\cite{dirmeier}.

  First, we define a kind of norm on the integers. The norm depends on a real parameter <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>q &gt; 1›</span></span></span></span>.
  The value of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>q›</span></span></span></span> does not matter in the sense that all values induce the same topology
  (which we will show). For the final definition, we then simply pick <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>q = 2›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> fbnorm <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> q_gt_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">N</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> int <span class="bound">k</span> <span class="keyword1">dvd</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Furstenberg_Topology-N_summable"><span class="command">lemma</span></span> N_summable<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> int <span class="bound">k</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> summable_comparison_test<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ summable_geometric<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">/</span></span></span><span class="free"><span class="free"><span class="free">q</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">use</span> q_gt_1 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main">!</span><span class="main">:</span> exI<span class="main">[</span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="quasi_keyword">simp</span><span class="main">:</span> power_divide›</span><span class="main">)</span>

<span class="keyword1" id="Furstenberg_Topology-N_sums"><span class="command">lemma</span></span> N_sums<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> int <span class="bound">k</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">sums</span> N <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> N_summable <span class="keyword1"><span class="command">unfolding</span></span> N_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> summable_sums<span class="main">)</span>

<span class="keyword1" id="Furstenberg_Topology-N_nonneg"><span class="command">lemma</span></span> N_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"N <span class="free">n</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sums_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ sums_zero N_sums<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> q_gt_1 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Furstenberg_Topology-N_uminus"><span class="command">lemma</span></span> N_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"N <span class="main">(</span><span class="main">-</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> N <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> N_def<span class="main">)</span>

<span class="keyword1" id="Furstenberg_Topology-N_minus_commute"><span class="command">lemma</span></span> N_minus_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"N <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> N <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> N_uminus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="free">y</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> N_uminus<span class="main">)</span>

<span class="keyword1" id="Furstenberg_Topology-N_zero"><span class="command">lemma</span></span> N_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"N <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> N_def<span class="main">)</span>

<span class="keyword1" id="Furstenberg_Topology-not_dvd_imp_N_ge"><span class="command">lemma</span></span> not_dvd_imp_N_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"N <span class="free">a</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sums_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ sums_single<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> N_sums<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> q_gt_1 assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Furstenberg_Topology-N_lt_imp_dvd"><span class="command">lemma</span></span> N_lt_imp_dvd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"N <span class="free">a</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> not_dvd_imp_N_ge<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Furstenberg_Topology-N_pos"><span class="command">lemma</span></span> N_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"N <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="main">(</span>nat <span class="main">¦</span><span class="free">n</span><span class="main">¦</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> q_gt_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">1</span> <span class="main">+</span> <span class="main">¦</span><span class="free">n</span><span class="main">¦</span> <span class="keyword1">dvd</span> <span class="main">¦</span><span class="free">n</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zdvd_imp_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="main">¦</span><span class="free">n</span><span class="main">¦</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">n</span><span class="main">¦</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="main">(</span>nat <span class="main">¦</span><span class="free">n</span><span class="main">¦</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> N <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> not_dvd_imp_N_ge<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Furstenberg_Topology-N_zero_iff"><span class="command">lemma</span></span> N_zero_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"N <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> N_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Furstenberg_Topology-N_triangle_ineq"><span class="command">lemma</span></span> N_triangle_ineq<span class="main">:</span> <span class="quoted"><span class="quoted">"N <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span> <span class="main">≤</span> N <span class="free">n</span> <span class="main">+</span> N <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sums_le<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> int <span class="bound">k</span> <span class="keyword1">dvd</span> <span class="bound">n</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="bound">k</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span> <span class="keyword1">sums</span> N <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> N_sums<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="var">?I</span> <span class="free">n</span> <span class="bound">k</span> <span class="main">+</span> <span class="var">?I</span> <span class="free">m</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span>N <span class="free">n</span> <span class="main">+</span> N <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sums_add N_sums<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> q_gt_1 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Furstenberg_Topology-N_1"><span class="command">lemma</span></span> N_1<span class="main">:</span> <span class="quoted"><span class="quoted">"N <span class="main">1</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sums_unique2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> int <span class="bound">k</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">sums</span> N <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> N_sums<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> int <span class="bound">k</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">q</span><span class="main">)</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_divide <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">q</span><span class="main">)</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">sums</span> N <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">q</span><span class="main">)</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">sums</span>
                 <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">q</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sums_If_finite_set'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> geometric_sums<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> q_gt_1 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> q_gt_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">q</span><span class="main">)</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  It follows directly from the definition that norms fulfil a kind of monotonicity property
  with respect to divisibility: the norm of a number is at most as large as the norm of any of
  its factors:
›</span></span>
<span class="keyword1" id="Furstenberg_Topology-N_dvd_mono"><span class="command">lemma</span></span> N_dvd_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"N <span class="free">n</span> <span class="main">≤</span> N <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sums_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ N_sums N_sums<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> int <span class="skolem">k</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">≤</span>
        <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> int <span class="skolem">k</span> <span class="keyword1">dvd</span> <span class="free">m</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> q_gt_1 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In particular, this means that 1 and -1 have the greatest norm.
›</span></span>
<span class="keyword1" id="Furstenberg_Topology-N_le_N_1"><span class="command">lemma</span></span> N_le_N_1<span class="main">:</span> <span class="quoted"><span class="quoted">"N <span class="free">n</span> <span class="main">≤</span> N <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> N_dvd_mono<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Primes have relatively large norms, almost reaching the norm of 1:
›</span></span>
<span class="keyword1" id="Furstenberg_Topology-N_prime"><span class="command">lemma</span></span> N_prime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"N <span class="free">p</span> <span class="main">=</span> N <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> nat <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sums_unique2<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> nat <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> int <span class="skolem">p'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p'_def prime_ge_0_int<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> int <span class="bound">k</span> <span class="keyword1">dvd</span> <span class="free">p</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">sums</span> N <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> N_sums<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">k</span> <span class="keyword1">dvd</span> <span class="free">p</span> <span class="main">⟷</span> <span class="skolem">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p prime_nat_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> int <span class="bound">k</span> <span class="keyword1">dvd</span> <span class="free">p</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span>
         <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">q</span><span class="main">)</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms q_gt_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_divide <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">sums</span> N <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">q</span><span class="main">)</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">sums</span>
                 <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">q</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">q</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">p'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sums_If_finite_set'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> geometric_sums<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p'</span>›</span></span> q_gt_1 prime_gt_Suc_0_nat<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p'</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> ›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> N <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="skolem">p'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> q_gt_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> N_1<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">q</span><span class="main">)</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Furstenberg_Topology-N_2"><span class="command">lemma</span></span> N_2<span class="main">:</span> <span class="quoted"><span class="quoted">"N <span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">q</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> q_gt_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> N_prime N_1 <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>

<span class="keyword1" id="Furstenberg_Topology-N_less_N_1"><span class="command">lemma</span></span> N_less_N_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"N <span class="free">n</span> <span class="main">&lt;</span> N <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_divisor_exists<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"N <span class="free">n</span> <span class="main">≤</span> N <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> N_dvd_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"N <span class="skolem">p</span> <span class="main">&lt;</span> N <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> q_gt_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> N_prime<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> q_gt_1 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> N_1›</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Composites, on the other hand, do not achieve this:
›</span></span>
<span class="keyword1" id="Furstenberg_Topology-nonprime_imp_N_lt"><span class="command">lemma</span></span> nonprime_imp_N_lt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>prime_elem <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">n</span><span class="main">¦</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"N <span class="free">n</span> <span class="main">&lt;</span> N <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> nat <span class="main">¦</span><span class="free">n</span><span class="main">¦</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_divisor_exists<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> nat <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> int <span class="skolem">p'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p'_def prime_ge_0_int<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">=</span> nat <span class="main">¦</span><span class="free">n</span><span class="main">¦</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n'_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"N <span class="free">n</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="skolem">p'</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="skolem">n'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sums_le<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> int <span class="bound">k</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">sums</span> N <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> N_sums<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">≠</span> <span class="skolem">p'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n'_def p'_def nat_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">q</span><span class="main">)</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">sums</span>
                   <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">q</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">q</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">p'</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">q</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sums_If_finite_set'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> geometric_sums<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p'</span>›</span></span> q_gt_1 prime_gt_Suc_0_nat<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p'</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> ›</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="skolem">p'</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="skolem">n'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> q_gt_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">q</span><span class="main">)</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> int <span class="bound">k</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span>
         <span class="main">≤</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">q</span><span class="main">)</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> q_gt_1 p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p'_def n'_def power_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="skolem">n'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> q_gt_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n'_def N_1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This implies that one can use the norm as a primality test:
›</span></span>
<span class="keyword1" id="Furstenberg_Topology-prime_iff_N_eq"><span class="command">lemma</span></span> prime_iff_N_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"prime_elem <span class="free">n</span> <span class="main">⟷</span> N <span class="free">n</span> <span class="main">=</span> N <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> nat <span class="main">¦</span><span class="free">n</span><span class="main">¦</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"prime_elem <span class="skolem">n</span> <span class="main">⟷</span> N <span class="skolem">n</span> <span class="main">=</span> N <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> nat <span class="main">¦</span><span class="skolem">n</span><span class="main">¦</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">n</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>prime <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> q_gt_1
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> N_1<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>prime <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> nonprime_imp_N_lt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> N_prime prime_ge_0_int<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">n</span>"</span></span><span class="main">]</span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Factorials, on the other hand, have very small norms:
›</span></span>
<span class="keyword1" id="Furstenberg_Topology-N_fact_le"><span class="command">lemma</span></span> N_fact_le<span class="main">:</span> <span class="quoted"><span class="quoted">"N <span class="main">(</span>fact <span class="free">m</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sums_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ N_sums<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="bound">k</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> Suc <span class="free">m</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="free">q</span> <span class="main">/</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> Suc <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> geometric_sums<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="free">q</span>"</span></span><span class="main">]</span> q_gt_1 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sums_divide<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">q</span> <span class="main">/</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> Suc <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> q_gt_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="bound">k</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> Suc <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="main">(</span><span class="bound">k</span> <span class="main">+</span> Suc <span class="free">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> q_gt_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power_add<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">+</span> Suc <span class="free">m</span> <span class="main">≤</span> <span class="free">m</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="main">(</span><span class="bound">k</span> <span class="main">+</span> Suc <span class="free">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">m</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sums_zero_iff_shift<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="main">…</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">k</span> <span class="keyword1">dvd</span> fact <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">k</span> <span class="keyword1">dvd</span> int <span class="main">(</span>fact <span class="free">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> int_dvd_int_iff <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_fact<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">k</span> <span class="keyword1">dvd</span> fact <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> of_nat_fact <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> int <span class="skolem">k</span> <span class="keyword1">dvd</span> fact <span class="free">m</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">≤</span>
        <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">k</span> <span class="main">≤</span> <span class="free">m</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q_gt_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Furstenberg_Topology-N_prime_mono"><span class="command">lemma</span></span> N_prime_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">p'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"N <span class="free">p</span> <span class="main">≤</span> N <span class="free">p'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms q_gt_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> N_prime <span class="dynamic"><span class="dynamic">field_simps</span></span> nat_le_iff prime_ge_0_int<span class="main">)</span>

<span class="keyword1" id="Furstenberg_Topology-N_prime_ge"><span class="command">lemma</span></span> N_prime_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"N <span class="free">p</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">q</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">q</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> N <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> q_gt_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> N_prime N_1 <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> N <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> N_prime_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_ge_2_int<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Furstenberg_Topology-N_prime_elem_ge"><span class="command">lemma</span></span> N_prime_elem_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime_elem <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"N <span class="free">p</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">q</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> assms N_prime_ge <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> assms N_prime_ge<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">p</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Next, we use this norm to derive a metric:
›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> dist <span class="main">::</span> <span class="quoted"><span class="quoted">"fbint <span class="main">⇒</span> fbint <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> N <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Furstenberg_Topology-dist_self"><span class="command">lemma</span></span> dist_self <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dist <span class="free">x</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1" id="Furstenberg_Topology-dist_sym"><span class="command">lemma</span></span> dist_sym <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dist <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> dist <span class="free">y</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> N_minus_commute<span class="main">)</span>

<span class="keyword1" id="Furstenberg_Topology-dist_pos"><span class="command">lemma</span></span> dist_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">⟹</span> dist <span class="free">x</span> <span class="free">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">use</span> N_pos <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Furstenberg_Topology-dist_eq_0_iff"><span class="command">lemma</span></span> dist_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dist <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dist_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Furstenberg_Topology-dist_triangle_ineq"><span class="command">lemma</span></span> dist_triangle_ineq<span class="main">:</span> <span class="quoted"><span class="quoted">"dist <span class="free">x</span> <span class="free">z</span> <span class="main">≤</span> dist <span class="free">x</span> <span class="free">y</span> <span class="main">+</span> dist <span class="free">y</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">transfer</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"N <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">≤</span> N <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> N <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> N_triangle_ineq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">-</span> <span class="skolem">z</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Lastly, we show that the metric we defined indeed induces the Furstenberg topology.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> dist_induces_open<span class="main">:</span>
  <span class="quoted"><span class="quoted">"open <span class="free">U</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> dist <span class="bound">x</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="bound">e</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">U</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">b</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> arith_prog <span class="bound">x</span> <span class="bound">b</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">x</span> <span class="skolem">b</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="skolem">b</span>"</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> N <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">e</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="keyword3">;</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q_gt_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"N <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> N_lt_imp_dvd<span class="main">)</span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> arith_prog <span class="skolem">x</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arith_prog_def cong_iff_dvd_diff dvd_diff_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> b <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">next</span></span>

  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> N <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">e</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> N <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="bound">N</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> q_gt_1 <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> fact <span class="skolem">m</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arith_prog <span class="skolem">x</span> <span class="skolem">b</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> arith_prog <span class="skolem">x</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> arith_prog <span class="skolem">x</span> <span class="skolem">b</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> int <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arith_prog_altdef<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> y <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"N <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> N <span class="main">(</span>int <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> y<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> N <span class="main">(</span>int <span class="skolem">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> N_dvd_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span> <span class="main">/</span> <span class="free">q</span> <span class="main">^</span> <span class="skolem">m</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> N_fact_le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> b_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">b</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> arith_prog <span class="skolem">x</span> <span class="bound">b</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now show that the Furstenberg space is a metric space with this metric (with <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>q = 2›</span></span></span></span>),
  which essentially only amounts to plugging together all the results from above.
›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> fb<span class="main">:</span> fbnorm <span class="quoted"><span class="numeral">2</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">instantiation</span></span> fbint <span class="main">::</span> <span class="quoted">dist</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">dist_fbint</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist_fbint</span> <span class="main">=</span> fb.dist"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">instantiation</span></span> fbint <span class="main">::</span> <span class="quoted">uniformity_dist</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">uniformity_fbint</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fbint <span class="main">×</span> fbint<span class="main">)</span> filter"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">uniformity_fbint</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">e</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span> <span class="main">&lt;..}</span><span class="main">.</span> principal <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> dist <span class="bound">x</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="bound">e</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uniformity_fbint_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">instance</span></span> fbint <span class="main">::</span> <span class="quoted">open_uniformity</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fbint set"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">U</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> eventually <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x'</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">U</span><span class="main">)</span> uniformity<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eventually_uniformity_metric dist_fbint_def
    <span class="keyword1"><span class="command">using</span></span> fb.dist_induces_open <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">instance</span></span> fbint <span class="main">::</span> <span class="quoted">metric_space</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">use</span> fb.dist_triangle_ineq <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> dist_fbint_def›</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In particular, we can now show that the sequence <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n!›</span></span></span></span> tends to 0 in the Furstenberg topology:
›</span></span>
<span class="keyword1" id="Furstenberg_Topology-tendsto_fbint_fact"><span class="command">lemma</span></span> tendsto_fbint_fact<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fbint <span class="main">(</span>fact <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> fbint <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> dist <span class="main">(</span>fbint <span class="main">(</span>fact <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fbint <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_sandwich<span class="main"><span class="main">[</span></span><span class="operator">OF</span> always_eventually always_eventually<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span>fbint <span class="main">(</span>fact <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fbint <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> dist_fbint_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> fb.N_fact_le<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span>fbint <span class="main">(</span>fact <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fbint <span class="main">0</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> tendsto_dist_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>