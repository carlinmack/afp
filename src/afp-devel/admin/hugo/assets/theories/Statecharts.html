<div id="Contrib">
<div class="head">
<h1>Theory Contrib</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      statecharts/DataSpace/Contrib.thy
    Author:     Steffen Helke and Florian Kammüller, Software Engineering Group
    Copyright   2010 Technische Universitaet Berlin
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Contributions to the Standard Library of HOL›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Contrib
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic definitions and lemmas›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Lambda expressions›</span></span>                  

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">restrict</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'a</span> set<span class="main">]</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">restrict</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">@</span> <span class="bound">y</span><span class="main">.</span> True<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="main">(</span>ASCII<span class="main">)</span>
  <span class="quoted">"_lambda_in"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>pttrn<span class="main">,</span> <span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'b</span><span class="main">]</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">%</span>_<span class="keyword1">:</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 3<span class="main">]</span> 3<span class="main">)</span>
<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_lambda_in"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>pttrn<span class="main">,</span> <span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'b</span><span class="main">]</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">λ</span>_<span class="keyword1">∈</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 3<span class="main">]</span> 3<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span> 
  <span class="quoted">"<span class="main">λ</span><span class="free">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span>"</span>  <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> restrict <span class="main">(</span><span class="main">%</span><span class="free">x</span><span class="main">.</span> <span class="free">f</span><span class="main">)</span> <span class="free">A</span>"</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Maps›</span></span>                  

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">chg_map</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'b</span> <span class="main">=&gt;</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇀</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇀</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>  
 <span class="quoted"><span class="quoted">"<span class="free">chg_map</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">of</span> None <span class="main">=&gt;</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">|</span> Some <span class="bound">b</span> <span class="main">=&gt;</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">|-&gt;</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Contrib-map_some_list"><span class="command">lemma</span></span> map_some_list <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"map the <span class="main">(</span>map Some <span class="free">L</span><span class="main">)</span> <span class="main">=</span> <span class="free">L</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">L</span></span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Contrib-dom_ran_the"><span class="command">lemma</span></span> dom_ran_the<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> ran <span class="free">G</span> <span class="main">=</span> <span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">(</span>dom <span class="free">G</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>the <span class="main">(</span><span class="free">G</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ran_def dom_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Contrib-dom_None"><span class="command">lemma</span></span> dom_None<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">S</span> <span class="main">∉</span> dom <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">F</span> <span class="free">S</span> <span class="main">=</span> None<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> dom_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Contrib-ran_dom_the"><span class="command">lemma</span></span> ran_dom_the<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">y</span> <span class="main">∉</span> Union <span class="main">(</span>ran <span class="free">G</span><span class="main">)</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∉</span> the <span class="main">(</span><span class="free">G</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> ran_def dom_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Contrib-dom_map_upd"><span class="command">lemma</span></span> dom_map_upd<span class="main">:</span> <span class="quoted"><span class="quoted">"dom<span class="main">(</span><span class="free">m</span><span class="main">(</span><span class="free">a</span><span class="main">|-&gt;</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> insert <span class="free">a</span> <span class="main">(</span>dom <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>rtrancl›</span></span></span></span>›</span></span>

<span class="keyword1" id="Contrib-rtrancl_Int"><span class="command">lemma</span></span> rtrancl_Int<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span>  <span class="free">B</span><span class="main">)</span><span class="main">^*</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Contrib-rtrancl_mem_Sigma"><span class="command">lemma</span></span> rtrancl_mem_Sigma<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span><span class="main">;</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">A</span><span class="main">)</span><span class="main">^*</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> rtranclD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">×</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trancl_subset_Sigma<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Contrib-help_rtrancl_Range"><span class="command">lemma</span></span> help_rtrancl_Range<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span><span class="main">;</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">^*</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> Range <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rtranclE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Contrib-rtrancl_Int_help"><span class="command">lemma</span></span> rtrancl_Int_help<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span> <span class="main">^*</span>  <span class="main">==&gt;</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span><span class="main">^*</span> <span class="main">∧</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">B</span><span class="main">^*</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Int_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rtrancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rtrancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> rtrancl_Int1 <span class="main">=</span> rtrancl_Int_help <span class="main">[</span><span class="operator">THEN</span> conjunct1<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> rtrancl_Int2 <span class="main">=</span> rtrancl_Int_help <span class="main">[</span><span class="operator">THEN</span> conjunct2<span class="main">]</span>

<span class="keyword1" id="Contrib-tranclD3"><span class="command">lemma</span></span> tranclD3 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">^+</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∉</span> <span class="free">R</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">U</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">^+</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">R</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Contrib-tranclD4"><span class="command">lemma</span></span> tranclD4 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">^+</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∉</span> <span class="free">R</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">^+</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">U</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">R</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Contrib-trancl_collect"><span class="command">lemma</span></span> trancl_collect <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">^*</span><span class="main">;</span> <span class="free">S</span> <span class="main">∉</span> Domain <span class="free">R</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≠</span> <span class="free">S</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> fst <span class="bound">p</span> <span class="main">≠</span> <span class="free">S</span> <span class="main">∧</span> snd <span class="bound">p</span> <span class="main">≠</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">R</span><span class="main">}</span><span class="main">^*</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rtrancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Contrib-trancl_subseteq"><span class="command">lemma</span></span> trancl_subseteq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">R</span> <span class="main">⊆</span> <span class="free">Q</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> <span class="free">R</span><span class="main">^*</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">^*</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> rtrancl_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Contrib-trancl_Int_subset"><span class="command">lemma</span></span> trancl_Int_subset<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">∩</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊆</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">∩</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> S<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> T V<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">T</span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">V</span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="free"><span class="free"><span class="free">R</span></span></span>  <span class="main"><span class="main"><span class="main">∩</span></span></span> <span class="free"><span class="free"><span class="free">A</span></span></span> <span class="main"><span class="main"><span class="main">×</span></span></span> <span class="free"><span class="free"><span class="free">A</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> converse_trancl_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Contrib-trancl_Int_mem"><span class="command">lemma</span></span> trancl_Int_mem<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">∩</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span>  <span class="main">∈</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">∩</span> <span class="free">A</span> <span class="main">×</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> trancl_Int_subset <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> subsetD<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>

<span class="keyword1" id="Contrib-Int_expand"><span class="command">lemma</span></span> Int_expand<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span><span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">S</span> <span class="bound">S'</span> <span class="main">∧</span>  <span class="free">Q</span> <span class="bound">S</span> <span class="bound">S'</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span><span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">S</span> <span class="bound">S'</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span><span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">S</span> <span class="bound">S'</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>finite›</span></span></span></span>›</span></span>

<span class="keyword1" id="Contrib-finite_conj"><span class="command">lemma</span></span> finite_conj<span class="main">:</span>  
 <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span><span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">S</span> <span class="bound">S'</span><span class="main">}</span><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">*</span><span class="tfree">'b</span><span class="main">)</span>set<span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>  
     finite <span class="main">{</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span><span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">S</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(</span><span class="bound">S'</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">S</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(</span><span class="bound">S'</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Int_expand<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_Int<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Contrib-finite_conj2"><span class="command">lemma</span></span> finite_conj2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> finite <span class="free">A</span><span class="main">;</span> finite <span class="free">B</span> <span class="main">⟧</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span><span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="bound">S</span><span class="main">:</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">S'</span> <span class="main">:</span> <span class="free">B</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>override›</span></span></span></span>›</span></span>

<span class="keyword1" id="Contrib-dom_override_the"><span class="command">lemma</span></span> dom_override_the<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∈</span> <span class="main">(</span>dom <span class="free">G2</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">++</span> <span class="free">G2</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">G2</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Contrib-dom_override_the2"><span class="command">lemma</span></span> dom_override_the2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> dom <span class="free">G1</span> <span class="main">∩</span> dom <span class="free">G2</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">(</span>dom <span class="free">G1</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">++</span> <span class="free">G2</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">G1</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> dom_def map_add_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> sym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> equalityE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Int_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 

<span class="keyword1" id="Contrib-dom_override_the3"><span class="command">lemma</span></span> dom_override_the3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="free">G2</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="free">G1</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">++</span> <span class="free">G2</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">G1</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> dom_def map_add_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Contrib-Union_ran_override"><span class="command">lemma</span></span> Union_ran_override <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> dom <span class="free">G</span> <span class="main">⟹</span> <span class="main">⋃</span> <span class="main">(</span>ran <span class="main">(</span><span class="free">G</span> <span class="main">++</span> Map.empty<span class="main">(</span><span class="free">S</span> <span class="main">↦</span> insert <span class="free">SA</span> <span class="main">(</span>the<span class="main">(</span><span class="free">G</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
   <span class="main">(</span>insert <span class="free">SA</span> <span class="main">(</span>Union <span class="main">(</span>ran <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> dom_def ran_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> T<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">T</span> <span class="main">=</span> <span class="free">S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Contrib-Union_ran_override2"><span class="command">lemma</span></span> Union_ran_override2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> dom <span class="free">G</span> <span class="main">⟹</span> <span class="main">⋃</span> <span class="main">(</span>ran <span class="main">(</span><span class="free">G</span><span class="main">(</span><span class="free">S</span> <span class="main">↦</span> insert <span class="free">SA</span> <span class="main">(</span>the<span class="main">(</span><span class="free">G</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>insert <span class="free">SA</span> <span class="main">(</span>Union <span class="main">(</span>ran <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> dom_def ran_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> T<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">T</span> <span class="main">=</span> <span class="free">S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Contrib-ran_override"><span class="command">lemma</span></span> ran_override <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>dom <span class="free">A</span> <span class="main">∩</span> dom <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> ran <span class="main">(</span><span class="free">A</span> <span class="main">++</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ran <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>ran <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Int_def ran_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_add_Some_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Contrib-chg_map_new"><span class="command">lemma</span></span> chg_map_new <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="free">a</span> <span class="main">=</span> None <span class="main">⟹</span> chg_map <span class="free">f</span> <span class="free">a</span> <span class="free">m</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> chg_map_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Contrib-chg_map_upd"><span class="command">lemma</span></span> chg_map_upd <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="free">a</span> <span class="main">=</span> Some <span class="free">b</span> <span class="main">⟹</span> chg_map <span class="free">f</span> <span class="free">a</span> <span class="free">m</span> <span class="main">=</span> <span class="free">m</span><span class="main">(</span><span class="free">a</span><span class="main">|-&gt;</span><span class="free">f</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> chg_map_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Contrib-ran_override_chg_map"><span class="command">lemma</span></span> ran_override_chg_map<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> dom <span class="free">G</span> <span class="main">⟹</span> ran <span class="main">(</span><span class="free">G</span> <span class="main">++</span> Map.empty<span class="main">(</span><span class="free">A</span><span class="main">|-&gt;</span><span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ran <span class="main">(</span>chg_map <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">B</span><span class="main">)</span> <span class="free">A</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> dom_def ran_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> map_add_Some_iff <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> ext<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> T<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">T</span> <span class="main">=</span> <span class="free">A</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Part›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span>  <span class="entity">Part</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'b</span> <span class="main">=&gt;</span> <span class="tfree">'a</span><span class="main">]</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
            <span class="quoted"><span class="quoted">"<span class="free">Part</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∩</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">(</span><span class="bound">z</span><span class="main">)</span><span class="main">}</span>"</span></span>
 

<span class="keyword1" id="Contrib-Part_UNIV_Inl_comp"><span class="command">lemma</span></span> Part_UNIV_Inl_comp<span class="main">:</span> 
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Part UNIV <span class="main">(</span>Inl <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Part UNIV <span class="main">(</span>Inl <span class="keyword1">o</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>Part UNIV <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Part UNIV <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Part_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> equalityE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> subsetCE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> equalityE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> subsetCE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Contrib-Part_eqI"><span class="command">lemma</span></span> Part_eqI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">a</span><span class="main">=</span><span class="free">h</span><span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> Part <span class="free">A</span> <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Part_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> PartI <span class="main">=</span> Part_eqI <span class="main">[</span><span class="operator">OF</span> _ refl<span class="main">]</span>

<span class="keyword1" id="Contrib-PartE"><span class="command">lemma</span></span> PartE <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> Part <span class="free">A</span> <span class="free">h</span><span class="main">;</span>  <span class="main">!!</span><span class="bound">z</span><span class="main">.</span> <span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span>  <span class="free">a</span><span class="main">=</span><span class="free">h</span><span class="main">(</span><span class="bound">z</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Part_def<span class="main">)</span>

<span class="keyword1" id="Contrib-Part_subset"><span class="command">lemma</span></span> Part_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"Part <span class="free">A</span> <span class="free">h</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Part_def<span class="main">)</span>

<span class="keyword1" id="Contrib-Part_mono"><span class="command">lemma</span></span> Part_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> Part <span class="free">A</span> <span class="free">h</span> <span class="main">⊆</span> Part <span class="free">B</span> <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemmas</span></span> basic_monos <span class="main">=</span> basic_monos Part_mono

<span class="keyword1" id="Contrib-PartD1"><span class="command">lemma</span></span> PartD1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> Part <span class="free">A</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Part_def<span class="main">)</span>

<span class="keyword1" id="Contrib-Part_id"><span class="command">lemma</span></span> Part_id<span class="main">:</span> <span class="quoted"><span class="quoted">"Part <span class="free">A</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Contrib-Part_Int"><span class="command">lemma</span></span> Part_Int<span class="main">:</span> <span class="quoted"><span class="quoted">"Part <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span> <span class="free">h</span> <span class="main">=</span> <span class="main">(</span>Part <span class="free">A</span> <span class="free">h</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>Part <span class="free">B</span> <span class="free">h</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Contrib-Part_Collect"><span class="command">lemma</span></span> Part_Collect<span class="main">:</span> <span class="quoted"><span class="quoted">"Part <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="free">h</span> <span class="main">=</span> <span class="main">(</span>Part <span class="free">A</span> <span class="free">h</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Set operators›</span></span>

<span class="keyword1" id="Contrib-subset_lemma"><span class="command">lemma</span></span> subset_lemma<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Contrib-subset_lemma2"><span class="command">lemma</span></span> subset_lemma2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">B</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free">C</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">C</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Contrib-insert_inter"><span class="command">lemma</span></span> insert_inter<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∉</span> <span class="free">A</span><span class="main">;</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">(</span>insert <span class="free">a</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Contrib-insert_notmem"><span class="command">lemma</span></span> insert_notmem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span><span class="main">;</span> <span class="free">a</span> <span class="main">∉</span> <span class="free">B</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∉</span> <span class="main">(</span>insert <span class="free">b</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Contrib-insert_union"><span class="command">lemma</span></span> insert_union<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∪</span> <span class="main">(</span>insert <span class="free">a</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> insert <span class="free">a</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Contrib-insert_or"><span class="command">lemma</span></span> insert_or<span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">t1</span> <span class="main">∨</span>  <span class="main">(</span><span class="free">P</span> <span class="bound">s</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> insert <span class="free">t1</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Contrib-Collect_subset"><span class="command">lemma</span></span> Collect_subset<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> Pow <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Contrib-OneElement_Card"><span class="command">lemma</span></span> OneElement_Card <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> finite <span class="free">M</span><span class="main">;</span> card <span class="free">M</span> <span class="main">&lt;=</span> Suc <span class="main">0</span><span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">M</span> <span class="main">=</span> <span class="main">{</span><span class="free">t</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> s<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"finite <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> mp<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"card <span class="free">M</span> <span class="main">&lt;=</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> mp<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> mp<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> F<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> finite_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"finite <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> mp<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"card <span class="free">M</span> <span class="main">&lt;=</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> mp<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">s</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> mp<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> mp<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> F<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> finite_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
  
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹One point rule›</span></span>

<span class="keyword1" id="Contrib-Ex1_one_point"><span class="command">lemma</span></span> Ex1_one_point <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃!</span> <span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Contrib-Ex1_one_point2"><span class="command">lemma</span></span> Ex1_one_point2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃!</span> <span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">Q</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Contrib-Some_one_point"><span class="command">lemma</span></span> Some_one_point <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Contrib-Some_one_point2"><span class="command">lemma</span></span> Some_one_point2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">Q</span> <span class="free">a</span><span class="main">;</span> <span class="free">P</span> <span class="free">a</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="DataSpace">
<div class="head">
<h1>Theory DataSpace</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      statecharts/DataSpace/DataSpace.thy

    Author:     Steffen Helke, Software Engineering Group
    Copyright   2010 Technische Universitaet Berlin
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Partitoned Data Spaces for Statecharts›</span></span>
<span class="keyword1"><span class="command">theory</span></span> DataSpace
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Contrib">Contrib</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">DataSpace</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> set<span class="main">)</span> list
                <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">DataSpace</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>distinct <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span> <span class="main">∧</span> 
                  <span class="main">(</span><span class="main">∀</span> <span class="bound">D1</span><span class="main">∈</span><span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">D2</span><span class="main">∈</span><span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span><span class="main">.</span>
                             <span class="bound">D1</span> <span class="main">≠</span> <span class="bound">D2</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="bound">D1</span> <span class="main">∩</span> <span class="bound">D2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> UNIV<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="DataSpace-DataSpace_EmptySet"><span class="command">lemma</span></span> DataSpace_EmptySet<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">[</span>UNIV<span class="main">]</span> <span class="main">∈</span> <span class="main">{</span> <span class="bound">L</span> <span class="main">|</span> <span class="bound">L</span><span class="main">.</span> DataSpace <span class="bound">L</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> DataSpace_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">dataspace</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">L</span> <span class="main">|</span> <span class="main">(</span><span class="bound">L</span><span class="main">::</span><span class="main">(</span><span class="tfree">'d</span> set<span class="main">)</span> list<span class="main">)</span><span class="main">.</span> DataSpace <span class="bound">L</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="tfree">'d</span> dataspace <span class="main">=</span> <span class="quoted"><span class="quoted">"dataspace <span class="main">::</span> <span class="tfree">'d</span> set list set"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dataspace_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> DataSpace_EmptySet<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">PartNum</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span><span class="main">)</span>dataspace <span class="main">=&gt;</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">PartNum</span> <span class="main">=</span> length <span class="keyword1">o</span> Rep_dataspace"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">PartDom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'d</span> dataspace<span class="main">,</span> nat<span class="main">]</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'d</span> set<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">!D!</span>"</span> 101<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">PartDom</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span>Rep_dataspace <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span> 

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lemmas›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>DataSpace›</span></span></span></span>›</span></span>

<span class="keyword1" id="DataSpace-DataSpace_UNIV"><span class="command">lemma</span></span> DataSpace_UNIV <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"DataSpace <span class="main">[</span>UNIV<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> DataSpace_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="DataSpace-DataSpace_select"><span class="command">lemma</span></span> DataSpace_select<span class="main">:</span> 
 <span class="quoted"><span class="quoted">"DataSpace <span class="main">(</span>Rep_dataspace <span class="free">L</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">L</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span>  Rep_dataspace<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> dataspace_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="DataSpace-UNIV_dataspace"><span class="command">lemma</span></span> UNIV_dataspace <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">[</span>UNIV<span class="main">]</span> <span class="main">∈</span> dataspace"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> dataspace_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="DataSpace-Inl_Inr_DataSpace"><span class="command">lemma</span></span> Inl_Inr_DataSpace <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"DataSpace <span class="main">[</span>Part UNIV Inl<span class="main">,</span> Part UNIV Inr<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> DataSpace_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> d<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>inv Inl<span class="main">)</span> <span class="improper">d</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Part_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">d</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="DataSpace-Inl_Inr_dataspace"><span class="command">lemma</span></span> Inl_Inr_dataspace <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span>Part UNIV Inl<span class="main">,</span> Part UNIV Inr<span class="main">]</span> <span class="main">∈</span> dataspace"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> dataspace_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="DataSpace-InlInr_InlInl_Inr_DataSpace"><span class="command">lemma</span></span> InlInr_InlInl_Inr_DataSpace <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"DataSpace <span class="main">[</span>Part UNIV <span class="main">(</span>Inl <span class="keyword1">o</span> Inr<span class="main">)</span><span class="main">,</span> Part UNIV <span class="main">(</span>Inl <span class="keyword1">o</span> Inl<span class="main">)</span><span class="main">,</span> Part UNIV Inr<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> DataSpace_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Part_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> a<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="DataSpace-InlInr_InlInl_Inr_dataspace"><span class="command">lemma</span></span> InlInr_InlInl_Inr_dataspace <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span>Part UNIV <span class="main">(</span>Inl <span class="keyword1">o</span> Inr<span class="main">)</span><span class="main">,</span> Part UNIV <span class="main">(</span>Inl <span class="keyword1">o</span> Inl<span class="main">)</span><span class="main">,</span> Part UNIV Inr<span class="main">]</span> <span class="main">:</span> dataspace"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> dataspace_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>PartNum›</span></span></span></span>›</span></span>

<span class="keyword1" id="DataSpace-PartDom_PartNum_distinct"><span class="command">lemma</span></span> PartDom_PartNum_distinct<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">i</span> <span class="main">&lt;</span> PartNum <span class="free">d</span><span class="main">;</span> <span class="free">j</span> <span class="main">&lt;</span> PartNum <span class="free">d</span><span class="main">;</span>        
         <span class="free">i</span> <span class="main">≠</span> <span class="free">j</span><span class="main">;</span> <span class="free">p</span> <span class="main">∈</span>  <span class="main">(</span><span class="free">d</span> <span class="keyword1">!D!</span> <span class="free">i</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
         <span class="free">p</span> <span class="main">∉</span> <span class="main">(</span><span class="free">d</span> <span class="keyword1">!D!</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> L<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> DataSpace_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> DataSpace_def<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Rep_dataspace <span class="free">d</span> <span class="main">!</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Rep_dataspace <span class="free">d</span> <span class="main">!</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>distinct_conv_nth PartNum_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> PartDom_def PartNum_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="DataSpace-PartDom_PartNum_distinct2"><span class="command">lemma</span></span> PartDom_PartNum_distinct2<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">i</span> <span class="main">&lt;</span> PartNum <span class="free">d</span><span class="main">;</span> <span class="free">j</span> <span class="main">&lt;</span> PartNum <span class="free">d</span><span class="main">;</span>       
         <span class="free">i</span> <span class="main">≠</span> <span class="free">j</span><span class="main">;</span> <span class="free">p</span> <span class="main">∈</span>  <span class="main">(</span><span class="free">d</span> <span class="keyword1">!D!</span> <span class="free">j</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
        <span class="free">p</span> <span class="main">∉</span> <span class="main">(</span><span class="free">d</span> <span class="keyword1">!D!</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> L<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> DataSpace_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> DataSpace_def<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Rep_dataspace <span class="free">d</span> <span class="main">!</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Rep_dataspace <span class="free">d</span> <span class="main">!</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>distinct_conv_nth PartNum_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> PartDom_def PartNum_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="DataSpace-PartNum_length"><span class="command">lemma</span></span> PartNum_length <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span>DataSpace <span class="free">L</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>PartNum <span class="main">(</span>Abs_dataspace <span class="free">L</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="free">L</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> PartNum_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_dataspace_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> dataspace_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Data">
<div class="head">
<h1>Theory Data</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      statecharts/DataSpace/Data.thy

    Author:     Steffen Helke, Software Engineering Group
    Copyright   2010 Technische Universitaet Berlin
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Data Space Assignments›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Data
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#DataSpace">DataSpace</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Total data space assignments›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Data</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'d</span> list<span class="main">,</span> <span class="tfree">'d</span> dataspace<span class="main">]</span>
                <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Data</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>PartNum <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
               <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="main">(</span>PartNum <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>PartDom <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Data-Data_EmptySet"><span class="command">lemma</span></span> Data_EmptySet<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="main">@</span> <span class="bound">t</span><span class="main">.</span> True<span class="main">]</span><span class="main">,</span> Abs_dataspace <span class="main">[</span>UNIV<span class="main">]</span><span class="main">)</span><span class="main">∈</span> <span class="main">{</span> <span class="main">(</span><span class="bound">L</span><span class="main">,</span><span class="bound">D</span><span class="main">)</span> <span class="main">|</span> <span class="bound">L</span> <span class="bound">D</span><span class="main">.</span> Data <span class="bound">L</span> <span class="bound">D</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Data_def PartDom_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_dataspace_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">data</span> <span class="main">=</span>
    <span class="main">{</span> <span class="main">(</span><span class="bound">L</span><span class="main">,</span><span class="bound">D</span><span class="main">)</span> <span class="main">|</span>
             <span class="main">(</span><span class="bound">L</span><span class="main">::</span><span class="main">(</span><span class="tfree">'d</span> list<span class="main">)</span><span class="main">)</span>
             <span class="main">(</span><span class="bound">D</span><span class="main">::</span><span class="main">(</span><span class="tfree">'d</span> dataspace<span class="main">)</span><span class="main">)</span><span class="main">.</span>
              Data <span class="bound">L</span> <span class="bound">D</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="tfree">'d</span> data <span class="main">=</span> <span class="quoted"><span class="quoted">"data <span class="main">::</span> <span class="main">(</span><span class="tfree">'d</span> list <span class="main">*</span> <span class="tfree">'d</span> dataspace<span class="main">)</span> set"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> data_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Data_EmptySet<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">DataValue</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> data<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'d</span> list<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">DataValue</span> <span class="main">=</span> fst <span class="keyword1">o</span> Rep_data"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">DataSpace</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> data<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'d</span> dataspace<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">DataSpace</span> <span class="main">=</span> snd <span class="keyword1">o</span> Rep_data"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">DataPart</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'d</span> data<span class="main">,</span> nat<span class="main">]</span> <span class="main">=&gt;</span> <span class="tfree">'d</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">!P!</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>10<span class="main">,</span>11<span class="main">]</span>10<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">DataPart</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span>DataValue <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1" id="Data-Rep_data_tuple"><span class="command">lemma</span></span> Rep_data_tuple<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Rep_data <span class="free">D</span> <span class="main">=</span> <span class="main">(</span>DataValue <span class="free">D</span><span class="main">,</span> DataSpace <span class="free">D</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> DataValue_def DataSpace_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Data-Rep_data_select"><span class="command">lemma</span></span> Rep_data_select<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span>DataValue <span class="free">D</span><span class="main">,</span> DataSpace <span class="free">D</span><span class="main">)</span> <span class="main">∈</span> data"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Rep_data_tuple <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Rep_data<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Data-Data_select"><span class="command">lemma</span></span> Data_select<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Data <span class="main">(</span>DataValue <span class="free">D</span><span class="main">)</span> <span class="main">(</span>DataSpace <span class="free">D</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> D<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">D</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Rep_data_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> data_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Data-length_DataValue_PartNum"><span class="command">lemma</span></span> length_DataValue_PartNum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"length <span class="main">(</span>DataValue <span class="free">D</span><span class="main">)</span> <span class="main">=</span> PartNum <span class="main">(</span>Data.DataSpace <span class="free">D</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> D<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">D</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Data_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Data_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Data-DataValue_PartDom"><span class="command">lemma</span></span> DataValue_PartDom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> PartNum <span class="main">(</span>Data.DataSpace <span class="free">D</span><span class="main">)</span> <span class="main">⟹</span>
   DataValue <span class="free">D</span> <span class="main">!</span> <span class="free">i</span> <span class="main">∈</span> PartDom <span class="main">(</span>Data.DataSpace <span class="free">D</span><span class="main">)</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> D<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">D</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Data_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Data_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 

<span class="keyword1" id="Data-DataPart_PartDom"><span class="command">lemma</span></span> DataPart_PartDom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> PartNum <span class="main">(</span>Data.DataSpace <span class="free">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">d</span> <span class="keyword1">!P!</span> <span class="free">i</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span>Data.DataSpace <span class="free">d</span><span class="main">)</span> <span class="keyword1">!D!</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> DataPart_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Partial data space assignments›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">PData</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'d</span> option list<span class="main">,</span> <span class="tfree">'d</span> dataspace<span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">PData</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">==</span> <span class="main">(</span><span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>PartNum <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
                <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="main">(</span>PartNum <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span><span class="main">}</span><span class="main">.</span>
                    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> None <span class="main">⟶</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>PartDom <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Data-PData_EmptySet"><span class="command">lemma</span></span> PData_EmptySet<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>Some <span class="main">(</span><span class="main">@</span> <span class="bound">t</span><span class="main">.</span> True<span class="main">)</span><span class="main">]</span><span class="main">,</span> Abs_dataspace <span class="main">[</span>UNIV<span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span> <span class="main">(</span><span class="bound">L</span><span class="main">,</span><span class="bound">D</span><span class="main">)</span> <span class="main">|</span> <span class="bound">L</span> <span class="bound">D</span><span class="main">.</span> PData <span class="bound">L</span> <span class="bound">D</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> PData_def PartDom_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_dataspace_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pdata</span> <span class="main">=</span>
    <span class="main">{</span> <span class="main">(</span><span class="bound">L</span><span class="main">,</span><span class="bound">D</span><span class="main">)</span> <span class="main">|</span>
             <span class="main">(</span><span class="bound">L</span><span class="main">::</span><span class="main">(</span><span class="tfree">'d</span> option list<span class="main">)</span><span class="main">)</span>
             <span class="main">(</span><span class="bound">D</span><span class="main">::</span><span class="main">(</span><span class="tfree">'d</span> dataspace<span class="main">)</span><span class="main">)</span><span class="main">.</span>
              PData <span class="bound">L</span> <span class="bound">D</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="tfree">'d</span> pdata <span class="main">=</span> <span class="quoted"><span class="quoted">"pdata <span class="main">::</span> <span class="main">(</span><span class="tfree">'d</span> option list <span class="main">*</span> <span class="tfree">'d</span> dataspace<span class="main">)</span> set"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> pdata_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> PData_EmptySet<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">PDataValue</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> pdata<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'d</span> option list<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">PDataValue</span> <span class="main">=</span> fst <span class="keyword1">o</span> Rep_pdata"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">PDataSpace</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> pdata<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'d</span> dataspace<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">PDataSpace</span> <span class="main">=</span> snd <span class="keyword1">o</span> Rep_pdata"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Data2PData</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> data<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'d</span> pdata<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Data2PData</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span>
                      <span class="main">(</span><span class="bound">L</span><span class="main">,</span><span class="bound">DP</span><span class="main">)</span> <span class="main">=</span> Rep_data <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">;</span>
                      <span class="bound">OL</span>     <span class="main">=</span> map Some <span class="bound">L</span>
                  <span class="keyword1">in</span>
                      Abs_pdata <span class="main">(</span><span class="bound">OL</span><span class="main">,</span><span class="bound">DP</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">PData2Data</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> pdata<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'d</span> data<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">PData2Data</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span>
                      <span class="main">(</span><span class="bound">OL</span><span class="main">,</span><span class="bound">DP</span><span class="main">)</span> <span class="main">=</span> Rep_pdata <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">;</span>
                       <span class="bound">L</span>      <span class="main">=</span> map the <span class="bound">OL</span>
                  <span class="keyword1">in</span>
                      Abs_data <span class="main">(</span><span class="bound">L</span><span class="main">,</span><span class="bound">DP</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">DefaultPData</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> dataspace<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'d</span> pdata<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">DefaultPData</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">=</span> Abs_pdata <span class="main">(</span>replicate <span class="main">(</span>PartNum <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span> None<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">OptionOverride</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> option <span class="main">*</span> <span class="tfree">'d</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="tfree">'d</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">OptionOverride</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">=</span> None <span class="keyword1">then</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span>the <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">DataOverride</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'d</span> pdata<span class="main">,</span> <span class="tfree">'d</span> data<span class="main">]</span> <span class="main">=&gt;</span> <span class="tfree">'d</span> data"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">[D+]</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>10<span class="main">,</span>11<span class="main">]</span>10<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">DataOverride</span> <span class="free"><span class="bound"><span class="entity">D1</span></span></span> <span class="free"><span class="bound"><span class="entity">D2</span></span></span> <span class="main">=</span>
                <span class="main">(</span><span class="keyword1">let</span>
                    <span class="main">(</span><span class="bound">L1</span><span class="main">,</span><span class="bound">DP1</span><span class="main">)</span> <span class="main">=</span> Rep_pdata <span class="free"><span class="bound"><span class="entity">D1</span></span></span><span class="main">;</span>
                    <span class="main">(</span><span class="bound">L2</span><span class="main">,</span><span class="bound">DP2</span><span class="main">)</span> <span class="main">=</span> Rep_data <span class="free"><span class="bound"><span class="entity">D2</span></span></span><span class="main">;</span>
                    <span class="bound">L</span>        <span class="main">=</span> map OptionOverride <span class="main">(</span>zip <span class="bound">L1</span> <span class="bound">L2</span><span class="main">)</span>
                 <span class="keyword1">in</span>
                    Abs_data <span class="main">(</span><span class="bound">L</span><span class="main">,</span><span class="bound">DP2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Data-Rep_pdata_tuple"><span class="command">lemma</span></span> Rep_pdata_tuple<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Rep_pdata <span class="free">D</span> <span class="main">=</span> <span class="main">(</span>PDataValue <span class="free">D</span><span class="main">,</span> PDataSpace <span class="free">D</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> PDataValue_def PDataSpace_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Data-Rep_pdata_select"><span class="command">lemma</span></span> Rep_pdata_select<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>PDataValue <span class="free">D</span><span class="main">,</span> PDataSpace <span class="free">D</span><span class="main">)</span> <span class="main">∈</span> pdata"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Rep_pdata_tuple <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Rep_pdata<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Data-PData_select"><span class="command">lemma</span></span> PData_select<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"PData <span class="main">(</span>PDataValue <span class="free">D</span><span class="main">)</span> <span class="main">(</span>PDataSpace <span class="free">D</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> D<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">D</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Rep_pdata_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> pdata_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>DefaultPData›</span></span></span></span>›</span></span>

<span class="keyword1" id="Data-PData_DefaultPData"><span class="command">lemma</span></span> PData_DefaultPData <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"PData <span class="main">(</span>replicate <span class="main">(</span>PartNum <span class="free">D</span><span class="main">)</span> None<span class="main">)</span> <span class="free">D</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> PData_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Data-pdata_DefaultPData"><span class="command">lemma</span></span> pdata_DefaultPData <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span>replicate <span class="main">(</span>PartNum <span class="free">D</span><span class="main">)</span> None<span class="main">,</span> <span class="free">D</span><span class="main">)</span> <span class="main">∈</span> pdata "</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> pdata_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Data-PDataSpace_DefaultPData"><span class="command">lemma</span></span> PDataSpace_DefaultPData <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"PDataSpace <span class="main">(</span>DefaultPData <span class="free">D</span><span class="main">)</span> <span class="main">=</span> <span class="free">D</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> DataSpace_def PDataSpace_def DefaultPData_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_pdata_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Data-length_PartNum_PData"><span class="command">lemma</span></span> length_PartNum_PData <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="main">(</span>PDataValue <span class="free">P</span><span class="main">)</span> <span class="main">=</span> PartNum <span class="main">(</span>PDataSpace <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> D<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">P</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Rep_pdata_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> pdata_def PData_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Data2PData›</span></span></span></span>›</span></span>

<span class="keyword1" id="Data-PData_Data2PData"><span class="command">lemma</span></span> PData_Data2PData <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"PData <span class="main">(</span>map Some <span class="main">(</span>DataValue <span class="free">D</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Data.DataSpace <span class="free">D</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> PData_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Data-pdata_Data2PData"><span class="command">lemma</span></span> pdata_Data2PData <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>map Some <span class="main">(</span>DataValue <span class="free">D</span><span class="main">)</span><span class="main">,</span> Data.DataSpace <span class="free">D</span><span class="main">)</span> <span class="main">∈</span> pdata"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> pdata_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Data-DataSpace_Data2PData"><span class="command">lemma</span></span> DataSpace_Data2PData <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>PDataSpace <span class="main">(</span>Data2PData <span class="free">D</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Data.DataSpace <span class="free">D</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> DataSpace_def PDataSpace_def Data2PData_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> D<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">D</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Rep_data_tuple<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_pdata_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Data-PDataValue_Data2PData_DataValue"><span class="command">lemma</span></span> PDataValue_Data2PData_DataValue <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span>map the <span class="main">(</span>PDataValue <span class="main">(</span>Data2PData <span class="free">D</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> DataValue <span class="free">D</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> DataValue_def PDataValue_def Data2PData_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> D<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">D</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Rep_data_tuple<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_pdata_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> map_map<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Data-DataSpace_PData2Data"><span class="command">lemma</span></span> DataSpace_PData2Data<span class="main">:</span>  
   <span class="quoted"><span class="quoted">"Data <span class="main">(</span>map the <span class="main">(</span>PDataValue <span class="free">D</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>PDataSpace <span class="free">D</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span>Data.DataSpace <span class="main">(</span>PData2Data <span class="free">D</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>PDataSpace <span class="free">D</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> DataSpace_def PDataSpace_def PData2Data_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> D<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">D</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Rep_pdata_tuple<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_data_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> data_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Data-PartNum_PDataValue_PartDom"><span class="command">lemma</span></span> PartNum_PDataValue_PartDom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">i</span> <span class="main">&lt;</span> PartNum <span class="main">(</span>PDataSpace <span class="free">Q</span><span class="main">)</span><span class="main">;</span>
      PDataValue <span class="free">Q</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> Some <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span>
      <span class="free">y</span> <span class="main">∈</span> PartDom <span class="main">(</span>PDataSpace <span class="free">Q</span><span class="main">)</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> D<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Rep_pdata_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> pdata_def PData_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>DataOverride›</span></span></span></span>›</span></span>

<span class="keyword1" id="Data-Data_DataOverride"><span class="command">lemma</span></span> Data_DataOverride<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>PDataSpace <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Data.DataSpace <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
  Data <span class="main">(</span>map OptionOverride <span class="main">(</span>zip <span class="main">(</span>PDataValue <span class="free">P</span><span class="main">)</span> <span class="main">(</span>Data.DataValue <span class="free">Q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Data.DataSpace <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Data_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> OptionOverride_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> i D<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"PDataValue <span class="free">P</span> <span class="main">!</span> <span class="improper">i</span> <span class="main">=</span> None"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> sym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Data-data_DataOverride"><span class="command">lemma</span></span> data_DataOverride<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>PDataSpace <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Data.DataSpace <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span>map OptionOverride <span class="main">(</span>zip <span class="main">(</span>PDataValue <span class="free">P</span><span class="main">)</span> <span class="main">(</span>Data.DataValue <span class="free">Q</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Data.DataSpace <span class="free">Q</span><span class="main">)</span> <span class="main">∈</span> data"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> data_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Data_DataOverride<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Data-DataSpace_DataOverride"><span class="command">lemma</span></span> DataSpace_DataOverride <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Data.DataSpace <span class="free">D</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>PDataSpace <span class="free">E</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   Data.DataSpace <span class="main">(</span><span class="free">E</span> <span class="keyword1">[D+]</span> <span class="free">D</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Data.DataSpace <span class="free">D</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> DataSpace_def DataOverride_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> D<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">D</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Rep_data_tuple<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> D<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">E</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Rep_pdata_tuple<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_data_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> sym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> data_DataOverride<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Data-DataValue_DataOverride"><span class="command">lemma</span></span> DataValue_DataOverride <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>PDataSpace <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Data.DataSpace <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="main">(</span>DataValue <span class="main">(</span><span class="free">P</span> <span class="keyword1">[D+]</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>map OptionOverride <span class="main">(</span>zip <span class="main">(</span>PDataValue <span class="free">P</span><span class="main">)</span> <span class="main">(</span>Data.DataValue <span class="free">Q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> DataValue_def DataOverride_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> D<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">P</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Rep_pdata_tuple<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> D<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Rep_data_tuple<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_data_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> data_DataOverride<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>OptionOverride›</span></span></span></span>›</span></span>

<span class="keyword1" id="Data-DataValue_OptionOverride_nth"><span class="command">lemma</span></span> DataValue_OptionOverride_nth<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="main">(</span>PDataSpace <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>DataSpace <span class="free">Q</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="free">i</span> <span class="main">&lt;</span> PartNum <span class="main">(</span>DataSpace <span class="free">Q</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
    <span class="main">(</span>DataValue <span class="main">(</span><span class="free">P</span> <span class="keyword1">[D+]</span> <span class="free">Q</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> 
    OptionOverride <span class="main">(</span>PDataValue <span class="free">P</span> <span class="main">!</span> <span class="free">i</span><span class="main">,</span> DataValue <span class="free">Q</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Data-None_OptionOverride"><span class="command">lemma</span></span> None_OptionOverride <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="free">P</span><span class="main">)</span> <span class="main">=</span> None <span class="main">⟹</span> OptionOverride <span class="free">P</span> <span class="main">=</span> <span class="main">(</span>snd <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> OptionOverride_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Data-Some_OptionOverride"><span class="command">lemma</span></span> Some_OptionOverride <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="free">P</span><span class="main">)</span> <span class="main">≠</span> None <span class="main">⟹</span> OptionOverride <span class="free">P</span> <span class="main">=</span> the <span class="main">(</span>fst <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> OptionOverride_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Update">
<div class="head">
<h1>Theory Update</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      statecharts/DataSpace/Update.thy

    Author:     Steffen Helke, Software Engineering Group
    Copyright   2010 Technische Universitaet Berlin
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Update-Functions on Data Spaces›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Update
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Data">Data</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Total update-functions›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Update</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'d</span> data<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'d</span> data<span class="main">)</span><span class="main">)</span> <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">Update</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">d</span><span class="main">.</span> Data.DataSpace <span class="bound">d</span> <span class="main">=</span> DataSpace <span class="main">(</span><span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Update-Update_EmptySet"><span class="command">lemma</span></span> Update_EmptySet<span class="main">:</span> 
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">%</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span> <span class="bound">L</span> <span class="main">|</span> <span class="bound">L</span><span class="main">.</span> Update <span class="bound">L</span><span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Update_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">update</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">L</span> <span class="main">|</span> <span class="main">(</span><span class="bound">L</span><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="tfree">'d</span> data<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'d</span> data<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> Update <span class="bound">L</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="tfree">'d</span> update <span class="main">=</span> <span class="quoted"><span class="quoted">"update <span class="main">::</span> <span class="main">(</span><span class="tfree">'d</span> data <span class="main">=&gt;</span> <span class="tfree">'d</span> data<span class="main">)</span> set"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> update_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Update_EmptySet<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
 
<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">UpdateApply</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'d</span> update<span class="main">,</span> <span class="tfree">'d</span> data<span class="main">]</span> <span class="main">=&gt;</span> <span class="tfree">'d</span> data"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">!!!</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>10<span class="main">,</span>11<span class="main">]</span>10<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">UpdateApply</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">==</span> Rep_update <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">DefaultUpdate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> update<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">DefaultUpdate</span> <span class="main">==</span>  Abs_update <span class="main">(</span><span class="main">λ</span> <span class="bound">D</span><span class="main">.</span> <span class="bound">D</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic lemmas›</span></span>

<span class="keyword1" id="Update-Update_select"><span class="command">lemma</span></span> Update_select<span class="main">:</span>
   <span class="quoted"><span class="quoted">"Update <span class="main">(</span>Rep_update <span class="free">U</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Rep_update<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> update_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Update-DataSpace_DataSpace_Update"><span class="command">lemma</span></span> DataSpace_DataSpace_Update <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"Data.DataSpace <span class="main">(</span>Rep_update <span class="free">U</span> <span class="free">DP</span><span class="main">)</span> <span class="main">=</span> Data.DataSpace <span class="free">DP</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> U<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Update_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Update_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>DefaultUpdate›</span></span></span></span>›</span></span>

<span class="keyword1" id="Update-Update_DefaultUpdate"><span class="command">lemma</span></span> Update_DefaultUpdate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"Update <span class="main">(</span><span class="main">λ</span> <span class="bound">D</span><span class="main">.</span> <span class="bound">D</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Update_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Update-update_DefaultUpdate"><span class="command">lemma</span></span> update_DefaultUpdate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">D</span><span class="main">.</span> <span class="bound">D</span><span class="main">)</span> <span class="main">∈</span> update"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> update_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Update-DataSpace_UpdateApply"><span class="command">lemma</span></span> DataSpace_UpdateApply <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"Data.DataSpace <span class="main">(</span><span class="free">U</span> <span class="main">!!!</span> <span class="free">D</span><span class="main">)</span> <span class="main">=</span> Data.DataSpace <span class="free">D</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> UpdateApply_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Partial update-functions›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">PUpdate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'d</span> data<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'d</span> pdata<span class="main">)</span><span class="main">)</span> <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">PUpdate</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">d</span><span class="main">.</span> Data.DataSpace <span class="bound">d</span> <span class="main">=</span> PDataSpace <span class="main">(</span><span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Update-PUpdate_EmptySet"><span class="command">lemma</span></span> PUpdate_EmptySet<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">%</span> <span class="bound">d</span><span class="main">.</span> Data2PData <span class="bound">d</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span> <span class="bound">L</span> <span class="main">|</span> <span class="bound">L</span><span class="main">.</span> PUpdate <span class="bound">L</span><span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> PUpdate_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">pupdate</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">L</span> <span class="main">|</span> <span class="main">(</span><span class="bound">L</span><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="tfree">'d</span> data<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'d</span> pdata<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> PUpdate <span class="bound">L</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="tfree">'d</span> pupdate <span class="main">=</span> <span class="quoted"><span class="quoted">"pupdate <span class="main">::</span> <span class="main">(</span><span class="tfree">'d</span> data <span class="main">=&gt;</span> <span class="tfree">'d</span> pdata<span class="main">)</span> set"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> pupdate_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> PUpdate_EmptySet<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
 
<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">PUpdateApply</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'d</span> pupdate<span class="main">,</span> <span class="tfree">'d</span> data<span class="main">]</span> <span class="main">=&gt;</span> <span class="tfree">'d</span> pdata"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">!!</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>10<span class="main">,</span>11<span class="main">]</span>10<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">PUpdateApply</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">=</span> Rep_pupdate <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">DefaultPUpdate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> pupdate<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">DefaultPUpdate</span> <span class="main">=</span> Abs_pupdate <span class="main">(</span><span class="main">λ</span> <span class="bound">D</span><span class="main">.</span> DefaultPData <span class="main">(</span>Data.DataSpace <span class="bound">D</span><span class="main">)</span><span class="main">)</span>"</span></span>
                      
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic lemmas›</span></span>

<span class="keyword1" id="Update-PUpdate_select"><span class="command">lemma</span></span> PUpdate_select<span class="main">:</span>
   <span class="quoted"><span class="quoted">"PUpdate <span class="main">(</span>Rep_pupdate <span class="free">U</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Rep_pupdate<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> pupdate_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Update-DataSpace_PDataSpace_PUpdate"><span class="command">lemma</span></span> DataSpace_PDataSpace_PUpdate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"PDataSpace <span class="main">(</span>Rep_pupdate <span class="free">U</span> <span class="free">DP</span><span class="main">)</span> <span class="main">=</span> Data.DataSpace <span class="free">DP</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> U<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> PUpdate_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> PUpdate_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Data2PData›</span></span></span></span>›</span></span>

<span class="keyword1" id="Update-PUpdate_Data2PData"><span class="command">lemma</span></span>  PUpdate_Data2PData <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
   <span class="quoted"><span class="quoted">"PUpdate Data2PData"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> PUpdate_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Update-pupdate_Data2PData"><span class="command">lemma</span></span> pupdate_Data2PData  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"Data2PData <span class="main">∈</span> pupdate"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> pupdate_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>PUpdate›</span></span></span></span>›</span></span>

<span class="keyword1" id="Update-PUpdate_DefaultPUpdate"><span class="command">lemma</span></span> PUpdate_DefaultPUpdate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"PUpdate <span class="main">(</span><span class="main">λ</span> <span class="bound">D</span><span class="main">.</span> DefaultPData <span class="main">(</span>Data.DataSpace <span class="bound">D</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> PUpdate_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Update-pupdate_DefaultPUpdate"><span class="command">lemma</span></span> pupdate_DefaultPUpdate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">D</span><span class="main">.</span> DefaultPData <span class="main">(</span>Data.DataSpace <span class="bound">D</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> pupdate"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> pupdate_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Update-DefaultPUpdate_None"><span class="command">lemma</span></span> DefaultPUpdate_None <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>DefaultPUpdate <span class="main">!!</span> <span class="free">D</span><span class="main">)</span> <span class="main">=</span> DefaultPData <span class="main">(</span>DataSpace <span class="free">D</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> DefaultPUpdate_def PUpdateApply_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_pupdate_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SequentialRacing›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">UpdateOverride</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'d</span> pupdate<span class="main">,</span> <span class="tfree">'d</span> update<span class="main">]</span> <span class="main">=&gt;</span> 
                     <span class="tfree">'d</span> update"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">[U+]</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>10<span class="main">,</span>11<span class="main">]</span>10<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">UpdateOverride</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> Abs_update <span class="main">(</span><span class="main">λ</span> <span class="bound">DA</span> <span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">!!</span> <span class="bound">DA</span><span class="main">)</span> <span class="keyword1">[D+]</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">!!!</span> <span class="bound">DA</span><span class="main">)</span><span class="main">)</span>"</span></span>
 

<span class="comment1">(* -------------------------------------------------------------- *)</span>
<span class="comment1">(* We use our own FoldSet operator simular to the definition      *)</span>
<span class="comment1">(* of Isabelle 2002. Note, it is different to the definition      *)</span>
<span class="comment1">(* in Isabelle 2009. Basically we express "f (g x)" by "h x"      *)</span>
<span class="comment1">(* -------------------------------------------------------------- *)</span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">FoldSet</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'b</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'b</span> set <span class="main">=&gt;</span> <span class="tfree">'a</span> <span class="main">=&gt;</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">h</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">z</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  emptyI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">FoldSet</span> <span class="free">h</span> <span class="free">z</span> <span class="main">{}</span> <span class="free">z</span>"</span></span>
<span class="main">|</span> insertI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">;</span> <span class="free">FoldSet</span> <span class="free">h</span> <span class="free">z</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟧</span>
      <span class="main">⟹</span> <span class="free">FoldSet</span> <span class="free">h</span> <span class="free">z</span> <span class="main">(</span>insert <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">h</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="entity">SequentialRacing</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> pupdate set<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'d</span> update set<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">SequentialRacing</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">=</span> 
     <span class="main">{</span><span class="bound">u</span><span class="main">.</span> FoldSet UpdateOverride DefaultUpdate <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="bound">u</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Update-FoldSet_imp_finite"><span class="command">lemma</span></span> FoldSet_imp_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"FoldSet <span class="free">h</span> <span class="free">z</span> <span class="free">A</span> <span class="free">x</span> <span class="main">⟹</span> finite <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> FoldSet<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Update-finite_imp_FoldSet"><span class="command">lemma</span></span> finite_imp_FoldSet<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> FoldSet <span class="free">h</span> <span class="free">z</span> <span class="free">A</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> finite<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Update-finite_SequentialRacing"><span class="command">lemma</span></span> finite_SequentialRacing<span class="main">:</span>
   <span class="quoted"><span class="quoted">"finite <span class="free">US</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> SequentialRacing <span class="free">US</span><span class="main">)</span> <span class="main">∈</span> SequentialRacing <span class="free">US</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> SequentialRacing_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> h<span class="main"><span class="main">=</span></span><span class="quoted">UpdateOverride</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> z<span class="main"><span class="main">=</span></span><span class="quoted">DefaultUpdate</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> finite_imp_FoldSet<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> someI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Expr">
<div class="head">
<h1>Theory Expr</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      statecharts/SA/Expr.thy

    Author:     Steffen Helke, Software Engineering Group
    Copyright   2010 Technische Universitaet Berlin
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Label Expressions›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Expr
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Update">Update</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">)</span>expr <span class="main">=</span> true
                        <span class="main">|</span> In <span class="tfree"><span class="quoted"><span class="tfree">'s</span></span></span>
                        <span class="main">|</span> En <span class="tfree"><span class="quoted"><span class="tfree">'e</span></span></span>
                        <span class="main">|</span> NOT <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">)</span>expr"</span></span>
                        <span class="main">|</span> And <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">)</span>expr"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">)</span>expr"</span></span>
                        <span class="main">|</span> Or  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">)</span>expr"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">)</span>expr"</span></span>
 
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'d</span> guard <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> data<span class="main">)</span> <span class="main">=&gt;</span> bool"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>action <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span> set <span class="main">*</span> <span class="tfree">'d</span> pupdate<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>label <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">)</span>expr <span class="main">*</span> <span class="tfree">'d</span> guard <span class="main">*</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>action<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>trans <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span> <span class="main">*</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>label <span class="main">*</span> <span class="tfree">'s</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span>
   <span class="entity">eval_expr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'s</span> set <span class="main">*</span> <span class="tfree">'e</span> set<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">)</span>expr<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
     <span class="quoted"><span class="quoted">"<span class="free">eval_expr</span> <span class="free"><span class="bound"><span class="entity">sc</span></span></span> true          <span class="main">=</span> True"</span></span>
   <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_expr</span> <span class="free"><span class="bound"><span class="entity">sc</span></span></span> <span class="main">(</span>En <span class="free"><span class="bound"><span class="entity">ev</span></span></span><span class="main">)</span>       <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ev</span></span></span> <span class="main">∈</span> snd <span class="free"><span class="bound"><span class="entity">sc</span></span></span><span class="main">)</span>"</span></span>
   <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_expr</span> <span class="free"><span class="bound"><span class="entity">sc</span></span></span> <span class="main">(</span>In <span class="free"><span class="bound"><span class="entity">st</span></span></span><span class="main">)</span>       <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">st</span></span></span> <span class="main">∈</span> fst <span class="free"><span class="bound"><span class="entity">sc</span></span></span><span class="main">)</span>"</span></span>
   <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_expr</span> <span class="free"><span class="bound"><span class="entity">sc</span></span></span> <span class="main">(</span>NOT <span class="free"><span class="bound"><span class="entity">e1</span></span></span><span class="main">)</span>      <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="free">eval_expr</span> <span class="free"><span class="bound"><span class="entity">sc</span></span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_expr</span> <span class="free"><span class="bound"><span class="entity">sc</span></span></span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span>   <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">eval_expr</span> <span class="free"><span class="bound"><span class="entity">sc</span></span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">eval_expr</span> <span class="free"><span class="bound"><span class="entity">sc</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_expr</span> <span class="free"><span class="bound"><span class="entity">sc</span></span></span> <span class="main">(</span>Or  <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span>   <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">eval_expr</span> <span class="free"><span class="bound"><span class="entity">sc</span></span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">eval_expr</span> <span class="free"><span class="bound"><span class="entity">sc</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span>
   <span class="entity">ExprEvents</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">)</span>expr <span class="main">⇒</span> <span class="tfree">'e</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">ExprEvents</span> true        <span class="main">=</span> <span class="main">{}</span>"</span></span>
   <span class="main">|</span>  <span class="quoted"><span class="quoted">"<span class="free">ExprEvents</span> <span class="main">(</span>En <span class="free"><span class="bound"><span class="entity">ev</span></span></span><span class="main">)</span>     <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">ev</span></span></span><span class="main">}</span>"</span></span>
   <span class="main">|</span>  <span class="quoted"><span class="quoted">"<span class="free">ExprEvents</span> <span class="main">(</span>In <span class="free"><span class="bound"><span class="entity">st</span></span></span><span class="main">)</span>     <span class="main">=</span> <span class="main">{}</span>"</span></span>
   <span class="main">|</span>  <span class="quoted"><span class="quoted">"<span class="free">ExprEvents</span> <span class="main">(</span>NOT <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>     <span class="main">=</span> <span class="main">(</span><span class="free">ExprEvents</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>
   <span class="main">|</span>  <span class="quoted"><span class="quoted">"<span class="free">ExprEvents</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">ExprEvents</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">ExprEvents</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="main">|</span>  <span class="quoted"><span class="quoted">"<span class="free">ExprEvents</span> <span class="main">(</span>Or  <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">ExprEvents</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">ExprEvents</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(* atomar propositions for Sequential Automata, will be necessary for CTL-interpretation *)</span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span> <span class="tfree">'e</span><span class="main">,</span> dead <span class="tfree">'d</span><span class="main">)</span>atomar <span class="main">=</span>
                          TRUE
                          <span class="main">|</span> FALSE
                          <span class="main">|</span> IN <span class="tfree"><span class="quoted"><span class="tfree">'s</span></span></span>
                          <span class="main">|</span> EN <span class="tfree"><span class="quoted"><span class="tfree">'e</span></span></span>
                          <span class="main">|</span> VAL <span class="quoted"><span class="quoted">"<span class="tfree">'d</span> data <span class="main">=&gt;</span> bool"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">source</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>trans <span class="main">=&gt;</span> <span class="tfree">'s</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">source</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>  <span class="main">=</span> fst <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">Source</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>trans set <span class="main">=&gt;</span> <span class="tfree">'s</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Source</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">==</span> source <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">target</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>trans <span class="main">=&gt;</span> <span class="tfree">'s</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">target</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>  <span class="main">=</span> snd<span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">Target</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>trans set <span class="main">=&gt;</span> <span class="tfree">'s</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Target</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">=</span> target <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">label</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>trans <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>label"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">label</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>  <span class="main">=</span> fst <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">Label</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>trans set <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>label set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Label</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">=</span> label <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">expr</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>label <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">)</span>expr"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">expr</span>  <span class="main">=</span> fst"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">action</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>label  <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>action"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">action</span> <span class="main">=</span> snd <span class="keyword1">o</span> snd"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">Action</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>label set <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>action set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Action</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> action <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">pupdate</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>label <span class="main">=&gt;</span> <span class="tfree">'d</span> pupdate"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pupdate</span>   <span class="main">=</span> snd <span class="keyword1">o</span> action"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">PUpdate</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>label set <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'d</span> pupdate<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">PUpdate</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> pupdate <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">actevent</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>label <span class="main">=&gt;</span> <span class="tfree">'e</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">actevent</span>  <span class="main">=</span> fst <span class="keyword1">o</span> action"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">Actevent</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>label set <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'e</span> set<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Actevent</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> actevent <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">guard</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>label  <span class="main">=&gt;</span> <span class="tfree">'d</span> guard"</span></span> <span class="keyword2"><span class="keyword">where</span></span>  
  <span class="quoted"><span class="quoted">"<span class="free">guard</span> <span class="main">=</span> fst <span class="keyword1">o</span> snd"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">Guard</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>label set <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'d</span> guard<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Guard</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> guard <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">defaultexpr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">)</span>expr"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">defaultexpr</span> <span class="main">=</span> true"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">defaultaction</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>action"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">defaultaction</span> <span class="main">=</span> <span class="main">(</span><span class="main">{}</span><span class="main">,</span>DefaultPUpdate<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">defaultguard</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> guard<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">defaultguard</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">d</span><span class="main">.</span> True<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">defaultlabel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>label"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">defaultlabel</span> <span class="main">=</span> <span class="main">(</span>defaultexpr<span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">eval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'s</span> set <span class="main">*</span> <span class="tfree">'e</span> set <span class="main">*</span> <span class="tfree">'d</span> data<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>label<span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span>
                                                       <span class="main">(</span><span class="quoted">"_ <span class="keyword1">|=</span> _"</span> <span class="main">[</span>91<span class="main">,</span>90<span class="main">]</span>90<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">scd</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">scd</span></span></span>
                 <span class="keyword1">in</span>
                    <span class="main">(</span><span class="main">(</span>eval_expr <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span> <span class="main">(</span>expr <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>guard <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Expr-Source_EmptySet"><span class="command">lemma</span></span> Source_EmptySet <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"Source <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Source_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Expr-Target_EmptySet"><span class="command">lemma</span></span> Target_EmptySet <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"Target <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Target_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Expr-Label_EmptySet"><span class="command">lemma</span></span> Label_EmptySet <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"Label <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Label_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Expr-Action_EmptySet"><span class="command">lemma</span></span> Action_EmptySet <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"Action <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Action_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Expr-PUpdate_EmptySet"><span class="command">lemma</span></span> PUpdate_EmptySet <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"PUpdate <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> PUpdate_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Expr-Actevent_EmptySet"><span class="command">lemma</span></span> Actevent_EmptySet <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"Actevent <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Actevent_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Expr-Union_Actevent_subset"><span class="command">lemma</span></span> Union_Actevent_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">m</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>Actevent <span class="main">(</span>Label <span class="main">(</span>Union <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">N</span><span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>Actevent <span class="main">(</span>Label <span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Actevent_def Label_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Expr-action_select"><span class="command">lemma</span></span> action_select <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"action <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> action_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Expr-label_select"><span class="command">lemma</span></span> label_select <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"label <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> label_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Expr-target_select"><span class="command">lemma</span></span> target_select <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> target_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Expr-actevent_select"><span class="command">lemma</span></span> actevent_select <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"actevent <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> actevent_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Expr-pupdate_select"><span class="command">lemma</span></span> pupdate_select <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"pupdate <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> pupdate_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Expr-source_select"><span class="command">lemma</span></span> source_select <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"source <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> source_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Expr-finite_PUpdate"><span class="command">lemma</span></span> finite_PUpdate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"finite <span class="free">S</span> <span class="main">⟹</span> finite<span class="main">(</span>PUpdate <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> PUpdate_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Expr-finite_Label"><span class="command">lemma</span></span> finite_Label <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"finite <span class="free">S</span> <span class="main">⟹</span> finite<span class="main">(</span>Label <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Label_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Expr-fst_defaultaction"><span class="command">lemma</span></span> fst_defaultaction <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"fst defaultaction <span class="main">=</span> <span class="main">{}</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> defaultaction_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Expr-action_defaultlabel"><span class="command">lemma</span></span> action_defaultlabel <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>action defaultlabel<span class="main">)</span> <span class="main">=</span> defaultaction"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> defaultlabel_def action_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Expr-fst_defaultlabel"><span class="command">lemma</span></span> fst_defaultlabel <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>fst defaultlabel<span class="main">)</span> <span class="main">=</span> defaultexpr"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> defaultlabel_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Expr-ExprEvents_defaultexpr"><span class="command">lemma</span></span> ExprEvents_defaultexpr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>ExprEvents defaultexpr<span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> defaultexpr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Expr-defaultlabel_defaultexpr"><span class="command">lemma</span></span> defaultlabel_defaultexpr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"expr defaultlabel <span class="main">=</span> defaultexpr"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> defaultlabel_def expr_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Expr-target_Target"><span class="command">lemma</span></span> target_Target <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">⟹</span> target <span class="free">t</span> <span class="main">∈</span> Target <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Target_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Expr-Source_union"><span class="command">lemma</span></span> Source_union <span class="main">:</span> <span class="quoted"><span class="quoted">"Source <span class="free">s</span> <span class="main">∪</span> Source <span class="free">t</span> <span class="main">=</span> Source <span class="main">(</span><span class="free">s</span> <span class="main">∪</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Source_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Expr-Target_union"><span class="command">lemma</span></span> Target_union <span class="main">:</span> <span class="quoted"><span class="quoted">"Target <span class="free">s</span> <span class="main">∪</span> Target <span class="free">t</span> <span class="main">=</span> Target <span class="main">(</span><span class="free">s</span> <span class="main">∪</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Target_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SA">
<div class="head">
<h1>Theory SA</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      statecharts/SA/SA.thy

    Author:     Steffen Helke and Florian Kammüller, Software Engineering Group
    Copyright   2010 Technische Universitaet Berlin
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Sequential Automata›</span></span>
<span class="keyword1"><span class="command">theory</span></span> SA
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Expr">Expr</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">SeqAuto</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'s</span> set<span class="main">,</span>
               <span class="tfree">'s</span><span class="main">,</span>
               <span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>label<span class="main">)</span> set<span class="main">,</span>
               <span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>trans<span class="main">)</span> set<span class="main">]</span>
              <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">SeqAuto</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">=</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span>  finite <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> finite <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">∧</span> 
                       <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">l</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SA-SeqAuto_EmptySet"><span class="command">lemma</span></span> SeqAuto_EmptySet<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{</span><span class="main">@</span><span class="bound">x</span> <span class="main">.</span>True<span class="main">}</span><span class="main">,</span> <span class="main">(</span><span class="main">@</span><span class="bound">x</span> <span class="main">.</span>True<span class="main">)</span><span class="main">,</span> <span class="main">{}</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span><span class="bound">I</span><span class="main">,</span><span class="bound">L</span><span class="main">,</span><span class="bound">D</span><span class="main">)</span> <span class="main">|</span> <span class="bound">S</span> <span class="bound">I</span> <span class="bound">L</span> <span class="bound">D</span><span class="main">.</span> SeqAuto <span class="bound">S</span> <span class="bound">I</span> <span class="bound">L</span> <span class="bound">D</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> SeqAuto_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">seqauto</span> <span class="main">=</span>
    <span class="main">{</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span><span class="bound">I</span><span class="main">,</span><span class="bound">L</span><span class="main">,</span><span class="bound">D</span><span class="main">)</span> <span class="main">|</span>
              <span class="main">(</span><span class="bound">S</span><span class="main">::</span><span class="tfree">'s</span> set<span class="main">)</span>
              <span class="main">(</span><span class="bound">I</span><span class="main">::</span><span class="tfree">'s</span><span class="main">)</span>
              <span class="main">(</span><span class="bound">L</span><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>label<span class="main">)</span> set<span class="main">)</span>
              <span class="main">(</span><span class="bound">D</span><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>trans<span class="main">)</span> set<span class="main">)</span><span class="main">.</span>
             SeqAuto <span class="bound">S</span> <span class="bound">I</span> <span class="bound">L</span> <span class="bound">D</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> seqauto <span class="main">=</span>
    <span class="quoted"><span class="quoted">"seqauto <span class="main">::</span> <span class="main">(</span><span class="tfree">'s</span> set <span class="main">*</span> <span class="tfree">'s</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>label<span class="main">)</span> set <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>trans<span class="main">)</span> set<span class="main">)</span> set"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> seqauto_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SeqAuto_EmptySet<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">States</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span> <span class="main">=&gt;</span> <span class="tfree">'s</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">States</span> <span class="main">=</span> fst <span class="keyword1">o</span> Rep_seqauto"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">InitState</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span> <span class="main">=&gt;</span> <span class="tfree">'s</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">InitState</span> <span class="main">=</span> fst <span class="keyword1">o</span> snd <span class="keyword1">o</span> Rep_seqauto"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">Labels</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>label<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Labels</span> <span class="main">=</span> fst <span class="keyword1">o</span> snd <span class="keyword1">o</span> snd <span class="keyword1">o</span> Rep_seqauto"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">Delta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>trans<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Delta</span> <span class="main">=</span> snd <span class="keyword1">o</span> snd <span class="keyword1">o</span> snd <span class="keyword1">o</span> Rep_seqauto"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">SAEvents</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span> <span class="main">=&gt;</span> <span class="tfree">'e</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">SAEvents</span> <span class="free"><span class="bound"><span class="entity">SA</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">l</span> <span class="main">∈</span> Label <span class="main">(</span>Delta <span class="free"><span class="bound"><span class="entity">SA</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>fst <span class="main">(</span>action <span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>ExprEvents <span class="main">(</span>expr <span class="bound">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SA-Rep_seqauto_tuple"><span class="command">lemma</span></span> Rep_seqauto_tuple<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Rep_seqauto <span class="free">SA</span> <span class="main">=</span> <span class="main">(</span>States <span class="free">SA</span><span class="main">,</span> InitState <span class="free">SA</span><span class="main">,</span> Labels <span class="free">SA</span><span class="main">,</span> Delta <span class="free">SA</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> States_def InitState_def Labels_def Delta_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="SA-Rep_seqauto_select"><span class="command">lemma</span></span> Rep_seqauto_select<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>States <span class="free">SA</span><span class="main">,</span>InitState <span class="free">SA</span><span class="main">,</span>Labels <span class="free">SA</span><span class="main">,</span>Delta <span class="free">SA</span><span class="main">)</span> <span class="main">∈</span>  seqauto"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Rep_seqauto_tuple <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> subst<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Rep_seqauto<span class="main">)</span>

<span class="keyword1" id="SA-SeqAuto_select"><span class="command">lemma</span></span> SeqAuto_select<span class="main">:</span>
  <span class="quoted"><span class="quoted">"SeqAuto <span class="main">(</span>States <span class="free">SA</span><span class="main">)</span> <span class="main">(</span>InitState <span class="free">SA</span><span class="main">)</span> <span class="main">(</span>Labels <span class="free">SA</span><span class="main">)</span> <span class="main">(</span>Delta <span class="free">SA</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cut_tac</span> SA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Rep_seqauto_select<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> seqauto_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="SA-neq_States"><span class="command">lemma</span></span> neq_States <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"States <span class="free">SA</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_seqauto_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> seqauto_def SeqAuto_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SA-SA_States_disjunct"><span class="command">lemma</span></span> SA_States_disjunct <span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>States <span class="free">A</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>States <span class="free">A'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">A'</span> <span class="main">≠</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="SA-SA_States_disjunct2"><span class="command">lemma</span></span> SA_States_disjunct2 <span class="main">:</span> 
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span>States <span class="free">A</span><span class="main">)</span> <span class="main">∩</span> <span class="free">C</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> States <span class="free">B</span> <span class="main">⊆</span> <span class="free">C</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">B</span> <span class="main">≠</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SA_States_disjunct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SA-SA_States_disjunct3"><span class="command">lemma</span></span> SA_States_disjunct3 <span class="main">:</span> 
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">C</span> <span class="main">∩</span> States <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> States <span class="free">B</span> <span class="main">⊆</span> <span class="free">C</span> <span class="main">⟧</span> <span class="main">⟹</span>  States <span class="free">A</span> <span class="main">∩</span> States <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> SA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">B</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> neq_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SA-EX_State_SA"><span class="command">lemma</span></span> EX_State_SA <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∈</span> States <span class="free">SA</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_seqauto_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> seqauto_def SeqAuto_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SA-finite_States"><span class="command">lemma</span></span> finite_States <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>States <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_seqauto_select<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> seqauto_def SeqAuto_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SA-finite_Delta"><span class="command">lemma</span></span> finite_Delta <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Delta <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_seqauto_select<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> seqauto_def SeqAuto_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SA-InitState_States"><span class="command">lemma</span></span> InitState_States <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"InitState <span class="free">A</span> <span class="main">∈</span> States <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_seqauto_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> seqauto_def SeqAuto_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SA-SeqAuto_EmptySet_States"><span class="command">lemma</span></span> SeqAuto_EmptySet_States <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>States <span class="main">(</span>Abs_seqauto <span class="main">(</span><span class="main">{</span><span class="main">@</span><span class="bound">x</span><span class="main">.</span> True<span class="main">}</span><span class="main">,</span> <span class="main">(</span><span class="main">@</span><span class="bound">x</span><span class="main">.</span> True<span class="main">)</span><span class="main">,</span> <span class="main">{}</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="main">@</span><span class="bound">x</span><span class="main">.</span> True<span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> States_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_seqauto_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> seqauto_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SeqAuto_EmptySet<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SA-SeqAuto_EmptySet_SAEvents"><span class="command">lemma</span></span> SeqAuto_EmptySet_SAEvents <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>SAEvents <span class="main">(</span>Abs_seqauto <span class="main">(</span><span class="main">{</span><span class="main">@</span><span class="bound">x</span><span class="main">.</span> True<span class="main">}</span><span class="main">,</span> <span class="main">(</span><span class="main">@</span><span class="bound">x</span><span class="main">.</span> True<span class="main">)</span><span class="main">,</span> <span class="main">{}</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> SAEvents_def Delta_def<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_seqauto_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> seqauto_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SeqAuto_EmptySet<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SA-Label_Delta_subset"><span class="command">lemma</span></span> Label_Delta_subset <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>Label <span class="main">(</span>Delta <span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> Labels <span class="free">SA</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Label_def label_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> SA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SeqAuto_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> SeqAuto_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SA-Target_SAs_Delta_States"><span class="command">lemma</span></span> Target_SAs_Delta_States<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Target <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>Delta <span class="main">`</span> <span class="main">(</span><span class="free">SAs</span> <span class="free">HA</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="main">(</span>States <span class="main">`</span> <span class="main">(</span><span class="free">SAs</span> <span class="free">HA</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> image_def Target_def target_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SA Source Trigger Guard Action Update Target<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> SA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SeqAuto_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> SeqAuto_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SA-States_Int_not_mem"><span class="command">lemma</span></span> States_Int_not_mem<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="main">(</span>States <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="keyword1">Int</span> States <span class="free">SA</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">SA</span> <span class="main">∉</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Int_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∈</span> States <span class="free">SA</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> EX_State_SA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> T<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SA-Delta_target_States"><span class="command">lemma</span></span> Delta_target_States <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">T</span> <span class="main">∈</span> Delta <span class="free">A</span><span class="main">⟧</span> <span class="main">⟹</span> target <span class="free">T</span> <span class="main">∈</span> States <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> SA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SeqAuto_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> SeqAuto_def source_def target_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SA-Delta_source_States"><span class="command">lemma</span></span> Delta_source_States <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">T</span> <span class="main">∈</span> Delta <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> source <span class="free">T</span> <span class="main">∈</span> States <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> SA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SeqAuto_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> SeqAuto_def source_def target_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="HA">
<div class="head">
<h1>Theory HA</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      statecharts/HA/HA.thy

    Author:     Steffen Helke, Software Engineering Group
    Copyright   2010 Technische Universitaet Berlin
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Syntax of Hierarchical Automata›</span></span>
<span class="keyword1"><span class="command">theory</span></span> HA
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#SA">SA</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="comment1">(* unique root automaton *)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">RootEx</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span> set<span class="main">,</span>
              <span class="tfree">'s</span> <span class="main">⇀</span>  <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> seqauto set<span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">RootEx</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃!</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span> <span class="bound">A</span> <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span>ran <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span> set<span class="main">,</span>
            <span class="tfree">'s</span> <span class="main">⇀</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> seqauto set<span class="main">]</span>
           <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> seqauto"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Root</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">@</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span>  <span class="bound">A</span> <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span>ran <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(* mutually distinct state spaces *)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">MutuallyDistinct</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span> set <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">MutuallyDistinct</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">=</span>
        <span class="main">(</span><span class="main">∀</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">.</span> <span class="main">∀</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span> <span class="main">⟶</span> <span class="main">(</span>States <span class="bound">a</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>States <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>

<span class="comment1">(* exactly one ancestor for every non root automaton *)</span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">OneAncestor</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span> set<span class="main">,</span>
                   <span class="tfree">'s</span> <span class="main">⇀</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> seqauto set<span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">OneAncestor</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span>
                <span class="main">(</span><span class="main">∀</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">-</span> <span class="main">{</span>Root <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">}</span> <span class="main">.</span>
                    <span class="main">∃!</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">A'</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="bound">A</span><span class="main">}</span> <span class="main">.</span> States <span class="bound">A'</span><span class="main">)</span> <span class="main">∧</span> 
                         <span class="bound">A</span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(* composition function contains no cycles *)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">NoCycles</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span> set<span class="main">,</span>
                   <span class="tfree">'s</span> <span class="main">⇀</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> seqauto set<span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">NoCycles</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span>
       <span class="main">(</span><span class="main">∀</span> <span class="bound">S</span> <span class="main">∈</span> Pow <span class="main">(</span><span class="main">⋃</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">.</span> States <span class="bound">A</span><span class="main">)</span><span class="main">.</span>
           <span class="bound">S</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟶</span>  <span class="main">(</span><span class="main">∃</span> <span class="bound">s</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">A</span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">.</span> States <span class="bound">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span>
 
<span class="comment1">(* properties of composition functions *)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">IsCompFun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span> set<span class="main">,</span>
                    <span class="tfree">'s</span> <span class="main">⇀</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> seqauto set<span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">IsCompFun</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>dom <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">.</span> States <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
                    <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>ran <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">-</span> <span class="main">{</span>Root <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
                    <span class="main">(</span>RootEx <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">∧</span> 
                    <span class="main">(</span>OneAncestor <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">∧</span> 
                    <span class="main">(</span>NoCycles <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Well-formedness for the syntax of HA›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">HierAuto</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'d</span> data<span class="main">,</span>
                 <span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span> set<span class="main">,</span>
                <span class="tfree">'e</span> set<span class="main">,</span>
                <span class="tfree">'s</span> <span class="main">⇀</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span> set<span class="main">]</span>
                <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">HierAuto</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">.</span> SAEvents <span class="bound">A</span><span class="main">)</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">∧</span> 
                       MutuallyDistinct <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span> 
                       finite <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span> 
                       IsCompFun <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="HA-HierAuto_EmptySet"><span class="command">lemma</span></span> HierAuto_EmptySet<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">@</span><span class="bound">x</span><span class="main">.</span> True<span class="main">)</span><span class="main">,</span><span class="main">{</span>Abs_seqauto <span class="main">(</span><span class="main">{</span><span class="main">@</span><span class="bound">x</span><span class="main">.</span> True<span class="main">}</span><span class="main">,</span> <span class="main">(</span><span class="main">@</span><span class="bound">x</span><span class="main">.</span> True<span class="main">)</span><span class="main">,</span> <span class="main">{}</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">}</span><span class="main">,</span> <span class="main">{}</span><span class="main">,</span> 
  Map.empty <span class="main">(</span> <span class="main">@</span><span class="bound">x</span><span class="main">.</span> True <span class="main">↦</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">D</span><span class="main">,</span><span class="bound">F</span><span class="main">,</span><span class="bound">E</span><span class="main">,</span><span class="bound">G</span><span class="main">)</span> <span class="main">|</span> <span class="bound">D</span> <span class="bound">F</span> <span class="bound">E</span> <span class="bound">G</span><span class="main">.</span> HierAuto <span class="bound">D</span> <span class="bound">F</span> <span class="bound">E</span> <span class="bound">G</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HierAuto_def IsCompFun_def Root_def RootEx_def MutuallyDistinct_def
           OneAncestor_def NoCycles_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">hierauto</span> <span class="main">=</span>
    <span class="main">{</span><span class="main">(</span><span class="bound">D</span><span class="main">,</span><span class="bound">F</span><span class="main">,</span><span class="bound">E</span><span class="main">,</span><span class="bound">G</span><span class="main">)</span> <span class="main">|</span>
        <span class="main">(</span><span class="bound">D</span><span class="main">::</span><span class="tfree">'d</span> data<span class="main">)</span>
        <span class="main">(</span><span class="bound">F</span><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> seqauto<span class="main">)</span> set<span class="main">)</span>
        <span class="main">(</span><span class="bound">E</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span> set<span class="main">)</span><span class="main">)</span>
        <span class="main">(</span><span class="bound">G</span><span class="main">::</span><span class="main">(</span><span class="tfree">'s</span> <span class="main">⇀</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> seqauto<span class="main">)</span> set<span class="main">)</span><span class="main">)</span><span class="main">.</span>
                                HierAuto <span class="bound">D</span> <span class="bound">F</span> <span class="bound">E</span> <span class="bound">G</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> hierauto <span class="main">=</span>
    <span class="quoted"><span class="quoted">"hierauto <span class="main">::</span> <span class="main">(</span><span class="tfree">'d</span> data <span class="main">*</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> seqauto set <span class="main">*</span> <span class="tfree">'e</span> set <span class="main">*</span> <span class="main">(</span><span class="tfree">'s</span> <span class="main">⇀</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> seqauto set<span class="main">)</span><span class="main">)</span> set"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> hierauto_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> HierAuto_EmptySet<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">SAs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> hierauto<span class="main">)</span>  <span class="main">=&gt;</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> seqauto<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">SAs</span> <span class="main">=</span> fst <span class="keyword1">o</span> snd <span class="keyword1">o</span> Rep_hierauto"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">HAEvents</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> hierauto<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'e</span> set<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">HAEvents</span> <span class="main">=</span> fst <span class="keyword1">o</span> snd <span class="keyword1">o</span> snd <span class="keyword1">o</span> Rep_hierauto"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">CompFun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> hierauto<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'s</span> <span class="main">⇀</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> seqauto set<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">CompFun</span> <span class="main">=</span> <span class="main">(</span>snd <span class="keyword1">o</span> snd <span class="keyword1">o</span> snd <span class="keyword1">o</span> Rep_hierauto<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">HAStates</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> hierauto<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'s</span> set<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">HAStates</span> <span class="free"><span class="bound"><span class="entity">HA</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span>  <span class="bound">A</span> <span class="main">∈</span> <span class="main">(</span>SAs <span class="free"><span class="bound"><span class="entity">HA</span></span></span><span class="main">)</span><span class="main">.</span> States <span class="bound">A</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">HADelta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> hierauto<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>trans<span class="main">)</span>set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">HADelta</span> <span class="free"><span class="bound"><span class="entity">HA</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">F</span> <span class="main">∈</span> <span class="main">(</span>SAs <span class="free"><span class="bound"><span class="entity">HA</span></span></span><span class="main">)</span><span class="main">.</span> Delta <span class="bound">F</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">HAInitValue</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> hierauto<span class="main">)</span> <span class="main">=&gt;</span> <span class="tfree">'d</span> data"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">HAInitValue</span> <span class="main">==</span> fst <span class="keyword1">o</span> Rep_hierauto"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">HAInitStates</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> hierauto<span class="main">)</span> <span class="main">=&gt;</span> <span class="tfree">'s</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">HAInitStates</span> <span class="free"><span class="bound"><span class="entity">HA</span></span></span> <span class="main">==</span> <span class="main">⋃</span> <span class="bound">A</span> <span class="main">∈</span> <span class="main">(</span>SAs <span class="free"><span class="bound"><span class="entity">HA</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">{</span> InitState <span class="bound">A</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">HARoot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> hierauto<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">HARoot</span> <span class="free"><span class="bound"><span class="entity">HA</span></span></span> <span class="main">==</span> Root <span class="main">(</span>SAs <span class="free"><span class="bound"><span class="entity">HA</span></span></span><span class="main">)</span> <span class="main">(</span>CompFun <span class="free"><span class="bound"><span class="entity">HA</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">HAInitState</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> hierauto<span class="main">)</span> <span class="main">=&gt;</span> <span class="tfree">'s</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">HAInitState</span> <span class="free"><span class="bound"><span class="entity">HA</span></span></span> <span class="main">==</span> InitState <span class="main">(</span>HARoot <span class="free"><span class="bound"><span class="entity">HA</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹State successor function›</span></span>

<span class="comment1">(* state successor function Chi *)</span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Chi</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hierauto <span class="main">=&gt;</span> <span class="tfree">'s</span> <span class="main">=&gt;</span> <span class="tfree">'s</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Chi</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">==</span>  <span class="main">(</span><span class="main">λ</span>  <span class="bound">S</span> <span class="main">∈</span>  <span class="main">(</span>HAStates <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">.</span>
                 <span class="main">{</span><span class="bound">S'</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">SA</span> <span class="main">∈</span> <span class="main">(</span>SAs <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">.</span> <span class="bound">SA</span> <span class="main">∈</span> the <span class="main">(</span><span class="main">(</span>CompFun <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="bound">S</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">S'</span> <span class="main">∈</span> States <span class="bound">SA</span> <span class="main">}</span><span class="main">)</span>"</span></span>

<span class="comment1">(* direct state successor relation ChiRel *)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">ChiRel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hierauto <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'s</span> <span class="main">*</span><span class="tfree">'s</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ChiRel</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">==</span> <span class="main">{</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span><span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∈</span> HAStates <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">S'</span> <span class="main">∈</span> HAStates <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">S'</span> <span class="main">∈</span> <span class="main">(</span>Chi <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="bound">S</span> <span class="main">}</span>"</span></span>

<span class="comment1">(* indirect state successor relation ChiPlus *)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">ChiPlus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hierauto <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'s</span> <span class="main">*</span><span class="tfree">'s</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ChiPlus</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">==</span> <span class="main">(</span>ChiRel <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">^+</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">ChiStar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hierauto <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'s</span> <span class="main">*</span><span class="tfree">'s</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ChiStar</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">==</span> <span class="main">(</span>ChiRel <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">^*</span>"</span></span>

<span class="comment1">(* priority on transitions that are successors *)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">HigherPriority</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hierauto<span class="main">,</span>
                      <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>trans <span class="main">*</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>trans<span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">HigherPriority</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">==</span>
             <span class="main">λ</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>HADelta <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span>HADelta <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">.</span>
                          <span class="main">(</span>source <span class="bound">t'</span><span class="main">,</span>source <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span>  ChiPlus <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Configurations›</span></span>

<span class="comment1">(* initial configuration *)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">InitConf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hierauto <span class="main">=&gt;</span> <span class="tfree">'s</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">InitConf</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">==</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>HAInitStates <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span>HAInitStates <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>ChiRel <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">^*</span> <span class="main">)</span>
                     <span class="main">``</span> <span class="main">{</span>HAInitState <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="comment1">(*  -------------------------------------------------------------- *)</span>
<span class="comment1">(*  First, the original definition calculating a step on           *)</span>
<span class="comment1">(*  configurations given by                                        *)</span>
<span class="comment1">(*                                                                 *)</span>
<span class="comment1">(*  E. Mikk, Y. Lakhnech, and M. Siegel. Hierarchical automata as  *)</span>
<span class="comment1">(*  model for statecharts. In Asian Computing Science Conference   *)</span>
<span class="comment1">(*  (ASIAN~97), Springer LNCS, 1345, 1997.                         *)</span>
<span class="comment1">(*                                                                
    "StepConf A C TS ==                                           
       (C - ((ChiStar A) `` (Source TS))) ∪                       
        (Target TS) ∪ (((ChiPlus A) `` (Target TS)) 
                    ∩ (HAInitStates A))"           
                                                                   *)</span>
<span class="comment1">(*                                                                 *)</span>
<span class="comment1">(* Note, that this semantic definition not preserves the           *)</span>
<span class="comment1">(* well-formedness of a Statecharts. Hence we use our definition.  *)</span>
<span class="comment1">(*  -------------------------------------------------------------- *)</span>

<span class="comment1">(* step on configurations *)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">StepConf</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hierauto<span class="main">,</span> <span class="tfree">'s</span> set<span class="main">,</span>
                 <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>trans set<span class="main">]</span> <span class="main">=&gt;</span> <span class="tfree">'s</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>

  <span class="quoted"><span class="quoted">"<span class="free">StepConf</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">TS</span></span></span> <span class="main">==</span>
               <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>ChiStar <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">``</span> <span class="main">(</span>Source <span class="free"><span class="bound"><span class="entity">TS</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> 
               <span class="main">(</span>Target <span class="free"><span class="bound"><span class="entity">TS</span></span></span><span class="main">)</span> <span class="main">∪</span>
               <span class="main">(</span><span class="main">(</span>ChiRel <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">``</span> <span class="main">(</span>Target <span class="free"><span class="bound"><span class="entity">TS</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>HAInitStates <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">∪</span>
               <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>ChiRel <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">(</span>HAInitStates <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span>HAInitStates <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> 
                   <span class="main">``</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>ChiRel <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">``</span> <span class="main">(</span>Target <span class="free"><span class="bound"><span class="entity">TS</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>HAInitStates <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lemmas›</span></span>

<span class="keyword1" id="HA-Rep_hierauto_tuple"><span class="command">lemma</span></span> Rep_hierauto_tuple<span class="main">:</span>
<span class="quoted"><span class="quoted">"Rep_hierauto <span class="free">HA</span> <span class="main">=</span> <span class="main">(</span>HAInitValue <span class="free">HA</span><span class="main">,</span> SAs <span class="free">HA</span><span class="main">,</span> HAEvents <span class="free">HA</span><span class="main">,</span> CompFun <span class="free">HA</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> SAs_def HAEvents_def CompFun_def HAInitValue_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="HA-Rep_hierauto_select"><span class="command">lemma</span></span> Rep_hierauto_select<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span>HAInitValue <span class="free">HA</span><span class="main">,</span> SAs <span class="free">HA</span><span class="main">,</span> HAEvents <span class="free">HA</span><span class="main">,</span> CompFun <span class="free">HA</span><span class="main">)</span><span class="main">:</span> hierauto"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Rep_hierauto_tuple <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> subst<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Rep_hierauto<span class="main">)</span>

<span class="keyword1" id="HA-HierAuto_select"><span class="command">lemma</span></span> HierAuto_select <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"HierAuto <span class="main">(</span>HAInitValue <span class="free">HA</span><span class="main">)</span> <span class="main">(</span>SAs <span class="free">HA</span><span class="main">)</span> <span class="main">(</span>HAEvents <span class="free">HA</span><span class="main">)</span> <span class="main">(</span>CompFun <span class="free">HA</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_hierauto_select<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> hierauto_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>HAStates›</span></span></span></span>›</span></span>

<span class="keyword1" id="HA-finite_HAStates"><span class="command">lemma</span></span> finite_HAStates <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>HAStates <span class="free">HA</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_hierauto_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> hierauto_def HierAuto_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_UN_I<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-HAStates_SA_mem"><span class="command">lemma</span></span> HAStates_SA_mem<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">SA</span> <span class="main">∈</span> SAs <span class="free">A</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> States <span class="free">SA</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HA-ChiRel_HAStates"><span class="command">lemma</span></span> ChiRel_HAStates <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="free">A</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> HAStates <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiRel_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiRel_HAStates2"><span class="command">lemma</span></span> ChiRel_HAStates2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span>  ChiRel <span class="free">A</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> HAStates <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiRel_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>HAEvents›</span></span></span></span>›</span></span>

<span class="keyword1" id="HA-HAEvents_SAEvents_SAs"><span class="command">lemma</span></span> HAEvents_SAEvents_SAs<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>SAEvents <span class="main">`</span> <span class="main">(</span>SAs <span class="free">HA</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> HAEvents <span class="free">HA</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_hierauto_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> hierauto_def HierAuto_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>NoCycles›</span></span></span></span>›</span></span>

<span class="keyword1" id="HA-NoCycles_EmptySet"><span class="command">lemma</span></span> NoCycles_EmptySet <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"NoCycles <span class="main">{}</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> NoCycles_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HA-NoCycles_HA"><span class="command">lemma</span></span> NoCycles_HA <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"NoCycles <span class="main">(</span>SAs <span class="free">HA</span><span class="main">)</span> <span class="main">(</span>CompFun <span class="free">HA</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_hierauto_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> hierauto_def HierAuto_def IsCompFun_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>OneAncestor›</span></span></span></span>›</span></span>

<span class="keyword1" id="HA-OneAncestor_HA"><span class="command">lemma</span></span> OneAncestor_HA <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"OneAncestor <span class="main">(</span>SAs <span class="free">HA</span><span class="main">)</span> <span class="main">(</span>CompFun <span class="free">HA</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_hierauto_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> hierauto_def HierAuto_def IsCompFun_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>MutuallyDistinct›</span></span></span></span>›</span></span>

<span class="keyword1" id="HA-MutuallyDistinct_Single"><span class="command">lemma</span></span> MutuallyDistinct_Single <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"MutuallyDistinct <span class="main">{</span><span class="free">SA</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> MutuallyDistinct_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HA-MutuallyDistinct_EmptySet"><span class="command">lemma</span></span> MutuallyDistinct_EmptySet <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"MutuallyDistinct <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> MutuallyDistinct_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HA-MutuallyDistinct_Insert"><span class="command">lemma</span></span> MutuallyDistinct_Insert<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> MutuallyDistinct <span class="free">S</span><span class="main">;</span> <span class="main">(</span>States <span class="free">A</span><span class="main">)</span> <span class="main">∩</span>  <span class="main">(</span><span class="main">⋃</span> <span class="bound">B</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> States <span class="bound">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟧</span>
  <span class="main">⟹</span> MutuallyDistinct <span class="main">(</span>insert <span class="free">A</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> MutuallyDistinct_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="HA-MutuallyDistinct_Union"><span class="command">lemma</span></span> MutuallyDistinct_Union<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> MutuallyDistinct <span class="free">A</span><span class="main">;</span> MutuallyDistinct <span class="free">B</span><span class="main">;</span>
  <span class="main">(</span><span class="main">⋃</span> <span class="bound">C</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> States <span class="bound">C</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">C</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> States <span class="bound">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟧</span>
  <span class="main">⟹</span> MutuallyDistinct <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> MutuallyDistinct_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="HA-MutuallyDistinct_HA"><span class="command">lemma</span></span> MutuallyDistinct_HA <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"MutuallyDistinct <span class="main">(</span>SAs <span class="free">HA</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_hierauto_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> hierauto_def HierAuto_def IsCompFun_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>RootEx›</span></span></span></span>›</span></span>

<span class="keyword1" id="HA-RootEx_Root"><span class="command">lemma</span></span> RootEx_Root <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"RootEx <span class="free">F</span> <span class="free">G</span> <span class="main">⟹</span> Root <span class="free">F</span> <span class="free">G</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> RootEx_def Root_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> ex1E<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> someI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-RootEx_Root_ran"><span class="command">lemma</span></span> RootEx_Root_ran <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"RootEx <span class="free">F</span> <span class="free">G</span> <span class="main">⟹</span> Root <span class="free">F</span> <span class="free">G</span> <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span>ran <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> RootEx_def Root_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> ex1E<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> someI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-RootEx_States_Subset"><span class="command">lemma</span></span> RootEx_States_Subset <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>RootEx <span class="free">F</span> <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> States <span class="main">(</span>Root <span class="free">F</span> <span class="free">G</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">.</span> States <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> RootEx_def Root_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> ex1E<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> someI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> UNION_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-RootEx_States_notdisjunct"><span class="command">lemma</span></span> RootEx_States_notdisjunct <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"RootEx <span class="free">F</span> <span class="free">G</span> <span class="main">⟹</span> States <span class="main">(</span>Root <span class="free">F</span> <span class="free">G</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">.</span> States <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> RootEx_States_Subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"States <span class="main">(</span>Root <span class="free">F</span> <span class="free">G</span><span class="main">)</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-Root_neq_SA"><span class="command">lemma</span></span> Root_neq_SA <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> RootEx <span class="free">F</span> <span class="free">G</span><span class="main">;</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">.</span> States <span class="bound">x</span><span class="main">)</span> <span class="main">∩</span> States <span class="free">SA</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> Root <span class="free">F</span> <span class="free">G</span> <span class="main">≠</span> <span class="free">SA</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span>  SA_States_disjunct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> RootEx_States_Subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-RootEx_HA"><span class="command">lemma</span></span> RootEx_HA <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"RootEx <span class="main">(</span>SAs <span class="free">HA</span><span class="main">)</span> <span class="main">(</span>CompFun <span class="free">HA</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_hierauto_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> hierauto_def HierAuto_def IsCompFun_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>HARoot›</span></span></span></span>›</span></span>

<span class="keyword1" id="HA-HARoot_SAs"><span class="command">lemma</span></span> HARoot_SAs <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  
  <span class="quoted"><span class="quoted">"<span class="main">(</span>HARoot <span class="free">HA</span><span class="main">)</span> <span class="main">∈</span> SAs <span class="free">HA</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HARoot_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_hierauto_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> hierauto_def HierAuto_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-States_HARoot_HAStates"><span class="command">lemma</span></span> States_HARoot_HAStates<span class="main">:</span>
  <span class="quoted"><span class="quoted">"States <span class="main">(</span>HARoot <span class="free">HA</span><span class="main">)</span> <span class="main">⊆</span>  HAStates <span class="free">HA</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"HARoot <span class="free">HA</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-SAEvents_HARoot_HAEvents"><span class="command">lemma</span></span> SAEvents_HARoot_HAEvents<span class="main">:</span>
  <span class="quoted"><span class="quoted">"SAEvents <span class="main">(</span>HARoot <span class="free">HA</span><span class="main">)</span> <span class="main">⊆</span> HAEvents <span class="free">HA</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_hierauto_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> hierauto_def HierAuto_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> S<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> UNION_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-HARoot_ran_CompFun"><span class="command">lemma</span></span> HARoot_ran_CompFun<span class="main">:</span>
  <span class="quoted"><span class="quoted">"HARoot <span class="free">HA</span> <span class="main">∉</span> Union <span class="main">(</span>ran <span class="main">(</span>CompFun <span class="free">HA</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HARoot_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_hierauto_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> IsCompFun_def hierauto_def HierAuto_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-HARoot_ran_CompFun2"><span class="command">lemma</span></span> HARoot_ran_CompFun2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> ran <span class="main">(</span>CompFun <span class="free">HA</span><span class="main">)</span> <span class="main">⟶</span> HARoot <span class="free">HA</span> <span class="main">∉</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HARoot_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_hierauto_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> IsCompFun_def hierauto_def HierAuto_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>CompFun›</span></span></span></span>›</span></span>

<span class="keyword1" id="HA-IsCompFun_HA"><span class="command">lemma</span></span> IsCompFun_HA <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"IsCompFun <span class="main">(</span>SAs <span class="free">HA</span><span class="main">)</span> <span class="main">(</span>CompFun <span class="free">HA</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_hierauto_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> hierauto_def HierAuto_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-dom_CompFun"><span class="command">lemma</span></span> dom_CompFun <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"dom <span class="main">(</span>CompFun <span class="free">HA</span><span class="main">)</span> <span class="main">=</span> HAStates <span class="free">HA</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">HA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> IsCompFun_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> IsCompFun_def HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ran_CompFun"><span class="command">lemma</span></span> ran_CompFun <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Union <span class="main">(</span>ran <span class="main">(</span>CompFun <span class="free">HA</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>SAs <span class="free">HA</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span>Root  <span class="main">(</span>SAs <span class="free">HA</span><span class="main">)</span><span class="main">(</span>CompFun <span class="free">HA</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">HA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> IsCompFun_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> IsCompFun_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ran_CompFun_subseteq"><span class="command">lemma</span></span> ran_CompFun_subseteq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Union <span class="main">(</span>ran <span class="main">(</span>CompFun <span class="free">HA</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>SAs <span class="free">HA</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">HA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> IsCompFun_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> IsCompFun_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ran_CompFun_is_not_SA"><span class="command">lemma</span></span> ran_CompFun_is_not_SA<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">Sas</span> <span class="main">⊆</span> <span class="main">(</span>SAs <span class="free">HA</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">Sas</span> <span class="main">∉</span> <span class="main">(</span>ran <span class="main">(</span>CompFun <span class="free">HA</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">HA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> IsCompFun_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> IsCompFun_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-HAStates_HARoot_CompFun"><span class="command">lemma</span></span> HAStates_HARoot_CompFun <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">HA</span> <span class="main">⟹</span> HARoot <span class="free">HA</span> <span class="main">∉</span> the <span class="main">(</span>CompFun <span class="free">HA</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ran_dom_the<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HARoot_ran_CompFun2 HARoot_def HAStates_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-HAStates_CompFun_SAs"><span class="command">lemma</span></span> HAStates_CompFun_SAs<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span> <span class="main">⟹</span> the <span class="main">(</span>CompFun <span class="free">A</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊆</span> SAs <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> T<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ran_CompFun<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> equalityE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subsetCE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> ran_dom_the<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-HAStates_CompFun_notmem"><span class="command">lemma</span></span> HAStates_CompFun_notmem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="free">A</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∉</span> States <span class="free">SA</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> T<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> MutuallyDistinct_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> MutuallyDistinct_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span>  HAStates_CompFun_SAs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> NoCycles_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> NoCycles_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">S</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-CompFun_Int_disjoint"><span class="command">lemma</span></span> CompFun_Int_disjoint<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">≠</span> <span class="free">T</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span>  HAStates <span class="free">A</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span>  HAStates <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> the <span class="main">(</span>CompFun <span class="free">A</span> <span class="free">T</span><span class="main">)</span> <span class="main">∩</span> the <span class="main">(</span>CompFun <span class="free">A</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> U<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> OneAncestor_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> OneAncestor_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> HARoot_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> HAStates_HARoot_CompFun<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> HAStates_CompFun_SAs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> NoCycles_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> NoCycles_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">S</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> NoCycles_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> NoCycles_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">T</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SAs›</span></span></span></span>›</span></span>

<span class="keyword1" id="HA-finite_SAs"><span class="command">lemma</span></span> finite_SAs <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>SAs <span class="free">HA</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_hierauto_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> hierauto_def HierAuto_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-HAStates_SAs_disjunct"><span class="command">lemma</span></span> HAStates_SAs_disjunct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"HAStates <span class="free">HA1</span> <span class="main">∩</span> HAStates <span class="free">HA2</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> SAs <span class="free">HA1</span> <span class="main">∩</span> SAs <span class="free">HA2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> UNION_eq HAStates_def Int_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> SA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> EX_State_SA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-HAStates_CompFun_SAs_mem"><span class="command">lemma</span></span> HAStates_CompFun_SAs_mem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="free">A</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">∈</span> SAs <span class="free">A</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HAStates_CompFun_SAs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 

<span class="keyword1" id="HA-SAs_States_HAStates"><span class="command">lemma</span></span> SAs_States_HAStates<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">SA</span> <span class="main">∈</span> SAs <span class="free">A</span> <span class="main">⟹</span> States <span class="free">SA</span> <span class="main">⊆</span> HAStates <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>HAInitState›</span></span></span></span>›</span></span>

<span class="keyword1" id="HA-HAInitState_HARoot"><span class="command">lemma</span></span> HAInitState_HARoot <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"HAInitState <span class="free">A</span> <span class="main">∈</span> States <span class="main">(</span>HARoot <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> HAInitState_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HA-HAInitState_HARoot2"><span class="command">lemma</span></span> HAInitState_HARoot2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"HAInitState <span class="free">A</span> <span class="main">∈</span> States <span class="main">(</span>Root <span class="main">(</span>SAs <span class="free">A</span><span class="main">)</span> <span class="main">(</span>CompFun <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> HARoot_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="HA-HAInitStates_HAStates"><span class="command">lemma</span></span> HAInitStates_HAStates <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"HAInitStates <span class="free">A</span> <span class="main">⊆</span> HAStates <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAInitStates_def HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-HAInitStates_HAStates2"><span class="command">lemma</span></span> HAInitStates_HAStates2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> HAInitStates <span class="free">A</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HAInitStates_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-HAInitState_HAStates"><span class="command">lemma</span></span> HAInitState_HAStates <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"HAInitState <span class="free">A</span> <span class="main">∈</span> HAStates <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"HARoot <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-HAInitState_HAInitStates"><span class="command">lemma</span></span> HAInitState_HAInitStates <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"HAInitState <span class="free">A</span> <span class="main">∈</span> HAInitStates <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> HAInitStates_def HAInitState_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1" id="HA-CompFun_HAInitStates_HAStates"><span class="command">lemma</span></span> CompFun_HAInitStates_HAStates <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="free">A</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>InitState <span class="free">SA</span><span class="main">)</span> <span class="main">∈</span> HAInitStates <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAInitStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-CompFun_HAInitState_HAInitStates"><span class="command">lemma</span></span> CompFun_HAInitState_HAInitStates <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">SA</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="free">A</span> <span class="main">(</span>HAInitState <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>InitState <span class="free">SA</span><span class="main">)</span> <span class="main">∈</span> HAInitStates <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAInitStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"HAInitState <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HAStates_CompFun_SAs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-HAInitState_notmem_States"><span class="command">lemma</span></span> HAInitState_notmem_States <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="free">A</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> HAInitState <span class="free">A</span> <span class="main">∉</span> States <span class="free">SA</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> MutuallyDistinct_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> MutuallyDistinct_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"HARoot <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-InitState_notmem_States"><span class="command">lemma</span></span> InitState_notmem_States <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="free">A</span> <span class="free">S</span><span class="main">)</span><span class="main">;</span> 
     <span class="free">T</span> <span class="main">∈</span> HAInitStates <span class="free">A</span><span class="main">;</span> <span class="free">T</span> <span class="main">≠</span> InitState <span class="free">SA</span> <span class="main">⟧</span> 
    <span class="main">⟹</span>  <span class="free">T</span> <span class="main">∉</span> States <span class="free">SA</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAInitStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SAA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> MutuallyDistinct_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> MutuallyDistinct_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">SAA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-InitState_States_notmem"><span class="command">lemma</span></span> InitState_States_notmem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">B</span> <span class="main">∈</span> SAs <span class="free">A</span><span class="main">;</span> <span class="free">C</span> <span class="main">∈</span> SAs <span class="free">A</span><span class="main">;</span> <span class="free">B</span> <span class="main">≠</span> <span class="free">C</span> <span class="main">⟧</span> <span class="main">⟹</span> InitState <span class="free">B</span> <span class="main">∉</span> States <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> MutuallyDistinct_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> MutuallyDistinct_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-OneHAInitState_SAStates"><span class="command">lemma</span></span> OneHAInitState_SAStates<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> HAInitStates <span class="free">A</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> HAInitStates <span class="free">A</span><span class="main">;</span>
      <span class="free">S</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> SAs <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> 
      <span class="free">S</span> <span class="main">=</span> <span class="free">T</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAInitStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> AA AAA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">AA</span> <span class="main">=</span> <span class="free">SA</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">AAA</span> <span class="main">=</span> <span class="free">SA</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Chi›</span></span></span></span>›</span></span>

<span class="keyword1" id="HA-HARootStates_notmem_Chi"><span class="command">lemma</span></span> HARootStates_notmem_Chi <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span><span class="main">;</span>  <span class="free">T</span> <span class="main">∈</span> States <span class="main">(</span>HARoot <span class="free">A</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">∉</span>  Chi <span class="free">A</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Chi_def restrict_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> MutuallyDistinct_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> MutuallyDistinct_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"HARoot <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">SA</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-SAStates_notmem_Chi"><span class="command">lemma</span></span> SAStates_notmem_Chi <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span>
     <span class="free">SA</span> <span class="main">∈</span> SAs <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">∉</span> Chi <span class="free">A</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Chi_def restrict_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SAA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> MutuallyDistinct_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> MutuallyDistinct_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">SAA</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">SA</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-HAInitState_notmem_Chi"><span class="command">lemma</span></span> HAInitState_notmem_Chi <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span> <span class="main">⟹</span> HAInitState <span class="free">A</span> <span class="main">∉</span> Chi <span class="free">A</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Chi_def restrict_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HA-Chi_HAStates"><span class="command">lemma</span></span> Chi_HAStates <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∈</span> HAStates <span class="free">A</span> <span class="main">⟹</span> <span class="main">(</span>Chi <span class="free">A</span> <span class="free">T</span><span class="main">)</span> <span class="main">⊆</span> HAStates <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Chi_def restrict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HAStates_CompFun_SAs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-Chi_HAStates_Self"><span class="command">lemma</span></span> Chi_HAStates_Self <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span>  HAStates <span class="free">a</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∉</span> <span class="main">(</span>Chi <span class="free">a</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Chi_def restrict_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HA-ChiRel_HAStates_Self"><span class="command">lemma</span></span> ChiRel_HAStates_Self <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∉</span> <span class="main">(</span>ChiRel <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span> <span class="operator">unfold</span> ChiRel_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HA-HAStates_Chi_NoCycles"><span class="command">lemma</span></span> HAStates_Chi_NoCycles<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">s</span> <span class="main">∈</span> HAStates <span class="free">a</span><span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> HAStates <span class="free">a</span><span class="main">;</span> <span class="free">s</span> <span class="main">∈</span> Chi <span class="free">a</span> <span class="free">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∉</span> Chi <span class="free">a</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Chi_def restrict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> NoCycles_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> NoCycles_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">s</span><span class="main">,</span><span class="free">t</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-HAStates_Chi_NoCycles_trans"><span class="command">lemma</span></span> HAStates_Chi_NoCycles_trans<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">s</span> <span class="main">∈</span> HAStates <span class="free">a</span><span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> HAStates <span class="free">a</span><span class="main">;</span> <span class="free">u</span> <span class="main">∈</span> HAStates <span class="free">a</span><span class="main">;</span>
    <span class="free">t</span> <span class="main">∈</span> Chi <span class="free">a</span> <span class="free">s</span><span class="main">;</span> <span class="free">u</span> <span class="main">∈</span> Chi <span class="free">a</span> <span class="free">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∉</span> Chi <span class="free">a</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Chi_def restrict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> NoCycles_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> NoCycles_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">s</span><span class="main">,</span><span class="free">t</span><span class="main">,</span><span class="free">u</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-Chi_range_disjoint"><span class="command">lemma</span></span> Chi_range_disjoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">≠</span> <span class="free">T</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> HAStates <span class="free">A</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span><span class="main">;</span> <span class="free">U</span> <span class="main">∈</span> Chi <span class="free">A</span> <span class="free">S</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">U</span> <span class="main">∉</span> Chi <span class="free">A</span> <span class="free">T</span>"</span></span>  
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> CompFun_Int_disjoint<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Chi_def restrict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SA SAA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> MutuallyDistinct_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> MutuallyDistinct_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">SAA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-SAStates_Chi_trans"><span class="command">lemma</span></span> SAStates_Chi_trans <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">U</span> <span class="main">∈</span> Chi <span class="free">A</span> <span class="free">T</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> Chi <span class="free">A</span> <span class="free">U</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span> 
     <span class="free">SA</span> <span class="main">∈</span> SAs <span class="free">A</span><span class="main">;</span> <span class="free">U</span> <span class="main">∈</span> HAStates <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∉</span> States <span class="free">SA</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> HAStates_SA_mem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Chi_def restrict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SAA SAAA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> NoCycles_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> NoCycles_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">U</span><span class="main">,</span><span class="free">T</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> HAStates_def<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> MutuallyDistinct_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> MutuallyDistinct_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> -1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> -1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">SAAA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ChiRel›</span></span></span></span>›</span></span>

<span class="keyword1" id="HA-finite_ChiRel"><span class="command">lemma</span></span> finite_ChiRel <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> B<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"HAStates <span class="free">A</span> <span class="main">×</span> HAStates <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> finite_subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiRel_HAStates_subseteq"><span class="command">lemma</span></span> ChiRel_HAStates_subseteq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>HAStates <span class="free">A</span> <span class="main">×</span> HAStates <span class="free">A</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiRel_def Chi_def restrict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiRel_CompFun"><span class="command">lemma</span></span> ChiRel_CompFun<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> HAStates <span class="free">a</span> <span class="main">⟹</span> ChiRel <span class="free">a</span> <span class="main">``</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">x</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="free">a</span> <span class="free">s</span><span class="main">)</span><span class="main">.</span> States <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiRel_def Chi_def restrict_def Image_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> HAStates_CompFun_SAs_mem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiRel_HARoot"><span class="command">lemma</span></span> ChiRel_HARoot<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∉</span> States <span class="main">(</span>HARoot <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiRel_def Chi_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> restrict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> HAStates_HARoot_CompFun<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> MutuallyDistinct_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> MutuallyDistinct_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"HARoot <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-HAStates_CompFun_States_ChiRel"><span class="command">lemma</span></span> HAStates_CompFun_States_ChiRel<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span> <span class="main">⟹</span> <span class="main">⋃</span> <span class="main">(</span>States <span class="main">`</span> the <span class="main">(</span>CompFun <span class="free">A</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ChiRel <span class="free">A</span> <span class="main">``</span> <span class="main">{</span><span class="free">S</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiRel_def Chi_def restrict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> HAStates_CompFun_SAs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-HAInitState_notmem_Range_ChiRel"><span class="command">lemma</span></span> HAInitState_notmem_Range_ChiRel <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"HAInitState <span class="free">A</span> <span class="main">∉</span> Range <span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> ChiRel_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HA-HAInitState_notmem_Range_ChiRel2"><span class="command">lemma</span></span> HAInitState_notmem_Range_ChiRel2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">S</span><span class="main">,</span>HAInitState <span class="free">A</span><span class="main">)</span> <span class="main">∉</span>  <span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> ChiRel_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HA-ChiRel_OneAncestor_notmem"><span class="command">lemma</span></span> ChiRel_OneAncestor_notmem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">≠</span> <span class="free">T</span><span class="main">;</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="free">A</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∉</span> ChiRel <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiRel_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Chi_range_disjoint<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiRel_OneAncestor"><span class="command">lemma</span></span> ChiRel_OneAncestor<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">S1</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="free">A</span><span class="main">;</span> <span class="main">(</span><span class="free">S2</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S1</span> <span class="main">=</span> <span class="free">S2</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notnotD<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> notI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ChiRel_OneAncestor_notmem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-CompFun_ChiRel"><span class="command">lemma</span></span> CompFun_ChiRel<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S1</span> <span class="main">∈</span> HAStates <span class="free">A</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="free">A</span> <span class="free">S1</span><span class="main">)</span><span class="main">;</span> 
     <span class="free">S2</span> <span class="main">∈</span> States <span class="free">SA</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S1</span><span class="main">,</span><span class="free">S2</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiRel_def Chi_def restrict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HAStates_CompFun_SAs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-CompFun_ChiRel2"><span class="command">lemma</span></span> CompFun_ChiRel2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="free">A</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> SAs <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">SA</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="free">A</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiRel_def Chi_def restrict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SAA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> MutuallyDistinct_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> MutuallyDistinct_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> -1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">SAA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiRel_HAStates_NoCycles"><span class="command">lemma</span></span> ChiRel_HAStates_NoCycles<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ChiRel <span class="free">a</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∉</span> <span class="main">(</span>ChiRel <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiRel_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> HAStates_Chi_NoCycles<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-HAStates_ChiRel_NoCycles_trans"><span class="command">lemma</span></span> HAStates_ChiRel_NoCycles_trans<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ChiRel <span class="free">a</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">u</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ChiRel <span class="free">a</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∉</span> <span class="main">(</span>ChiRel <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiRel_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> HAStates_Chi_NoCycles_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-SAStates_ChiRel"><span class="command">lemma</span></span> SAStates_ChiRel<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span>
     <span class="free">SA</span> <span class="main">∈</span> SAs <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∉</span> <span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> ChiRel_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HA-ChiRel_SA_OneAncestor"><span class="command">lemma</span></span> ChiRel_SA_OneAncestor<span class="main">:</span> 
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="free">A</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span> 
      <span class="free">U</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> SAs <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> 
      <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> CompFun_ChiRel2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> CompFun_ChiRel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiRel_OneAncestor2"><span class="command">lemma</span></span> ChiRel_OneAncestor2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span><span class="main">;</span> <span class="free">S</span> <span class="main">∉</span> States <span class="main">(</span>HARoot <span class="free">A</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> 
     <span class="main">∃!</span> <span class="bound">T</span><span class="main">.</span> <span class="main">(</span><span class="bound">T</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiRel_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> T U<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Chi_def restrict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SA SAA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> OneAncestor_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> OneAncestor_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> HARoot_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> rev_conj_cong<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">T</span> <span class="main">=</span> <span class="improper">U</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> CompFun_Int_disjoint<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">SA</span><span class="main">=</span><span class="improper">SAA</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> MutuallyDistinct_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> MutuallyDistinct_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">SAA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HAStates_CompFun_SAs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HAStates_CompFun_SAs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-HARootStates_notmem_Range_ChiRel"><span class="command">lemma</span></span> HARootStates_notmem_Range_ChiRel <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> States <span class="main">(</span>HARoot <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∉</span> Range <span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> ChiRel_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HA-ChiRel_int_disjoint"><span class="command">lemma</span></span> ChiRel_int_disjoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≠</span> <span class="free">T</span> <span class="main">⟹</span> <span class="main">(</span>ChiRel <span class="free">A</span> <span class="main">``</span> <span class="main">{</span><span class="free">S</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>ChiRel <span class="free">A</span> <span class="main">``</span> <span class="main">{</span><span class="free">T</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>  
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiRel_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Chi_range_disjoint<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-SAStates_ChiRel_trans"><span class="command">lemma</span></span> SAStates_ChiRel_trans <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="free">U</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="free">A</span><span class="main">;</span> 
     <span class="free">S</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> SAs <span class="free">A</span>  <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">∉</span> States <span class="free">SA</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiRel_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> SAStates_Chi_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-HAInitStates_InitState_trancl"><span class="command">lemma</span></span> HAInitStates_InitState_trancl<span class="main">:</span> 
  <span class="quoted"><span class="quoted">" <span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> HAInitStates <span class="main">(</span><span class="free">HA</span> <span class="free">ST</span><span class="main">)</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="main">(</span><span class="free">HA</span> <span class="free">ST</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> 
       <span class="main">(</span><span class="free">S</span><span class="main">,</span> InitState <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ChiRel <span class="main">(</span><span class="free">HA</span> <span class="free">ST</span><span class="main">)</span> <span class="main">∩</span> HAInitStates <span class="main">(</span><span class="free">HA</span> <span class="free">ST</span><span class="main">)</span> <span class="main">×</span> HAInitStates <span class="main">(</span><span class="free">HA</span> <span class="free">ST</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> HAStates <span class="main">(</span><span class="free">HA</span> <span class="free">ST</span><span class="main">)</span>"</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> CompFun_ChiRel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> InitState_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> r_into_trancl'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> CompFun_HAInitStates_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-HAInitStates_InitState_trancl2"><span class="command">lemma</span></span> HAInitStates_InitState_trancl2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> HAStates <span class="main">(</span><span class="free">HA</span> <span class="free">ST</span><span class="main">)</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="main">(</span><span class="free">HA</span> <span class="free">ST</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">;</span> 
   <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">S</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ChiRel <span class="main">(</span><span class="free">HA</span> <span class="free">ST</span><span class="main">)</span> <span class="main">∩</span> HAInitStates <span class="main">(</span><span class="free">HA</span> <span class="free">ST</span><span class="main">)</span> <span class="main">×</span> HAInitStates <span class="main">(</span><span class="free">HA</span> <span class="free">ST</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> InitState <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ChiRel <span class="main">(</span><span class="free">HA</span> <span class="free">ST</span><span class="main">)</span> <span class="main">∩</span> HAInitStates <span class="main">(</span><span class="free">HA</span> <span class="free">ST</span><span class="main">)</span> <span class="main">×</span> HAInitStates <span class="main">(</span><span class="free">HA</span> <span class="free">ST</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"ChiRel <span class="main">(</span><span class="free">HA</span> <span class="free">ST</span><span class="main">)</span> <span class="main">∩</span> HAInitStates <span class="main">(</span><span class="free">HA</span> <span class="free">ST</span><span class="main">)</span> <span class="main">×</span> HAInitStates <span class="main">(</span><span class="free">HA</span> <span class="free">ST</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> converse_trancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> T U<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> HAStates <span class="main">(</span><span class="free">HA</span> <span class="free">ST</span><span class="main">)</span>"</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> CompFun_ChiRel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> InitState_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> trancl_trans <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">S</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> r_into_trancl'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> r_into_trancl'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> CompFun_HAInitStates_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">HA</span> <span class="free">ST</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HAInitStates_HAStates<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trancl_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> r_into_trancl'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ChiPlus›</span></span></span></span>›</span></span>

<span class="keyword1" id="HA-ChiPlus_ChiRel"><span class="command">lemma</span></span> ChiPlus_ChiRel <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="free">A</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> r_into_trancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiPlus_HAStates"><span class="command">lemma</span></span> ChiPlus_HAStates <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>ChiPlus <span class="free">A</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>HAStates <span class="free">A</span> <span class="main">×</span> HAStates <span class="free">A</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> trancl_subset_Sigma<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiPlus_subset_States"><span class="command">lemma</span></span> ChiPlus_subset_States<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ChiPlus <span class="free">a</span> <span class="main">``</span> <span class="main">{</span><span class="free">t</span><span class="main">}</span> <span class="main">⊆</span>  <span class="main">⋃</span><span class="main">(</span>States <span class="main">`</span> <span class="main">(</span>SAs <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ChiPlus_HAStates<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-finite_ChiPlus"><span class="command">lemma</span></span> finite_ChiPlus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>ChiPlus <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> B<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"HAStates <span class="free">A</span> <span class="main">×</span> HAStates <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> finite_subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiPlus_OneAncestor"><span class="command">lemma</span></span> ChiPlus_OneAncestor<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span><span class="main">;</span> <span class="free">S</span> <span class="main">∉</span> States <span class="main">(</span>HARoot <span class="free">A</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> 
     <span class="main">∃</span> <span class="bound">T</span><span class="main">.</span> <span class="main">(</span><span class="bound">T</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ChiRel_OneAncestor2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiPlus_HAStates_Left"><span class="command">lemma</span></span> ChiPlus_HAStates_Left<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ChiPlus_HAStates<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiPlus_HAStates_Right"><span class="command">lemma</span></span> ChiPlus_HAStates_Right<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">∈</span>  HAStates <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ChiPlus_HAStates<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiPlus_ChiRel_int"><span class="command">lemma</span></span> ChiPlus_ChiRel_int <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ChiPlus <span class="free">A</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>ChiPlus <span class="free">A</span> <span class="main">``</span> <span class="main">{</span><span class="free">T</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>ChiRel <span class="free">A</span> <span class="main">``</span> <span class="main">{</span><span class="free">S</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ChiRel <span class="free">A</span> <span class="main">``</span> <span class="main">{</span><span class="free">S</span><span class="main">}</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> converse_trancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiPlus_ChiPlus_int"><span class="command">lemma</span></span> ChiPlus_ChiPlus_int <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ChiPlus <span class="free">A</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>ChiPlus <span class="free">A</span> <span class="main">``</span> <span class="main">{</span><span class="free">T</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>ChiPlus <span class="free">A</span> <span class="main">``</span> <span class="main">{</span><span class="free">S</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ChiPlus <span class="free">A</span> <span class="main">``</span> <span class="main">{</span><span class="free">S</span><span class="main">}</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> converse_trancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiPlus_ChiRel_NoCycle_1"><span class="command">lemma</span></span> ChiPlus_ChiRel_NoCycle_1 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span><span class="main">⟧</span> <span class="main">⟹</span>    
   <span class="main">(</span>insert <span class="free">S</span> <span class="main">(</span>insert <span class="free">T</span> <span class="main">(</span><span class="main">{</span><span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">U</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>  <span class="main">∩</span> <span class="main">(</span>ChiRel <span class="free">A</span> <span class="main">``</span> <span class="main">{</span><span class="free">T</span><span class="main">}</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> converse_trancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Image_def Int_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiPlus_ChiRel_NoCycle_2"><span class="command">lemma</span></span> ChiPlus_ChiRel_NoCycle_2 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span><span class="main">⟧</span> <span class="main">⟹</span>  <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> 
   <span class="main">(</span>insert <span class="free">S</span> <span class="main">(</span>insert <span class="free">T</span> <span class="main">(</span><span class="main">{</span><span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">U</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>  <span class="main">∩</span> <span class="main">(</span>ChiRel <span class="free">A</span> <span class="main">``</span> <span class="main">{</span><span class="free">S</span><span class="main">}</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> converse_trancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Image_def Int_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiPlus_ChiRel_NoCycle_3"><span class="command">lemma</span></span> ChiPlus_ChiRel_NoCycle_3 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span><span class="main">⟧</span> <span class="main">⟹</span>  <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span>  ChiPlus <span class="free">A</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">U</span><span class="main">,</span> <span class="free">S</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span> <span class="main">⟶</span> 
   <span class="main">(</span>insert <span class="free">S</span> <span class="main">(</span>insert <span class="free">T</span> <span class="main">(</span><span class="main">{</span><span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">U</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>  <span class="main">∩</span> <span class="main">(</span>ChiRel <span class="free">A</span> <span class="main">``</span> <span class="main">{</span><span class="free">U</span><span class="main">}</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Image_def Int_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> V<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> V W<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ChiRel_HAStates_NoCycles<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span><span class="free"><span class="free"><span class="free"><span class="free"><span class="free">U</span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span></span><span class="improper"><span class="improper"><span class="improper"><span class="improper"><span class="improper">W</span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main"><span class="main">∈</span></span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span>ChiRel <span class="free"><span class="free"><span class="free"><span class="free"><span class="free">A</span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span>"</span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rotate_tac</span> 5<span class="main"><span class="keyword3">,</span></span> <span class="operator">frule</span> tranclD3<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> trancl_into_trancl<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiPlus_ChiRel_NoCycle_4"><span class="command">lemma</span></span> ChiPlus_ChiRel_NoCycle_4 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span>  <span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>ChiPlus <span class="free">A</span> <span class="main">``</span><span class="main">{</span><span class="free">T</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>ChiRel <span class="free">A</span> <span class="main">``</span> <span class="main">{</span><span class="free">S</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Image_def Int_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ChiRel_HAStates_NoCycles<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiRel_ChiPlus_NoCycles"><span class="command">lemma</span></span> ChiRel_ChiPlus_NoCycles<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∉</span> <span class="main">(</span>ChiPlus <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> NoCycles_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> NoCycles_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"insert <span class="free">S</span> <span class="main">(</span>insert <span class="free">T</span> <span class="main">(</span><span class="main">{</span><span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">U</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ChiPlus_subset_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ChiPlus_HAStates<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ChiPlus_ChiRel_NoCycle_2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>ChiRel_CompFun<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ChiPlus_ChiRel_NoCycle_1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>ChiRel_CompFun<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ChiPlus_ChiRel_NoCycle_3<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> V<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">V</span> <span class="main">∈</span> HAStates <span class="free">A</span>"</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ChiRel_CompFun<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ChiPlus_HAStates_Right<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiPlus_ChiPlus_NoCycles"><span class="command">lemma</span></span> ChiPlus_ChiPlus_NoCycles<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ChiPlus <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∉</span> <span class="main">(</span>ChiPlus <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ChiRel_ChiPlus_NoCycles<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> trancl_into_trancl2 <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiPlus_NoCycles"><span class="command">lemma</span></span> ChiPlus_NoCycles <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ChiPlus <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">≠</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ChiPlus_ChiPlus_NoCycles<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiPlus_NoCycles_2"><span class="command">lemma</span></span> ChiPlus_NoCycles_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∉</span> <span class="main">(</span>ChiPlus <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ChiPlus_NoCycles<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiPlus_ChiPlus_NoCycles_2"><span class="command">lemma</span></span> ChiPlus_ChiPlus_NoCycles_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span><span class="main">;</span> <span class="main">(</span><span class="free">U</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∉</span>  ChiPlus <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ChiPlus_ChiPlus_NoCycles<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> trancl_trans <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiRel_ChiPlus_trans"><span class="command">lemma</span></span> ChiRel_ChiPlus_trans<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">U</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span><span class="main">;</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="free">A</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">U</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiRel_ChiPlus_trans2"><span class="command">lemma</span></span> ChiRel_ChiPlus_trans2<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">U</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="free">A</span><span class="main">;</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">U</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiPlus_ChiRel_Ex"><span class="command">lemma</span></span> ChiPlus_ChiRel_Ex <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∉</span> ChiRel <span class="free">A</span> <span class="main">⟶</span> 
    <span class="main">(</span><span class="main">∃</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">U</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> converse_trancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> U<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiPlus_ChiRel_Ex2"><span class="command">lemma</span></span> ChiPlus_ChiRel_Ex2 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∉</span> ChiRel <span class="free">A</span> <span class="main">⟶</span> 
    <span class="main">(</span><span class="main">∃</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="bound">U</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">U</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> converse_trancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-HARootStates_Range_ChiPlus"><span class="command">lemma</span></span> HARootStates_Range_ChiPlus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> States <span class="main">(</span>HARoot <span class="free">A</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∉</span> Range <span class="main">(</span>ChiPlus <span class="free">A</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HA-HARootStates_Range_ChiPlus2"><span class="command">lemma</span></span> HARootStates_Range_ChiPlus2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> States <span class="main">(</span>HARoot <span class="free">A</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∉</span> <span class="main">(</span>ChiPlus <span class="free">A</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">frule</span> HARootStates_Range_ChiPlus<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> Domain_converse <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>

<span class="keyword1" id="HA-SAStates_ChiPlus_ChiRel_NoCycle_1"><span class="command">lemma</span></span> SAStates_ChiPlus_ChiRel_NoCycle_1 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> SAs <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">U</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">S</span> <span class="main">∈</span> States <span class="free">SA</span> <span class="main">⟶</span> <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA</span> <span class="main">⟶</span> 
   <span class="main">(</span>insert <span class="free">S</span> <span class="main">(</span>insert <span class="free">U</span> <span class="main">(</span><span class="main">{</span><span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>ChiRel <span class="free">A</span> <span class="main">``</span> <span class="main">{</span><span class="free">U</span><span class="main">}</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> converse_trancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> SAStates_ChiRel_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>ChiRel_CompFun<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CompFun_ChiRel2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Int_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> W<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> U<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">W</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ChiRel_ChiPlus_trans2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-SAStates_ChiPlus_ChiRel_NoCycle_2"><span class="command">lemma</span></span> SAStates_ChiPlus_ChiRel_NoCycle_2 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span>  ChiPlus <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span>  <span class="main">(</span><span class="free">U</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> 
   <span class="main">(</span>insert <span class="free">S</span> <span class="main">(</span>insert <span class="free">U</span> <span class="main">(</span><span class="main">{</span><span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>  <span class="main">∩</span> <span class="main">(</span>ChiRel <span class="free">A</span> <span class="main">``</span> <span class="main">{</span><span class="free">S</span><span class="main">}</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> converse_trancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Image_def Int_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(* TO DO *)</span>

<span class="keyword1" id="HA-SAStates_ChiPlus_ChiRel_NoCycle_3"><span class="command">lemma</span></span> SAStates_ChiPlus_ChiRel_NoCycle_3 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span>  ChiPlus <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span>  <span class="main">(</span><span class="free">U</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span> <span class="main">⟶</span>
   <span class="main">(</span>insert <span class="free">S</span> <span class="main">(</span>insert <span class="free">U</span> <span class="main">(</span><span class="main">{</span><span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>  <span class="main">∩</span> <span class="main">(</span>ChiRel <span class="free">A</span> <span class="main">``</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> W<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> W X<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Image_def Int_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="improper">W</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="free">A</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">s</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">W</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ChiPlus_ChiRel_Ex2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> X<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">X</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ChiRel_ChiPlus_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="improper">X</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="free">A</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">s</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">X</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ChiPlus_ChiRel_Ex2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> Y<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">Y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ChiRel_ChiPlus_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="improper">X</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="free">A</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">s</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">X</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ChiPlus_ChiRel_Ex2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> Y<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">Y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ChiRel_ChiPlus_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">W</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> Y<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">Y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ChiRel_ChiPlus_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-SAStates_ChiPlus_ChiRel_trans"><span class="command">lemma</span></span> SAStates_ChiPlus_ChiRel_trans <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ChiPlus <span class="free">A</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="free">U</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> SAs <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">∉</span> States <span class="free">SA</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> NoCycles_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> NoCycles_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"insert <span class="free">S</span> <span class="main">(</span>insert <span class="free">U</span> <span class="main">(</span><span class="main">{</span><span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="bound">V</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ChiPlus_subset_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ChiPlus_HAStates<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> SAStates_ChiPlus_ChiRel_NoCycle_2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> HAStates_SA_mem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>ChiRel_CompFun<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> SAStates_ChiPlus_ChiRel_NoCycle_1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>3<span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>ChiRel_CompFun<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> SAStates_ChiPlus_ChiRel_NoCycle_3<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>ChiPlus_HAStates_Left ChiRel_CompFun<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-SAStates_ChiPlus2"><span class="command">lemma</span></span> SAStates_ChiPlus2 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> SAs <span class="free">A</span>  <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∈</span> States <span class="free">SA</span> <span class="main">⟶</span> <span class="free">T</span> <span class="main">∉</span> States <span class="free">SA</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> U<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SAStates_ChiRel<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> SAStates_ChiPlus_ChiRel_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-SAStates_ChiPlus"><span class="command">lemma</span></span> SAStates_ChiPlus <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> SAs <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∉</span> ChiPlus <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> SAStates_ChiPlus2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-SAStates_ChiPlus_ChiRel_OneAncestor"><span class="command">lemma</span></span> SAStates_ChiPlus_ChiRel_OneAncestor <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> SAs <span class="free">A</span><span class="main">;</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span><span class="main">⟧</span> <span class="main">⟹</span>  <span class="free">S</span> <span class="main">≠</span> <span class="free">T</span> <span class="main">⟶</span> <span class="free">S</span> <span class="main">∈</span> States <span class="free">SA</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∉</span> ChiRel <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ChiRel_OneAncestor_notmem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> V W<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">V</span><span class="main">=</span><span class="free">T</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ChiRel_OneAncestor_notmem SAStates_ChiPlus<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-SAStates_ChiPlus_OneAncestor"><span class="command">lemma</span></span> SAStates_ChiPlus_OneAncestor <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> SAs <span class="free">A</span><span class="main">;</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span>  <span class="free">S</span> <span class="main">≠</span> <span class="free">T</span> <span class="main">⟶</span>  
     <span class="free">S</span> <span class="main">∈</span> States <span class="free">SA</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∉</span> ChiPlus <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> V<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> U<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">V</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SAStates_ChiPlus_ChiRel_OneAncestor<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> V W<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">W</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ChiPlus_ChiRel_Ex<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> U<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">W</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SAStates_ChiPlus_ChiRel_OneAncestor<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ChiRel_ChiPlus_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> X<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">V</span><span class="main">=</span><span class="improper">X</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ChiRel_OneAncestor_notmem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiRel_ChiPlus_OneAncestor"><span class="command">lemma</span></span> ChiRel_ChiPlus_OneAncestor <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">≠</span> <span class="free">S</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="free">A</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>ChiRel_OneAncestor<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> V W<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">=</span><span class="improper">V</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>ChiRel_OneAncestor<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiPlus_SA_OneAncestor"><span class="command">lemma</span></span> ChiPlus_SA_OneAncestor <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span><span class="main">;</span> 
      <span class="free">U</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> SAs <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> converse_trancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ChiRel_SA_OneAncestor<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ChiStar›</span></span></span></span>›</span></span>

<span class="keyword1" id="HA-ChiPlus_ChiStar"><span class="command">lemma</span></span> ChiPlus_ChiStar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span>  <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiStar <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def ChiStar_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HA-HARootState_Range_ChiStar"><span class="command">lemma</span></span> HARootState_Range_ChiStar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">S</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> States <span class="main">(</span>HARoot <span class="free">A</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∉</span> <span class="main">(</span>ChiStar <span class="free">A</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiStar_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rtrancl_eq_or_trancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiStar_Self"><span class="command">lemma</span></span> ChiStar_Self <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∈</span> ChiStar <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiStar_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiStar_Image"><span class="command">lemma</span></span> ChiStar_Image <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  
  <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∈</span> <span class="main">(</span>ChiStar <span class="free">A</span> <span class="main">``</span> <span class="free">M</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Image_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ChiStar_Self<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiStar_ChiPlus_noteq"><span class="command">lemma</span></span> ChiStar_ChiPlus_noteq<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">≠</span> <span class="free">T</span><span class="main">;</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiStar <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def ChiStar_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rtrancl_eq_or_trancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-ChiRel_ChiStar_trans"><span class="command">lemma</span></span> ChiRel_ChiStar_trans<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span> ChiStar <span class="free">A</span><span class="main">;</span> <span class="main">(</span><span class="free">U</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiStar <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiStar_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>InitConf›</span></span></span></span>›</span></span>

<span class="keyword1" id="HA-InitConf_HAStates"><span class="command">lemma</span></span> InitConf_HAStates <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"InitConf <span class="free">A</span> <span class="main">⊆</span> HAStates <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> InitConf_def HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rtrancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"HARoot <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def ChiRel_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-InitConf_HAStates2"><span class="command">lemma</span></span> InitConf_HAStates2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> InitConf <span class="free">A</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> InitConf_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-HAInitState_InitConf"><span class="command">lemma</span></span> HAInitState_InitConf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"HAInitState <span class="free">A</span> <span class="main">∈</span> InitConf <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> HAInitState_def InitConf_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HA-InitConf_HAInitState_HARoot"><span class="command">lemma</span></span> InitConf_HAInitState_HARoot<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">S</span> <span class="main">∈</span> InitConf <span class="free">A</span><span class="main">;</span> <span class="free">S</span> <span class="main">≠</span> HAInitState <span class="free">A</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="free">S</span> <span class="main">∉</span> States <span class="main">(</span>HARoot <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> InitConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mp<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mp<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rtrancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ChiRel_HARoot<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-InitConf_HARoot_HAInitState"><span class="command">lemma</span></span> InitConf_HARoot_HAInitState <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> InitConf <span class="free">A</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> States <span class="main">(</span>HARoot <span class="free">A</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">=</span> HAInitState <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> not_not <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>InitConf_HAInitState_HARoot<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-HAInitState_CompFun_InitConf"><span class="command">lemma</span></span> HAInitState_CompFun_InitConf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">[|</span><span class="free">SA</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="free">A</span>  <span class="main">(</span>HAInitState <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="main">(</span>InitState <span class="free">SA</span><span class="main">)</span> <span class="main">∈</span> InitConf <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> InitConf_def HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rtrancl_Int<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"HAInitState <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HAStates_CompFun_States_ChiRel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Image_singleton_iff <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> subst<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> -1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> sym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-InitState_CompFun_InitConf"><span class="command">lemma</span></span> InitState_CompFun_InitConf<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="free">A</span> <span class="free">S</span><span class="main">)</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> InitConf <span class="free">A</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="main">(</span>InitState <span class="free">SA</span><span class="main">)</span> <span class="main">∈</span> InitConf <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> InitConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> rtrancl_Int1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> HAInitState <span class="free">A</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rtrancl_mem_Sigma<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HAStates_CompFun_States_ChiRel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Image_singleton_iff <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> subst<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> -1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> sym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-InitConf_HAInitStates"><span class="command">lemma</span></span> InitConf_HAInitStates<span class="main">:</span>
  <span class="quoted"><span class="quoted">"InitConf <span class="free">A</span> <span class="main">⊆</span> HAInitStates <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> InitConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> rtrancl_Int1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">=</span> HAInitState <span class="free">A</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rtrancl_mem_Sigma<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-InitState_notmem_InitConf"><span class="command">lemma</span></span> InitState_notmem_InitConf<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">SA</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="free">A</span> <span class="free">S</span><span class="main">)</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> InitConf <span class="free">A</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span>
     <span class="free">T</span> <span class="main">≠</span> InitState <span class="free">SA</span> <span class="main">|]</span> <span class="main">==&gt;</span>  <span class="free">T</span> <span class="main">∉</span> InitConf <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> InitConf_HAStates2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> InitConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mp<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mp<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mp<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mp<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mp<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mp<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rtrancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-InitConf_CompFun_InitState"><span class="command">lemma</span></span> InitConf_CompFun_InitState <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">SA</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="free">A</span> <span class="free">S</span><span class="main">)</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> InitConf <span class="free">A</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span>
    <span class="free">T</span> <span class="main">∈</span> InitConf <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">=</span> InitState <span class="free">SA</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> not_not <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> InitState_notmem_InitConf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-InitConf_ChiRel_Ancestor"><span class="command">lemma</span></span> InitConf_ChiRel_Ancestor<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">T</span> <span class="main">∈</span> InitConf <span class="free">A</span><span class="main">;</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∈</span> InitConf <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> InitConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rtranclE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> U<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span>  <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HAInitState_notmem_Range_ChiRel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">U</span> <span class="main">=</span> <span class="free">S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ChiRel_OneAncestor<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HA-InitConf_CompFun_Ancestor"><span class="command">lemma</span></span> InitConf_CompFun_Ancestor<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="free">A</span> <span class="free">S</span><span class="main">)</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> InitConf <span class="free">A</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA</span> <span class="main">⟧</span>
    <span class="main">⟹</span>  <span class="free">S</span> <span class="main">∈</span> InitConf <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> InitConf_ChiRel_Ancestor<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> CompFun_ChiRel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>StepConf›</span></span></span></span>›</span></span>

<span class="keyword1" id="HA-StepConf_EmptySet"><span class="command">lemma</span></span> StepConf_EmptySet <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"StepConf <span class="free">A</span> <span class="free">C</span> <span class="main">{}</span> <span class="main">=</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> StepConf_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="HASem">
<div class="head">
<h1>Theory HASem</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      statecharts/HA/HASem.thy

    Author:     Steffen Helke and Florian Kammüller, Software Engineering Group
    Copyright   2010 Technische Universitaet Berlin
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Semantics of Hierarchical Automata›</span></span>
<span class="keyword1"><span class="command">theory</span></span> HASem
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#HA">HA</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">RootExSem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span> set<span class="main">,</span> <span class="tfree">'s</span> <span class="main">⇀</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto set<span class="main">,</span>
                 <span class="tfree">'s</span> set<span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">RootExSem</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">==</span> <span class="main">(</span><span class="main">∃!</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∈</span> States <span class="main">(</span>Root <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">UniqueSucStates</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span> set<span class="main">,</span> <span class="tfree">'s</span> <span class="main">⇀</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto set<span class="main">,</span>
                        <span class="tfree">'s</span> set<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">UniqueSucStates</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span>  <span class="main">==</span> <span class="main">∀</span> <span class="bound">S</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>States <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
                                   <span class="main">∀</span> <span class="bound">A</span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">S</span><span class="main">)</span><span class="main">.</span>
                                      <span class="keyword1">if</span> <span class="main">(</span><span class="bound">S</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="keyword1">then</span>
                                       <span class="main">∃!</span> <span class="bound">S'</span> <span class="main">.</span> <span class="bound">S'</span> <span class="main">∈</span>  States <span class="bound">A</span> <span class="main">∧</span> <span class="bound">S'</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span>
                                     <span class="keyword1">else</span>
                                       <span class="main">∀</span> <span class="bound">S</span> <span class="main">∈</span> States <span class="bound">A</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">IsConfSet</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span> set<span class="main">,</span> <span class="tfree">'s</span> <span class="main">⇀</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto set<span class="main">,</span>
                 <span class="tfree">'s</span> set<span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">IsConfSet</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">==</span>
                <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>States <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">&amp;</span>
                RootExSem <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">&amp;</span>
                UniqueSucStates <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Status</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hierauto<span class="main">,</span>
              <span class="tfree">'s</span> set<span class="main">,</span>
              <span class="tfree">'e</span> set<span class="main">,</span>
              <span class="tfree">'d</span> data<span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Status</span> <span class="free"><span class="bound"><span class="entity">HA</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">==</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">⊆</span> HAEvents <span class="free"><span class="bound"><span class="entity">HA</span></span></span> <span class="main">∧</span> 
                      IsConfSet <span class="main">(</span>SAs <span class="free"><span class="bound"><span class="entity">HA</span></span></span><span class="main">)</span> <span class="main">(</span>CompFun <span class="free"><span class="bound"><span class="entity">HA</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∧</span> 
                      Data.DataSpace <span class="main">(</span>HAInitValue <span class="free"><span class="bound"><span class="entity">HA</span></span></span><span class="main">)</span> <span class="main">=</span> Data.DataSpace <span class="free"><span class="bound"><span class="entity">D</span></span></span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Status›</span></span></span></span>›</span></span>

<span class="keyword1" id="HASem-Status_EmptySet"><span class="command">lemma</span></span> Status_EmptySet<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>Abs_hierauto <span class="main">(</span><span class="main">(</span><span class="main">@</span> <span class="bound">x</span> <span class="main">.</span> True<span class="main">)</span><span class="main">,</span>
    <span class="main">{</span>Abs_seqauto <span class="main">(</span><span class="main">{</span> <span class="main">@</span> <span class="bound">x</span> <span class="main">.</span> True<span class="main">}</span><span class="main">,</span> <span class="main">(</span><span class="main">@</span> <span class="bound">x</span> <span class="main">.</span> True<span class="main">)</span><span class="main">,</span> <span class="main">{}</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">}</span><span class="main">,</span> <span class="main">{}</span><span class="main">,</span> Map.empty<span class="main">(</span><span class="main">@</span> <span class="bound">x</span> <span class="main">.</span> True <span class="main">↦</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
  <span class="main">{</span><span class="main">@</span><span class="bound">x</span><span class="main">.</span> True<span class="main">}</span><span class="main">,</span><span class="main">{}</span><span class="main">,</span> <span class="main">@</span><span class="bound">x</span><span class="main">.</span> True<span class="main">)</span> <span class="main">∈</span> 
  <span class="main">{</span><span class="main">(</span><span class="bound">HA</span><span class="main">,</span><span class="bound">C</span><span class="main">,</span><span class="bound">E</span><span class="main">,</span><span class="bound">D</span><span class="main">)</span> <span class="main">|</span> <span class="bound">HA</span> <span class="bound">C</span> <span class="bound">E</span> <span class="bound">D</span><span class="main">.</span> Status <span class="bound">HA</span> <span class="bound">C</span> <span class="bound">E</span> <span class="bound">D</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Status_def CompFun_def SAs_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_hierauto_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> hierauto_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> HierAuto_EmptySet<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_hierauto_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> hierauto_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> HierAuto_EmptySet<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> IsConfSet_def UniqueSucStates_def RootExSem_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> States_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Root_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> someI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ran_def<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_seqauto_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> seqauto_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SeqAuto_EmptySet<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAInitValue_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_hierauto_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> hierauto_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> HierAuto_EmptySet<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">status</span> <span class="main">=</span>
    <span class="main">{</span><span class="main">(</span><span class="bound">HA</span><span class="main">,</span><span class="bound">C</span><span class="main">,</span><span class="bound">E</span><span class="main">,</span><span class="bound">D</span><span class="main">)</span> <span class="main">|</span>
        <span class="main">(</span><span class="bound">HA</span><span class="main">::</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hierauto<span class="main">)</span>
        <span class="main">(</span><span class="bound">C</span><span class="main">::</span><span class="main">(</span><span class="tfree">'s</span> set<span class="main">)</span><span class="main">)</span>
        <span class="main">(</span><span class="bound">E</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span> set<span class="main">)</span><span class="main">)</span>
        <span class="main">(</span><span class="bound">D</span><span class="main">::</span><span class="tfree">'d</span> data<span class="main">)</span><span class="main">.</span> Status <span class="bound">HA</span> <span class="bound">C</span> <span class="bound">E</span> <span class="bound">D</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> status <span class="main">=</span>
    <span class="quoted"><span class="quoted">"status <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hierauto <span class="main">*</span> <span class="tfree">'s</span> set <span class="main">*</span> <span class="tfree">'e</span> set <span class="main">*</span> <span class="tfree">'d</span> data<span class="main">)</span> set"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> status_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Status_EmptySet<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">HA</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> status  <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> hierauto"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">HA</span> <span class="main">==</span> fst <span class="keyword1">o</span> Rep_status"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Conf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> status  <span class="main">=&gt;</span> <span class="tfree">'s</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Conf</span> <span class="main">==</span> fst <span class="keyword1">o</span> snd <span class="keyword1">o</span> Rep_status"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Events</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> status  <span class="main">=&gt;</span> <span class="tfree">'e</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Events</span> <span class="main">==</span> fst <span class="keyword1">o</span> snd <span class="keyword1">o</span> snd <span class="keyword1">o</span> Rep_status"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Value</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> status  <span class="main">=&gt;</span> <span class="tfree">'d</span> data"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Value</span> <span class="main">==</span> snd <span class="keyword1">o</span> snd <span class="keyword1">o</span> snd <span class="keyword1">o</span> Rep_status"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">RootState</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> status  <span class="main">=&gt;</span> <span class="tfree">'s</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">RootState</span> <span class="free"><span class="bound"><span class="entity">ST</span></span></span> <span class="main">==</span> <span class="main">@</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∈</span> Conf <span class="free"><span class="bound"><span class="entity">ST</span></span></span> <span class="main">∧</span> <span class="bound">S</span> <span class="main">∈</span> States <span class="main">(</span>HARoot <span class="main">(</span>HA <span class="free"><span class="bound"><span class="entity">ST</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(* -------------------------------------------------------------- *)</span>
<span class="comment1">(* enabled transitions                                            *)</span>
<span class="comment1">(* -------------------------------------------------------------- *)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">EnabledTrans</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>status <span class="main">*</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto <span class="main">*</span>
                    <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>trans<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">EnabledTrans</span> <span class="main">==</span> <span class="main">{</span><span class="main">(</span><span class="bound">ST</span><span class="main">,</span><span class="bound">SA</span><span class="main">,</span><span class="bound">T</span><span class="main">)</span> <span class="main">.</span>
                       <span class="bound">SA</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="bound">ST</span><span class="main">)</span> <span class="main">∧</span> 
                       <span class="bound">T</span> <span class="main">∈</span> Delta <span class="bound">SA</span> <span class="main">∧</span> 
                       source <span class="bound">T</span> <span class="main">∈</span> Conf <span class="bound">ST</span> <span class="main">∧</span> 
                       <span class="main">(</span>Conf <span class="bound">ST</span><span class="main">,</span> Events <span class="bound">ST</span><span class="main">,</span> Value <span class="bound">ST</span><span class="main">)</span> <span class="main">|=</span> <span class="main">(</span>label <span class="bound">T</span><span class="main">)</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">ET</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> status <span class="main">=&gt;</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> trans<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ET</span> <span class="free"><span class="bound"><span class="entity">ST</span></span></span> <span class="main">==</span> <span class="main">⋃</span> <span class="bound">SA</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free"><span class="bound"><span class="entity">ST</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>EnabledTrans <span class="main">``</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">ST</span></span></span><span class="main">}</span><span class="main">)</span> <span class="main">``</span> <span class="main">{</span><span class="bound">SA</span><span class="main">}</span>"</span></span>

<span class="comment1">(* -------------------------------------------------------------- *)</span>
<span class="comment1">(* maximal non conflicting set of transitions                     *)</span>
<span class="comment1">(* -------------------------------------------------------------- *)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">MaxNonConflict</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>status<span class="main">,</span>
                      <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>trans set<span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">MaxNonConflict</span> <span class="free"><span class="bound"><span class="entity">ST</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">==</span>
        <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">⊆</span> ET <span class="free"><span class="bound"><span class="entity">ST</span></span></span><span class="main">)</span> <span class="main">∧</span> 
        <span class="main">(</span><span class="main">∀</span> <span class="bound">A</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free"><span class="bound"><span class="entity">ST</span></span></span><span class="main">)</span><span class="main">.</span> card <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="keyword1">Int</span> Delta <span class="bound">A</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>  <span class="main">∧</span> 
        <span class="main">(</span><span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> <span class="main">(</span>ET <span class="free"><span class="bound"><span class="entity">ST</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">t'</span> <span class="main">∈</span> ET <span class="free"><span class="bound"><span class="entity">ST</span></span></span><span class="main">.</span> HigherPriority <span class="main">(</span>HA <span class="free"><span class="bound"><span class="entity">ST</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">t'</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(* -------------------------------------------------------------- *)</span>
<span class="comment1">(* resolving the occurrence of racing with interleaving semantic  *)</span>
<span class="comment1">(* for one set of transitions                                     *)</span>
<span class="comment1">(* -------------------------------------------------------------- *)</span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">ResolveRacing</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>trans set
                   <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'d</span> update set<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">ResolveRacing</span> <span class="free"><span class="bound"><span class="entity">TS</span></span></span> <span class="main">==</span>
            <span class="keyword1">let</span>
                <span class="bound">U</span> <span class="main">=</span> PUpdate <span class="main">(</span>Label <span class="free"><span class="bound"><span class="entity">TS</span></span></span><span class="main">)</span>
            <span class="keyword1">in</span>
                SequentialRacing <span class="bound">U</span>"</span></span>

<span class="comment1">(* -------------------------------------------------------------- *)</span>
<span class="comment1">(* HPT is a set, there can be more than one! If there are         *)</span>
<span class="comment1">(* nondeterministic transitions t1, t2 in one SA : SAs A, then    *)</span>
<span class="comment1">(* they are not in conflict wt higher priority. We have to chose  *)</span>
<span class="comment1">(* one and get different sets.                                    *)</span>
<span class="comment1">(* -------------------------------------------------------------- *)</span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">HPT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>status <span class="main">=&gt;</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>trans set<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">HPT</span> <span class="free"><span class="bound"><span class="entity">ST</span></span></span> <span class="main">==</span> <span class="main">{</span> <span class="bound">T</span><span class="main">.</span> MaxNonConflict <span class="free"><span class="bound"><span class="entity">ST</span></span></span> <span class="bound">T</span><span class="main">}</span>"</span></span>

<span class="comment1">(* -------------------------------------------------------------- *)</span>
<span class="comment1">(* The initials status can be defined now for a given automaton.  *)</span>
<span class="comment1">(* -------------------------------------------------------------- *)</span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">InitStatus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hierauto <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>status"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">InitStatus</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">==</span>
    Abs_status <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span>InitConf <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span><span class="main">{}</span><span class="main">,</span> HAInitValue <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(* -------------------------------------------------------------- *)</span>
<span class="comment1">(* The next status for a given status can be defined now by a     *)</span>
<span class="comment1">(* step.                                                          *)</span>
<span class="comment1">(* -------------------------------------------------------------- *)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">StepActEvent</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>trans set <span class="main">=&gt;</span> <span class="tfree">'e</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">StepActEvent</span> <span class="free"><span class="bound"><span class="entity">TS</span></span></span> <span class="main">==</span> Union <span class="main">(</span>Actevent <span class="main">(</span>Label <span class="free"><span class="bound"><span class="entity">TS</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">StepStatus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>status<span class="main">,</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>trans set<span class="main">,</span> <span class="tfree">'d</span> update<span class="main">]</span>
                 <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>status"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">StepStatus</span> <span class="free"><span class="bound"><span class="entity">ST</span></span></span> <span class="free"><span class="bound"><span class="entity">TS</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">=</span>
                <span class="main">(</span><span class="keyword1">let</span>
                   <span class="main">(</span><span class="bound">A</span><span class="main">,</span><span class="bound">C</span><span class="main">,</span><span class="bound">E</span><span class="main">,</span><span class="bound">D</span><span class="main">)</span> <span class="main">=</span> Rep_status <span class="free"><span class="bound"><span class="entity">ST</span></span></span><span class="main">;</span>
                   <span class="bound">C'</span>        <span class="main">=</span> StepConf <span class="bound">A</span> <span class="bound">C</span> <span class="free"><span class="bound"><span class="entity">TS</span></span></span><span class="main">;</span>
                   <span class="bound">E'</span>        <span class="main">=</span> StepActEvent <span class="free"><span class="bound"><span class="entity">TS</span></span></span><span class="main">;</span>
                   <span class="bound">D'</span>        <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">!!!</span> <span class="bound">D</span>
                 <span class="keyword1">in</span>
                   Abs_status <span class="main">(</span><span class="bound">A</span><span class="main">,</span><span class="bound">C'</span><span class="main">,</span><span class="bound">E'</span><span class="main">,</span><span class="bound">D'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(* --------------------------------------------------------------- *)</span>
<span class="comment1">(* The Relation StepRel defines semantic transitions on statuses   *)</span>
<span class="comment1">(* for given hierarchical automaton.                               *)</span>
<span class="comment1">(* --------------------------------------------------------------- *)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">StepRelSem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hierauto
              <span class="main">=&gt;</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>status <span class="main">*</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>status<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">StepRelSem</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">==</span> <span class="main">{</span><span class="main">(</span><span class="bound">ST</span><span class="main">,</span><span class="bound">ST'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>HA <span class="bound">ST</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span>
                    <span class="main">(</span><span class="main">(</span>HPT <span class="bound">ST</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span> <span class="main">⟶</span>
                       <span class="main">(</span><span class="main">∃</span><span class="bound">TS</span> <span class="main">∈</span> HPT <span class="bound">ST</span><span class="main">.</span>
                           <span class="main">∃</span><span class="bound">U</span> <span class="main">∈</span> ResolveRacing <span class="bound">TS</span><span class="main">.</span>
                                  <span class="bound">ST'</span> <span class="main">=</span> StepStatus <span class="bound">ST</span> <span class="bound">TS</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span> <span class="main">&amp;</span>
                    <span class="main">(</span><span class="main">(</span>HPT <span class="bound">ST</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">⟶</span>
                       <span class="main">(</span><span class="bound">ST'</span> <span class="main">=</span> StepStatus <span class="bound">ST</span> <span class="main">{}</span> DefaultUpdate<span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="comment1">(* --------------------------------------------------------------- *)</span>
<span class="comment1">(* The Relation StepRel defines semantic transitions on statuses   *)</span>
<span class="comment1">(* The set of all reachable stati can now be defined inductively   *)</span>
<span class="comment1">(* as the set of statuses derived through applications of          *)</span>
<span class="comment1">(* transitions starting from the initial status TInitStatus 0.     *)</span>
<span class="comment1">(* --------------------------------------------------------------- *)</span>

<span class="keyword1"><span class="command">inductive_set</span></span>
  <span class="entity">ReachStati</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hierauto <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> status set"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">A</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hierauto"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  Status0 <span class="main">:</span> <span class="quoted"><span class="quoted">"InitStatus <span class="free">A</span> <span class="main">∈</span> <span class="free">ReachStati</span> <span class="free">A</span>"</span></span>
<span class="main">|</span> StatusStep <span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">ST</span></span></span> <span class="main">∈</span> <span class="free">ReachStati</span> <span class="free">A</span><span class="main">;</span>  <span class="free"><span class="bound"><span class="entity">TS</span></span></span> <span class="main">∈</span> HPT <span class="free"><span class="bound"><span class="entity">ST</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">∈</span> ResolveRacing <span class="free"><span class="bound"><span class="entity">TS</span></span></span> <span class="main">⟧</span>
      <span class="main">⟹</span> StepStatus <span class="free"><span class="bound"><span class="entity">ST</span></span></span> <span class="free"><span class="bound"><span class="entity">TS</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">∈</span> <span class="free">ReachStati</span> <span class="free">A</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lemmas›</span></span>

<span class="keyword1" id="HASem-Rep_status_tuple"><span class="command">lemma</span></span> Rep_status_tuple<span class="main">:</span> 
 <span class="quoted"><span class="quoted">"Rep_status <span class="free">ST</span> <span class="main">=</span> <span class="main">(</span>HA <span class="free">ST</span><span class="main">,</span> Conf <span class="free">ST</span><span class="main">,</span> Events <span class="free">ST</span><span class="main">,</span> Value <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> HA_def Conf_def Events_def Value_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 

<span class="keyword1" id="HASem-Rep_status_select"><span class="command">lemma</span></span> Rep_status_select<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>HA <span class="free">ST</span><span class="main">,</span> Conf <span class="free">ST</span><span class="main">,</span> Events <span class="free">ST</span><span class="main">,</span> Value <span class="free">ST</span><span class="main">)</span> <span class="main">∈</span> status"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Rep_status_tuple <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> subst<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Rep_status<span class="main">)</span>

<span class="keyword1" id="HASem-Status_select"><span class="command">lemma</span></span> Status_select <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Status <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Events <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Value <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_status_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> status_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>IsConfSet›</span></span></span></span>›</span></span>

<span class="keyword1" id="HASem-IsConfSet_Status"><span class="command">lemma</span></span> IsConfSet_Status <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
 <span class="quoted"><span class="quoted">"IsConfSet <span class="main">(</span>SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>CompFun <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_status_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> status_def Status_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>InitStatus›</span></span></span></span>›</span></span>

<span class="keyword1" id="HASem-IsConfSet_InitConf"><span class="command">lemma</span></span> IsConfSet_InitConf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"IsConfSet <span class="main">(</span>SAs <span class="free">A</span><span class="main">)</span> <span class="main">(</span>CompFun <span class="free">A</span><span class="main">)</span> <span class="main">(</span>InitConf <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> IsConfSet_def RootExSem_def UniqueSucStates_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fold</span> HARoot_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> HAStates_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"HAInitState <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ex1I<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> S SA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">S</span> <span class="main">∈</span> InitConf <span class="free">A</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"InitState <span class="improper">SA</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> InitState_CompFun_InitConf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> S SA T U<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">U</span> <span class="main">=</span> InitState <span class="improper">SA</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>InitConf_CompFun_Ancestor HAStates_SA_mem<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-InitConf_status"><span class="command">lemma</span></span> InitConf_status <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="main">,</span> InitConf <span class="free">A</span><span class="main">,</span> <span class="main">{}</span><span class="main">,</span> HAInitValue <span class="free">A</span><span class="main">)</span> <span class="main">∈</span>  status"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_status_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> status_def Status_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-Conf_InitStatus_InitConf"><span class="command">lemma</span></span> Conf_InitStatus_InitConf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"Conf <span class="main">(</span>InitStatus <span class="free">A</span><span class="main">)</span> <span class="main">=</span> InitConf <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Conf_def InitStatus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_status_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-HAInitValue_Value_DataSpace_Status"><span class="command">lemma</span></span> HAInitValue_Value_DataSpace_Status <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Data.DataSpace <span class="main">(</span>HAInitValue <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Data.DataSpace <span class="main">(</span>Value <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_status_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> status_def Status_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-Value_InitStatus_HAInitValue"><span class="command">lemma</span></span> Value_InitStatus_HAInitValue <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"Value <span class="main">(</span>InitStatus <span class="free">A</span><span class="main">)</span> <span class="main">=</span> HAInitValue <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Value_def InitStatus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_status_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-HA_InitStatus"><span class="command">lemma</span></span> HA_InitStatus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"HA <span class="main">(</span>InitStatus <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> InitStatus_def HA_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_status_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Events›</span></span></span></span>›</span></span>

<span class="keyword1" id="HASem-Events_HAEvents_Status"><span class="command">lemma</span></span> Events_HAEvents_Status<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span>Events <span class="free">ST</span><span class="main">)</span> <span class="main">⊆</span> HAEvents <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_status_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> status_def Status_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-TS_EventSet"><span class="command">lemma</span></span> TS_EventSet<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">TS</span> <span class="main">⊆</span>  ET <span class="free">ST</span> <span class="main">⟹</span> <span class="main">⋃</span> <span class="main">(</span>Actevent <span class="main">(</span>Label <span class="free">TS</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> HAEvents <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Actevent_def actevent_def ET_def EnabledTrans_def Action_def Label_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"HA <span class="free">ST</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HAEvents_SAEvents_SAs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> Event Source Trigger Guard Action Update Target<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> SAEvents_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> subsetCE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> subsetCE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">Trigger</span><span class="main">,</span> <span class="improper">Guard</span><span class="main">,</span> <span class="improper">Action</span><span class="main">,</span> <span class="improper">Update</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> SA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Label_Delta_subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> subsetCE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Label_def image_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>StepStatus›</span></span></span></span>›</span></span>

<span class="keyword1" id="HASem-StepStatus_empty"><span class="command">lemma</span></span> StepStatus_empty<span class="main">:</span>
   <span class="quoted"><span class="quoted">"Abs_status <span class="main">(</span>HA <span class="free">ST</span><span class="main">,</span> Conf <span class="free">ST</span><span class="main">,</span> <span class="main">{}</span><span class="main">,</span> <span class="free">U</span> <span class="main">!!!</span> <span class="main">(</span>Value <span class="free">ST</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> StepStatus <span class="free">ST</span> <span class="main">{}</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> StepStatus_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Rep_status_tuple<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> StepActEvent_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-status_empty_eventset"><span class="command">lemma</span></span> status_empty_eventset <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>HA <span class="free">ST</span><span class="main">,</span> Conf <span class="free">ST</span><span class="main">,</span> <span class="main">{}</span><span class="main">,</span> <span class="free">U</span> <span class="main">!!!</span> <span class="main">(</span>Value <span class="free">ST</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> status"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> status_def Status_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-HA_StepStatus_emptyTS"><span class="command">lemma</span></span> HA_StepStatus_emptyTS <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"HA <span class="main">(</span>StepStatus <span class="free">ST</span> <span class="main">{}</span> <span class="free">U</span><span class="main">)</span> <span class="main">=</span> HA <span class="free">ST</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> StepStatus_empty <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HA_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_status_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Rep_status_tuple<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Enabled Transitions <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ET›</span></span></span></span>›</span></span>

<span class="keyword1" id="HASem-HPT_ETI"><span class="command">lemma</span></span> HPT_ETI<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span> <span class="main">⟹</span> <span class="free">TS</span> <span class="main">⊆</span> ET <span class="free">ST</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> HPT_def MaxNonConflict_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HASem-finite_ET"><span class="command">lemma</span></span> finite_ET <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"finite <span class="main">(</span>ET <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> ET_def Image_def EnabledTrans_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Finite Transition Set›</span></span>

<span class="keyword1" id="HASem-finite_MaxNonConflict"><span class="command">lemma</span></span> finite_MaxNonConflict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"MaxNonConflict <span class="free">ST</span> <span class="free">TS</span> <span class="main">⟹</span> finite <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> MaxNonConflict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> finite_subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-finite_HPT"><span class="command">lemma</span></span> finite_HPT <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span> <span class="main">⟹</span> finite <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> HPT_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>PUpdate›</span></span></span></span>›</span></span>

<span class="keyword1" id="HASem-finite_Update"><span class="command">lemma</span></span> finite_Update<span class="main">:</span>
 <span class="quoted"><span class="quoted">"finite <span class="free">TS</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="bound">F</span><span class="main">.</span> <span class="main">(</span>Rep_pupdate <span class="bound">F</span><span class="main">)</span> <span class="main">(</span>Value <span class="free">ST</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>PUpdate <span class="main">(</span>Label <span class="free">TS</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HASem-finite_PUpdate"><span class="command">lemma</span></span> finite_PUpdate<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">S</span> <span class="main">⟹</span> finite <span class="main">(</span>Expr.PUpdate <span class="main">(</span>Label <span class="free">TS</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-HPT_ResolveRacing_Some"><span class="command">lemma</span></span> HPT_ResolveRacing_Some <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">S</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> ResolveRacing <span class="free">TS</span><span class="main">)</span> <span class="main">∈</span> ResolveRacing <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ResolveRacing_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_SequentialRacing<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Higher Priority Transitions <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>HPT›</span></span></span></span>›</span></span>

<span class="keyword1" id="HASem-finite_HPT2"><span class="command">lemma</span></span> finite_HPT2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>HPT <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> ST<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ST</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> finite_ET<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HPT_def MaxNonConflict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Collect_subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> finite_Collect_subsets<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-HPT_target_StepConf"><span class="command">lemma</span></span> HPT_target_StepConf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> <span class="free">TS</span> <span class="main">⟧</span> <span class="main">⟹</span> target <span class="free">T</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-HPT_target_StepConf2"><span class="command">lemma</span></span> HPT_target_StepConf2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">L</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> <span class="free">TS</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> StepConf_def Target_def Source_def source_def target_def image_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Delta Transition Set›</span></span>

<span class="keyword1" id="HASem-ET_Delta"><span class="command">lemma</span></span> ET_Delta<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">⊆</span> ET <span class="free">ST</span><span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">TS</span><span class="main">;</span> source <span class="free">t</span> <span class="main">∈</span> States <span class="free">A</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> Delta <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ET_def EnabledTrans_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> subsetCE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="improper">SA</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"HA <span class="free">ST</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> MutuallyDistinct_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> MutuallyDistinct_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-ET_Delta_target"><span class="command">lemma</span></span> ET_Delta_target<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">⊆</span> ET <span class="free">ST</span><span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">TS</span><span class="main">;</span> target <span class="free">t</span> <span class="main">∈</span> States <span class="free">A</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> Delta <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ET_def EnabledTrans_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> subsetCE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="improper">SA</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"HA <span class="free">ST</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> MutuallyDistinct_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> MutuallyDistinct_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-ET_HADelta"><span class="command">lemma</span></span> ET_HADelta<span class="main">:</span>
   <span class="quoted"><span class="quoted">" <span class="main">⟦</span> <span class="free">TS</span> <span class="main">⊆</span> ET <span class="free">ST</span><span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">TS</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> HADelta <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HADelta_def<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ET_def EnabledTrans_def Image_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-HPT_HADelta"><span class="command">lemma</span></span> HPT_HADelta<span class="main">:</span>
   <span class="quoted"><span class="quoted">" <span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">TS</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> HADelta <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ET_HADelta<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HPT_def MaxNonConflict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-HPT_Delta"><span class="command">lemma</span></span> HPT_Delta<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">TS</span><span class="main">;</span> source <span class="free">t</span> <span class="main">∈</span> States <span class="free">A</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> Delta <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ET_Delta<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HPT_def MaxNonConflict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-HPT_Delta_target"><span class="command">lemma</span></span> HPT_Delta_target<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">TS</span><span class="main">;</span> target <span class="free">t</span> <span class="main">∈</span> States <span class="free">A</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> Delta <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ET_Delta_target<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HPT_def MaxNonConflict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-OneTrans_HPT_SA"><span class="command">lemma</span></span> OneTrans_HPT_SA<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> <span class="free">TS</span><span class="main">;</span> source <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span>
     <span class="free">U</span> <span class="main">∈</span> <span class="free">TS</span><span class="main">;</span> source <span class="free">U</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">=</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HPT_def MaxNonConflict_def Source_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">TS</span> <span class="main">∩</span> Delta <span class="free">SA</span><span class="main">)</span>"</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> OneElement_Card<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ET_Delta<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> OneElement_Card<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ET_Delta<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-OneTrans_HPT_SA2"><span class="command">lemma</span></span> OneTrans_HPT_SA2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> <span class="free">TS</span><span class="main">;</span> target <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span>
     <span class="free">U</span> <span class="main">∈</span> <span class="free">TS</span><span class="main">;</span> target <span class="free">U</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">=</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HPT_def MaxNonConflict_def Target_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">TS</span> <span class="main">∩</span> Delta <span class="free">SA</span><span class="main">)</span>"</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> OneElement_Card<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ET_Delta_target<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> OneElement_Card<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ET_Delta_target<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Target Transition Set›</span></span>

<span class="keyword1" id="HASem-ET_Target_HAStates"><span class="command">lemma</span></span> ET_Target_HAStates<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">TS</span> <span class="main">⊆</span> ET <span class="free">ST</span> <span class="main">⟹</span> Target <span class="free">TS</span> <span class="main">⊆</span> HAStates <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def Target_def target_def ET_def EnabledTrans_def Action_def Label_def<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"HA <span class="free">ST</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Target_SAs_Delta_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> Source Trigger Guard Action Update Target<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Target_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> subsetCE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> subsetCE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> image_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> target_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-HPT_Target_HAStates"><span class="command">lemma</span></span> HPT_Target_HAStates<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span> <span class="main">⟹</span> Target <span class="free">TS</span> <span class="main">⊆</span> HAStates <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> HPT_ETI <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> ET_Target_HAStates<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-HPT_Target_HAStates2"><span class="command">lemma</span></span> HPT_Target_HAStates2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> Target <span class="free">TS</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∈</span> HAStates <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HPT_Target_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-OneState_HPT_Target"><span class="command">lemma</span></span> OneState_HPT_Target<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> Target <span class="free">TS</span><span class="main">;</span> 
     <span class="free">T</span> <span class="main">∈</span> Target <span class="free">TS</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span>
     <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">⟧</span>
   <span class="main">⟹</span> <span class="free">S</span> <span class="main">=</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Target_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> OneTrans_HPT_SA2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span> -1<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Source Transition Set›</span></span>

<span class="keyword1" id="HASem-ET_Source_Conf"><span class="command">lemma</span></span> ET_Source_Conf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">TS</span> <span class="main">⊆</span> ET <span class="free">ST</span> <span class="main">⟹</span> <span class="main">(</span>Source <span class="free">TS</span><span class="main">)</span> <span class="main">⊆</span> Conf <span class="free">ST</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Source_def ET_def EnabledTrans_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-HPT_Source_Conf"><span class="command">lemma</span></span> HPT_Source_Conf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span> <span class="main">⟹</span> <span class="main">(</span>Source <span class="free">TS</span><span class="main">)</span> <span class="main">⊆</span> Conf <span class="free">ST</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HPT_def MaxNonConflict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ET_Source_Conf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-ET_Source_Target"><span class="command">lemma</span></span> ET_Source_Target <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">SA</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">;</span> <span class="free">TS</span> <span class="main">⊆</span> ET <span class="free">ST</span><span class="main">;</span> States <span class="free">SA</span> <span class="main">∩</span> Source <span class="free">TS</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> States <span class="free">SA</span> <span class="main">∩</span> Target <span class="free">TS</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ET_def EnabledTrans_def Source_def Target_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> Source Trigger Guard Action Update Target<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> subsetCE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SAA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> image_def source_def Int_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">Source</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> Delta_source_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> source_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">SA</span><span class="main">=</span><span class="improper">SAA</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"HA <span class="free">ST</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> MutuallyDistinct_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> MutuallyDistinct_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">SAA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> Delta_target_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> target_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-HPT_Source_Target"><span class="command">lemma</span></span> HPT_Source_Target <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> States <span class="free">SA</span> <span class="main">∩</span> Source <span class="free">TS</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> States <span class="free">SA</span> <span class="main">∩</span> Target <span class="free">TS</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HPT_def MaxNonConflict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-ET_target_source"><span class="command">lemma</span></span> ET_target_source<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">⊆</span> ET <span class="free">ST</span><span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">TS</span><span class="main">;</span> target <span class="free">t</span> <span class="main">∈</span> States <span class="free">A</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> source <span class="free">t</span> <span class="main">∈</span> States <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ET_Delta_target<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-ET_source_target"><span class="command">lemma</span></span> ET_source_target<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">⊆</span> ET <span class="free">ST</span><span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">TS</span><span class="main">;</span> source <span class="free">t</span> <span class="main">∈</span> States <span class="free">A</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> target <span class="free">t</span> <span class="main">∈</span> States <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ET_Delta<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-HPT_target_source"><span class="command">lemma</span></span> HPT_target_source<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">TS</span><span class="main">;</span> target <span class="free">t</span> <span class="main">∈</span> States <span class="free">A</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> source <span class="free">t</span> <span class="main">∈</span> States <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ET_target_source<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HPT_def MaxNonConflict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-HPT_source_target"><span class="command">lemma</span></span> HPT_source_target<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">TS</span><span class="main">;</span> source <span class="free">t</span> <span class="main">∈</span> States <span class="free">A</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> target <span class="free">t</span> <span class="main">∈</span> States <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ET_source_target<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HPT_def MaxNonConflict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-HPT_source_target2"><span class="command">lemma</span></span> HPT_source_target2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span>HPT <span class="free">ST</span><span class="main">;</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">TS</span><span class="main">;</span> <span class="free">s</span> <span class="main">∈</span> States <span class="free">A</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>  <span class="free">t</span> <span class="main">∈</span>States <span class="free">A</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> ST<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ST</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> TS<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">TS</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HPT_source_target<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-ChiRel_ChiStar_Source_notmem"><span class="command">lemma</span></span> ChiRel_ChiStar_Source_notmem<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span> <span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> Conf <span class="free">ST</span><span class="main">;</span> 
      <span class="free">T</span> <span class="main">∉</span> ChiStar <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">``</span> Source <span class="free">TS</span> <span class="main">⟧</span> <span class="main">⟹</span> 
      <span class="free">S</span> <span class="main">∉</span> ChiStar <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">``</span> Source <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> U<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Image_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ChiRel_ChiStar_trans<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-ChiRel_ChiStar_notmem"><span class="command">lemma</span></span> ChiRel_ChiStar_notmem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">;</span> 
     <span class="free">S</span> <span class="main">∈</span> ChiStar <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">``</span> Source <span class="free">TS</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">∉</span> Source <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">hypsubst_thin</span> <span class="main"><span class="main">=</span></span> <span class="quasi_keyword">true</span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HPT_def MaxNonConflict_def HigherPriority_def restrict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> U<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Source_def image_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SSource STrigger SGuard SAction SUpdate STarget 
                  TSource TTrigger TGuard TAction TUpdate TTarget<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">SSource</span><span class="main">,</span> <span class="main">(</span><span class="improper">STrigger</span><span class="main">,</span> <span class="improper">SGuard</span><span class="main">,</span> <span class="improper">SAction</span><span class="main">,</span> <span class="improper">SUpdate</span><span class="main">)</span><span class="main">,</span> <span class="improper">STarget</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">TSource</span><span class="main">,</span> <span class="main">(</span><span class="improper">TTrigger</span><span class="main">,</span> <span class="improper">TGuard</span><span class="main">,</span> <span class="improper">TAction</span><span class="main">,</span> <span class="improper">TUpdate</span><span class="main">)</span><span class="main">,</span> <span class="improper">TTarget</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ET_HADelta<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">SSource</span><span class="main">=</span><span class="free">S</span>"</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ChiStar_ChiPlus_noteq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ChiRel_ChiPlus_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>StepActEvents›</span></span></span></span>›</span></span>

<span class="keyword1" id="HASem-StepActEvent_empty"><span class="command">lemma</span></span> StepActEvent_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"StepActEvent <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> StepActEvent_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HASem-StepActEvent_HAEvents"><span class="command">lemma</span></span> StepActEvent_HAEvents<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span> <span class="main">⟹</span> StepActEvent <span class="free">TS</span> <span class="main">⊆</span> HAEvents <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> StepActEvent_def image_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> HPT_ETI <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> TS_EventSet<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>UniqueSucStates›</span></span></span></span>›</span></span>

<span class="keyword1" id="HASem-UniqueSucStates_Status"><span class="command">lemma</span></span> UniqueSucStates_Status <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"UniqueSucStates <span class="main">(</span>SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>CompFun <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_status_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> status_def Status_def IsConfSet_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>RootState›</span></span></span></span>›</span></span>

<span class="keyword1" id="HASem-RootExSem_Status"><span class="command">lemma</span></span> RootExSem_Status <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"RootExSem <span class="main">(</span>SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>CompFun <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_status_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> status_def Status_def IsConfSet_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-RootState_HARootState"><span class="command">lemma</span></span> RootState_HARootState <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>RootState <span class="free">ST</span><span class="main">)</span> <span class="main">∈</span> States <span class="main">(</span>HARoot <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> RootState_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> ST<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ST</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> RootExSem_Status<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> RootExSem_def HARoot_def HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> some1_equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-RootState_Conf"><span class="command">lemma</span></span> RootState_Conf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>RootState <span class="free">ST</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> RootState_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> ST<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ST</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> RootExSem_Status<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> RootExSem_def HARoot_def HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> some1_equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-RootState_notmem_Chi"><span class="command">lemma</span></span> RootState_notmem_Chi <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> HAStates <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>RootState <span class="free">ST</span><span class="main">)</span> <span class="main">∉</span> Chi <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="HASem-RootState_notmem_Range_ChiRel"><span class="command">lemma</span></span> RootState_notmem_Range_ChiRel <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"RootState <span class="free">ST</span> <span class="main">∉</span> Range <span class="main">(</span>ChiRel <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="HASem-RootState_Range_ChiPlus"><span class="command">lemma</span></span> RootState_Range_ChiPlus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"RootState <span class="free">ST</span> <span class="main">∉</span> Range <span class="main">(</span>ChiPlus <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="HASem-RootState_Range_ChiStar"><span class="command">lemma</span></span> RootState_Range_ChiStar <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">≠</span> RootState <span class="free">ST</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span>RootState <span class="free">ST</span><span class="main">)</span> <span class="main">∉</span> <span class="main">(</span>ChiStar <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="HASem-RootState_notmem_ChiRel"><span class="command">lemma</span></span> RootState_notmem_ChiRel <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span>RootState <span class="free">ST</span><span class="main">)</span> <span class="main">∉</span> <span class="main">(</span>ChiRel <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> ChiRel_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HASem-RootState_notmem_ChiRel2"><span class="command">lemma</span></span> RootState_notmem_ChiRel2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> States <span class="main">(</span>HARoot <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span>  <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∉</span> <span class="main">(</span>ChiRel <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> ChiRel_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HASem-RootState_Conf_StepConf"><span class="command">lemma</span></span> RootState_Conf_StepConf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> RootState <span class="free">ST</span> <span class="main">∉</span> Source <span class="free">TS</span> <span class="main">⟧</span> <span class="main">⟹</span> RootState <span class="free">ST</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> S<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">S</span><span class="main">=</span>RootState <span class="free">ST</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> S<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">S</span><span class="main">=</span>RootState <span class="free">ST</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-OneRootState_Conf"><span class="command">lemma</span></span> OneRootState_Conf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> States <span class="main">(</span>HARoot <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> Conf <span class="free">ST</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">=</span> RootState <span class="free">ST</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> ST<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ST</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> IsConfSet_Status<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> IsConfSet_def RootExSem_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> HARoot_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-OneRootState_Source"><span class="command">lemma</span></span> OneRootState_Source<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> Source <span class="free">TS</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> States <span class="main">(</span>HARoot <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">=</span> RootState <span class="free">ST</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> ST<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ST</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> TS<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">TS</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HPT_Source_Conf<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> ST<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ST</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> OneRootState_Conf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-OneState_HPT_Target_Source"><span class="command">lemma</span></span> OneState_HPT_Target_Source<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">;</span>
     States <span class="free">SA</span> <span class="main">∩</span> Source <span class="free">TS</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟧</span> 
   <span class="main">⟹</span> <span class="free">S</span> <span class="main">∉</span> Target <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Target_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Source_def Image_def Int_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> HPT_target_source<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-RootState_notmem_Target"><span class="command">lemma</span></span> RootState_notmem_Target <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> States <span class="main">(</span>HARoot <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> RootState <span class="free">ST</span> <span class="main">∉</span> Source <span class="free">TS</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∉</span> Target <span class="free">TS</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> OneState_HPT_Target_Source<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 4
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Int_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> OneRootState_Source<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Configuration <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Conf›</span></span></span></span>›</span></span>

<span class="keyword1" id="HASem-Conf_HAStates"><span class="command">lemma</span></span> Conf_HAStates<span class="main">:</span>
 <span class="quoted"><span class="quoted">"Conf <span class="free">ST</span> <span class="main">⊆</span> HAStates <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Rep_status_select<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> IsConfSet_def status_def Status_def HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-Conf_HAStates2"><span class="command">lemma</span></span> Conf_HAStates2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> Conf <span class="free">ST</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∈</span> HAStates <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> ST<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">ST</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Conf_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-OneState_Conf"><span class="command">lemma</span></span> OneState_Conf <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> Conf <span class="free">ST</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> Conf <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span>
     <span class="free">SA</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">=</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> ST<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ST</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> IsConfSet_Status<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> IsConfSet_def UniqueSucStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">SA</span> <span class="main">=</span> HARoot <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> ST<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ST</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> OneRootState_Conf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>OneRootState_Conf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"HA <span class="free">ST</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> OneAncestor_HA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> OneAncestor_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> HARoot_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> ex1_implies_ex<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> U<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">U</span> <span class="main">∈</span> Conf <span class="free">ST</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-OneState_HPT_SA"><span class="command">lemma</span></span> OneState_HPT_SA<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> Source <span class="free">TS</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> Source <span class="free">TS</span><span class="main">;</span>
     <span class="free">S</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span> 
     <span class="free">SA</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">=</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> OneState_Conf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> HPT_Source_Conf<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-HPT_SAStates_Target_Source"><span class="command">lemma</span></span> HPT_SAStates_Target_Source<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> States <span class="free">A</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> States <span class="free">A</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> Conf <span class="free">ST</span><span class="main">;</span>
     <span class="free">T</span> <span class="main">∈</span> Target <span class="free">TS</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∈</span> Source <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"States <span class="free">A</span> <span class="main">∩</span> Source <span class="free">TS</span> <span class="main">=</span><span class="main">{}</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> OneState_HPT_Target_Source<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> U<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> ST<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ST</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HPT_Source_Conf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> OneState_Conf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-HPT_Conf_Target_Source"><span class="command">lemma</span></span> HPT_Conf_Target_Source<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> Conf <span class="free">ST</span><span class="main">;</span>
     <span class="free">S</span> <span class="main">∈</span> Target <span class="free">TS</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∈</span> Source <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> Conf_HAStates2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>HPT_SAStates_Target_Source<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-Conf_SA"><span class="command">lemma</span></span> Conf_SA<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> Conf <span class="free">ST</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">A</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">.</span> <span class="free">S</span> <span class="main">∈</span> States <span class="bound">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> ST<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ST</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> IsConfSet_Status<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> IsConfSet_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-HPT_Source_HAStates"><span class="command">lemma</span></span> HPT_Source_HAStates <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> Source <span class="free">TS</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∈</span> HAStates <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> HPT_Source_Conf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Conf_HAStates2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-Conf_Ancestor"><span class="command">lemma</span></span> Conf_Ancestor<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> Conf <span class="free">ST</span><span class="main">;</span>  <span class="free">A</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃!</span> <span class="bound"><span class="bound">T</span></span> <span class="main">∈</span> States <span class="free">A</span><span class="main">.</span> <span class="bound">T</span> <span class="main">∈</span> Conf <span class="free">ST</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> ST<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ST</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> IsConfSet_Status<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> IsConfSet_def UniqueSucStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> HAStates_CompFun_SAs_mem Conf_HAStates2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="HASem-Conf_ChiRel"><span class="command">lemma</span></span> Conf_ChiRel<span class="main">:</span> 
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> Conf <span class="free">ST</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∈</span> Conf <span class="free">ST</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiRel_def Chi_def restrict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> U<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> ST<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ST</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> UniqueSucStates_Status<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> UniqueSucStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> Conf <span class="free">ST</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-Conf_ChiPlus"><span class="command">lemma</span></span> Conf_ChiPlus<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">S</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>  <span class="free">S</span> <span class="main">∈</span> Conf <span class="free">ST</span> <span class="main">⟶</span> <span class="free">T</span> <span class="main">∈</span> Conf <span class="free">ST</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ChiRel <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Conf_ChiRel<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-HPT_Conf_Target_Source_ChiPlus"><span class="command">lemma</span></span> HPT_Conf_Target_Source_ChiPlus<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> Conf <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> ChiPlus <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">``</span> Target <span class="free">TS</span> <span class="main">⟧</span>
     <span class="main">⟹</span> <span class="free">S</span> <span class="main">∈</span> ChiStar <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">``</span> Source <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> T<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Image_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> HPT_Target_HAStates2<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"States <span class="improper">SA</span> <span class="main">∩</span> Source <span class="free">TS</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>OneState_HPT_Target_Source<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> U<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">U</span><span class="main">=</span><span class="improper">T</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> Conf_ChiPlus<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> HPT_Conf_Target_Source<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>OneState_HPT_SA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-OneState_HPT_Target_ChiRel"><span class="command">lemma</span></span> OneState_HPT_Target_ChiRel<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="main">(</span><span class="free">U</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">;</span>
      <span class="free">U</span> <span class="main">∈</span> Target <span class="free">TS</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> States <span class="free">A</span><span class="main">;</span>
      <span class="free">S</span> <span class="main">∈</span> States <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∉</span> Target <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">hypsubst_thin</span> <span class="main"><span class="main">=</span></span> <span class="quasi_keyword">true</span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HigherPriority_def restrict_def HPT_def MaxNonConflict_def Target_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SSource STrigger SGuard SAction SUpdate STarget 
                  TSource TTrigger TGuard TAction TUpdate TTarget<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">TSource</span><span class="main">,</span> <span class="main">(</span><span class="improper">TTrigger</span><span class="main">,</span> <span class="improper">TGuard</span><span class="main">,</span> <span class="improper">TAction</span><span class="main">,</span> <span class="improper">TUpdate</span><span class="main">)</span><span class="main">,</span> <span class="improper">TTarget</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> TS<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">TS</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ST<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ST</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ET_target_source<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ChiRel_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">SSource</span><span class="main">,</span> <span class="main">(</span><span class="improper">STrigger</span><span class="main">,</span> <span class="improper">SGuard</span><span class="main">,</span> <span class="improper">SAction</span><span class="main">,</span> <span class="improper">SUpdate</span><span class="main">)</span><span class="main">,</span> <span class="improper">STarget</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ST<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ST</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> TS<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">TS</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ET_target_source<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">SSource</span><span class="main">,</span> <span class="main">(</span><span class="improper">STrigger</span><span class="main">,</span> <span class="improper">SGuard</span><span class="main">,</span> <span class="improper">SAction</span><span class="main">,</span> <span class="improper">SUpdate</span><span class="main">)</span><span class="main">,</span> <span class="improper">STarget</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">TSource</span><span class="main">,</span> <span class="main">(</span><span class="improper">TTrigger</span><span class="main">,</span> <span class="improper">TGuard</span><span class="main">,</span> <span class="improper">TAction</span><span class="main">,</span> <span class="improper">TUpdate</span><span class="main">)</span><span class="main">,</span> <span class="improper">TTarget</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ET_HADelta<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"HA <span class="free">ST</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">STarget</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> U<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">TSource</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ChiRel_SA_OneAncestor<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ET_Source_Conf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Source_def image_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">SSource</span> <span class="main">∈</span>Conf <span class="free">ST</span>"</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> subsetCE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">TSource</span> <span class="main">∈</span>Conf <span class="free">ST</span>"</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> subsetCE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">STarget</span><span class="main">=</span><span class="improper">SSource</span>"</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>Conf_ChiRel<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-OneState_HPT_Target_ChiPlus"><span class="command">lemma</span></span> OneState_HPT_Target_ChiPlus <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="main">(</span><span class="free">U</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiPlus <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">;</span>
      <span class="free">S</span> <span class="main">∈</span> Target <span class="free">TS</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">;</span> 
      <span class="free">S</span> <span class="main">∈</span> States <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">∈</span> States <span class="free">A</span> <span class="main">⟶</span> <span class="free">U</span> <span class="main">∉</span> Target <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">hypsubst_thin</span> <span class="main"><span class="main">=</span></span> <span class="quasi_keyword">true</span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ChiRel <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> converse_trancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>OneState_HPT_Target_ChiRel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> V W<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HPT_def MaxNonConflict_def Target_def HigherPriority_def restrict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SSource STrigger SGuard SAction SUpdate STarget 
                  TSource TTrigger TGuard TAction TUpdate TTarget<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">SSource</span><span class="main">,</span> <span class="main">(</span><span class="improper">STrigger</span><span class="main">,</span> <span class="improper">SGuard</span><span class="main">,</span> <span class="improper">SAction</span><span class="main">,</span> <span class="improper">SUpdate</span><span class="main">)</span><span class="main">,</span> <span class="improper">STarget</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ST<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ST</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> TS<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">TS</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ET_target_source<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ChiRel_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">TSource</span><span class="main">,</span> <span class="main">(</span><span class="improper">TTrigger</span><span class="main">,</span> <span class="improper">TGuard</span><span class="main">,</span> <span class="improper">TAction</span><span class="main">,</span> <span class="improper">TUpdate</span><span class="main">)</span><span class="main">,</span> <span class="improper">TTarget</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> TS<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">TS</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ST<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ST</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ET_target_source<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">TSource</span><span class="main">,</span> <span class="main">(</span><span class="improper">TTrigger</span><span class="main">,</span> <span class="improper">TGuard</span><span class="main">,</span> <span class="improper">TAction</span><span class="main">,</span> <span class="improper">TUpdate</span><span class="main">)</span><span class="main">,</span> <span class="improper">TTarget</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">SSource</span><span class="main">,</span> <span class="main">(</span><span class="improper">STrigger</span><span class="main">,</span> <span class="improper">SGuard</span><span class="main">,</span> <span class="improper">SAction</span><span class="main">,</span> <span class="improper">SUpdate</span><span class="main">)</span><span class="main">,</span> <span class="improper">STarget</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ET_HADelta<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"HA <span class="free">ST</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">TTarget</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> U<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">SSource</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ChiPlus_SA_OneAncestor<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ChiRel_ChiPlus_trans2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ET_Source_Conf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Source_def image_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">SSource</span> <span class="main">∈</span>Conf <span class="free">ST</span>"</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> subsetCE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">TSource</span> <span class="main">∈</span>Conf <span class="free">ST</span>"</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> subsetCE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">TTarget</span><span class="main">=</span><span class="improper">SSource</span>"</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">TTarget</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">SSource</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Conf_ChiPlus<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">TSource</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">TTarget</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> OneState_Conf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>RootExSem›</span></span></span></span>›</span></span>

<span class="keyword1" id="HASem-RootExSem_StepConf"><span class="command">lemma</span></span> RootExSem_StepConf<span class="main">:</span> 
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span> <span class="main">⟧</span> <span class="main">⟹</span> 
      RootExSem <span class="main">(</span>SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>CompFun <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> RootExSem_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> HARoot_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"RootState <span class="free">ST</span> <span class="main">∉</span> Source <span class="free">TS</span>"</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"RootState <span class="free">ST</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Source_def image_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> bexE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> T<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"target <span class="improper">T</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> HPT_source_target<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> S T<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">S</span> <span class="main">∈</span> Conf <span class="free">ST</span>"</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">T</span> <span class="main">∈</span> Conf <span class="free">ST</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> OneRootState_Conf<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> OneRootState_Conf<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> OneRootState_Conf<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"RootState <span class="free">ST</span> <span class="main">∈</span> Source <span class="free">TS</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">T</span> <span class="main">∈</span> Source <span class="free">TS</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> HPT_Source_Conf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> OneState_HPT_Target<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> SA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"HARoot <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> TS<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">TS</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"RootState <span class="free">ST</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> OneState_HPT_Target<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> trancl_Int_mem<span class="main"><span class="keyword3">,</span></span> <span class="operator">fold</span> ChiPlus_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> OneState_HPT_Target<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"RootState <span class="free">ST</span> <span class="main">∈</span> Source <span class="free">TS</span>"</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">T</span> <span class="main">=</span> RootState <span class="free">ST</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> trancl_Int_mem<span class="main"><span class="keyword3">,</span></span> <span class="operator">fold</span> ChiPlus_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>StepConf›</span></span></span></span>›</span></span>

<span class="keyword1" id="HASem-Target_StepConf"><span class="command">lemma</span></span> Target_StepConf<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> Target <span class="free">TS</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-Target_ChiRel_HAInit_StepConf"><span class="command">lemma</span></span> Target_ChiRel_HAInit_StepConf<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> Target <span class="free">TS</span><span class="main">;</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="free">A</span><span class="main">;</span> 
      <span class="free">T</span> <span class="main">∈</span> HAInitStates <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">∈</span> StepConf <span class="free">A</span> <span class="free">C</span> <span class="free">TS</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-StepConf_HAStates"><span class="command">lemma</span></span> StepConf_HAStates<span class="main">:</span> 
 <span class="quoted"><span class="quoted">"<span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span> <span class="main">⟹</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span> <span class="main">⊆</span> HAStates <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> tranclD2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-RootState_Conf_StepConf2"><span class="command">lemma</span></span> RootState_Conf_StepConf2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> source <span class="free">T</span> <span class="main">=</span> RootState <span class="free">ST</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> <span class="free">TS</span> <span class="main">⟧</span> <span class="main">⟹</span> target <span class="free">T</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-HPT_StepConf_HAStates"><span class="command">lemma</span></span> HPT_StepConf_HAStates <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∈</span> HAStates <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> tranclD2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-StepConf_Target_HAInitStates"><span class="command">lemma</span></span> StepConf_Target_HAInitStates<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span><span class="main">;</span> <span class="free">S</span> <span class="main">∉</span> Target <span class="free">TS</span><span class="main">;</span> <span class="free">S</span> <span class="main">∉</span> Conf <span class="free">ST</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">∈</span> HAInitStates <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> tranclD2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-InitSucState_StepConf"><span class="command">lemma</span></span> InitSucState_StepConf<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∉</span> Target <span class="free">TS</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">;</span>
      <span class="free">S</span> <span class="main">∉</span> Conf <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span> <span class="main">⟧</span> <span class="main">⟹</span>
      InitState <span class="free">A</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> StepConf_HAStates <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> subsetD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> CompFun_HAInitStates_HAStates<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> HAInitStates_InitState_trancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> trancl_Int_mem<span class="main"><span class="keyword3">,</span></span> <span class="operator">fold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>ChiPlus_HAStates_Right <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> HAInitStates_InitState_trancl2<span class="main"><span class="main">]</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-InitSucState_Target_StepConf"><span class="command">lemma</span></span> InitSucState_Target_StepConf<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> Target <span class="free">TS</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
      InitState <span class="free">A</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> HPT_Target_HAStates2 <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> CompFun_HAInitStates_HAStates<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> HPT_Target_HAStates2 <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> CompFun_ChiRel<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>InitState_States<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-InitSucState_Conf_StepConf"><span class="command">lemma</span></span> InitSucState_Conf_StepConf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span><span class="main">;</span> 
     <span class="free">S</span> <span class="main">∉</span> Target <span class="free">TS</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">;</span>
     <span class="free">S</span> <span class="main">∈</span> Conf <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> ChiStar <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">``</span> <span class="main">(</span>Source <span class="free">TS</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> 
     InitState <span class="free">A</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> Conf_HAStates2 <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> CompFun_HAInitStates_HAStates<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>HAInitStates_InitState_trancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> T U V<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> trancl_Int_mem<span class="main"><span class="keyword3">,</span></span> <span class="operator">fold</span> ChiPlus_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> Image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ChiPlus_HAStates_Right <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> HAInitStates_InitState_trancl2<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> Image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ChiPlus_HAStates_Right <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> HAInitStates_InitState_trancl2<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-SucState_Conf_StepConf"><span class="command">lemma</span></span> SucState_Conf_StepConf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span><span class="main">;</span>
     <span class="free">S</span> <span class="main">∉</span> Target <span class="free">TS</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">;</span>
     <span class="free">S</span> <span class="main">∈</span> Conf <span class="free">ST</span><span class="main">;</span> States <span class="free">A</span> <span class="main">∩</span> ChiStar <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">``</span> <span class="main">(</span>Source <span class="free">TS</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> 
     <span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> States <span class="free">A</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> ST<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ST</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> UniqueSucStates_Status<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> UniqueSucStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> ST<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ST</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Conf_HAStates2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-SucState_Conf_Source_StepConf"><span class="command">lemma</span></span> SucState_Conf_Source_StepConf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span><span class="main">;</span> 
     <span class="free">S</span> <span class="main">∉</span> Target <span class="free">TS</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">;</span>
     <span class="free">S</span> <span class="main">∈</span> Conf <span class="free">ST</span><span class="main">;</span> States <span class="free">A</span> <span class="main">∩</span> ChiStar <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">``</span> <span class="main">(</span>Source <span class="free">TS</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> 
     <span class="free">S</span> <span class="main">∉</span> ChiStar <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">``</span> <span class="main">(</span>Source <span class="free">TS</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> 
     <span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> States <span class="free">A</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> T U<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> Conf_HAStates2 <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> CompFun_ChiRel<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">U</span><span class="main">=</span><span class="improper">T</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> -5<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>Source_def Target_def image_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> Source Trigger Guard Action Update Target<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">Target</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> HPT_source_target2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> HAStates_CompFun_SAs_mem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Conf_HAStates2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ChiStar_ChiPlus_noteq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">U</span><span class="main">=</span><span class="free">S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>ChiStar_Self ChiRel_ChiPlus_OneAncestor ChiPlus_ChiStar<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-SucState_StepConf"><span class="command">lemma</span></span> SucState_StepConf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span><span class="main">;</span> 
     <span class="free">A</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> 
     <span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> States <span class="free">A</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> Target <span class="free">TS</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> InitSucState_Target_StepConf InitState_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> Conf <span class="free">ST</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> InitSucState_StepConf InitState_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> ChiStar <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">``</span> <span class="main">(</span>Source <span class="free">TS</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> InitSucState_Conf_StepConf InitState_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"States <span class="free">A</span> <span class="main">∩</span> ChiStar <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">``</span> <span class="main">(</span>Source <span class="free">TS</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SucState_Conf_StepConf SucState_Conf_Source_StepConf<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>StepStatus›</span></span></span></span>›</span></span>

<span class="keyword1" id="HASem-StepStatus_expand"><span class="command">lemma</span></span> StepStatus_expand<span class="main">:</span>
   <span class="quoted"><span class="quoted">"Abs_status <span class="main">(</span>HA <span class="free">ST</span><span class="main">,</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span><span class="main">,</span> 
                StepActEvent <span class="free">TS</span><span class="main">,</span> <span class="free">U</span> <span class="main">!!!</span> <span class="main">(</span>Value <span class="free">ST</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span>StepStatus <span class="free">ST</span> <span class="free">TS</span> <span class="free">U</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> StepStatus_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Rep_status_tuple<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-UniqueSucState_Conf_Source_StepConf"><span class="command">lemma</span></span> UniqueSucState_Conf_Source_StepConf<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">;</span>
      <span class="free">A</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> States <span class="free">A</span><span class="main">;</span> <span class="free">U</span> <span class="main">∈</span> States <span class="free">A</span><span class="main">;</span>
      <span class="free">T</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span><span class="main">;</span> <span class="free">T</span> <span class="main">≠</span> <span class="free">U</span><span class="main">;</span> <span class="free">U</span> <span class="main">∈</span> Conf <span class="free">ST</span> <span class="main">⟧</span> <span class="main">⟹</span> 
      <span class="free">U</span> <span class="main">∈</span> ChiStar <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">``</span> Source <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> <span class="var">?S2.0</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> StepConf_HAStates <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> subsetD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> CompFun_ChiRel<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> <span class="var">?S2.0</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> StepConf_HAStates <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> subsetD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> CompFun_ChiRel<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Conf_ChiRel<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> ChiStar <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">``</span> Source <span class="free">TS</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ChiRel_ChiStar_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">∈</span> Source <span class="free">TS</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> HPT_SAStates_Target_Source<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> V<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">V</span><span class="main">=</span><span class="free">S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HPT_Conf_Target_Source<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ChiStar_Image ChiRel_OneAncestor<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> V W<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> trancl_Int_mem<span class="main"><span class="keyword3">,</span></span> <span class="operator">fold</span> ChiPlus_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> ST<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ST</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HPT_Conf_Target_Source_ChiPlus<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>Image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">V</span><span class="main">,</span> <span class="free">T</span><span class="main">)</span> <span class="main">∉</span> ChiRel <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">V</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ChiPlus_ChiRel_Ex<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> X<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">X</span><span class="main">=</span><span class="free">S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">W</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 4
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">V</span><span class="main">=</span><span class="free">S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ChiPlus_ChiRel ChiRel_ChiPlus_trans2 ChiRel_OneAncestor<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-UniqueSucState_Target_StepConf"><span class="command">lemma</span></span> UniqueSucState_Target_StepConf<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">;</span>
      <span class="free">A</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> States <span class="free">A</span><span class="main">;</span> <span class="free">U</span> <span class="main">∈</span> States <span class="free">A</span><span class="main">;</span>
      <span class="free">T</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span><span class="main">;</span> <span class="free">T</span> <span class="main">≠</span> <span class="free">U</span> <span class="main">⟧</span> <span class="main">⟹</span> 
      <span class="free">U</span> <span class="main">∉</span> Target <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> ST<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ST</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Target_StepConf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> TS<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">TS</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ST<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ST</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> UniqueSucState_Conf_Source_StepConf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> OneState_HPT_Target<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>OneState_HPT_Target_ChiRel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> V W<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> U<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">W</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">V</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ChiRel_ChiPlus_trans2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> trancl_Int_mem<span class="main"><span class="keyword3">,</span></span> <span class="operator">fold</span> ChiPlus_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>OneState_HPT_Target_ChiPlus<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-UniqueSucState_Target_ChiRel_StepConf"><span class="command">lemma</span></span> UniqueSucState_Target_ChiRel_StepConf<span class="main">:</span> 
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">;</span>
      <span class="free">A</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> States <span class="free">A</span><span class="main">;</span> <span class="free">U</span> <span class="main">∈</span> States <span class="free">A</span><span class="main">;</span>
      <span class="free">T</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span><span class="main">;</span> <span class="free">T</span> <span class="main">≠</span> <span class="free">U</span><span class="main">;</span> <span class="main">(</span><span class="free">V</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">;</span> 
      <span class="free">U</span> <span class="main">∈</span> HAInitStates <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">⟧</span>
    <span class="main">⟹</span> <span class="free">V</span> <span class="main">∉</span> Target <span class="free">TS</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"HA <span class="free">ST</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> C<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Conf <span class="free">ST</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Target_ChiRel_HAInit_StepConf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> StepConf_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>UniqueSucState_Conf_Source_StepConf<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>OneState_HPT_Target_ChiRel<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>OneHAInitState_SAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> trancl_Int_mem<span class="main"><span class="keyword3">,</span></span> <span class="operator">fold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>OneHAInitState_SAStates<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-UniqueSucState_Target_ChiPlus_StepConf"><span class="command">lemma</span></span> UniqueSucState_Target_ChiPlus_StepConf <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">T</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">;</span> 
     <span class="free">V</span> <span class="main">∈</span> Target <span class="free">TS</span><span class="main">;</span> <span class="main">(</span><span class="free">V</span><span class="main">,</span><span class="free">W</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">;</span> <span class="free">T</span> <span class="main">∉</span> ChiStar <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">``</span> Source <span class="free">TS</span><span class="main">;</span>
     <span class="main">(</span><span class="free">W</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ChiRel <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">∩</span> HAInitStates <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">×</span> HAInitStates <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">;</span>
     <span class="free">T</span> <span class="main">∈</span> Conf <span class="free">ST</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">U</span><span class="main">)</span> <span class="main">∈</span> ChiRel <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">T</span><span class="main">=</span><span class="free">U</span>"</span></span>    
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Conf_ChiRel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"ChiRel <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">∩</span> HAInitStates <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">×</span> HAInitStates <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> X<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">W</span><span class="main">=</span><span class="free">S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ChiRel_OneAncestor<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> X Y<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">X</span><span class="main">=</span><span class="free">S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ChiRel_OneAncestor<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">V</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ChiRel_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> Y<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"States <span class="improper">Y</span> <span class="main">∩</span> Source <span class="free">TS</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>OneState_HPT_Target_Source<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> Int_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> Z<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">V</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Conf_ChiRel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> HPT_Conf_Target_Source<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">Z</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">V</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span>  OneState_HPT_SA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ChiPlus_ChiRel ChiRel_ChiPlus_trans ChiPlus_ChiStar<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Image_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> trancl_Int_mem<span class="main"><span class="keyword3">,</span></span> <span class="operator">fold</span> ChiPlus_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">W</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Conf_ChiPlus<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">V</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">W</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Conf_ChiRel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">V</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ChiRel_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> Z<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"States <span class="improper">Z</span> <span class="main">∩</span> Source <span class="free">TS</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>OneState_HPT_Target_Source<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> Int_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">V</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HPT_Conf_Target_Source<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> P<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">P</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">V</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span>  OneState_HPT_SA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> U<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">V</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">W</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ChiRel_ChiPlus_trans2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ChiPlus_ChiRel ChiRel_ChiPlus_trans ChiPlus_ChiStar<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">T</span><span class="main">=</span><span class="free">S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ChiRel_OneAncestor<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-UniqueSucStates_SAStates_StepConf"><span class="command">lemma</span></span> UniqueSucStates_SAStates_StepConf<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">;</span>
      <span class="free">A</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> States <span class="free">A</span><span class="main">;</span> <span class="free">U</span> <span class="main">∈</span> States <span class="free">A</span><span class="main">;</span>
      <span class="free">T</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span><span class="main">;</span> <span class="free">T</span> <span class="main">≠</span> <span class="free">U</span> <span class="main">⟧</span> <span class="main">⟹</span> 
      <span class="free">U</span> <span class="main">∉</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> UniqueSucState_Conf_Source_StepConf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> U<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> UniqueSucState_Target_StepConf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> U<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> UniqueSucState_Target_ChiRel_StepConf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> V W<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> trancl_Int_mem<span class="main"><span class="keyword3">,</span></span> <span class="operator">fold</span> ChiPlus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> <span class="var">?S2.0</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> StepConf_HAStates <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> subsetD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> CompFun_ChiRel<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> <span class="var">?S2.0</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> StepConf_HAStates <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> subsetD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> CompFun_ChiRel<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> UniqueSucState_Target_ChiPlus_StepConf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> U<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">W</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> OneState_HPT_Target_ChiPlus<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ChiPlus_ChiRel ChiRel_ChiPlus_trans2 OneHAInitState_SAStates<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> trancl_Int_mem<span class="main"><span class="keyword3">,</span></span> <span class="operator">fold</span> ChiPlus_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>OneHAInitState_SAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-UniqueSucStates_Ancestor_StepConf"><span class="command">lemma</span></span> UniqueSucStates_Ancestor_StepConf<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> HAStates <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">;</span> <span class="free">SA</span> <span class="main">∈</span> the <span class="main">(</span>CompFun <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">;</span> 
      <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span> <span class="main">⟧</span>
    <span class="main">⟹</span> <span class="free">S</span> <span class="main">∈</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notnotD<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> notI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span>  CompFun_ChiRel<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> Conf_ChiRel<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ChiRel_ChiStar_Source_notmem<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"States <span class="free">SA</span> <span class="main">∩</span> Source <span class="free">TS</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>OneState_HPT_Target_Source<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> Int_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> U<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> <span class="var">?S2.0</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> CompFun_ChiRel<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> Conf_ChiRel<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> HPT_Source_Conf<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> ChiStar <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">``</span> Source <span class="free">TS</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ChiRel_ChiStar_notmem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">U</span><span class="main">=</span><span class="free">S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> U<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">U</span><span class="main">=</span><span class="free">S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span>  CompFun_ChiRel<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ChiRel_OneAncestor<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> U V<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> trancl_Int_mem<span class="main"><span class="keyword3">,</span></span> <span class="operator">fold</span> ChiPlus_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> tranclD2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> W<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">W</span><span class="main">=</span><span class="free">S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> CompFun_ChiRel<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ChiRel_OneAncestor<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> StepConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Image_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">U</span><span class="main">=</span><span class="free">S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rtrancl_eq_or_trancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Image_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> W<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rtrancl_eq_or_trancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-UniqueSucStates_StepConf"><span class="command">lemma</span></span> UniqueSucStates_StepConf<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span> <span class="main">⟧</span> <span class="main">⟹</span> 
      UniqueSucStates <span class="main">(</span>SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>CompFun <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> UniqueSucStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> SucState_StepConf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notnotD<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> notI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> UniqueSucStates_SAStates_StepConf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> HAStates_CompFun_SAs_mem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> HAStates_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> UniqueSucStates_Ancestor_StepConf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>HAStates_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-Status_Step"><span class="command">lemma</span></span> Status_Step<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">U</span> <span class="main">∈</span> ResolveRacing <span class="free">TS</span> <span class="main">⟧</span> <span class="main">⟹</span>  
    <span class="main">(</span>HA <span class="free">ST</span><span class="main">,</span> StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span><span class="main">,</span> StepActEvent <span class="free">TS</span><span class="main">,</span> <span class="free">U</span> <span class="main">!!!</span> <span class="main">(</span>Value <span class="free">ST</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> status"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> status_def Status_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> StepActEvent_HAEvents<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> IsConfSet_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">frule</span> StepConf_HAStates<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> HAStates_def<span class="main"><span class="keyword3">,</span></span><span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> RootExSem_StepConf<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> UniqueSucStates_StepConf<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Meta Theorem: Preservation for Statecharts›</span></span>

<span class="comment1">(* We prove, that the well-formedness of a Statecharts is preserved by the semantics
   (theorem "IsConfSet_StepConf") *)</span>

<span class="keyword1" id="HASem-IsConfSet_StepConf"><span class="command">lemma</span></span> IsConfSet_StepConf<span class="main">:</span>
       <span class="quoted"><span class="quoted">"<span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span> <span class="main">⟹</span> IsConfSet <span class="main">(</span>SAs <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>CompFun <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span><span class="main">)</span>
                                  <span class="main">(</span>StepConf <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span> <span class="free">TS</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> IsConfSet_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> StepConf_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> RootExSem_StepConf<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> UniqueSucStates_StepConf<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HASem-HA_StepStatus_HPT_ResolveRacing"><span class="command">lemma</span></span> HA_StepStatus_HPT_ResolveRacing <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">TS</span> <span class="main">∈</span> HPT <span class="free">ST</span><span class="main">;</span> <span class="free">U</span> <span class="main">∈</span> ResolveRacing <span class="free">TS</span> <span class="main">⟧</span> <span class="main">⟹</span> 
    HA <span class="main">(</span>StepStatus <span class="free">ST</span> <span class="free">TS</span> <span class="free">U</span><span class="main">)</span> <span class="main">=</span> HA <span class="free">ST</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> StepStatus_expand <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> HA_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_status_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Status_Step<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Kripke">
<div class="head">
<h1>Theory Kripke</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      statecharts/CTL/Kripke.thy

    Author:     Steffen Helke, Software Engineering Group
    Copyright   2010 Technische Universitaet Berlin
*)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Kripke Structures and CTL›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Kripke
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Kripke</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'s</span> set<span class="main">,</span>
              <span class="tfree">'s</span> set<span class="main">,</span>
              <span class="main">(</span><span class="tfree">'s</span> <span class="main">*</span> <span class="tfree">'s</span><span class="main">)</span> set<span class="main">,</span>
              <span class="main">(</span><span class="tfree">'s</span> <span class="main">⇀</span> <span class="tfree">'a</span> set<span class="main">)</span><span class="main">]</span>
             <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>

  <span class="quoted"><span class="quoted">"<span class="free">Kripke</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">S0</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span>
                <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S0</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> 
                 <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">&lt;=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">×</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> 
                 <span class="main">(</span>Domain <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> 
                 <span class="main">(</span>dom <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Kripke-Kripke_EmptySet"><span class="command">lemma</span></span> Kripke_EmptySet<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{</span><span class="main">@</span><span class="bound">x</span><span class="main">.</span> True<span class="main">}</span><span class="main">,</span> <span class="main">{</span><span class="main">@</span><span class="bound">x</span><span class="main">.</span> True<span class="main">}</span><span class="main">,</span><span class="main">{</span><span class="main">(</span><span class="main">@</span><span class="bound">x</span><span class="main">.</span> True<span class="main">,</span> <span class="main">@</span><span class="bound">x</span><span class="main">.</span> True<span class="main">)</span><span class="main">}</span><span class="main">,</span> Map.empty<span class="main">(</span><span class="main">@</span><span class="bound">x</span><span class="main">.</span> True <span class="main">↦</span> <span class="main">{</span><span class="main">@</span><span class="bound">x</span><span class="main">.</span> True<span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> 
   <span class="main">{</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span><span class="bound">S0</span><span class="main">,</span><span class="bound">R</span><span class="main">,</span><span class="bound">L</span><span class="main">)</span> <span class="main">|</span> <span class="bound">S</span> <span class="bound">S0</span> <span class="bound">R</span> <span class="bound">L</span><span class="main">.</span> Kripke <span class="bound">S</span> <span class="bound">S0</span> <span class="bound">R</span> <span class="bound">L</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Kripke_def Domain_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">kripke</span> <span class="main">=</span>
    <span class="main">{</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span><span class="bound">S0</span><span class="main">,</span><span class="bound">T</span><span class="main">,</span><span class="bound">L</span><span class="main">)</span> <span class="main">|</span>
        <span class="main">(</span><span class="bound">S</span><span class="main">::</span><span class="main">(</span><span class="tfree">'s</span> set<span class="main">)</span><span class="main">)</span>
        <span class="main">(</span><span class="bound">S0</span><span class="main">::</span><span class="main">(</span><span class="tfree">'s</span> set<span class="main">)</span><span class="main">)</span>
        <span class="main">(</span><span class="bound">T</span><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="tfree">'s</span> <span class="main">*</span> <span class="tfree">'s</span><span class="main">)</span> set<span class="main">)</span><span class="main">)</span>
        <span class="main">(</span><span class="bound">L</span><span class="main">::</span><span class="main">(</span><span class="tfree">'s</span> <span class="main">⇀</span> <span class="main">(</span><span class="tfree">'a</span>  set<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
                      Kripke <span class="bound">S</span> <span class="bound">S0</span> <span class="bound">T</span> <span class="bound">L</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> kripke <span class="main">=</span>
    <span class="quoted"><span class="quoted">"kripke <span class="main">::</span> <span class="main">(</span><span class="tfree">'s</span> set <span class="main">*</span> <span class="tfree">'s</span> set <span class="main">*</span> <span class="main">(</span><span class="tfree">'s</span> <span class="main">*</span> <span class="tfree">'s</span><span class="main">)</span> set <span class="main">*</span> <span class="main">(</span><span class="tfree">'s</span> <span class="main">⇀</span> <span class="tfree">'a</span> set<span class="main">)</span><span class="main">)</span> set"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> kripke_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Kripke_EmptySet<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Statuses</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> kripke <span class="main">=&gt;</span> <span class="tfree">'s</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Statuses</span> <span class="main">=</span> fst <span class="keyword1">o</span> Rep_kripke"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">InitStatuses</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> kripke  <span class="main">=&gt;</span> <span class="tfree">'s</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">InitStatuses</span> <span class="main">==</span> fst <span class="keyword1">o</span> snd <span class="keyword1">o</span> Rep_kripke"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">StepRel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> kripke <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'s</span> <span class="main">*</span> <span class="tfree">'s</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">StepRel</span> <span class="main">==</span> fst <span class="keyword1">o</span> snd <span class="keyword1">o</span> snd <span class="keyword1">o</span> Rep_kripke"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">LabelFun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> kripke <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'s</span> <span class="main">⇀</span> <span class="tfree">'a</span> set<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">LabelFun</span> <span class="main">==</span> snd <span class="keyword1">o</span> snd <span class="keyword1">o</span> snd <span class="keyword1">o</span> Rep_kripke"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">Paths</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> kripke<span class="main">,</span> <span class="tfree">'s</span><span class="main">]</span> <span class="main">=&gt;</span>
             <span class="main">(</span>nat <span class="main">=&gt;</span> <span class="tfree">'s</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Paths</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">==</span> <span class="main">{</span> <span class="bound">p</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="bound">p</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">p</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>StepRel <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> ctl <span class="main">=</span>  Atom <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
                          <span class="main">|</span> AND <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> ctl"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> ctl"</span></span>
                          <span class="main">|</span> OR  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> ctl"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> ctl"</span></span>
                          <span class="main">|</span> IMPLIES <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> ctl"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> ctl"</span></span>
                          <span class="main">|</span> CAX <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> ctl"</span></span>
                          <span class="main">|</span> AF  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> ctl"</span></span>
                          <span class="main">|</span> AG  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> ctl"</span></span>
                          <span class="main">|</span> AU  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> ctl"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> ctl"</span></span>
                          <span class="main">|</span> AR  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> ctl"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> ctl"</span></span>


<span class="keyword1"><span class="command">primrec</span></span>
   <span class="entity">eval_ctl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> kripke<span class="main">,</span> <span class="tfree">'s</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> ctl<span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span>  <span class="main">(</span><span class="quoted">"_<span class="keyword1">,</span>_ <span class="keyword1">|=c=</span> _"</span> <span class="main">[</span>92<span class="main">,</span>91<span class="main">,</span>90<span class="main">]</span>90<span class="main">)</span> 
   <span class="keyword2"><span class="keyword">where</span></span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1"><span class="free">|=c=</span></span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span>        <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∈</span> the <span class="main">(</span><span class="main">(</span>LabelFun <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1"><span class="free">|=c=</span></span> <span class="main">(</span>AND <span class="free"><span class="bound"><span class="entity">F1</span></span></span> <span class="free"><span class="bound"><span class="entity">F2</span></span></span><span class="main">)</span><span class="main">)</span>     <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1"><span class="free">|=c=</span></span> <span class="free"><span class="bound"><span class="entity">F1</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1"><span class="free">|=c=</span></span> <span class="free"><span class="bound"><span class="entity">F2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1"><span class="free">|=c=</span></span> <span class="main">(</span>OR <span class="free"><span class="bound"><span class="entity">F1</span></span></span> <span class="free"><span class="bound"><span class="entity">F2</span></span></span><span class="main">)</span><span class="main">)</span>      <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1"><span class="free">|=c=</span></span> <span class="free"><span class="bound"><span class="entity">F1</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1"><span class="free">|=c=</span></span> <span class="free"><span class="bound"><span class="entity">F2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1"><span class="free">|=c=</span></span> <span class="main">(</span>IMPLIES <span class="free"><span class="bound"><span class="entity">F1</span></span></span> <span class="free"><span class="bound"><span class="entity">F2</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1"><span class="free">|=c=</span></span> <span class="free"><span class="bound"><span class="entity">F1</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1"><span class="free">|=c=</span></span> <span class="free"><span class="bound"><span class="entity">F2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1"><span class="free">|=c=</span></span> <span class="main">(</span>CAX <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">)</span>         <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">T</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span><span class="bound">T</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>StepRel <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span><span class="bound">T</span> <span class="keyword1"><span class="free">|=c=</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1"><span class="free">|=c=</span></span> <span class="main">(</span>AF <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">)</span>          <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">P</span> <span class="main">∈</span> Paths <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1"><span class="free">|=c=</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1"><span class="free">|=c=</span></span> <span class="main">(</span>AG <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">)</span>          <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">P</span> <span class="main">∈</span> Paths <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1"><span class="free">|=c=</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1"><span class="free">|=c=</span></span> <span class="main">(</span>AU <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span>        <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">P</span> <span class="main">∈</span> Paths <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span>
                                     <span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1"><span class="free">|=c=</span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">∧</span> 
                                       <span class="main">(</span><span class="main">∀</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span><span class="main">(</span><span class="bound">P</span> <span class="bound">j</span><span class="main">)</span> <span class="keyword1"><span class="free">|=c=</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1"><span class="free">|=c=</span></span> <span class="main">(</span>AR <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span>        <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">P</span> <span class="main">∈</span> Paths <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span>
                                     <span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1"><span class="free">|=c=</span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">∨</span> 
                                       <span class="main">(</span><span class="main">∃</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span><span class="main">(</span><span class="bound">P</span> <span class="bound">j</span><span class="main">)</span> <span class="keyword1"><span class="free">|=c=</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="HAKripke">
<div class="head">
<h1>Theory HAKripke</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      statecharts/HA/HAKripke.thy

    Author:     Steffen Helke, Software Engineering Group
    Copyright   2010 Technische Universitaet Berlin
*)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Kripke Structures as Hierarchical Automata›</span></span>
<span class="keyword1"><span class="command">theory</span></span> HAKripke
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#HASem">HASem</a> <a href="#Kripke">Kripke</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hakripke <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>status<span class="main">,</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>atomar<span class="main">)</span>kripke"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hactl    <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>status<span class="main">,</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>atomar<span class="main">)</span>ctl"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">LabelFunSem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hierauto
              <span class="main">=&gt;</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>status <span class="main">⇀</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> atomar<span class="main">)</span> set<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">LabelFunSem</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">ST</span><span class="main">.</span>
         <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>HA <span class="bound">ST</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="keyword1">then</span>
              <span class="main">(</span><span class="keyword1">let</span>
                  <span class="bound">In_preds</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span>IN <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Conf <span class="bound">ST</span><span class="main">)</span><span class="main">;</span>
                  <span class="bound">En_preds</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">e</span><span class="main">.</span> <span class="main">(</span>EN <span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Events <span class="bound">ST</span><span class="main">)</span><span class="main">;</span>
                  <span class="bound">Val_preds</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">P</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">=</span> <span class="main">(</span>VAL <span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">P</span> <span class="main">(</span>Value <span class="bound">ST</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span>
               <span class="keyword1">in</span>
                  Some <span class="main">(</span><span class="bound">In_preds</span> <span class="main">∪</span> <span class="bound">En_preds</span> <span class="main">∪</span> <span class="bound">Val_preds</span> <span class="main">∪</span> <span class="main">{</span>atomar.TRUE<span class="main">}</span><span class="main">)</span><span class="main">)</span>
            <span class="keyword1">else</span>
               None<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">HA2Kripke</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hierauto <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hakripke"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">HA2Kripke</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span>
         Abs_kripke <span class="main">(</span><span class="main">{</span><span class="bound">ST</span><span class="main">.</span> HA <span class="bound">ST</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">}</span><span class="main">,</span>
                     <span class="main">{</span>InitStatus <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">}</span><span class="main">,</span>
                     StepRelSem <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span>
                     LabelFunSem <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">eval_ctl_HA</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hierauto<span class="main">,</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hactl<span class="main">]</span>
                   <span class="main">=&gt;</span> bool"</span></span>  <span class="main">(</span><span class="quoted">"_ <span class="keyword1">|=H=</span> _"</span> <span class="main">[</span>92<span class="main">,</span>91<span class="main">]</span>90<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>

   <span class="quoted"><span class="quoted">"<span class="free">eval_ctl_HA</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>HA2Kripke <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>InitStatus <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="keyword1">|=c=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="HAKripke-Kripke_HA"><span class="command">lemma</span></span> Kripke_HA <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Kripke <span class="main">{</span><span class="bound">ST</span><span class="main">.</span> HA <span class="bound">ST</span> <span class="main">=</span> <span class="free">a</span><span class="main">}</span> <span class="main">{</span>InitStatus <span class="free">a</span><span class="main">}</span> <span class="main">(</span>StepRelSem <span class="free">a</span><span class="main">)</span> <span class="main">(</span>LabelFunSem <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Kripke_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> StepRelSem_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> LabelFunSem_def Let_def If_def dom_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> ST S<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"HA <span class="improper">ST</span> <span class="main">=</span> <span class="free">a</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> ST<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"HPT <span class="improper">ST</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> TSS<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"StepStatus <span class="improper">ST</span> <span class="improper">TSS</span> <span class="main">(</span><span class="main">@</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">:</span> ResolveRacing <span class="improper">TSS</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">TSS</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAKripke-LabelFun_LabelFunSem"><span class="command">lemma</span></span> LabelFun_LabelFunSem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span>LabelFun <span class="main">(</span>HA2Kripke <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>LabelFunSem <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HA2Kripke_def LabelFun_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_kripke_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> kripke_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAKripke-InitStatuses_InitStatus"><span class="command">lemma</span></span> InitStatuses_InitStatus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span>InitStatuses <span class="main">(</span>HA2Kripke <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>InitStatus <span class="free">a</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HA2Kripke_def InitStatuses_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_kripke_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> kripke_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAKripke-Statuses_StatusesOfHA"><span class="command">lemma</span></span> Statuses_StatusesOfHA <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span>Statuses <span class="main">(</span>HA2Kripke <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">ST</span><span class="main">.</span> HA <span class="bound">ST</span> <span class="main">=</span> <span class="free">a</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HA2Kripke_def Statuses_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_kripke_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> kripke_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAKripke-StepRel_StepRelSem"><span class="command">lemma</span></span> StepRel_StepRelSem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>StepRel <span class="main">(</span>HA2Kripke <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>StepRelSem <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HA2Kripke_def StepRel_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_kripke_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> kripke_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAKripke-TRUE_LabelFunSem"><span class="command">lemma</span></span> TRUE_LabelFunSem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"atomar.TRUE <span class="main">∈</span> the <span class="main">(</span>LabelFunSem <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> LabelFunSem_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAKripke-FALSE_LabelFunSem"><span class="command">lemma</span></span> FALSE_LabelFunSem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"atomar.FALSE <span class="main">∉</span> the <span class="main">(</span>LabelFunSem <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="free">ST</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> LabelFunSem_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAKripke-Conf_LabelFunSem"><span class="command">lemma</span></span> Conf_LabelFunSem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>IN <span class="free">S</span><span class="main">)</span> <span class="main">∈</span> the <span class="main">(</span>LabelFunSem <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="free">ST</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">S</span> <span class="main">∈</span> <span class="main">(</span>Conf <span class="free">ST</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> LabelFunSem_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAKripke-Events_LabelFunSem"><span class="command">lemma</span></span> Events_LabelFunSem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>EN <span class="free">S</span><span class="main">)</span> <span class="main">∈</span> the <span class="main">(</span>LabelFunSem <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="free">ST</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">S</span> <span class="main">∈</span> <span class="main">(</span>Events <span class="free">ST</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> LabelFunSem_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAKripke-Value_LabelFunSem"><span class="command">lemma</span></span> Value_LabelFunSem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>VAL <span class="free">P</span><span class="main">)</span> <span class="main">∈</span> the <span class="main">(</span>LabelFunSem <span class="main">(</span>HA <span class="free">ST</span><span class="main">)</span> <span class="free">ST</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span>Value <span class="free">ST</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> LabelFunSem_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAKripke-AtomTRUE_EvalCTLHA"><span class="command">lemma</span></span> AtomTRUE_EvalCTLHA <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">|=H=</span> <span class="main">(</span>Atom <span class="main">(</span>atomar.TRUE<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> eval_ctl_HA_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> HA_InitStatus <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> TRUE_LabelFunSem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAKripke-AtomFalse_EvalCTLHA"><span class="command">lemma</span></span> AtomFalse_EvalCTLHA <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">a</span> <span class="keyword1">|=H=</span> <span class="main">(</span>Atom <span class="main">(</span>atomar.FALSE<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> eval_ctl_HA_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> HA_InitStatus <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> FALSE_LabelFunSem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAKripke-Events_InitStatus_EvalCTLHA"><span class="command">lemma</span></span> Events_InitStatus_EvalCTLHA <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="keyword1">|=H=</span> <span class="main">(</span>Atom <span class="main">(</span>EN <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">S</span> <span class="main">∈</span> <span class="main">(</span>Events <span class="main">(</span>InitStatus <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> eval_ctl_HA_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> HA_InitStatus <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Events_LabelFunSem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAKripke-Conf_InitStatus_EvalCTLHA"><span class="command">lemma</span></span> Conf_InitStatus_EvalCTLHA <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="keyword1">|=H=</span> <span class="main">(</span>Atom <span class="main">(</span>IN <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">S</span> <span class="main">∈</span> <span class="main">(</span>Conf <span class="main">(</span>InitStatus <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> eval_ctl_HA_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> HA_InitStatus <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Conf_LabelFunSem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAKripke-HAInitValue_EvalCTLHA"><span class="command">lemma</span></span> HAInitValue_EvalCTLHA <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="keyword1">|=H=</span> <span class="main">(</span>Atom <span class="main">(</span>VAL <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span>HAInitValue <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> eval_ctl_HA_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> HA_InitStatus <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Value_LabelFunSem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="HAOps">
<div class="head">
<h1>Theory HAOps</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      statecharts/HA/HAOps.thy
    Author:     Steffen Helke, Software Engineering Group
    Copyright   2010 Technische Universitaet Berlin
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Constructing Hierarchical Automata›</span></span>
<span class="keyword1"><span class="command">theory</span></span> HAOps
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#HA">HA</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Constructing a Composition Function for a PseudoHA"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">EmptyMap</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> set <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'s</span> <span class="main">⇀</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span> set<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">EmptyMap</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1">then</span> Some <span class="main">{}</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>

<span class="keyword1" id="HAOps-EmptyMap_dom"><span class="command">lemma</span></span> EmptyMap_dom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"dom <span class="main">(</span>EmptyMap <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> dom_def EmptyMap_def<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HAOps-EmptyMap_ran"><span class="command">lemma</span></span> EmptyMap_ran <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> ran <span class="main">(</span>EmptyMap <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> ran_def EmptyMap_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HAOps-EmptyMap_the"><span class="command">lemma</span></span> EmptyMap_the <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> the <span class="main">(</span><span class="main">(</span>EmptyMap <span class="free">S</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> ran_def EmptyMap_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HAOps-EmptyMap_ran_override"><span class="command">lemma</span></span> EmptyMap_ran_override<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="main">(</span><span class="free">S</span> <span class="main">∩</span> <span class="main">(</span>dom <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span>  
  ran <span class="main">(</span><span class="free">G</span> <span class="main">++</span> EmptyMap <span class="free">S</span><span class="main">)</span> <span class="main">=</span> insert <span class="main">{}</span> <span class="main">(</span>ran <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> ran_override<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_commute<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-EmptyMap_Union_ran_override"><span class="command">lemma</span></span> EmptyMap_Union_ran_override<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span>  
    <span class="free">S</span> <span class="main">∩</span> dom <span class="free">G</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span>  
  <span class="main">(</span>Union <span class="main">(</span>ran <span class="main">(</span><span class="free">G</span> <span class="main">++</span> <span class="main">(</span>EmptyMap <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Union <span class="main">(</span>ran <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> EmptyMap_ran_override<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-EmptyMap_Union_ran_override2"><span class="command">lemma</span></span> EmptyMap_Union_ran_override2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="free">S</span> <span class="main">∩</span> dom <span class="free">G1</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> 
    dom <span class="free">G1</span> <span class="main">∩</span> dom <span class="free">G2</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> 
   <span class="main">⋃</span> <span class="main">(</span>ran <span class="main">(</span><span class="free">G1</span> <span class="main">++</span> EmptyMap <span class="free">S</span> <span class="main">++</span> <span class="free">G2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>ran <span class="free">G1</span> <span class="main">∪</span> ran <span class="free">G2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Union_eq UNION_eq EmptyMap_def Int_def ran_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_add_Some_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> dom_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> t<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> bexE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> U<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> v<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">v</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-EmptyMap_Root"><span class="command">lemma</span></span> EmptyMap_Root <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"Root <span class="main">{</span><span class="free">SA</span><span class="main">}</span> <span class="main">(</span>EmptyMap <span class="main">(</span>States <span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">SA</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Root_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HAOps-EmptyMap_RootEx"><span class="command">lemma</span></span> EmptyMap_RootEx <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"RootEx <span class="main">{</span><span class="free">SA</span><span class="main">}</span> <span class="main">(</span>EmptyMap <span class="main">(</span>States <span class="free">SA</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> RootEx_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HAOps-EmptyMap_OneAncestor"><span class="command">lemma</span></span> EmptyMap_OneAncestor <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"OneAncestor <span class="main">{</span><span class="free">SA</span><span class="main">}</span> <span class="main">(</span>EmptyMap <span class="main">(</span>States <span class="free">SA</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> OneAncestor_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HAOps-EmptyMap_NoCycles"><span class="command">lemma</span></span> EmptyMap_NoCycles <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"NoCycles <span class="main">{</span><span class="free">SA</span><span class="main">}</span> <span class="main">(</span>EmptyMap <span class="main">(</span>States <span class="free">SA</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> NoCycles_def EmptyMap_def <span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HAOps-EmptyMap_IsCompFun"><span class="command">lemma</span></span> EmptyMap_IsCompFun <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"IsCompFun <span class="main">{</span><span class="free">SA</span><span class="main">}</span> <span class="main">(</span>EmptyMap <span class="main">(</span>States <span class="free">SA</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> IsCompFun_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HAOps-EmptyMap_hierauto"><span class="command">lemma</span></span> EmptyMap_hierauto <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span><span class="main">,</span><span class="main">{</span><span class="free">SA</span><span class="main">}</span><span class="main">,</span> SAEvents <span class="free">SA</span><span class="main">,</span> EmptyMap <span class="main">(</span>States <span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> hierauto"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> hierauto_def HierAuto_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Extending a Composition Function by a SA"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">FAddSA</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'s</span> <span class="main">⇀</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span> set<span class="main">)</span><span class="main">,</span> <span class="tfree">'s</span> <span class="main">*</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">]</span>
             <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'s</span> <span class="main">⇀</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span> set<span class="main">)</span>"</span></span>
           <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">[f+]</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>10<span class="main">,</span>11<span class="main">]</span>10<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FAddSA</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">SSA</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span>  <span class="main">(</span><span class="bound">S</span><span class="main">,</span><span class="bound">SA</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">SSA</span></span></span>
                   <span class="keyword1">in</span>
                     <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">(</span><span class="bound">S</span> <span class="main">∈</span> dom <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">S</span> <span class="main">∉</span> States <span class="bound">SA</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span>
                        <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">++</span> <span class="main">(</span>Map.empty<span class="main">(</span><span class="bound">S</span> <span class="main">↦</span> <span class="main">(</span>insert <span class="bound">SA</span> <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">++</span> EmptyMap <span class="main">(</span>States <span class="bound">SA</span><span class="main">)</span><span class="main">)</span>
                      <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="HAOps-FAddSA_dom"><span class="command">lemma</span></span> FAddSA_dom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">S</span> <span class="main">∉</span> <span class="main">(</span>dom <span class="main">(</span><span class="free">A</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'c</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto set option<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">[f+]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="main">(</span><span class="free">SA</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'c</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> FAddSA_def Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HAOps-FAddSA_States"><span class="command">lemma</span></span> FAddSA_States <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">S</span> <span class="main">∈</span> <span class="main">(</span>States <span class="main">(</span><span class="free">SA</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'c</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">A</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'c</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto set option<span class="main">)</span><span class="main">)</span> <span class="keyword1">[f+]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> FAddSA_def Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HAOps-FAddSA_dom_insert"><span class="command">lemma</span></span> FAddSA_dom_insert <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> <span class="main">(</span>dom <span class="free">A</span><span class="main">)</span><span class="main">;</span> <span class="free">S</span> <span class="main">∉</span>  States <span class="free">SA</span> <span class="main">⟧</span> <span class="main">⟹</span> 
   <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">[f+]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span>insert <span class="free">SA</span> <span class="main">(</span>the <span class="main">(</span><span class="free">A</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> FAddSA_def Let_def restrict_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HAOps-FAddSA_States_neq"><span class="command">lemma</span></span> FAddSA_States_neq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S'</span> <span class="main">∉</span> States <span class="main">(</span><span class="free">SA</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'c</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span><span class="main">;</span> <span class="free">S</span> <span class="main">≠</span>  <span class="free">S'</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">A</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'c</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto set option<span class="main">)</span><span class="main">)</span> <span class="keyword1">[f+]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="free">S'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="free">S'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> dom <span class="free">A</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> States <span class="free">SA</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">S'</span> <span class="main">∈</span> dom <span class="free">A</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> FAddSA_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dom_None<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-FAddSA_dom_emptyset"><span class="command">lemma</span></span> FAddSA_dom_emptyset <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> <span class="main">(</span>dom <span class="free">A</span><span class="main">)</span><span class="main">;</span> <span class="free">S</span> <span class="main">∉</span> States <span class="free">SA</span><span class="main">;</span> <span class="free">S'</span> <span class="main">∈</span> States <span class="main">(</span><span class="free">SA</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'c</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>  
    <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">A</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'c</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto set option<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">[f+]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="free">S'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Some <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> FAddSA_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> EmptyMap_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-FAddSA_dom_dom_States"><span class="command">lemma</span></span> FAddSA_dom_dom_States <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> <span class="main">(</span>dom <span class="free">F</span><span class="main">)</span><span class="main">;</span> <span class="free">S</span> <span class="main">∉</span> States <span class="free">SA</span> <span class="main">⟧</span> <span class="main">⟹</span> 
    <span class="main">(</span>dom <span class="main">(</span><span class="main">(</span><span class="free">F</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇀</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span> set<span class="main">)</span><span class="main">)</span> <span class="keyword1">[f+]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span> <span class="free">SA</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">(</span>dom <span class="free">F</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>States <span class="main">(</span><span class="free">SA</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> FAddSA_def Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HAOps-FAddSA_dom_dom"><span class="command">lemma</span></span> FAddSA_dom_dom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∉</span> <span class="main">(</span>dom <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span>   
   <span class="main">(</span>dom <span class="main">(</span><span class="main">(</span><span class="free">F</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇀</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span> set<span class="main">)</span><span class="main">)</span> <span class="keyword1">[f+]</span> 
       <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="main">(</span><span class="free">SA</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>dom <span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> FAddSA_def Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HAOps-FAddSA_States_dom"><span class="command">lemma</span></span> FAddSA_States_dom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> <span class="main">(</span>States <span class="free">SA</span><span class="main">)</span> <span class="main">⟹</span>  
   <span class="main">(</span>dom <span class="main">(</span><span class="main">(</span><span class="free">F</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇀</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span> set<span class="main">)</span><span class="main">)</span> <span class="keyword1">[f+]</span> 
        <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="main">(</span><span class="free">SA</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>dom <span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> FAddSA_def Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HAOps-FAddSA_dom_insert_dom_disjunct"><span class="command">lemma</span></span> FAddSA_dom_insert_dom_disjunct <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> dom <span class="free">G</span><span class="main">;</span> States <span class="free">SA</span> <span class="main">∩</span> dom <span class="free">G</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">G</span> <span class="keyword1">[f+]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span>insert <span class="free">SA</span> <span class="main">(</span>the <span class="main">(</span><span class="free">G</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span>  FAddSA_dom_insert<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-FAddSA_Union_ran"><span class="command">lemma</span></span> FAddSA_Union_ran<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> dom <span class="free">G</span><span class="main">;</span> <span class="main">(</span>States <span class="free">SA</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>dom <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> 
   <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>ran <span class="main">(</span><span class="free">G</span> <span class="keyword1">[f+]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>insert <span class="free">SA</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>ran <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> FAddSA_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Int_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> Int_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> EmptyMap_Union_ran_override<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-FAddSA_Union_ran2"><span class="command">lemma</span></span> FAddSA_Union_ran2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> dom <span class="free">G1</span><span class="main">;</span> <span class="main">(</span>States <span class="free">SA</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>dom <span class="free">G1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="main">(</span>dom <span class="free">G1</span> <span class="main">∩</span> dom <span class="free">G2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>ran <span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="keyword1">[f+]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="main">++</span> <span class="free">G2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>insert <span class="free">SA</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="main">(</span>ran <span class="free">G1</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>ran <span class="free">G2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> FAddSA_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> EmptyMap_Union_ran_override2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Union_Un_distrib<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Union_ran_override2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-FAddSA_ran"><span class="command">lemma</span></span> FAddSA_ran<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span> <span class="bound">T</span> <span class="main">∈</span> dom <span class="free">G</span> <span class="main">.</span> <span class="bound">T</span> <span class="main">≠</span> <span class="free">S</span> <span class="main">⟶</span> <span class="main">(</span>the <span class="main">(</span><span class="free">G</span> <span class="bound">T</span><span class="main">)</span> <span class="main">∩</span> the <span class="main">(</span><span class="free">G</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>  
     <span class="free">S</span> <span class="main">∈</span> dom <span class="free">G</span><span class="main">;</span> <span class="main">(</span>States <span class="free">SA</span><span class="main">)</span> <span class="main">∩</span>  <span class="main">(</span>dom <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span>  
    ran <span class="main">(</span><span class="free">G</span> <span class="keyword1">[f+]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> insert <span class="main">{}</span> <span class="main">(</span>insert <span class="main">(</span>insert <span class="free">SA</span> <span class="main">(</span>the <span class="main">(</span><span class="free">G</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ran <span class="free">G</span> <span class="main">-</span> <span class="main">{</span>the <span class="main">(</span><span class="free">G</span> <span class="free">S</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> FAddSA_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> EmptyMap_ran_override<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ran_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> Y X a xa xb<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-FAddSA_RootEx_def"><span class="command">lemma</span></span> FAddSA_RootEx_def<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> dom <span class="free">G</span><span class="main">;</span> <span class="main">(</span>States <span class="free">SA</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>dom <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> 
    RootEx <span class="free">F</span> <span class="main">(</span><span class="free">G</span> <span class="keyword1">[f+]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃!</span> <span class="bound">A</span> <span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">∧</span> <span class="bound">A</span> <span class="main">∉</span> insert <span class="free">SA</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>ran <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> RootEx_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> FAddSA_Union_ran Int_commute<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-FAddSA_RootEx"><span class="command">lemma</span></span> FAddSA_RootEx<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⋃</span> <span class="main">(</span>ran <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="free">F</span> <span class="main">-</span> <span class="main">{</span>Root <span class="free">F</span> <span class="free">G</span><span class="main">}</span><span class="main">;</span> 
     dom <span class="free">G</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span>States <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">;</span> 
     <span class="main">(</span>dom <span class="free">G</span> <span class="main">∩</span> States <span class="free">SA</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> dom <span class="free">G</span><span class="main">;</span> 
     RootEx <span class="free">F</span> <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span> RootEx <span class="main">(</span>insert <span class="free">SA</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="free">G</span> <span class="keyword1">[f+]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FAddSA_RootEx_def Int_commute <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> rev_conj_cong<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> conj_cong<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-FAddSA_Root_def"><span class="command">lemma</span></span> FAddSA_Root_def<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> dom <span class="free">G</span><span class="main">;</span> <span class="main">(</span>States <span class="free">SA</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>dom <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟧</span>  <span class="main">⟹</span> 
   <span class="main">(</span>Root <span class="free">F</span> <span class="main">(</span><span class="free">G</span> <span class="keyword1">[f+]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">@</span> <span class="bound">A</span> <span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">∧</span> <span class="bound">A</span> <span class="main">∉</span> insert <span class="free">SA</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>ran <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Root_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> FAddSA_Union_ran Int_commute<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-FAddSA_RootEx_Root"><span class="command">lemma</span></span> FAddSA_RootEx_Root<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> Union <span class="main">(</span>ran <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="free">F</span> <span class="main">-</span> <span class="main">{</span>Root <span class="free">F</span> <span class="free">G</span><span class="main">}</span><span class="main">;</span>  
     <span class="main">⋃</span><span class="main">(</span>States <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> dom <span class="free">G</span><span class="main">;</span> 
     <span class="main">(</span>dom <span class="free">G</span> <span class="main">∩</span> States <span class="free">SA</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> dom <span class="free">G</span><span class="main">;</span>
     RootEx <span class="free">F</span> <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>Root <span class="main">(</span>insert <span class="free">SA</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="free">G</span> <span class="keyword1">[f+]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Root <span class="free">F</span> <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FAddSA_Root_def Int_commute <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> rev_conj_cong<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span>conj_cong<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-FAddSA_OneAncestor"><span class="command">lemma</span></span> FAddSA_OneAncestor<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⋃</span> <span class="main">(</span>ran <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="free">F</span> <span class="main">-</span> <span class="main">{</span>Root <span class="free">F</span> <span class="free">G</span><span class="main">}</span><span class="main">;</span> 
     <span class="main">(</span>dom <span class="free">G</span> <span class="main">∩</span> States <span class="free">SA</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> dom <span class="free">G</span><span class="main">;</span> 
     <span class="main">⋃</span><span class="main">(</span>States <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> dom <span class="free">G</span><span class="main">;</span> RootEx <span class="free">F</span> <span class="free">G</span><span class="main">;</span>
     OneAncestor <span class="free">F</span> <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span> OneAncestor <span class="main">(</span>insert <span class="free">SA</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="free">G</span> <span class="keyword1">[f+]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> OneAncestor_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SAA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">SA</span> <span class="main">=</span> <span class="improper">SAA</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ex1I<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> FAddSA_dom_insert<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Int_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> T<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> conjE bexE exE disjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SAAA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> not_not <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">T</span> <span class="main">∈</span> States <span class="improper">SAA</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">G</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> SA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">SAA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> FAddSA_States_neq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">SAA</span> <span class="main">∉</span> Union <span class="main">(</span>ran <span class="free">G</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ran_dom_the<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> States_Int_not_mem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> OneAncestor_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> G<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">G</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> SA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> FAddSA_RootEx_Root<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">SAA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> conjE bexE ex1E exE disjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> T SAAA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ex1I<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">T</span> <span class="main">=</span> <span class="free">S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∉</span> States <span class="free">SA</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> FAddSA_States_neq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> not_sym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> U<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> conjE bexE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SAAAA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> conjE disjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> FAddSA_dom_emptyset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">U</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≠</span> <span class="improper">U</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">U</span> <span class="main">∉</span> States <span class="free">SA</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">G</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> FAddSA_States_neq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">G</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> SA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> FAddSA_dom_insert<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-FAddSA_NoCycles"><span class="command">lemma</span></span> FAddSA_NoCycles<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span>States <span class="free">SA</span> <span class="main">∩</span> dom <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> dom <span class="free">G</span><span class="main">;</span>
     dom <span class="free">G</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span>States <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">;</span> NoCycles <span class="free">F</span> <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span> 
     NoCycles  <span class="main">(</span>insert <span class="free">SA</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="free">G</span> <span class="keyword1">[f+]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> NoCycles_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SAA<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">s</span> <span class="main">∈</span> <span class="improper">SAA</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> States <span class="free">SA</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> bexE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SAAA T<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> FAddSA_dom_emptyset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">SAA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> UNION_eq Pow_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">SAA</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> bexE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> SAAA T<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">T</span><span class="main">=</span><span class="free">S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> FAddSA_dom_insert<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-FAddSA_IsCompFun"><span class="command">lemma</span></span> FAddSA_IsCompFun<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span>States <span class="free">SA</span> <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>States <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
     <span class="free">S</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>States <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> 
     IsCompFun <span class="free">F</span> <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span>  IsCompFun <span class="main">(</span>insert <span class="free">SA</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="free">G</span> <span class="keyword1">[f+]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> IsCompFun_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_commute FAddSA_RootEx_Root FAddSA_RootEx FAddSA_OneAncestor FAddSA_NoCycles<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> FAddSA_dom_dom_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_commute<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FAddSA_Union_ran<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">SA</span> <span class="main">=</span> Root <span class="free">F</span> <span class="free">G</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"States <span class="main">(</span>Root <span class="free">F</span> <span class="free">G</span><span class="main">)</span> <span class="main">⊆</span>  <span class="main">⋃</span><span class="main">(</span>States <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> subset_lemma<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-FAddSA_HierAuto"><span class="command">lemma</span></span> FAddSA_HierAuto<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span>States <span class="free">SA</span> <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>States <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
      <span class="free">S</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>States <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> 
      HierAuto <span class="free">D</span> <span class="free">F</span> <span class="free">E</span> <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span> HierAuto <span class="free">D</span> <span class="main">(</span>insert <span class="free">SA</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> SAEvents <span class="free">SA</span><span class="main">)</span> <span class="main">(</span><span class="free">G</span> <span class="keyword1">[f+]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HierAuto_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MutuallyDistinct_Insert<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> FAddSA_IsCompFun<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-FAddSA_HierAuto_insert"><span class="command">lemma</span></span> FAddSA_HierAuto_insert <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span>States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">HA</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
      <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">HA</span> <span class="main">⟧</span> <span class="main">⟹</span> 
    HierAuto <span class="main">(</span>HAInitValue <span class="free">HA</span><span class="main">)</span>                  
             <span class="main">(</span>insert <span class="free">SA</span> <span class="main">(</span>SAs <span class="free">HA</span><span class="main">)</span><span class="main">)</span>              
             <span class="main">(</span>HAEvents <span class="free">HA</span> <span class="main">∪</span> SAEvents <span class="free">SA</span><span class="main">)</span>      
             <span class="main">(</span>CompFun <span class="free">HA</span> <span class="keyword1">[f+]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> FAddSA_HierAuto<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Constructing a PseudoHA"</span></span> 

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">PseudoHA</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">,</span><span class="tfree">'d</span> data<span class="main">]</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hierauto"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">PseudoHA</span> <span class="free"><span class="bound"><span class="entity">SA</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">=</span> Abs_hierauto<span class="main">(</span><span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">SA</span></span></span><span class="main">}</span><span class="main">,</span> SAEvents <span class="free"><span class="bound"><span class="entity">SA</span></span></span> <span class="main">,</span>EmptyMap <span class="main">(</span>States <span class="free"><span class="bound"><span class="entity">SA</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="HAOps-PseudoHA_SAs"><span class="command">lemma</span></span> PseudoHA_SAs <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"SAs <span class="main">(</span>PseudoHA <span class="free">SA</span> <span class="free">D</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">SA</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> PseudoHA_def SAs_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_hierauto_inverse<span class="main">)</span>

<span class="keyword1" id="HAOps-PseudoHA_Events"><span class="command">lemma</span></span> PseudoHA_Events <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"HAEvents <span class="main">(</span>PseudoHA <span class="free">SA</span> <span class="free">D</span><span class="main">)</span> <span class="main">=</span> SAEvents <span class="free">SA</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> PseudoHA_def HAEvents_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_hierauto_inverse<span class="main">)</span>
 
<span class="keyword1" id="HAOps-PseudoHA_CompFun"><span class="command">lemma</span></span> PseudoHA_CompFun <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"CompFun <span class="main">(</span>PseudoHA <span class="free">SA</span> <span class="free">D</span><span class="main">)</span> <span class="main">=</span> EmptyMap <span class="main">(</span>States <span class="free">SA</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> PseudoHA_def CompFun_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_hierauto_inverse<span class="main">)</span>

<span class="keyword1" id="HAOps-PseudoHA_HAStates"><span class="command">lemma</span></span> PseudoHA_HAStates <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"HAStates <span class="main">(</span>PseudoHA <span class="free">SA</span> <span class="free">D</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>States <span class="free">SA</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HAOps-PseudoHA_HAInitValue"><span class="command">lemma</span></span> PseudoHA_HAInitValue <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>HAInitValue <span class="main">(</span>PseudoHA <span class="free">SA</span> <span class="free">D</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">D</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> PseudoHA_def Let_def HAInitValue_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_hierauto_inverse<span class="main">)</span>
 
<span class="keyword1" id="HAOps-PseudoHA_CompFun_the"><span class="command">lemma</span></span> PseudoHA_CompFun_the <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
 <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> States <span class="free">A</span> <span class="main">⟹</span> <span class="main">(</span>the <span class="main">(</span>CompFun <span class="main">(</span>PseudoHA <span class="free">A</span> <span class="free">D</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="HAOps-PseudoHA_CompFun_ran"><span class="command">lemma</span></span> PseudoHA_CompFun_ran <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>ran <span class="main">(</span>CompFun <span class="main">(</span>PseudoHA <span class="free">SA</span> <span class="free">D</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="HAOps-PseudoHA_HARoot"><span class="command">lemma</span></span> PseudoHA_HARoot <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>HARoot <span class="main">(</span>PseudoHA <span class="free">SA</span> <span class="free">D</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">SA</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> HARoot_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HAOps-PseudoHA_HAInitState"><span class="command">lemma</span></span> PseudoHA_HAInitState <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"HAInitState <span class="main">(</span>PseudoHA <span class="free">A</span> <span class="free">D</span><span class="main">)</span> <span class="main">=</span> InitState <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAInitState_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-PseudoHA_HAInitStates"><span class="command">lemma</span></span> PseudoHA_HAInitStates <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"HAInitStates <span class="main">(</span>PseudoHA <span class="free">A</span> <span class="free">D</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>InitState <span class="free">A</span><span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAInitStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-PseudoHA_Chi"><span class="command">lemma</span></span> PseudoHA_Chi <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> States <span class="free">A</span> <span class="main">⟹</span> Chi <span class="main">(</span>PseudoHA <span class="free">A</span> <span class="free">D</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Chi_def restrict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-PseudoHA_ChiRel"><span class="command">lemma</span></span> PseudoHA_ChiRel <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"ChiRel <span class="main">(</span>PseudoHA <span class="free">A</span> <span class="free">D</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiRel_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-PseudoHA_InitConf"><span class="command">lemma</span></span> PseudoHA_InitConf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"InitConf <span class="main">(</span>PseudoHA <span class="free">A</span> <span class="free">D</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>InitState <span class="free">A</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> InitConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Extending a HA by a SA (<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>AddSA›</span></span></span></span>)›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">AddSA</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hierauto<span class="main">,</span> <span class="tfree">'s</span> <span class="main">*</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">]</span>
             <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hierauto"</span></span>
           <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">[++]</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>10<span class="main">,</span>11<span class="main">]</span>10<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">AddSA</span> <span class="free"><span class="bound"><span class="entity">HA</span></span></span> <span class="free"><span class="bound"><span class="entity">SSA</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span><span class="bound">SA</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">SSA</span></span></span><span class="main">;</span>
                        <span class="bound">DNew</span> <span class="main">=</span> HAInitValue <span class="free"><span class="bound"><span class="entity">HA</span></span></span><span class="main">;</span>
                        <span class="bound">FNew</span> <span class="main">=</span> insert <span class="bound">SA</span> <span class="main">(</span>SAs <span class="free"><span class="bound"><span class="entity">HA</span></span></span><span class="main">)</span><span class="main">;</span>
                        <span class="bound">ENew</span>  <span class="main">=</span> HAEvents <span class="free"><span class="bound"><span class="entity">HA</span></span></span> <span class="main">∪</span> SAEvents <span class="bound">SA</span><span class="main">;</span>
                        <span class="bound">GNew</span>  <span class="main">=</span> CompFun <span class="free"><span class="bound"><span class="entity">HA</span></span></span> <span class="keyword1">[f+]</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span><span class="bound">SA</span><span class="main">)</span>
                   <span class="keyword1">in</span>
                       Abs_hierauto<span class="main">(</span><span class="bound">DNew</span><span class="main">,</span><span class="bound">FNew</span><span class="main">,</span><span class="bound">ENew</span><span class="main">,</span><span class="bound">GNew</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">AddHA</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hierauto<span class="main">,</span> <span class="tfree">'s</span> <span class="main">*</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hierauto<span class="main">]</span>
             <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'s</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>hierauto"</span></span>
           <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">[**]</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>10<span class="main">,</span>11<span class="main">]</span>10<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">AddHA</span> <span class="free"><span class="bound"><span class="entity">HA1</span></span></span> <span class="free"><span class="bound"><span class="entity">SHA</span></span></span> <span class="main">=</span>
            <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span><span class="bound">HA2</span><span class="main">)</span>     <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">SHA</span></span></span><span class="main">;</span>
                 <span class="main">(</span><span class="bound">D1</span><span class="main">,</span><span class="bound">F1</span><span class="main">,</span><span class="bound">E1</span><span class="main">,</span><span class="bound">G1</span><span class="main">)</span> <span class="main">=</span> Rep_hierauto <span class="main">(</span><span class="free"><span class="bound"><span class="entity">HA1</span></span></span> <span class="main">[++]</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span>HARoot <span class="bound">HA2</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
                 <span class="main">(</span><span class="bound">D2</span><span class="main">,</span><span class="bound">F2</span><span class="main">,</span><span class="bound">E2</span><span class="main">,</span><span class="bound">G2</span><span class="main">)</span> <span class="main">=</span> Rep_hierauto <span class="bound">HA2</span><span class="main">;</span>
                 <span class="bound">FNew</span>       <span class="main">=</span> <span class="bound">F1</span> <span class="main">∪</span> <span class="bound">F2</span><span class="main">;</span>
                 <span class="bound">ENew</span>       <span class="main">=</span> <span class="bound">E1</span> <span class="main">∪</span> <span class="bound">E2</span><span class="main">;</span>
                 <span class="bound">GNew</span>       <span class="main">=</span> <span class="bound">G1</span> <span class="main">++</span> <span class="bound">G2</span>
             <span class="keyword1">in</span>
                 Abs_hierauto<span class="main">(</span><span class="bound">D1</span><span class="main">,</span><span class="bound">FNew</span><span class="main">,</span><span class="bound">ENew</span><span class="main">,</span><span class="bound">GNew</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="HAOps-AddSA_SAs"><span class="command">lemma</span></span> AddSA_SAs<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span>States <span class="free">SA</span> <span class="main">∩</span>  HAStates <span class="free">HA</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> 
      <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">HA</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>SAs <span class="main">(</span><span class="free">HA</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> insert <span class="free">SA</span> <span class="main">(</span>SAs <span class="free">HA</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Let_def AddSA_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> SAs_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hierauto_def Abs_hierauto_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_Events"><span class="command">lemma</span></span> AddSA_Events<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span>States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">HA</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> 
      <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">HA</span> <span class="main">⟧</span> <span class="main">⟹</span>
     HAEvents <span class="main">(</span><span class="free">HA</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>HAEvents <span class="free">HA</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>SAEvents <span class="free">SA</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Let_def AddSA_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> HAEvents_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hierauto_def Abs_hierauto_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_CompFun"><span class="command">lemma</span></span> AddSA_CompFun<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span>States <span class="free">SA</span> <span class="main">∩</span>  HAStates <span class="free">HA</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> 
      <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">HA</span> <span class="main">⟧</span> <span class="main">⟹</span>  
     CompFun <span class="main">(</span><span class="free">HA</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>CompFun <span class="free">HA</span> <span class="keyword1">[f+]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Let_def AddSA_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CompFun_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hierauto_def Abs_hierauto_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_HAStates"><span class="command">lemma</span></span> AddSA_HAStates<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span>States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">HA</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> 
       <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">HA</span> <span class="main">⟧</span> <span class="main">⟹</span>
      HAStates <span class="main">(</span><span class="free">HA</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>HAStates <span class="free">HA</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>States <span class="free">SA</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_SAs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_HAInitValue"><span class="command">lemma</span></span> AddSA_HAInitValue<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span>States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">HA</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
       <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">HA</span> <span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">(</span>HAInitValue <span class="main">(</span><span class="free">HA</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>HAInitValue <span class="free">HA</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Let_def AddSA_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> HAInitValue_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hierauto_def Abs_hierauto_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_HARoot"><span class="command">lemma</span></span> AddSA_HARoot<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span>States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">HA</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
      <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">HA</span> <span class="main">⟧</span> <span class="main">⟹</span> 
      <span class="main">(</span>HARoot <span class="main">(</span><span class="free">HA</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>HARoot <span class="free">HA</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HARoot_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AddSA_CompFun AddSA_SAs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> FAddSA_RootEx_Root<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> HAStates_SA_mem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_CompFun_the"><span class="command">lemma</span></span> AddSA_CompFun_the<span class="main">:</span> 
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span>States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> 
    <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">(</span>the <span class="main">(</span><span class="main">(</span>CompFun <span class="main">(</span><span class="free">A</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> insert <span class="free">SA</span> <span class="main">(</span>the <span class="main">(</span><span class="main">(</span>CompFun <span class="free">A</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AddSA_CompFun<span class="main">)</span>

<span class="keyword1" id="HAOps-AddSA_CompFun_the2"><span class="command">lemma</span></span> AddSA_CompFun_the2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S'</span> <span class="main">∈</span> States <span class="main">(</span><span class="free">SA</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'c</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span><span class="main">;</span> 
    <span class="main">(</span>States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
    <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span>
    the <span class="main">(</span><span class="main">(</span>CompFun <span class="main">(</span><span class="free">A</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">S'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AddSA_CompFun<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> FAddSA_dom_emptyset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_CompFun_the3"><span class="command">lemma</span></span> AddSA_CompFun_the3<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S'</span> <span class="main">∉</span> States <span class="main">(</span><span class="free">SA</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'c</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span>seqauto<span class="main">)</span><span class="main">;</span> 
    <span class="free">S</span> <span class="main">≠</span> <span class="free">S'</span><span class="main">;</span> 
    <span class="main">(</span>States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> 
    <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> 
   <span class="main">(</span>the <span class="main">(</span><span class="main">(</span>CompFun <span class="main">(</span><span class="free">A</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">S'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>the <span class="main">(</span><span class="main">(</span>CompFun <span class="free">A</span><span class="main">)</span> <span class="free">S'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AddSA_CompFun<span class="main">)</span>

<span class="keyword1" id="HAOps-AddSA_CompFun_ran"><span class="command">lemma</span></span> AddSA_CompFun_ran<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span>States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
     <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> 
   ran <span class="main">(</span>CompFun <span class="main">(</span><span class="free">A</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
       insert <span class="main">{}</span> <span class="main">(</span>insert <span class="main">(</span>insert <span class="free">SA</span> <span class="main">(</span>the <span class="main">(</span><span class="main">(</span>CompFun <span class="free">A</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ran <span class="main">(</span>CompFun <span class="free">A</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span>the <span class="main">(</span><span class="main">(</span>CompFun <span class="free">A</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AddSA_CompFun<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> FAddSA_ran<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> CompFun_Int_disjoint<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_CompFun_ran2"><span class="command">lemma</span></span> AddSA_CompFun_ran2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span>States <span class="free">SA1</span> <span class="main">∩</span> HAStates <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
    <span class="main">(</span>States <span class="free">SA2</span> <span class="main">∩</span> <span class="main">(</span>HAStates <span class="free">A</span> <span class="main">∪</span> States <span class="free">SA1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
     <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span><span class="main">;</span>
     <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA1</span> <span class="main">⟧</span> <span class="main">⟹</span>
   ran <span class="main">(</span>CompFun <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA1</span><span class="main">)</span><span class="main">)</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">SA2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
       insert <span class="main">{}</span> <span class="main">(</span>insert <span class="main">{</span><span class="free">SA2</span><span class="main">}</span> <span class="main">(</span>ran <span class="main">(</span>CompFun <span class="main">(</span><span class="free">A</span>  <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AddSA_HAStates AddSA_CompFun<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> FAddSA_ran<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> CompFun_Int_disjoint<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AddSA_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AddSA_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> States <span class="free">SA1</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dom_CompFun <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> FAddSA_dom_dom_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> States <span class="free">SA1</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> FAddSA_dom_dom_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span>  States <span class="free">SA1</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> FAddSA_dom_dom_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span>  States <span class="free">SA1</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_CompFun_ran_not_mem"><span class="command">lemma</span></span> AddSA_CompFun_ran_not_mem<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> States <span class="free">SA2</span> <span class="main">∩</span> <span class="main">(</span>HAStates <span class="free">A</span> <span class="main">∪</span> States <span class="free">SA1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
    States <span class="free">SA1</span> <span class="main">∩</span> HAStates <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
    <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> 
   <span class="main">{</span><span class="free">SA2</span><span class="main">}</span> <span class="main">∉</span> ran <span class="main">(</span>CompFun <span class="free">A</span> <span class="keyword1">[f+]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span> <span class="free">SA1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> HA<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Sas<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">SA2</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ran_CompFun_is_not_SA<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> AddSA_HAStates SA_States_disjunct2 SAs_States_HAStates insert_subset<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AddSA_HAStates AddSA_CompFun<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_CompFun_ran3"><span class="command">lemma</span></span> AddSA_CompFun_ran3<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span>States <span class="free">SA1</span> <span class="main">∩</span> HAStates <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
    <span class="main">(</span>States <span class="free">SA2</span> <span class="main">∩</span> <span class="main">(</span>HAStates <span class="free">A</span> <span class="main">∪</span> States <span class="free">SA1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
    <span class="main">(</span>States <span class="free">SA3</span> <span class="main">∩</span> <span class="main">(</span>HAStates <span class="free">A</span> <span class="main">∪</span> States <span class="free">SA1</span> <span class="main">∪</span> States <span class="free">SA2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
     <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span><span class="main">;</span> 
     <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA1</span> <span class="main">⟧</span> <span class="main">⟹</span> 
    ran <span class="main">(</span>CompFun <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA1</span><span class="main">)</span><span class="main">)</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">SA2</span><span class="main">)</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">SA3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
       insert <span class="main">{}</span> <span class="main">(</span>insert <span class="main">{</span><span class="free">SA3</span><span class="main">,</span><span class="free">SA2</span><span class="main">}</span> <span class="main">(</span>ran <span class="main">(</span>CompFun <span class="main">(</span><span class="free">A</span>  <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AddSA_HAStates AddSA_CompFun<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> FAddSA_ran<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> AddSA_CompFun AddSA_HAStates CompFun_Int_disjoint UnCI dom_CompFun<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> AddSA_CompFun AddSA_HAStates UnCI dom_CompFun<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> AddSA_CompFun AddSA_HAStates UnCI dom_CompFun<span class="main">)</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AddSA_HAStates<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AddSA_HAStates<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun_ran2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AddSA_CompFun<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span>  FAddSA_dom_insert<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> FAddSA_dom_dom_States<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> FAddSA_dom_emptyset<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span>  FAddSA_dom_insert<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> FAddSA_dom_dom_States<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> FAddSA_dom_emptyset<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AddSA_CompFun_ran_not_mem insert_Diff_if insert_commute<span class="main">)</span>

<span class="keyword1" id="HAOps-AddSA_CompFun_PseudoHA_ran"><span class="command">lemma</span></span> AddSA_CompFun_PseudoHA_ran<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> States <span class="free">RootSA</span><span class="main">;</span>
     States <span class="free">RootSA</span> <span class="main">∩</span> States <span class="free">SA</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> 
     <span class="main">(</span>ran <span class="main">(</span>CompFun <span class="main">(</span><span class="main">(</span>PseudoHA <span class="free">RootSA</span> <span class="free">D</span><span class="main">)</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>insert <span class="main">{}</span> <span class="main">{</span><span class="main">{</span><span class="free">SA</span><span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun_ran<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_CompFun_PseudoHA_ran2"><span class="command">lemma</span></span> AddSA_CompFun_PseudoHA_ran2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> States <span class="free">SA1</span> <span class="main">∩</span> States <span class="free">RootSA</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
     States <span class="free">SA2</span> <span class="main">∩</span> <span class="main">(</span>States <span class="free">RootSA</span> <span class="main">∪</span> States <span class="free">SA1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> 
     <span class="free">S</span> <span class="main">∈</span> States <span class="free">RootSA</span> <span class="main">⟧</span> <span class="main">⟹</span>  
     <span class="main">(</span>ran <span class="main">(</span>CompFun <span class="main">(</span><span class="main">(</span>PseudoHA <span class="free">RootSA</span> <span class="free">D</span><span class="main">)</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA1</span><span class="main">)</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>insert <span class="main">{}</span> <span class="main">{</span><span class="main">{</span><span class="free">SA2</span><span class="main">,</span><span class="free">SA1</span><span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun_ran<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun_the<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun_PseudoHA_ran<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun_the<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AddSA_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AddSA_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_HAInitStates"><span class="command">lemma</span></span> AddSA_HAInitStates <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
    <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span>
   HAInitStates <span class="main">(</span><span class="free">A</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> insert <span class="main">(</span>InitState <span class="free">SA</span><span class="main">)</span> <span class="main">(</span>HAInitStates <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAInitStates_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AddSA_SAs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_HAInitState"><span class="command">lemma</span></span> AddSA_HAInitState <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
    <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span>
  HAInitState <span class="main">(</span><span class="free">A</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>HAInitState <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> HAInitState_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AddSA_HARoot<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_Chi"><span class="command">lemma</span></span> AddSA_Chi <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
   <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span>  
  Chi <span class="main">(</span><span class="free">A</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> <span class="main">(</span>States <span class="free">SA</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>Chi <span class="free">A</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Chi_def restrict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AddSA_SAs AddSA_HAStates AddSA_CompFun_the<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_Chi2"><span class="command">lemma</span></span> AddSA_Chi2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
    <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span><span class="main">;</span>  
    <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA</span> <span class="main">⟧</span> <span class="main">⟹</span>
    Chi <span class="main">(</span><span class="free">A</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="free">T</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Chi_def restrict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AddSA_SAs AddSA_HAStates AddSA_CompFun_the2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_Chi3"><span class="command">lemma</span></span> AddSA_Chi3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
    <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span><span class="main">;</span> 
    <span class="free">T</span> <span class="main">∉</span> States <span class="free">SA</span><span class="main">;</span> <span class="free">T</span> <span class="main">≠</span> <span class="free">S</span> <span class="main">⟧</span> <span class="main">⟹</span>
    Chi <span class="main">(</span><span class="free">A</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="free">T</span> <span class="main">=</span> Chi <span class="free">A</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Chi_def restrict_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AddSA_SAs AddSA_HAStates AddSA_CompFun_the3<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_ChiRel"><span class="command">lemma</span></span> AddSA_ChiRel <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
    <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> 
   ChiRel <span class="main">(</span><span class="free">A</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span> <span class="main">(</span><span class="bound">T</span><span class="main">,</span><span class="bound">T'</span><span class="main">)</span> <span class="main">.</span> <span class="bound">T</span> <span class="main">=</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">T'</span> <span class="main">∈</span> States <span class="free">SA</span> <span class="main">}</span> <span class="main">∪</span> <span class="main">(</span>ChiRel <span class="free">A</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ChiRel_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AddSA_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> T U<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">T</span> <span class="main">∈</span> States <span class="free">SA</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> T U<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">T</span> <span class="main">≠</span> <span class="free">S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">T</span> <span class="main">∈</span>  States <span class="free">SA</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> T U<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">T</span> <span class="main">∈</span>  States <span class="free">SA</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Chi_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">T</span> <span class="main">∈</span> States <span class="free">SA</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">T</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Chi_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> T U<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">T</span> <span class="main">≠</span> <span class="free">S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">T</span> <span class="main">∈</span> States <span class="free">SA</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> T U<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">T</span> <span class="main">∈</span>  States <span class="free">SA</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> AddSA_Chi AddSA_Chi3 Int_iff Un_iff empty_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-help_InitConf"><span class="command">lemma</span></span> help_InitConf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> fst <span class="bound">p</span> <span class="main">≠</span> InitState <span class="free">SA</span> <span class="main">∧</span> snd <span class="bound">p</span> <span class="main">≠</span> InitState <span class="free">SA</span> <span class="main">∧</span> 
       <span class="bound">p</span> <span class="main">∈</span>  insert <span class="main">(</span>InitState <span class="free">SA</span><span class="main">)</span> <span class="main">(</span>HAInitStates <span class="free">A</span><span class="main">)</span> <span class="main">×</span> insert <span class="main">(</span>InitState <span class="free">SA</span><span class="main">)</span> <span class="main">(</span>HAInitStates <span class="free">A</span><span class="main">)</span> <span class="main">∧</span>  
       <span class="main">(</span><span class="bound">p</span> <span class="main">∈</span>  <span class="main">{</span><span class="free">S</span><span class="main">}</span> <span class="main">×</span> States <span class="free">SA</span> <span class="main">∨</span>  <span class="bound">p</span> <span class="main">∈</span>  ChiRel <span class="free">A</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> 
   <span class="main">(</span>HAInitStates <span class="free">A</span> <span class="main">×</span> HAInitStates <span class="free">A</span> <span class="main">∩</span>  ChiRel <span class="free">A</span><span class="main">)</span>"</span></span>    
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> InitState_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HAInitStates_HAStates<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> InitState_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HAInitStates_HAStates<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
 
<span class="keyword1" id="HAOps-AddSA_InitConf"><span class="command">lemma</span></span> AddSA_InitConf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
    <span class="free">S</span> <span class="main">∈</span> InitConf <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> 
    InitConf <span class="main">(</span><span class="free">A</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> insert <span class="main">(</span>InitState <span class="free">SA</span><span class="main">)</span> <span class="main">(</span>InitConf <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> InitConf_HAStates2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> InitConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> insert_Times_insert<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> T<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">T</span><span class="main">=</span><span class="free">S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> R<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>HAInitStates <span class="free">A</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span>HAInitStates <span class="free">A</span><span class="main">)</span> <span class="main">∩</span> ChiRel <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trancl_subseteq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> 3<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> trancl_collect<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> InitState_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ChiRel_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ChiRel_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> InitState_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ChiRel_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> InitState_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> help_InitConf <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rtranclE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rtranclE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> R<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>HAInitStates <span class="free">A</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span>HAInitStates <span class="free">A</span><span class="main">)</span> <span class="main">∩</span> ChiRel <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trancl_subseteq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_InitConf2"><span class="command">lemma</span></span> AddSA_InitConf2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
    <span class="free">S</span> <span class="main">∉</span> InitConf <span class="free">A</span><span class="main">;</span>
  <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span>
  InitConf <span class="main">(</span><span class="free">A</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> InitConf <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> InitConf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> T<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> R<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>HAInitStates <span class="free">A</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span>HAInitStates <span class="free">A</span><span class="main">)</span> <span class="main">∩</span> ChiRel <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trancl_subseteq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">T</span><span class="main">=</span>InitState <span class="free">SA</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> 3<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> trancl_collect<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> InitState_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ChiRel_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> InitState_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ChiRel_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> InitState_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HAInitStates_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> help_InitConf <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"InitState <span class="free">SA</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rtrancl_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ChiRel_HAStates2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> InitState_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ChiRel_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">SA</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> InitState_States<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Theorems for Calculating Wellformedness of HA"</span></span>

<span class="keyword1" id="HAOps-PseudoHA_HAStates_IFF"><span class="command">lemma</span></span> PseudoHA_HAStates_IFF<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>States <span class="free">SA</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span>  <span class="main">⟹</span> <span class="main">(</span>HAStates <span class="main">(</span>PseudoHA <span class="free">SA</span> <span class="free">D</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_SAs_IFF"><span class="command">lemma</span></span> AddSA_SAs_IFF<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">HA</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
    <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">HA</span><span class="main">;</span>
    <span class="main">(</span>SAs <span class="free">HA</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>SAs <span class="main">(</span><span class="free">HA</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span> <span class="free">SA</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>insert <span class="free">SA</span> <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_SAs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_Events_IFF"><span class="command">lemma</span></span> AddSA_Events_IFF<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">HA</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> 
    <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">HA</span><span class="main">;</span> 
    <span class="main">(</span>HAEvents <span class="free">HA</span><span class="main">)</span> <span class="main">=</span> <span class="free">HAE</span><span class="main">;</span>
    <span class="main">(</span>SAEvents <span class="free">SA</span><span class="main">)</span> <span class="main">=</span> <span class="free">SAE</span><span class="main">;</span>  
    <span class="main">(</span><span class="free">HAE</span> <span class="main">∪</span> <span class="free">SAE</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>HAEvents <span class="main">(</span><span class="free">HA</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span> <span class="free">SA</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_Events<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_CompFun_IFF"><span class="command">lemma</span></span> AddSA_CompFun_IFF<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> States <span class="free">SA</span> <span class="main">∩</span>  HAStates <span class="free">HA</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
    <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">HA</span><span class="main">;</span>
    <span class="main">(</span>CompFun <span class="free">HA</span><span class="main">)</span> <span class="main">=</span> <span class="free">HAG</span><span class="main">;</span>
    <span class="main">(</span><span class="free">HAG</span> <span class="keyword1">[f+]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span> <span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>CompFun <span class="main">(</span><span class="free">HA</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span> <span class="free">SA</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_HAStates_IFF"><span class="command">lemma</span></span> AddSA_HAStates_IFF<span class="main">:</span> 
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">HA</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
    <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">HA</span><span class="main">;</span>
    <span class="main">(</span>HAStates <span class="free">HA</span><span class="main">)</span> <span class="main">=</span> <span class="free">HAS</span><span class="main">;</span>
    <span class="main">(</span>States <span class="free">SA</span><span class="main">)</span> <span class="main">=</span> <span class="free">SAS</span><span class="main">;</span>
    <span class="main">(</span><span class="free">HAS</span> <span class="main">∪</span> <span class="free">SAS</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>HAStates <span class="main">(</span><span class="free">HA</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span> <span class="free">SA</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_HAStates<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_HAInitValue_IFF"><span class="command">lemma</span></span> AddSA_HAInitValue_IFF<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">HA</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
    <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">HA</span><span class="main">;</span>
    <span class="main">(</span>HAInitValue <span class="free">HA</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>HAInitValue <span class="main">(</span><span class="free">HA</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span> <span class="free">SA</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_HAInitValue<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_HARoot_IFF"><span class="command">lemma</span></span> AddSA_HARoot_IFF<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">HA</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
    <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">HA</span><span class="main">;</span>
    <span class="main">(</span>HARoot <span class="free">HA</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>HARoot <span class="main">(</span><span class="free">HA</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span> <span class="free">SA</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_HARoot<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_InitConf_IFF"><span class="command">lemma</span></span> AddSA_InitConf_IFF<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> InitConf <span class="free">A</span> <span class="main">=</span> <span class="free">Y</span><span class="main">;</span>
    States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
    <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span><span class="main">;</span> 
    <span class="main">(</span><span class="keyword1">if</span> <span class="free">S</span> <span class="main">∈</span> <span class="free">Y</span> <span class="keyword1">then</span> insert <span class="main">(</span>InitState <span class="free">SA</span><span class="main">)</span> <span class="free">Y</span> <span class="keyword1">else</span> <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span> <span class="main">⟧</span> <span class="main">⟹</span> 
    InitConf <span class="main">(</span><span class="free">A</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_CompFun_ran_IFF"><span class="command">lemma</span></span> AddSA_CompFun_ran_IFF<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span>States <span class="free">SA</span> <span class="main">∩</span> HAStates <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> 
     <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span><span class="main">;</span>
     <span class="main">(</span>insert <span class="main">{}</span> <span class="main">(</span>insert <span class="main">(</span>insert <span class="free">SA</span> <span class="main">(</span>the <span class="main">(</span><span class="main">(</span>CompFun <span class="free">A</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ran <span class="main">(</span>CompFun <span class="free">A</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span>the <span class="main">(</span><span class="main">(</span>CompFun <span class="free">A</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span> <span class="main">⟧</span> <span class="main">⟹</span>
     ran <span class="main">(</span>CompFun <span class="main">(</span><span class="free">A</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span>  AddSA_CompFun_ran<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_CompFun_ran2_IFF"><span class="command">lemma</span></span> AddSA_CompFun_ran2_IFF<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span>States <span class="free">SA1</span> <span class="main">∩</span> HAStates <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> 
    <span class="main">(</span>States <span class="free">SA2</span> <span class="main">∩</span> <span class="main">(</span>HAStates <span class="free">A</span> <span class="main">∪</span> States <span class="free">SA1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
    <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span><span class="main">;</span>
    <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA1</span><span class="main">;</span>
    insert <span class="main">{}</span> <span class="main">(</span>insert <span class="main">{</span><span class="free">SA2</span><span class="main">}</span> <span class="main">(</span>ran <span class="main">(</span>CompFun <span class="main">(</span><span class="free">A</span>  <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span> <span class="main">⟧</span> <span class="main">⟹</span>
    ran <span class="main">(</span>CompFun <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA1</span><span class="main">)</span><span class="main">)</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">SA2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun_ran2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
   
<span class="keyword1" id="HAOps-AddSA_CompFun_ran3_IFF"><span class="command">lemma</span></span> AddSA_CompFun_ran3_IFF<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span>States <span class="free">SA1</span> <span class="main">∩</span> HAStates <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
    <span class="main">(</span>States <span class="free">SA2</span> <span class="main">∩</span> <span class="main">(</span>HAStates <span class="free">A</span> <span class="main">∪</span> States <span class="free">SA1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
    <span class="main">(</span>States <span class="free">SA3</span> <span class="main">∩</span> <span class="main">(</span>HAStates <span class="free">A</span> <span class="main">∪</span> States <span class="free">SA1</span> <span class="main">∪</span> States <span class="free">SA2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
     <span class="free">S</span> <span class="main">∈</span> HAStates <span class="free">A</span><span class="main">;</span>
     <span class="free">T</span> <span class="main">∈</span> States <span class="free">SA1</span><span class="main">;</span>
     insert <span class="main">{}</span> <span class="main">(</span>insert <span class="main">{</span><span class="free">SA3</span><span class="main">,</span><span class="free">SA2</span><span class="main">}</span> <span class="main">(</span>ran <span class="main">(</span>CompFun <span class="main">(</span><span class="free">A</span>  <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span> <span class="main">⟧</span> <span class="main">⟹</span>
     ran <span class="main">(</span>CompFun <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA1</span><span class="main">)</span><span class="main">)</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">SA2</span><span class="main">)</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">SA3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun_ran3<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_CompFun_PseudoHA_ran_IFF"><span class="command">lemma</span></span> AddSA_CompFun_PseudoHA_ran_IFF<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">S</span> <span class="main">∈</span> States <span class="free">RootSA</span><span class="main">;</span> 
     States <span class="free">RootSA</span> <span class="main">∩</span> States <span class="free">SA</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
   <span class="main">(</span>insert <span class="main">{}</span> <span class="main">{</span><span class="main">{</span><span class="free">SA</span><span class="main">}</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span> <span class="main">⟧</span> <span class="main">⟹</span> 
   <span class="main">(</span>ran <span class="main">(</span>CompFun <span class="main">(</span><span class="main">(</span>PseudoHA <span class="free">RootSA</span> <span class="free">D</span><span class="main">)</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun_PseudoHA_ran<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HAOps-AddSA_CompFun_PseudoHA_ran2_IFF"><span class="command">lemma</span></span> AddSA_CompFun_PseudoHA_ran2_IFF<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> States <span class="free">SA1</span> <span class="main">∩</span> States <span class="free">RootSA</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
     States <span class="free">SA2</span> <span class="main">∩</span> <span class="main">(</span>States <span class="free">RootSA</span> <span class="main">∪</span> States <span class="free">SA1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span>
     <span class="free">S</span> <span class="main">∈</span> States <span class="free">RootSA</span><span class="main">;</span>
     <span class="main">(</span>insert <span class="main">{}</span> <span class="main">{</span><span class="main">{</span><span class="free">SA2</span><span class="main">,</span><span class="free">SA1</span><span class="main">}</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span> <span class="main">⟧</span> <span class="main">⟹</span> 
     <span class="main">(</span>ran <span class="main">(</span>CompFun <span class="main">(</span><span class="main">(</span>PseudoHA <span class="free">RootSA</span> <span class="free">D</span><span class="main">)</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA1</span><span class="main">)</span> <span class="main">[++]</span> <span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="free">SA2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun_PseudoHA_ran2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">AddSA_SAs_IFF</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> AddSA_SAs_IFF<span class="antiquote">}</span></span></span><span class="main">;</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">AddSA_Events_IFF</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> AddSA_Events_IFF<span class="antiquote">}</span></span></span><span class="main">;</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">AddSA_CompFun_IFF</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> AddSA_CompFun_IFF<span class="antiquote">}</span></span></span><span class="main">;</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">AddSA_HAStates_IFF</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> AddSA_HAStates_IFF<span class="antiquote">}</span></span></span><span class="main">;</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">PseudoHA_HAStates_IFF</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> PseudoHA_HAStates_IFF<span class="antiquote">}</span></span></span><span class="main">;</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">AddSA_HAInitValue_IFF</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> AddSA_HAInitValue_IFF<span class="antiquote">}</span></span></span><span class="main">;</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">AddSA_CompFun_ran_IFF</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> AddSA_CompFun_ran_IFF<span class="antiquote">}</span></span></span><span class="main">;</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">AddSA_HARoot_IFF</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> AddSA_HARoot_IFF<span class="antiquote">}</span></span></span><span class="main">;</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">insert_inter</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> insert_inter<span class="antiquote">}</span></span></span><span class="main">;</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">insert_notmem</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> insert_notmem<span class="antiquote">}</span></span></span><span class="main">;</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">PseudoHA_CompFun</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> PseudoHA_CompFun<span class="antiquote">}</span></span></span><span class="main">;</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">PseudoHA_Events</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> PseudoHA_Events<span class="antiquote">}</span></span></span><span class="main">;</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">PseudoHA_SAs</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> PseudoHA_SAs<span class="antiquote">}</span></span></span><span class="main">;</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">PseudoHA_HARoot</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> PseudoHA_HARoot<span class="antiquote">}</span></span></span><span class="main">;</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">PseudoHA_HAInitValue</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> PseudoHA_HAInitValue<span class="antiquote">}</span></span></span><span class="main">;</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">PseudoHA_CompFun_ran</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> PseudoHA_CompFun_ran<span class="antiquote">}</span></span></span><span class="main">;</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">Un_empty_right</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> Un_empty_right<span class="antiquote">}</span></span></span><span class="main">;</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">insert_union</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> insert_union<span class="antiquote">}</span></span></span><span class="main">;</span>


<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">wellformed_tac</span> <span class="entity">ctxt</span> <span class="entity">L</span> <span class="entity">i</span> <span class="main">=</span>
  FIRST<span class="main">[</span>resolve_tac <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">AddSA_SAs_IFF</span><span class="main">]</span> <span class="entity">i</span><span class="main">,</span>
        resolve_tac <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">AddSA_Events_IFF</span><span class="main">]</span> <span class="entity">i</span><span class="main">,</span>
        resolve_tac <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">AddSA_CompFun_IFF</span><span class="main">]</span> <span class="entity">i</span><span class="main">,</span>
        resolve_tac <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">AddSA_HAStates_IFF</span><span class="main">]</span> <span class="entity">i</span><span class="main">,</span>
        resolve_tac <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">PseudoHA_HAStates_IFF</span><span class="main">]</span> <span class="entity">i</span><span class="main">,</span>
        resolve_tac <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">AddSA_HAInitValue_IFF</span><span class="main">]</span> <span class="entity">i</span><span class="main">,</span>
        resolve_tac <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">AddSA_HARoot_IFF</span><span class="main">]</span> <span class="entity">i</span><span class="main">,</span>
        resolve_tac <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">AddSA_CompFun_ran_IFF</span><span class="main">]</span> <span class="entity">i</span><span class="main">,</span>
        resolve_tac <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">insert_inter</span><span class="main">]</span> <span class="entity">i</span><span class="main">,</span>
        resolve_tac <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">insert_notmem</span><span class="main">]</span> <span class="entity">i</span><span class="main">,</span>
        CHANGED <span class="main">(</span><span class="entity">simp_tac</span> <span class="main">(</span>put_simpset <span class="entity">HOL_basic_ss</span> <span class="entity">ctxt</span> addsimps
           <span class="main">[</span><span class="entity">PseudoHA_HARoot</span><span class="main">,</span> <span class="entity">PseudoHA_CompFun</span><span class="main">,</span> <span class="entity">PseudoHA_CompFun_ran</span><span class="main">,</span><span class="entity">PseudoHA_Events</span><span class="main">,</span><span class="entity">PseudoHA_SAs</span><span class="main">,</span><span class="entity">insert_union</span><span class="main">,</span>
            <span class="entity">PseudoHA_HAInitValue</span><span class="main">,</span><span class="entity">Un_empty_right</span><span class="main">]</span>@ <span class="entity">L</span><span class="main">)</span> <span class="entity">i</span><span class="main">)</span><span class="main">,</span>
        <span class="entity">fast_tac</span> <span class="entity">ctxt</span> <span class="entity">i</span><span class="main">,</span>
        CHANGED <span class="main">(</span><span class="entity">simp_tac</span> <span class="entity">ctxt</span> <span class="entity">i</span><span class="main">)</span><span class="main">]</span><span class="main">;</span>
›</span>

<span class="keyword1"><span class="command">method_setup</span></span> wellformed  <span class="main">=</span> <span class="quoted">‹<span class="entity">Attrib.thms</span> &gt;&gt; <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">thms</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">METHOD</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">facts</span> <span class="main">=&gt;</span> 
                                       <span class="main">(</span>HEADGOAL <span class="main">(</span><span class="entity">wellformed_tac</span> <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">facts</span> @ <span class="entity">thms</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="CarAudioSystem">
<div class="head">
<h1>Theory CarAudioSystem</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      statecharts/Examples/CarAudioSystem.thy

    Author:     Steffen Helke and Florian Kammüller, Software Engineering Group
    Copyright   2010 Technische Universitaet Berlin
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Example Specification for a Car Audio System›</span></span>

<span class="keyword1"><span class="command">theory</span></span> CarAudioSystem
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#HAKripke">HAKripke</a> <a href="#HAOps">HAOps</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Data space for two Integer-Variables›</span></span>                  

<span class="keyword1"><span class="command">datatype</span></span> d <span class="main">=</span> V0 <span class="quoted">int</span>
             <span class="main">|</span> V1 <span class="quoted">int</span>

<span class="keyword1"><span class="command">primrec</span></span>
 <span class="entity">Sel0</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"d <span class="main">=&gt;</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Sel0</span> <span class="main">(</span>V0 <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span>
 <span class="entity">Sel1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"d <span class="main">=&gt;</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Sel1</span> <span class="main">(</span>V1 <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span>


<span class="comment1">(* Selectors for the two Integer-Variables *)</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Select0</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>d data<span class="main">]</span> <span class="main">=&gt;</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Select0</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">=</span> Sel0 <span class="main">(</span>DataPart <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">Select1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>d data<span class="main">]</span> <span class="main">=&gt;</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">Select1</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">=</span> Sel1 <span class="main">(</span>DataPart <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="comment1">(* Data Space for tthe two Integer-Variables *)</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">DSpace</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"d dataspace"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">DSpace</span> <span class="main">=</span> Abs_dataspace <span class="main">(</span><span class="main">[</span>range V0<span class="main">,</span> range V1<span class="main">]</span><span class="main">)</span>"</span></span>

<span class="comment1">(* Lift in InitData *)</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">LiftInitData</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>d list<span class="main">)</span> <span class="main">=&gt;</span> d data"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">LiftInitData</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> Abs_data <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">,</span>DSpace<span class="main">)</span>"</span></span>

<span class="comment1">(* Lift in PUpdate-Function *)</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">LiftPUpdate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>d data <span class="main">=&gt;</span> <span class="main">(</span><span class="main">(</span>d option<span class="main">)</span> list<span class="main">)</span><span class="main">)</span> <span class="main">=&gt;</span> d pupdate"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">LiftPUpdate</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> Abs_pupdate
                        <span class="main">(</span><span class="main">λ</span> <span class="bound">d</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">(</span>DataSpace <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> DSpace<span class="main">)</span> <span class="keyword1">then</span>
                                   Abs_pdata <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="bound">d</span><span class="main">,</span> DSpace<span class="main">)</span>
                              <span class="keyword1">else</span> <span class="main">(</span>Data2PData <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Sequential Automaton  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Root_CTRL›</span></span></span></span>›</span></span>                  

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">Root_CTRL_States</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Root_CTRL_States</span> <span class="main">=</span> <span class="main">{</span><span class="inner_quoted">''CarAudioSystem''</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">Root_CTRL_Init</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Root_CTRL_Init</span> <span class="main">=</span> <span class="inner_quoted">''CarAudioSystem''</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">Root_CTRL_Labels</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>string<span class="main">,</span>d<span class="main">)</span>label set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Root_CTRL_Labels</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">Root_CTRL_Delta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>string<span class="main">,</span>d<span class="main">)</span>trans set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Root_CTRL_Delta</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">Root_CTRL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>string<span class="main">,</span>d<span class="main">)</span>seqauto"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Root_CTRL</span> <span class="main">=</span> Abs_seqauto <span class="main">(</span>Root_CTRL_States<span class="main">,</span> Root_CTRL_Init<span class="main">,</span>
                            Root_CTRL_Labels<span class="main">,</span> Root_CTRL_Delta<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Sequential Automaton  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>CDPlayer_CTRL›</span></span></span></span>›</span></span>                  

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">CDPlayer_CTRL_States</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">CDPlayer_CTRL_States</span> <span class="main">=</span> <span class="main">{</span><span class="inner_quoted">''ReadTracks''</span><span class="main">,</span><span class="inner_quoted">''CDFull''</span><span class="main">,</span><span class="inner_quoted">''CDEmpty''</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">CDPlayer_CTRL_Init</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">CDPlayer_CTRL_Init</span> <span class="main">=</span> <span class="inner_quoted">''CDEmpty''</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">CDPlayer_CTRL_Update1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"d pupdate"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">CDPlayer_CTRL_Update1</span> <span class="main">=</span> LiftPUpdate <span class="main">(</span><span class="main">%</span> <span class="bound">d</span><span class="main">.</span> <span class="main">[</span>None<span class="main">,</span> Some <span class="main">(</span>V1 <span class="main">(</span><span class="main">(</span>Select0 <span class="bound">d</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">CDPlayer_CTRL_Action1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>d<span class="main">)</span>action"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">CDPlayer_CTRL_Action1</span> <span class="main">=</span> <span class="main">(</span><span class="main">{}</span><span class="main">,</span>CDPlayer_CTRL_Update1<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">CDPlayer_CTRL_Update2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"d pupdate"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">CDPlayer_CTRL_Update2</span> <span class="main">=</span> LiftPUpdate <span class="main">(</span><span class="main">%</span> <span class="bound">d</span><span class="main">.</span> <span class="main">[</span>Some <span class="main">(</span>V0 <span class="main">(</span><span class="main">(</span>Select0 <span class="bound">d</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> None<span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">CDPlayer_CTRL_Action2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>d<span class="main">)</span>action"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">CDPlayer_CTRL_Action2</span> <span class="main">=</span> <span class="main">(</span><span class="main">{}</span><span class="main">,</span>CDPlayer_CTRL_Update2<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">CDPlayer_CTRL_Update3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"d pupdate"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">CDPlayer_CTRL_Update3</span> <span class="main">=</span> LiftPUpdate <span class="main">(</span><span class="main">%</span> <span class="bound">d</span><span class="main">.</span> <span class="main">[</span>Some <span class="main">(</span>V0 <span class="main">0</span><span class="main">)</span><span class="main">,</span> None<span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">CDPlayer_CTRL_Action3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>d<span class="main">)</span>action"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">CDPlayer_CTRL_Action3</span> <span class="main">=</span> <span class="main">(</span><span class="main">{}</span><span class="main">,</span>CDPlayer_CTRL_Update3<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">CDPlayer_CTRL_Labels</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>string<span class="main">,</span>d<span class="main">)</span>label set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">CDPlayer_CTRL_Labels</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>En <span class="inner_quoted">''LastTrack''</span><span class="main">,</span> defaultguard<span class="main">,</span> CDPlayer_CTRL_Action1<span class="main">)</span><span class="main">,</span>
                          <span class="main">(</span>En <span class="inner_quoted">''NewTrack''</span><span class="main">,</span> defaultguard<span class="main">,</span> CDPlayer_CTRL_Action2<span class="main">)</span><span class="main">,</span>
                          <span class="main">(</span>And <span class="main">(</span>En <span class="inner_quoted">''CDEject''</span><span class="main">)</span> <span class="main">(</span>In <span class="inner_quoted">''On''</span><span class="main">)</span><span class="main">,</span> defaultguard<span class="main">,</span> CDPlayer_CTRL_Action3<span class="main">)</span><span class="main">,</span>
                          <span class="main">(</span>En <span class="inner_quoted">''CDIn''</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">CDPlayer_CTRL_Delta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>string<span class="main">,</span>d<span class="main">)</span>trans set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">CDPlayer_CTRL_Delta</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="inner_quoted">''ReadTracks''</span><span class="main">,</span><span class="main">(</span>En <span class="inner_quoted">''LastTrack''</span><span class="main">,</span> defaultguard<span class="main">,</span> CDPlayer_CTRL_Action1<span class="main">)</span><span class="main">,</span>
                          <span class="inner_quoted">''CDFull''</span><span class="main">)</span><span class="main">,</span>
                         <span class="main">(</span><span class="inner_quoted">''CDFull''</span><span class="main">,</span><span class="main">(</span>And <span class="main">(</span>En <span class="inner_quoted">''CDEject''</span><span class="main">)</span> <span class="main">(</span>In <span class="inner_quoted">''On''</span><span class="main">)</span><span class="main">,</span> defaultguard<span class="main">,</span> CDPlayer_CTRL_Action3<span class="main">)</span><span class="main">,</span> 
                          <span class="inner_quoted">''CDEmpty''</span><span class="main">)</span><span class="main">,</span>
                         <span class="main">(</span><span class="inner_quoted">''ReadTracks''</span><span class="main">,</span><span class="main">(</span>En <span class="inner_quoted">''NewTrack''</span><span class="main">,</span> defaultguard<span class="main">,</span> CDPlayer_CTRL_Action2<span class="main">)</span><span class="main">,</span>
                          <span class="inner_quoted">''ReadTracks''</span><span class="main">)</span><span class="main">,</span>
                         <span class="main">(</span><span class="inner_quoted">''CDEmpty''</span><span class="main">,</span><span class="main">(</span>En <span class="inner_quoted">''CDIn''</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span><span class="main">,</span>
                          <span class="inner_quoted">''ReadTracks''</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">CDPlayer_CTRL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>string<span class="main">,</span>d<span class="main">)</span>seqauto"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">CDPlayer_CTRL</span>  <span class="main">=</span> Abs_seqauto <span class="main">(</span>CDPlayer_CTRL_States<span class="main">,</span> CDPlayer_CTRL_Init<span class="main">,</span>
                                CDPlayer_CTRL_Labels<span class="main">,</span> CDPlayer_CTRL_Delta<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Sequential Automaton  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>AudioPlayer_CTRL›</span></span></span></span>›</span></span>                  

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">AudioPlayer_CTRL_States</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">AudioPlayer_CTRL_States</span> <span class="main">=</span> <span class="main">{</span><span class="inner_quoted">''Off''</span><span class="main">,</span><span class="inner_quoted">''On''</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">AudioPlayer_CTRL_Init</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">AudioPlayer_CTRL_Init</span> <span class="main">=</span> <span class="inner_quoted">''Off''</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">AudioPlayer_CTRL_Labels</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>string<span class="main">,</span>d<span class="main">)</span>label set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">AudioPlayer_CTRL_Labels</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>En <span class="inner_quoted">''O''</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">AudioPlayer_CTRL_Delta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>string<span class="main">,</span>d<span class="main">)</span>trans set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">AudioPlayer_CTRL_Delta</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="inner_quoted">''Off''</span><span class="main">,</span> <span class="main">(</span>En <span class="inner_quoted">''O''</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span><span class="main">,</span> <span class="inner_quoted">''On''</span><span class="main">)</span><span class="main">,</span>
                            <span class="main">(</span><span class="inner_quoted">''On''</span><span class="main">,</span> <span class="main">(</span>En <span class="inner_quoted">''O''</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span><span class="main">,</span> <span class="inner_quoted">''Off''</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">AudioPlayer_CTRL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>string<span class="main">,</span>d<span class="main">)</span>seqauto"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">AudioPlayer_CTRL</span> <span class="main">=</span> Abs_seqauto <span class="main">(</span>AudioPlayer_CTRL_States<span class="main">,</span> AudioPlayer_CTRL_Init<span class="main">,</span>
                                  AudioPlayer_CTRL_Labels<span class="main">,</span> AudioPlayer_CTRL_Delta<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Sequential Automaton  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>On_CTRL›</span></span></span></span>›</span></span>                  

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">On_CTRL_States</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">On_CTRL_States</span> <span class="main">=</span> <span class="main">{</span><span class="inner_quoted">''TunerMode''</span><span class="main">,</span><span class="inner_quoted">''CDMode''</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">On_CTRL_Init</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">On_CTRL_Init</span> <span class="main">=</span> <span class="inner_quoted">''TunerMode''</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">On_CTRL_Labels</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>string<span class="main">,</span>d<span class="main">)</span>label set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">On_CTRL_Labels</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>And <span class="main">(</span>En <span class="inner_quoted">''Src''</span><span class="main">)</span> <span class="main">(</span>In <span class="inner_quoted">''CDFull''</span><span class="main">)</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span><span class="main">,</span>
                    <span class="main">(</span>En <span class="inner_quoted">''Src''</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span><span class="main">,</span>
                    <span class="main">(</span>En <span class="inner_quoted">''CDEject''</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span><span class="main">,</span>
                    <span class="main">(</span>En <span class="inner_quoted">''EndOfTitle''</span><span class="main">,</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span>DataPart <span class="bound">d</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>DataPart <span class="bound">d</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> defaultaction<span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">On_CTRL_Delta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>string<span class="main">,</span>d<span class="main">)</span>trans set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">On_CTRL_Delta</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="inner_quoted">''TunerMode''</span><span class="main">,</span><span class="main">(</span>And <span class="main">(</span>En <span class="inner_quoted">''Src''</span><span class="main">)</span> <span class="main">(</span>In <span class="inner_quoted">''CDFull''</span><span class="main">)</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span><span class="main">,</span><span class="inner_quoted">''CDMode''</span><span class="main">)</span><span class="main">,</span>
                   <span class="main">(</span><span class="inner_quoted">''CDMode''</span><span class="main">,</span> <span class="main">(</span>En <span class="inner_quoted">''Src''</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span><span class="main">,</span> <span class="inner_quoted">''TunerMode''</span><span class="main">)</span><span class="main">,</span>
                   <span class="main">(</span><span class="inner_quoted">''CDMode''</span><span class="main">,</span> <span class="main">(</span>En <span class="inner_quoted">''CDEject''</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span><span class="main">,</span> <span class="inner_quoted">''TunerMode''</span><span class="main">)</span><span class="main">,</span> 
                   <span class="main">(</span><span class="inner_quoted">''CDMode''</span><span class="main">,</span> <span class="main">(</span>En <span class="inner_quoted">''EndOfTitle''</span><span class="main">,</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span>DataPart <span class="bound">d</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>DataPart <span class="bound">d</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> defaultaction<span class="main">)</span><span class="main">,</span>
                    <span class="inner_quoted">''TunerMode''</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">On_CTRL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>string<span class="main">,</span>d<span class="main">)</span>seqauto"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">On_CTRL</span> <span class="main">=</span> Abs_seqauto <span class="main">(</span>On_CTRL_States<span class="main">,</span> On_CTRL_Init<span class="main">,</span>
                         On_CTRL_Labels<span class="main">,</span> On_CTRL_Delta<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Sequential Automaton  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>TunerMode_CTRL›</span></span></span></span>›</span></span>                  

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">TunerMode_CTRL_States</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">TunerMode_CTRL_States</span> <span class="main">=</span> <span class="main">{</span><span class="inner_quoted">''1''</span><span class="main">,</span><span class="inner_quoted">''2''</span><span class="main">,</span><span class="inner_quoted">''3''</span><span class="main">,</span><span class="inner_quoted">''4''</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">TunerMode_CTRL_Init</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">TunerMode_CTRL_Init</span> <span class="main">=</span> <span class="inner_quoted">''1''</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">TunerMode_CTRL_Labels</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>string<span class="main">,</span>d<span class="main">)</span>label set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">TunerMode_CTRL_Labels</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>En <span class="inner_quoted">''Next''</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span><span class="main">,</span>
                       <span class="main">(</span>En <span class="inner_quoted">''Back''</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">TunerMode_CTRL_Delta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>string<span class="main">,</span>d<span class="main">)</span>trans set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">TunerMode_CTRL_Delta</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="inner_quoted">''1''</span><span class="main">,</span> <span class="main">(</span>En <span class="inner_quoted">''Next''</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span><span class="main">,</span> <span class="inner_quoted">''2''</span><span class="main">)</span><span class="main">,</span>
                      <span class="main">(</span><span class="inner_quoted">''2''</span><span class="main">,</span> <span class="main">(</span>En <span class="inner_quoted">''Next''</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span><span class="main">,</span> <span class="inner_quoted">''3''</span><span class="main">)</span><span class="main">,</span>
                      <span class="main">(</span><span class="inner_quoted">''3''</span><span class="main">,</span> <span class="main">(</span>En <span class="inner_quoted">''Next''</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span><span class="main">,</span> <span class="inner_quoted">''4''</span><span class="main">)</span><span class="main">,</span>
                      <span class="main">(</span><span class="inner_quoted">''4''</span><span class="main">,</span> <span class="main">(</span>En <span class="inner_quoted">''Next''</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span><span class="main">,</span> <span class="inner_quoted">''1''</span><span class="main">)</span><span class="main">,</span>
                      <span class="main">(</span><span class="inner_quoted">''1''</span><span class="main">,</span> <span class="main">(</span>En <span class="inner_quoted">''Back''</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span><span class="main">,</span> <span class="inner_quoted">''4''</span><span class="main">)</span><span class="main">,</span>
                      <span class="main">(</span><span class="inner_quoted">''4''</span><span class="main">,</span> <span class="main">(</span>En <span class="inner_quoted">''Back''</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span><span class="main">,</span> <span class="inner_quoted">''3''</span><span class="main">)</span><span class="main">,</span>
                      <span class="main">(</span><span class="inner_quoted">''3''</span><span class="main">,</span> <span class="main">(</span>En <span class="inner_quoted">''Back''</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span><span class="main">,</span> <span class="inner_quoted">''2''</span><span class="main">)</span><span class="main">,</span>
                      <span class="main">(</span><span class="inner_quoted">''2''</span><span class="main">,</span> <span class="main">(</span>En <span class="inner_quoted">''Back''</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span><span class="main">,</span> <span class="inner_quoted">''1''</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">TunerMode_CTRL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>string<span class="main">,</span>d<span class="main">)</span>seqauto"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">TunerMode_CTRL</span>  <span class="main">=</span> Abs_seqauto <span class="main">(</span>TunerMode_CTRL_States<span class="main">,</span> TunerMode_CTRL_Init<span class="main">,</span>
                                  TunerMode_CTRL_Labels<span class="main">,</span> TunerMode_CTRL_Delta<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Sequential Automaton  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>CDMode_CTRL›</span></span></span></span>›</span></span>                  

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">CDMode_CTRL_States</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">CDMode_CTRL_States</span> <span class="main">=</span> <span class="main">{</span><span class="inner_quoted">''Playing''</span><span class="main">,</span><span class="inner_quoted">''SelectingNextTrack''</span><span class="main">,</span>
                        <span class="inner_quoted">''SelectingPreviousTrack''</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">CDMode_CTRL_Init</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">CDMode_CTRL_Init</span> <span class="main">=</span> <span class="inner_quoted">''Playing''</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">CDMode_CTRL_Update1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"d pupdate"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">CDMode_CTRL_Update1</span> <span class="main">=</span> LiftPUpdate <span class="main">(</span><span class="main">%</span> <span class="bound">d</span><span class="main">.</span> <span class="main">[</span> Some <span class="main">(</span>V0 <span class="main">(</span><span class="main">(</span>Select0 <span class="bound">d</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> None <span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">CDMode_CTRL_Action1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>d<span class="main">)</span>action"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">CDMode_CTRL_Action1</span> <span class="main">=</span> <span class="main">(</span><span class="main">{}</span><span class="main">,</span>CDMode_CTRL_Update1<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">CDMode_CTRL_Update2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"d pupdate"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">CDMode_CTRL_Update2</span> <span class="main">=</span> LiftPUpdate <span class="main">(</span><span class="main">%</span> <span class="bound">d</span><span class="main">.</span> <span class="main">[</span> Some <span class="main">(</span>V0 <span class="main">(</span><span class="main">(</span>Select0 <span class="bound">d</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> None <span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">CDMode_CTRL_Action2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>d<span class="main">)</span>action"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">CDMode_CTRL_Action2</span> <span class="main">=</span> <span class="main">(</span><span class="main">{}</span><span class="main">,</span>CDMode_CTRL_Update2<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">CDMode_CTRL_Labels</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>string<span class="main">,</span>d<span class="main">)</span>label set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">CDMode_CTRL_Labels</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>En <span class="inner_quoted">''Next''</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span><span class="main">,</span>
                        <span class="main">(</span>En <span class="inner_quoted">''Back''</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span><span class="main">,</span>
                        <span class="main">(</span>En <span class="inner_quoted">''Ready''</span><span class="main">,</span> defaultguard<span class="main">,</span> CDMode_CTRL_Action1<span class="main">)</span><span class="main">,</span>
                        <span class="main">(</span>En <span class="inner_quoted">''Ready''</span><span class="main">,</span> defaultguard<span class="main">,</span> CDMode_CTRL_Action2<span class="main">)</span><span class="main">,</span>
                        <span class="main">(</span>En <span class="inner_quoted">''EndOfTitle''</span><span class="main">,</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">d</span><span class="main">::</span> d data<span class="main">)</span><span class="main">.</span> <span class="main">(</span>Select0 <span class="bound">d</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>Select1 <span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> defaultaction<span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">CDMode_CTRL_Delta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>string<span class="main">,</span>d<span class="main">)</span>trans set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">CDMode_CTRL_Delta</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="inner_quoted">''Playing''</span><span class="main">,</span> <span class="main">(</span>En <span class="inner_quoted">''Next''</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span> <span class="main">,</span> <span class="inner_quoted">''SelectingNextTrack''</span><span class="main">)</span><span class="main">,</span>
                       <span class="main">(</span><span class="inner_quoted">''SelectingNextTrack''</span><span class="main">,</span> <span class="main">(</span>En <span class="inner_quoted">''Ready''</span><span class="main">,</span> defaultguard<span class="main">,</span> CDMode_CTRL_Action1<span class="main">)</span> <span class="main">,</span><span class="inner_quoted">''Playing''</span><span class="main">)</span><span class="main">,</span>
                       <span class="main">(</span><span class="inner_quoted">''Playing''</span><span class="main">,</span> <span class="main">(</span>En <span class="inner_quoted">''Back''</span><span class="main">,</span> defaultguard<span class="main">,</span> defaultaction<span class="main">)</span> <span class="main">,</span><span class="inner_quoted">''SelectingPreviousTrack''</span><span class="main">)</span><span class="main">,</span>
                       <span class="main">(</span><span class="inner_quoted">''SelectingPreviousTrack''</span><span class="main">,</span> <span class="main">(</span>En <span class="inner_quoted">''Ready''</span><span class="main">,</span> defaultguard<span class="main">,</span> CDMode_CTRL_Action2<span class="main">)</span><span class="main">,</span> 
                        <span class="inner_quoted">''Playing''</span><span class="main">)</span><span class="main">,</span>
                       <span class="main">(</span><span class="inner_quoted">''Playing''</span><span class="main">,</span> <span class="main">(</span>En <span class="inner_quoted">''EndOfTitle''</span><span class="main">,</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">d</span><span class="main">::</span> d data<span class="main">)</span><span class="main">.</span> <span class="main">(</span>Select0 <span class="bound">d</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>Select1 <span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> defaultaction<span class="main">)</span><span class="main">,</span>
                        <span class="inner_quoted">''SelectingNextTrack''</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">CDMode_CTRL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>string<span class="main">,</span>d<span class="main">)</span>seqauto"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">CDMode_CTRL</span>  <span class="main">=</span> Abs_seqauto <span class="main">(</span>CDMode_CTRL_States<span class="main">,</span> CDMode_CTRL_Init<span class="main">,</span>
                               CDMode_CTRL_Labels<span class="main">,</span> CDMode_CTRL_Delta<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Hierarchical Automaton  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>CarAudioSystem›</span></span></span></span>›</span></span>                  

<span class="keyword1"><span class="command">definition</span></span>
     <span class="entity">CarAudioSystem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span>string<span class="main">,</span>d<span class="main">)</span>hierauto"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     <span class="quoted"><span class="quoted">"<span class="free">CarAudioSystem</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>PseudoHA Root_CTRL <span class="main">(</span>LiftInitData <span class="main">[</span>V0 <span class="main">0</span><span class="main">,</span> V1 <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">[++]</span> <span class="main">(</span><span class="inner_quoted">''CarAudioSystem''</span><span class="main">,</span>CDPlayer_CTRL<span class="main">)</span>
                  <span class="main">[++]</span> <span class="main">(</span><span class="inner_quoted">''CarAudioSystem''</span><span class="main">,</span>AudioPlayer_CTRL<span class="main">)</span>
                  <span class="main">[++]</span> <span class="main">(</span><span class="inner_quoted">''On''</span><span class="main">,</span> TunerMode_CTRL<span class="main">)</span>
                  <span class="main">[++]</span> <span class="main">(</span><span class="inner_quoted">''On''</span><span class="main">,</span> CDMode_CTRL<span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lemmas›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Sequential Automaton <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>CDMode_CTRL›</span></span></span></span>›</span></span>

<span class="keyword1" id="CarAudioSystem-check_Root_CTRL"><span class="command">lemma</span></span> check_Root_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>Root_CTRL_States<span class="main">,</span>Root_CTRL_Init<span class="main">,</span>Root_CTRL_Labels<span class="main">,</span>Root_CTRL_Delta<span class="main">)</span> <span class="main">:</span> seqauto"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> seqauto_def SeqAuto_def Root_CTRL_States_def Root_CTRL_Init_def Root_CTRL_Labels_def Root_CTRL_Delta_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-States_Root_CTRL"><span class="command">lemma</span></span> States_Root_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"States Root_CTRL <span class="main">=</span> Root_CTRL_States"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Root_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> States_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_Root_CTRL<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Init_State_Root_CTRL"><span class="command">lemma</span></span> Init_State_Root_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"InitState Root_CTRL <span class="main">=</span> Root_CTRL_Init"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Root_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> InitState_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_Root_CTRL<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Labels_Root_CTRL"><span class="command">lemma</span></span> Labels_Root_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Labels Root_CTRL <span class="main">=</span> Root_CTRL_Labels"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Root_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Labels_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_Root_CTRL<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Delta_Root_CTRL"><span class="command">lemma</span></span> Delta_Root_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Delta Root_CTRL <span class="main">=</span> Root_CTRL_Delta"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Root_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Delta_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_Root_CTRL<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">schematic_goal</span></span> Events_Root_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"SAEvents Root_CTRL <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> SAEvents_def expr_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> expr_def Delta_Root_CTRL Root_CTRL_Delta_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Sequential Automaton <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>CDPlayer_CTRL›</span></span></span></span>›</span></span>

<span class="keyword1" id="CarAudioSystem-check_CDPlayer_CTRL"><span class="command">lemma</span></span> check_CDPlayer_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>CDPlayer_CTRL_States<span class="main">,</span>CDPlayer_CTRL_Init<span class="main">,</span>CDPlayer_CTRL_Labels<span class="main">,</span>CDPlayer_CTRL_Delta<span class="main">)</span> <span class="main">:</span> seqauto"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> seqauto_def SeqAuto_def CDPlayer_CTRL_States_def CDPlayer_CTRL_Init_def CDPlayer_CTRL_Labels_def CDPlayer_CTRL_Delta_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-States_CDPlayer_CTRL"><span class="command">lemma</span></span> States_CDPlayer_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"States CDPlayer_CTRL <span class="main">=</span> CDPlayer_CTRL_States"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CDPlayer_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> States_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_CDPlayer_CTRL<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Init_State_CDPlayer_CTRL"><span class="command">lemma</span></span> Init_State_CDPlayer_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"InitState CDPlayer_CTRL <span class="main">=</span> CDPlayer_CTRL_Init"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CDPlayer_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> InitState_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_CDPlayer_CTRL<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Labels_CDPlayer_CTRL"><span class="command">lemma</span></span> Labels_CDPlayer_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Labels CDPlayer_CTRL <span class="main">=</span> CDPlayer_CTRL_Labels"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CDPlayer_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Labels_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_CDPlayer_CTRL<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Delta_CDPlayer_CTRL"><span class="command">lemma</span></span> Delta_CDPlayer_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Delta CDPlayer_CTRL <span class="main">=</span> CDPlayer_CTRL_Delta"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CDPlayer_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Delta_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_CDPlayer_CTRL<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">schematic_goal</span></span> Events_CDPlayer_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"SAEvents CDPlayer_CTRL <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> SAEvents_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> expr_def Delta_CDPlayer_CTRL CDPlayer_CTRL_Delta_def CDPlayer_CTRL_Action1_def CDPlayer_CTRL_Action2_def CDPlayer_CTRL_Action3_def Label_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Sequential Automaton <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>AudioPlayer_CTRL›</span></span></span></span>›</span></span>

<span class="keyword1" id="CarAudioSystem-check_AudioPlayer_CTRL"><span class="command">lemma</span></span> check_AudioPlayer_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>AudioPlayer_CTRL_States<span class="main">,</span>AudioPlayer_CTRL_Init<span class="main">,</span>AudioPlayer_CTRL_Labels<span class="main">,</span>AudioPlayer_CTRL_Delta<span class="main">)</span> <span class="main">:</span> seqauto"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> seqauto_def SeqAuto_def AudioPlayer_CTRL_States_def AudioPlayer_CTRL_Init_def AudioPlayer_CTRL_Labels_def AudioPlayer_CTRL_Delta_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-States_AudioPlayer_CTRL"><span class="command">lemma</span></span> States_AudioPlayer_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"States AudioPlayer_CTRL <span class="main">=</span> AudioPlayer_CTRL_States"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AudioPlayer_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> States_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_AudioPlayer_CTRL<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Init_State_AudioPlayer_CTRL"><span class="command">lemma</span></span> Init_State_AudioPlayer_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"InitState AudioPlayer_CTRL <span class="main">=</span> AudioPlayer_CTRL_Init"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AudioPlayer_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> InitState_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_AudioPlayer_CTRL<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Labels_AudioPlayer_CTRL"><span class="command">lemma</span></span> Labels_AudioPlayer_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Labels AudioPlayer_CTRL <span class="main">=</span> AudioPlayer_CTRL_Labels"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AudioPlayer_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Labels_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_AudioPlayer_CTRL<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Delta_AudioPlayer_CTRL"><span class="command">lemma</span></span> Delta_AudioPlayer_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Delta AudioPlayer_CTRL <span class="main">=</span> AudioPlayer_CTRL_Delta"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AudioPlayer_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Delta_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_AudioPlayer_CTRL<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">schematic_goal</span></span> Events_AudioPlayer_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"SAEvents AudioPlayer_CTRL <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> SAEvents_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> expr_def Delta_AudioPlayer_CTRL AudioPlayer_CTRL_Delta_def Label_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Sequential Automaton <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>On_CTRL›</span></span></span></span>›</span></span>

<span class="keyword1" id="CarAudioSystem-check_On_CTRL"><span class="command">lemma</span></span> check_On_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>On_CTRL_States<span class="main">,</span>On_CTRL_Init<span class="main">,</span>On_CTRL_Labels<span class="main">,</span>On_CTRL_Delta<span class="main">)</span> <span class="main">:</span> seqauto"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> seqauto_def SeqAuto_def On_CTRL_States_def On_CTRL_Init_def On_CTRL_Labels_def On_CTRL_Delta_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-States_On_CTRL"><span class="command">lemma</span></span> States_On_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"States On_CTRL <span class="main">=</span> On_CTRL_States"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> On_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> States_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_On_CTRL<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Init_State_On_CTRL"><span class="command">lemma</span></span> Init_State_On_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"InitState On_CTRL <span class="main">=</span> On_CTRL_Init"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> On_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> InitState_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_On_CTRL<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Labels_On_CTRL"><span class="command">lemma</span></span> Labels_On_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Labels On_CTRL <span class="main">=</span> On_CTRL_Labels"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> On_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Labels_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_On_CTRL<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Delta_On_CTRL"><span class="command">lemma</span></span> Delta_On_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Delta On_CTRL <span class="main">=</span> On_CTRL_Delta"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> On_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Delta_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_On_CTRL<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">schematic_goal</span></span> Events_On_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"SAEvents On_CTRL <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> SAEvents_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> expr_def Delta_On_CTRL On_CTRL_Delta_def Label_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Sequential Automaton <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>TunerMode_CTRL›</span></span></span></span>›</span></span>

<span class="keyword1" id="CarAudioSystem-check_TunerMode_CTRL"><span class="command">lemma</span></span> check_TunerMode_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>TunerMode_CTRL_States<span class="main">,</span>TunerMode_CTRL_Init<span class="main">,</span>TunerMode_CTRL_Labels<span class="main">,</span>TunerMode_CTRL_Delta<span class="main">)</span> <span class="main">:</span> seqauto"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> seqauto_def SeqAuto_def TunerMode_CTRL_States_def TunerMode_CTRL_Init_def TunerMode_CTRL_Labels_def TunerMode_CTRL_Delta_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-States_TunerMode_CTRL"><span class="command">lemma</span></span> States_TunerMode_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"States TunerMode_CTRL <span class="main">=</span> TunerMode_CTRL_States"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TunerMode_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> States_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_TunerMode_CTRL<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Init_State_TunerMode_CTRL"><span class="command">lemma</span></span> Init_State_TunerMode_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"InitState TunerMode_CTRL <span class="main">=</span> TunerMode_CTRL_Init"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TunerMode_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> InitState_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_TunerMode_CTRL<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Labels_TunerMode_CTRL"><span class="command">lemma</span></span> Labels_TunerMode_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Labels TunerMode_CTRL <span class="main">=</span> TunerMode_CTRL_Labels"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TunerMode_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Labels_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_TunerMode_CTRL<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Delta_TunerMode_CTRL"><span class="command">lemma</span></span> Delta_TunerMode_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Delta TunerMode_CTRL <span class="main">=</span> TunerMode_CTRL_Delta"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TunerMode_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Delta_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_TunerMode_CTRL<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">schematic_goal</span></span> Events_TunerMode_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"SAEvents TunerMode_CTRL <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> SAEvents_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> expr_def Delta_TunerMode_CTRL TunerMode_CTRL_Delta_def Label_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Sequential Automaton <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>CDMode_CTRL›</span></span></span></span>›</span></span>

<span class="keyword1" id="CarAudioSystem-check_CDMode_CTRL"><span class="command">lemma</span></span> check_CDMode_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>CDMode_CTRL_States<span class="main">,</span>CDMode_CTRL_Init<span class="main">,</span>CDMode_CTRL_Labels<span class="main">,</span>CDMode_CTRL_Delta<span class="main">)</span> <span class="main">:</span> seqauto"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> seqauto_def SeqAuto_def CDMode_CTRL_States_def CDMode_CTRL_Init_def CDMode_CTRL_Labels_def CDMode_CTRL_Delta_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-States_CDMode_CTRL"><span class="command">lemma</span></span> States_CDMode_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"States CDMode_CTRL <span class="main">=</span> CDMode_CTRL_States"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CDMode_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> States_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_CDMode_CTRL<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Init_State_CDMode_CTRL"><span class="command">lemma</span></span> Init_State_CDMode_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"InitState CDMode_CTRL <span class="main">=</span> CDMode_CTRL_Init"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CDMode_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> InitState_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_CDMode_CTRL<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Labels_CDMode_CTRL"><span class="command">lemma</span></span> Labels_CDMode_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Labels CDMode_CTRL <span class="main">=</span> CDMode_CTRL_Labels"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CDMode_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Labels_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_CDMode_CTRL<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Delta_CDMode_CTRL"><span class="command">lemma</span></span> Delta_CDMode_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Delta CDMode_CTRL <span class="main">=</span> CDMode_CTRL_Delta"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CDMode_CTRL_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Delta_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_seqauto_inverse check_CDMode_CTRL<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">schematic_goal</span></span> Events_CDMode_CTRL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"SAEvents CDMode_CTRL <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> SAEvents_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> expr_def Label_def Delta_CDMode_CTRL CDMode_CTRL_Delta_def CDMode_CTRL_Action1_def CDMode_CTRL_Action2_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Hierarchical Automaton <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>CarAudioSystem›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> CarAudioSystemStates <span class="main">=</span> States_Root_CTRL States_CDPlayer_CTRL States_AudioPlayer_CTRL States_On_CTRL 
                              States_TunerMode_CTRL States_CDMode_CTRL
                              Root_CTRL_States_def CDPlayer_CTRL_States_def AudioPlayer_CTRL_States_def 
                              On_CTRL_States_def TunerMode_CTRL_States_def CDMode_CTRL_States_def

<span class="keyword1"><span class="command">lemmas</span></span> CarAudioSystemInitState <span class="main">=</span> Init_State_Root_CTRL Init_State_CDPlayer_CTRL Init_State_AudioPlayer_CTRL 
                                 Init_State_On_CTRL Init_State_TunerMode_CTRL Init_State_CDMode_CTRL
                                 Root_CTRL_Init_def CDPlayer_CTRL_Init_def AudioPlayer_CTRL_Init_def
                                 On_CTRL_Init_def TunerMode_CTRL_Init_def CDMode_CTRL_Init_def  

<span class="keyword1"><span class="command">lemmas</span></span> CarAudioSystemEvents <span class="main">=</span> Events_Root_CTRL Events_CDPlayer_CTRL Events_AudioPlayer_CTRL Events_On_CTRL 
                              Events_TunerMode_CTRL Events_CDMode_CTRL 

<span class="keyword1"><span class="command">lemmas</span></span> CarAudioSystemthms <span class="main">=</span> CarAudioSystemStates CarAudioSystemEvents CarAudioSystemInitState

<span class="comment1">(* -------------------------------------------------------------- *)</span>
<span class="comment1">(*                  States of » CarAudioSystem «                  *)</span>
<span class="comment1">(* -------------------------------------------------------------- *)</span>

<span class="keyword1"><span class="command">schematic_goal</span></span> CarAudioSystem_StatesRoot<span class="main">:</span>
  <span class="quoted"><span class="quoted">"HAStates <span class="main">(</span>PseudoHA Root_CTRL <span class="main">(</span>LiftInitData <span class="main">[</span>V0 <span class="main">0</span><span class="main">,</span> V1 <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> CarAudioSystemthms_1 <span class="main">=</span> CarAudioSystemthms CarAudioSystem_StatesRoot


<span class="keyword1"><span class="command">schematic_goal</span></span> CarAudioSystem_StatesCDPlayer<span class="main">:</span>
  <span class="quoted"><span class="quoted">"HAStates <span class="main">(</span>PseudoHA Root_CTRL <span class="main">(</span>LiftInitData <span class="main">[</span>V0 <span class="main">0</span><span class="main">,</span> V1 <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">[++]</span> 
            <span class="main">(</span><span class="inner_quoted">''CarAudioSystem''</span><span class="main">,</span>CDPlayer_CTRL<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_1<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> CarAudioSystemthms_2 <span class="main">=</span> CarAudioSystemthms_1 CarAudioSystem_StatesCDPlayer

<span class="keyword1"><span class="command">schematic_goal</span></span> CarAudioSystem_StatesAudioPlayer<span class="main">:</span>
  <span class="quoted"><span class="quoted">"HAStates <span class="main">(</span>PseudoHA Root_CTRL <span class="main">(</span>LiftInitData <span class="main">[</span>V0 <span class="main">0</span><span class="main">,</span> V1 <span class="main">0</span><span class="main">]</span><span class="main">)</span>
                  <span class="main">[++]</span> <span class="main">(</span><span class="inner_quoted">''CarAudioSystem''</span><span class="main">,</span>CDPlayer_CTRL<span class="main">)</span>
                  <span class="main">[++]</span> <span class="main">(</span><span class="inner_quoted">''CarAudioSystem''</span><span class="main">,</span>AudioPlayer_CTRL<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> CarAudioSystemthms_3 <span class="main">=</span> CarAudioSystemthms_2 CarAudioSystem_StatesAudioPlayer

<span class="keyword1"><span class="command">schematic_goal</span></span> CarAudioSystem_StatesTunerMode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"HAStates <span class="main">(</span>PseudoHA Root_CTRL <span class="main">(</span>LiftInitData <span class="main">[</span>V0 <span class="main">0</span><span class="main">,</span> V1 <span class="main">0</span><span class="main">]</span><span class="main">)</span>
                  <span class="main">[++]</span> <span class="main">(</span><span class="inner_quoted">''CarAudioSystem''</span><span class="main">,</span>CDPlayer_CTRL<span class="main">)</span>
                  <span class="main">[++]</span> <span class="main">(</span><span class="inner_quoted">''CarAudioSystem''</span><span class="main">,</span>AudioPlayer_CTRL<span class="main">)</span>
                  <span class="main">[++]</span> <span class="main">(</span><span class="inner_quoted">''On''</span><span class="main">,</span> TunerMode_CTRL <span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_3<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> CarAudioSystemthms_4 <span class="main">=</span> CarAudioSystemthms_3 CarAudioSystem_StatesTunerMode

<span class="keyword1"><span class="command">schematic_goal</span></span> CarAudioSystem_StatesCDMode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"HAStates <span class="main">(</span>PseudoHA Root_CTRL <span class="main">(</span>LiftInitData <span class="main">[</span>V0 <span class="main">0</span><span class="main">,</span> V1 <span class="main">0</span><span class="main">]</span><span class="main">)</span>
                  <span class="main">[++]</span> <span class="main">(</span><span class="inner_quoted">''CarAudioSystem''</span><span class="main">,</span>CDPlayer_CTRL<span class="main">)</span>
                  <span class="main">[++]</span> <span class="main">(</span><span class="inner_quoted">''CarAudioSystem''</span><span class="main">,</span>AudioPlayer_CTRL<span class="main">)</span>
                  <span class="main">[++]</span> <span class="main">(</span><span class="inner_quoted">''On''</span><span class="main">,</span> TunerMode_CTRL <span class="main">)</span>
                  <span class="main">[++]</span> <span class="main">(</span><span class="inner_quoted">''On''</span><span class="main">,</span> CDMode_CTRL<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_4<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> CarAudioSystemthms_5 <span class="main">=</span> CarAudioSystemthms_4 CarAudioSystem_StatesCDMode

<span class="keyword1"><span class="command">schematic_goal</span></span> SAsCarAudioSystem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"SAs CarAudioSystem <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> CarAudioSystem_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">schematic_goal</span></span> EventsCarAudioSystem<span class="main">:</span>
 <span class="quoted"><span class="quoted">"HAEvents CarAudioSystem <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> CarAudioSystem_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">schematic_goal</span></span> CompFunCarAudioSystem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"CompFun CarAudioSystem <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> CarAudioSystem_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">schematic_goal</span></span> StatesCarAudioSystem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"HAStates CarAudioSystem <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> CarAudioSystem_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">schematic_goal</span></span> ValueCarAudioSystem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"HAInitValue CarAudioSystem <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> CarAudioSystem_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">schematic_goal</span></span> HAInitStatesCarAudioSystem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"HAInitStates CarAudioSystem <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HAInitStates_def SAsCarAudioSystem CarAudioSystemInitState<span class="main">)</span>

<span class="keyword1"><span class="command">schematic_goal</span></span> HARootCarAudioSystem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"HARoot CarAudioSystem <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> CarAudioSystem_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">schematic_goal</span></span> HAInitStateCarAudioSystem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"HAInitState CarAudioSystem <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HARootCarAudioSystem HAInitState_def CarAudioSystemInitState<span class="main">)</span>


<span class="comment1">(* -------------------------------------------------------------- *)</span>
<span class="comment1">(*      Components of the initial data space assignement          *)</span>
<span class="comment1">(* -------------------------------------------------------------- *)</span>

<span class="keyword1" id="CarAudioSystem-check_DataSpace"><span class="command">lemma</span></span> check_DataSpace <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span>range V0<span class="main">,</span> range V1<span class="main">]</span> <span class="main">∈</span> dataspace"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> dataspace_def DataSpace.DataSpace_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> D<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">D</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-PartNum_DataSpace"><span class="command">lemma</span></span> PartNum_DataSpace <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"PartNum <span class="main">(</span>DSpace<span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> PartNum_def DSpace_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_dataspace_inverse<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-PartDom_DataSpace_V0"><span class="command">lemma</span></span> PartDom_DataSpace_V0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>PartDom DSpace <span class="main">0</span><span class="main">)</span> <span class="main">=</span> range V0"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> PartDom_def DSpace_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_dataspace_inverse<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-PartDom_DataSpace_V1"><span class="command">lemma</span></span> PartDom_DataSpace_V1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>PartDom DSpace <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> range V1"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> PartDom_def DSpace_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_dataspace_inverse<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-check_InitialData"><span class="command">lemma</span></span> check_InitialData <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>V0 <span class="main">0</span><span class="main">,</span> V1 <span class="main">0</span><span class="main">]</span><span class="main">,</span>DSpace<span class="main">)</span> <span class="main">∈</span> data"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> data_def Data.Data_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> d<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">d</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="improper">d</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Select0_InitData"><span class="command">lemma</span></span> Select0_InitData <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Select0 <span class="main">(</span>LiftInitData <span class="main">[</span>V0 <span class="main">0</span><span class="main">,</span> V1 <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> LiftInitData_def Select0_def DataPart_def DataValue_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_data_inverse<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Select1_InitData"><span class="command">lemma</span></span> Select1_InitData <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Select1 <span class="main">(</span>LiftInitData <span class="main">[</span>V0 <span class="main">0</span><span class="main">,</span> V1 <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> LiftInitData_def Select1_def DataPart_def DataValue_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_data_inverse<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-HAInitValue1_CarAudioSystem"><span class="command">lemma</span></span> HAInitValue1_CarAudioSystem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"CarAudioSystem <span class="keyword1">|=H=</span> Atom <span class="main">(</span>VAL <span class="main">(</span><span class="main">λ</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span>Select0 <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ValueCarAudioSystem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-HAInitValue2_CarAudioSystem"><span class="command">lemma</span></span> HAInitValue2_CarAudioSystem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"CarAudioSystem <span class="keyword1">|=H=</span> Atom <span class="main">(</span>VAL <span class="main">(</span><span class="main">λ</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span>Select1 <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ValueCarAudioSystem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-HAInitValue_DSpace_CarAudioSystem"><span class="command">lemma</span></span> HAInitValue_DSpace_CarAudioSystem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Data.DataSpace <span class="main">(</span>LiftInitData <span class="main">[</span>V0 <span class="main">0</span><span class="main">,</span> V1 <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> DSpace"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> LiftInitData_def Data.DataSpace_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_data_inverse<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-check_InitStatus"><span class="command">lemma</span></span> check_InitStatus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>CarAudioSystem<span class="main">,</span> InitConf CarAudioSystem<span class="main">,</span> <span class="main">{}</span><span class="main">,</span>LiftInitData <span class="main">[</span>V0 <span class="main">0</span><span class="main">,</span> V1 <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> status"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> status_def Status_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ValueCarAudioSystem<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-InitData_InitStatus"><span class="command">lemma</span></span> InitData_InitStatus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Value <span class="main">(</span>InitStatus CarAudioSystem<span class="main">)</span> <span class="main">=</span> LiftInitData <span class="main">[</span>V0 <span class="main">0</span><span class="main">,</span> V1 <span class="main">0</span><span class="main">]</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ValueCarAudioSystem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Events_InitStatus"><span class="command">lemma</span></span> Events_InitStatus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Events <span class="main">(</span>InitStatus CarAudioSystem<span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> InitStatus_def Events_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_status_inverse<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Conf_InitStatus"><span class="command">lemma</span></span> Conf_InitStatus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Conf <span class="main">(</span>InitStatus CarAudioSystem<span class="main">)</span> <span class="main">=</span> InitConf CarAudioSystem"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> InitStatus_def Conf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_status_inverse<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-CompFunCarAudioSystem_the"><span class="command">lemma</span></span> CompFunCarAudioSystem_the<span class="main">:</span>
  <span class="quoted"><span class="quoted">"the <span class="main">(</span>CompFun CarAudioSystem <span class="inner_quoted">''On''</span><span class="main">)</span> <span class="main">=</span>  <span class="main">{</span>CDMode_CTRL<span class="main">,</span>TunerMode_CTRL<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> CarAudioSystem_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun_the<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun_the<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun_the2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-CompFunCarAudioSystem_the2"><span class="command">lemma</span></span> CompFunCarAudioSystem_the2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"the <span class="main">(</span>CompFun CarAudioSystem <span class="inner_quoted">''CarAudioSystem''</span><span class="main">)</span> <span class="main">=</span>  <span class="main">{</span>AudioPlayer_CTRL<span class="main">,</span> CDPlayer_CTRL<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> CarAudioSystem_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun_the3<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 5
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun_the3<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 5
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun_the<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun_the<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> PseudoHA_CompFun_the<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-CompFunCarAudioSystem_the3"><span class="command">lemma</span></span> CompFunCarAudioSystem_the3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"the <span class="main">(</span>CompFun CarAudioSystem <span class="inner_quoted">''Off''</span><span class="main">)</span> <span class="main">=</span>  <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> CarAudioSystem_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun_the3<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 5
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun_the3<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 5
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun_the2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">schematic_goal</span></span> CompFunCarAudioSystem_ran<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ran <span class="main">(</span>CompFun CarAudioSystem<span class="main">)</span> <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> CarAudioSystem_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> AddSA_CompFun_ran3_IFF<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 6
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AddSA_CompFun_PseudoHA_ran2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 4
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Root_CTRL_CDPlayer_CTRL_noteq"><span class="command">lemma</span></span> Root_CTRL_CDPlayer_CTRL_noteq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Root_CTRL <span class="main">≠</span> CDPlayer_CTRL"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SA_States_disjunct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Root_CTRL_AudioPlayer_CTRL_noteq"><span class="command">lemma</span></span> Root_CTRL_AudioPlayer_CTRL_noteq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Root_CTRL <span class="main">≠</span> AudioPlayer_CTRL"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SA_States_disjunct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Root_CTRL_TunerMode_CTRL_noteq"><span class="command">lemma</span></span> Root_CTRL_TunerMode_CTRL_noteq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Root_CTRL <span class="main">≠</span> TunerMode_CTRL"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SA_States_disjunct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Root_CTRL_CDMode_CTRL_noteq"><span class="command">lemma</span></span> Root_CTRL_CDMode_CTRL_noteq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Root_CTRL <span class="main">≠</span> CDMode_CTRL"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SA_States_disjunct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-CDPlayer_CTRL_AudioPlayer_CTRL_noteq"><span class="command">lemma</span></span> CDPlayer_CTRL_AudioPlayer_CTRL_noteq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"CDPlayer_CTRL <span class="main">≠</span> AudioPlayer_CTRL"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SA_States_disjunct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-CDPlayer_CTRL_TunerMode_CTRL_noteq"><span class="command">lemma</span></span> CDPlayer_CTRL_TunerMode_CTRL_noteq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"CDPlayer_CTRL <span class="main">≠</span> TunerMode_CTRL"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SA_States_disjunct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-CDPlayer_CTRL_CDMode_CTRL_noteq"><span class="command">lemma</span></span> CDPlayer_CTRL_CDMode_CTRL_noteq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"CDPlayer_CTRL <span class="main">≠</span> CDMode_CTRL"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SA_States_disjunct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-AudioPlayer_CTRL_TunerMode_CTRL_noteq"><span class="command">lemma</span></span> AudioPlayer_CTRL_TunerMode_CTRL_noteq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"AudioPlayer_CTRL <span class="main">≠</span>  TunerMode_CTRL"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SA_States_disjunct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-AudioPlayer_CTRL_CDMode_CTRL_noteq"><span class="command">lemma</span></span> AudioPlayer_CTRL_CDMode_CTRL_noteq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"AudioPlayer_CTRL <span class="main">≠</span> CDMode_CTRL"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SA_States_disjunct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-TunerMode_CTRL_CDMode_CTRL_noteq"><span class="command">lemma</span></span> TunerMode_CTRL_CDMode_CTRL_noteq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"TunerMode_CTRL <span class="main">≠</span>  CDMode_CTRL"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SA_States_disjunct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">schematic_goal</span></span> Chi_CarAudioSystem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Chi CarAudioSystem <span class="inner_quoted">''CarAudioSystem''</span> <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Chi_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SAsCarAudioSystem StatesCarAudioSystem restrict_def CompFunCarAudioSystem_the2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_sym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CarAudioSystemStates insert_or<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">schematic_goal</span></span> Chi_CarAudioSystem_On<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Chi CarAudioSystem <span class="inner_quoted">''On''</span> <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Chi_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SAsCarAudioSystem StatesCarAudioSystem restrict_def CompFunCarAudioSystem_the<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_sym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CarAudioSystemStates insert_or<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">schematic_goal</span></span> Chi_CarAudioSystem_Off<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Chi CarAudioSystem <span class="inner_quoted">''Off''</span> <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Chi_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SAsCarAudioSystem StatesCarAudioSystem restrict_def CompFunCarAudioSystem_the3<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">schematic_goal</span></span> InitConf_CarAudioSystem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"InitConf CarAudioSystem <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> CarAudioSystem_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> AddSA_InitConf_IFF<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CarAudioSystemthms_5<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">wellformed</span> CarAudioSystemthms_5<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CarAudioSystemthms_5<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CarAudioSystem-Initial_State_CarAudioSystem"><span class="command">lemma</span></span> Initial_State_CarAudioSystem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"CarAudioSystem <span class="keyword1">|=H=</span> Atom <span class="main">(</span>IN <span class="inner_quoted">''Off''</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> InitConf_CarAudioSystem <span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div>