<div id="FormalSSA_Misc">
<div class="head">
<h1>Theory FormalSSA_Misc</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      FormalSSA_Misc.thy
    Author:     Sebastian Ullrich, Denis Lohner
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Prelude›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Miscellaneous Lemmata›</span></span>

<span class="keyword1"><span class="command">theory</span></span> FormalSSA_Misc
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Sublist.html">HOL-Library.Sublist</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="FormalSSA_Misc-length_1_last_hd"><span class="command">lemma</span></span> length_1_last_hd<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ns</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> last <span class="free">ns</span> <span class="main">=</span> hd <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def append.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> append_butlast_last_id diff_Suc_Suc diff_zero length_0_conv length_butlast list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zero_neq_one<span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-not_in_butlast"><span class="command">lemma</span></span> not_in_butlast<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">∈</span> set <span class="free">ys</span><span class="main">;</span> <span class="free">x</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="free">ys</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> last <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> append_butlast_last_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>append_butlast_last_id<span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-in_set_butlastI"><span class="command">lemma</span></span> in_set_butlastI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≠</span> last <span class="free">xs</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_butlast_last_id append_is_Nil_conv list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rotate1.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> set_ConsD set_rotate1 split_list<span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-butlast_strict_prefix"><span class="command">lemma</span></span> butlast_strict_prefix<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> strict_prefix <span class="main">(</span>butlast <span class="free">xs</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_butlast_last_id strict_prefixI'<span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-set_tl"><span class="command">lemma</span></span> set_tl<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>tl <span class="free">xs</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> set_mono_suffix suffix_tl<span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-in_set_tlD"><span class="command">lemma</span></span> in_set_tlD<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_tl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">xs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="FormalSSA_Misc-suffix_unsnoc"><span class="command">lemma</span></span> suffix_unsnoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">xs</span> <span class="free">ys</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> butlast <span class="free">xs</span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> butlast <span class="free">ys</span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_butlast_last_id append_is_Nil_conv assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> last_appendR suffix_def<span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-prefix_split_first"><span class="command">lemma</span></span> prefix_split_first<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">as</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span><span class="free">as</span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> set <span class="free">as</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">atomize_elim</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="skolem">as</span><span class="main">@</span><span class="free">x</span><span class="main">#</span><span class="skolem">bs</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∉</span> set <span class="skolem">as</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize_elim</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> split_list_first<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">as</span><span class="main">.</span> prefix <span class="main">(</span><span class="bound">as</span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="free">xs</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∉</span> set <span class="bound">as</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">as</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FormalSSA_Misc-in_prefix"><span class="command">lemma</span></span> in_prefix<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prefix <span class="free">xs</span> <span class="free">ys</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>prefixE<span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-strict_prefix_butlast"><span class="command">lemma</span></span> strict_prefix_butlast<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prefix <span class="free">xs</span> <span class="main">(</span>butlast <span class="free">ys</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strict_prefix <span class="free">xs</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> append_butlast_last_id<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>less_le butlast_strict_prefix prefix_order.le_less_trans<span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-prefix_tl_subset"><span class="command">lemma</span></span> prefix_tl_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"prefix <span class="free">xs</span> <span class="free">ys</span> <span class="main">⟹</span> set <span class="main">(</span>tl <span class="free">xs</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>tl <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil_tl prefix_bot.extremum prefix_def set_mono_prefix tl_append2<span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-suffix_tl_subset"><span class="command">lemma</span></span> suffix_tl_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"suffix <span class="free">xs</span> <span class="free">ys</span> <span class="main">⟹</span> set <span class="main">(</span>tl <span class="free">xs</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>tl <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil suffix_def set_mono_suffix suffix_tl suffix_order.order_trans tl_append2<span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-set_tl_append'"><span class="command">lemma</span></span> set_tl_append'<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>tl <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>tl <span class="free">xs</span><span class="main">)</span> <span class="main">∪</span> set <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> order_refl set_append set_mono_suffix suffix_tl tl_append2<span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-last_in_tl"><span class="command">lemma</span></span> last_in_tl<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> last <span class="free">xs</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def diff_Suc_Suc last_in_set last_tl length_tl less_numeral_extra<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> zero_less_diff<span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-concat_join"><span class="command">lemma</span></span> concat_join<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">ys</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> last <span class="free">xs</span> <span class="main">=</span> hd <span class="free">ys</span> <span class="main">⟹</span> butlast <span class="free">xs</span><span class="main">@</span><span class="free">ys</span> <span class="main">=</span> <span class="free">xs</span><span class="main">@</span>tl <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-fold_induct"><span class="command">lemma</span></span> fold_induct<span class="main">[</span><span class="operator">case_names</span> Nil Cons<span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">s</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>fold <span class="free">f</span> <span class="free">xs</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fold_invariant <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span> <span class="main"><span class="main"><span class="main">∈</span></span></span> set <span class="free"><span class="free"><span class="free">xs</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1" id="FormalSSA_Misc-fold_union_elem"><span class="command">lemma</span></span> fold_union_elem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> fold <span class="main">(∪)</span> <span class="free">xss</span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ys</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">ys</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">∈</span> set <span class="free">xss</span> <span class="main">∪</span> <span class="main">{</span><span class="free">xs</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>fold_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="FormalSSA_Misc-fold_union_elemI"><span class="command">lemma</span></span> fold_union_elemI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">ys</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">∈</span> set <span class="free">xss</span> <span class="main">∪</span> <span class="main">{</span><span class="free">xs</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> fold <span class="main">(∪)</span> <span class="free">xss</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sup_empty Sup_insert Sup_set_fold Un_insert_right UnionI ccpo_Sup_singleton fold_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-fold_union_elemI'"><span class="command">lemma</span></span> fold_union_elemI'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">xs</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">xs</span> <span class="main">∈</span> set <span class="free">xss</span><span class="main">.</span> <span class="free">x</span> <span class="main">∈</span> <span class="bound">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> fold <span class="main">(∪)</span> <span class="free">xss</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">using</span></span> fold_union_elemI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="FormalSSA_Misc-fold_union_finite"><span class="command">lemma</span></span> fold_union_finite<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span> <span class="main">∈</span> set <span class="free">xss</span><span class="main">.</span> finite <span class="bound">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>fold <span class="main">(∪)</span> <span class="free">xss</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> fold_invariant<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-in_set_zip_map"><span class="command">lemma</span></span> in_set_zip_map<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="free">xs</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">y'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">y'</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> map <span class="free">f</span> <span class="free">ys</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>set_zip<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">ys</span></span></span> <span class="main"><span class="main"><span class="main">!</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">i</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>set_zip<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FormalSSA_Misc-dom_comp_subset"><span class="command">lemma</span></span> dom_comp_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">`</span> dom <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊆</span> dom <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dom_def<span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-finite_dom_comp"><span class="command">lemma</span></span> finite_dom_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>dom <span class="free">f</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">g</span> <span class="main">(</span>dom <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>dom <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageD<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">`</span> dom <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊆</span> dom <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">g</span> <span class="main">`</span> dom <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-the1_list"><span class="command">lemma</span></span> the1_list<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> set <span class="free">xs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span>filter <span class="free">P</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">xs</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="bound">xs</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> Cons.prems <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> hd <span class="main">(</span>filter <span class="free">P</span> <span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">y</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> Cons.prems x <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="skolem">xs</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="skolem">xs</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x False <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> the1_equality<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="skolem">xs</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span>filter <span class="free">P</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.IH<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False x Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> the1_equality<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Cons.prems<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="FormalSSA_Misc-set_zip_leftI"><span class="command">lemma</span></span> set_zip_leftI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> set <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">xs</span></span></span> <span class="main"><span class="main"><span class="main">!</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">i</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>set_zip<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FormalSSA_Misc-butlast_idx"><span class="command">lemma</span></span> butlast_idx<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">i</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">atomize_elim</span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">y</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons.prems <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>True<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> Cons.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Cons.IH<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">xs</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem"><span class="skolem">i</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="FormalSSA_Misc-butlast_idx'"><span class="command">lemma</span></span> butlast_idx'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">with</span></span> Cons.prems<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> Cons.prems<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> Cons.IH<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="FormalSSA_Misc-card_eq_1_singleton"><span class="command">lemma</span></span> card_eq_1_singleton<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">drule</span> card_eq_SucD<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-set_take_two"><span class="command">lemma</span></span> set_take_two<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="free">y</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_iff_add<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> card_eq_SucD<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> insert <span class="skolem">x</span> <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">B</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> card_eq_SucD<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> x y <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">y</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FormalSSA_Misc-singleton_list_hd_last"><span class="command">lemma</span></span> singleton_list_hd_last<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> hd <span class="free">xs</span> <span class="main">=</span> last <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def impossible_Cons last.simps length_0_conv less_nat_zero_code list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> nat_less_le neq_Nil_conv not_less_eq_eq<span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-distinct_hd_tl"><span class="command">lemma</span></span> distinct_hd_tl<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span> <span class="main">⟹</span> hd <span class="free">xs</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distinct.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hd_Cons_tl in_set_member list.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> member_rec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-set_mono_strict_prefix"><span class="command">lemma</span></span> set_mono_strict_prefix<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_prefix <span class="free">xs</span> <span class="free">ys</span> <span class="main">⟹</span> set <span class="free">xs</span> <span class="main">⊆</span> set <span class="main">(</span>butlast <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_butlast_last_id strict_prefixE strict_prefix_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prefix_snoc set_mono_prefix<span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-set_butlast_distinct"><span class="command">lemma</span></span> set_butlast_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span> <span class="main">⟹</span> set <span class="main">(</span>butlast <span class="free">xs</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{</span>last <span class="free">xs</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_butlast_last_id butlast.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> distinct_append inf_bot_right inf_commute list.set<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-disjoint_elem"><span class="command">lemma</span></span> disjoint_elem<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="FormalSSA_Misc-prefix_butlastD"><span class="command">lemma</span></span> prefix_butlastD<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"prefix <span class="free">xs</span> <span class="main">(</span>butlast <span class="free">ys</span><span class="main">)</span> <span class="main">⟹</span> prefix <span class="free">xs</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> strict_prefix_butlast <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="FormalSSA_Misc-butlast_prefix"><span class="command">lemma</span></span> butlast_prefix<span class="main">:</span> <span class="quoted"><span class="quoted">"prefix <span class="free">xs</span> <span class="free">ys</span> <span class="main">⟹</span> prefix <span class="main">(</span>butlast <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>butlast <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-hd_in_butlast"><span class="command">lemma</span></span> hd_in_butlast<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> hd <span class="free">xs</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> butlast.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> dual_order.strict_iff_order hd_Cons_tl hd_in_set length_greater_0_conv length_tl less_le_trans list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> neq0_conv zero_less_diff<span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-nonsimple_length_gt_1"><span class="command">lemma</span></span> nonsimple_length_gt_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> hd <span class="free">xs</span> <span class="main">≠</span> last <span class="free">xs</span> <span class="main">⟹</span> length <span class="free">xs</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_0_conv less_one nat_neq_iff singleton_list_hd_last<span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-set_hd_tl"><span class="command">lemma</span></span> set_hd_tl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> set <span class="main">[</span>hd <span class="free">xs</span><span class="main">]</span> <span class="main">∪</span> set <span class="main">(</span>tl <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_sup_aci<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> rotate1_hd_tl set_append set_rotate1<span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-fold_update_conv"><span class="command">lemma</span></span> fold_update_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fold <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span><span class="main">(</span><span class="bound">n</span> <span class="main">↦</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span> <span class="free">m</span> <span class="free">x</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span><span class="main">)</span> <span class="keyword1">then</span> Some <span class="main">(</span><span class="free">g</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">m</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> removeAll_le <span class="main">=</span> length_removeAll_less_eq

<span class="keyword1"><span class="command">lemmas</span></span> removeAll_less <span class="main">[</span><span class="operator">intro</span><span class="main">]</span> <span class="main">=</span> length_removeAll_less

<span class="keyword1" id="FormalSSA_Misc-removeAll_induct"><span class="command">lemma</span></span> removeAll_induct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">xs</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="bound">xs</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>removeAll <span class="bound">x</span> <span class="bound">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>length_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> assms<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="FormalSSA_Misc-The_Min"><span class="command">lemma</span></span> The_Min<span class="main">:</span> <span class="quoted"><span class="quoted">"Ex1 <span class="free">P</span> <span class="main">⟹</span> The <span class="free">P</span> <span class="main">=</span> Min <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Min.infinite Min_in Min_singleton all_not_in_conv finite_subset insert_iff mem_Collect_eq subsetI<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>erased<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Least_Min Least_equality Set.set_insert ex_in_conv finite.emptyI finite_insert insert_iff mem_Collect_eq order_refl<span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-The_Max"><span class="command">lemma</span></span> The_Max<span class="main">:</span> <span class="quoted"><span class="quoted">"Ex1 <span class="free">P</span> <span class="main">⟹</span> The <span class="free">P</span> <span class="main">=</span> Max <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Max.infinite Max_in Max_singleton all_not_in_conv finite_subset insert_iff mem_Collect_eq subsetI<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Max_singleton Min_singleton Nitpick.Ex1_unfold The_Min the_equality<span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-set_sorted_list_of_set_remove"><span class="command">lemma</span></span> set_sorted_list_of_set_remove <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"set <span class="main">(</span>sorted_list_of_set <span class="main">(</span>Set.remove <span class="free">x</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Set.remove <span class="free">x</span> <span class="main">(</span>set <span class="main">(</span>sorted_list_of_set <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Set.remove_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-set_minus_one"><span class="command">lemma</span></span> set_minus_one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">v</span> <span class="main">≠</span> <span class="free">v'</span><span class="main">;</span> <span class="free">v'</span> <span class="main">∈</span> set <span class="free">vs</span><span class="main">⟧</span> <span class="main">⟹</span> set <span class="free">vs</span> <span class="main">-</span> <span class="main">{</span><span class="free">v'</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span> <span class="main">⟷</span> set <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">v'</span><span class="main">}</span> <span class="main">∨</span> set <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="FormalSSA_Misc-set_single_hd"><span class="command">lemma</span></span> set_single_hd<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span> <span class="main">⟹</span> hd <span class="free">vs</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">vs</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="FormalSSA_Misc-set_double_filter_hd"><span class="command">lemma</span></span> set_double_filter_hd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> set <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span><span class="main">;</span> <span class="free">v</span> <span class="main">≠</span> <span class="free">v'</span> <span class="main">⟧</span> <span class="main">⟹</span> hd <span class="main">[</span><span class="bound">v'</span><span class="main">←</span><span class="free">vs</span> <span class="main">.</span> <span class="bound">v'</span> <span class="main">≠</span> <span class="free">v</span><span class="main">]</span> <span class="main">=</span> <span class="free">v'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">vs</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="improper">vs</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"set <span class="improper">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">v'</span><span class="main">}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_single_hd<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="FormalSSA_Misc-map_option_the"><span class="command">lemma</span></span> map_option_the<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> map_option <span class="free">f</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≠</span> None <span class="main">⟹</span> the <span class="free">x</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>the <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_option_case <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split prod.splits<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Serial_Rel">
<div class="head">
<h1>Theory Serial_Rel</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Serial_Rel.thy
    Author:     Sebastian Ullrich
*)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Serial Relations"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A serial relation on a finite carrier induces a cycle.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Serial_Rel
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">serial_on</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> serial_onI <span class="main">=</span> serial_on_def<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> serial_onE <span class="main">=</span> serial_on_def<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">THEN</span> bexE<span class="main">]</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">iterated_serial_on</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">iterated_serial_on</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">iterated_serial_on</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="free">iterated_serial_on</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Serial_Rel-iterated_serial_on_linear"><span class="command">lemma</span></span> iterated_serial_on_linear<span class="main">:</span> <span class="quoted"><span class="quoted">"iterated_serial_on <span class="free">A</span> <span class="free">r</span> <span class="free">x</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">m</span><span class="main">)</span> <span class="main">=</span> iterated_serial_on <span class="free">A</span> <span class="free">r</span> <span class="main">(</span>iterated_serial_on <span class="free">A</span> <span class="free">r</span> <span class="free">x</span> <span class="free">n</span><span class="main">)</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Serial_Rel-iterated_serial_on_in_A"><span class="command">lemma</span></span> iterated_serial_on_in_A<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"serial_on <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"iterated_serial_on <span class="free">A</span> <span class="free">r</span> <span class="free">a</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> iterated_serial_on.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> someI2_ex<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> serial_onE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Serial_Rel-iterated_serial_on_in_power"><span class="command">lemma</span></span> iterated_serial_on_in_power<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"serial_on <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span>iterated_serial_on <span class="free">A</span> <span class="free">r</span> <span class="free">a</span> <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">^^</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>iterated_serial_on <span class="free">A</span> <span class="free">r</span> <span class="free">a</span> <span class="skolem">n</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> iterated_serial_on_in_A<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> serial_onE<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> iterated_serial_on.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> someI2_ex<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Serial_Rel-trancl_powerI"><span class="command">lemma</span></span> trancl_powerI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">^^</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>trancl_power<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> serial_on_finite_cycle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"serial_on <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">a</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"iterated_serial_on <span class="free">A</span> <span class="free">r</span> <span class="skolem">a</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range <span class="var">?f</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> iterated_serial_on_in_A<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">∈</span>UNIV<span class="main">.</span><span class="main">¬</span> finite <span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> UNIV<span class="main">.</span> <span class="var">?f</span> <span class="bound">n</span> <span class="main">=</span> <span class="var">?f</span> <span class="bound">m</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> pigeonhole_infinite<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">m</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> finite_nat_set_iff_bounded mem_Collect_eq not_less_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">n</span> <span class="main">=</span> iterated_serial_on <span class="free">A</span> <span class="free">r</span> <span class="main">(</span><span class="var">?f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">m</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> iterated_serial_on_linear<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">-</span><span class="skolem">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>less_imp_le_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?f</span> <span class="skolem">n</span><span class="main">,</span>iterated_serial_on <span class="free">A</span> <span class="free">r</span> <span class="main">(</span><span class="var">?f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">m</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">^^</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iterated_serial_on_in_power<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> iterated_serial_on_in_A<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> a<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var"><span class="var">?f</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">n</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> iterated_serial_on_in_A<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> a<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> trancl_powerI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Mapping_Exts">
<div class="head">
<h1>Theory Mapping_Exts</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Mapping_Exts.thy
    Author:     Denis Lohner, Sebastian Ullrich
*)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Mapping Extensions"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some lifted definition on mapping and efficient implementations.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Mapping_Exts
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Mapping.html">HOL-Library.Mapping</a>"</span> <a href="#FormalSSA_Misc">FormalSSA_Misc</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> mapping_delete_all <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> mapping <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> mapping"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">P</span> <span class="bound">m</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span><span class="bound">P</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">then</span> None <span class="keyword1">else</span> <span class="bound">m</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> map_keys <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'c</span><span class="main">)</span> mapping <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'c</span><span class="main">)</span> mapping"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">m</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">f</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="bound">m</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">k</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">else</span> None"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> map_values <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span> option<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> mapping <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'c</span><span class="main">)</span> mapping"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">m</span> <span class="bound">x</span><span class="main">.</span> Option.bind <span class="main">(</span><span class="bound">m</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> restrict_mapping <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> mapping"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span><span class="main">.</span> restrict_map <span class="main">(</span>Some <span class="main">∘</span> <span class="bound">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> mapping_add <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> mapping <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> mapping <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> mapping"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(++)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">mmap</span> <span class="main">=</span> Mapping.map id"</span></span>

<span class="keyword1" id="Mapping_Exts-lookup_map_keys"><span class="command">lemma</span></span> lookup_map_keys<span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span>map_keys <span class="free">f</span> <span class="free">m</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">f</span> <span class="main">-`</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span> <span class="keyword1">then</span> Mapping.lookup <span class="free">m</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="main">-`</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">k</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Mapping_Exts-Mapping_Mapping_lookup"><span class="command">lemma</span></span> Mapping_Mapping_lookup <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.Mapping <span class="main">(</span>Mapping.lookup <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">declare</span></span> Mapping.lookup.abs_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1" id="Mapping_Exts-Mapping_eq_lookup"><span class="command">lemma</span></span> Mapping_eq_lookup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="free">m'</span> <span class="main">⟷</span> Mapping.lookup <span class="free">m</span> <span class="main">=</span> Mapping.lookup <span class="free">m'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1" id="Mapping_Exts-map_of_map_if_conv"><span class="command">lemma</span></span> map_of_map_if_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span><span class="main">)</span> <span class="keyword1">then</span> Some <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_of_map_restrict<span class="main">)</span>

<span class="keyword1" id="Mapping_Exts-Mapping_lookup_map"><span class="command">lemma</span></span> Mapping_lookup_map<span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span>Mapping.map <span class="free">f</span> <span class="free">g</span> <span class="free">m</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> map_option <span class="free">g</span> <span class="main">(</span>Mapping.lookup <span class="free">m</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1" id="Mapping_Exts-Mapping_lookup_map_default"><span class="command">lemma</span></span> Mapping_lookup_map_default<span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span>Mapping.map_default <span class="free">k</span> <span class="free">d</span> <span class="free">f</span> <span class="free">m</span><span class="main">)</span> <span class="free">k'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">k</span> <span class="main">=</span> <span class="free">k'</span>
  <span class="keyword1">then</span> <span class="main">(</span>Some <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">case</span> Mapping.lookup <span class="free">m</span> <span class="free">k</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="free">d</span> <span class="main">|</span> Some <span class="bound">x</span> <span class="main">⇒</span> <span class="bound">x</span><span class="main">)</span>
  <span class="keyword1">else</span> Mapping.lookup <span class="free">m</span> <span class="free">k'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Mapping.map_default_def Mapping.default_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Mapping_Exts-Mapping_lookup_mapping_add"><span class="command">lemma</span></span> Mapping_lookup_mapping_add<span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span>mapping_add <span class="free">m1</span> <span class="free">m2</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span>
  case_option <span class="main">(</span>Mapping.lookup <span class="free">m1</span> <span class="free">k</span><span class="main">)</span> Some <span class="main">(</span>Mapping.lookup <span class="free">m2</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_add_def<span class="main">)</span>

<span class="keyword1" id="Mapping_Exts-Mapping_lookup_map_values"><span class="command">lemma</span></span> Mapping_lookup_map_values<span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span>map_values <span class="free">f</span> <span class="free">m</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span>
  Option.bind <span class="main">(</span>Mapping.lookup <span class="free">m</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1" id="Mapping_Exts-lookup_fold_update"><span class="command">lemma</span></span> lookup_fold_update <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span>fold <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Mapping.update <span class="bound">n</span> <span class="main">(</span><span class="free">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span> <span class="free">m</span><span class="main">)</span> <span class="free">x</span>
  <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span><span class="main">)</span> <span class="keyword1">then</span> Some <span class="main">(</span><span class="free">g</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">else</span> Mapping.lookup <span class="free">m</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">rule</span> fold_update_conv<span class="main">)</span>

<span class="keyword1" id="Mapping_Exts-mapping_eq_iff"><span class="command">lemma</span></span> mapping_eq_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="main">=</span> <span class="free">m2</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> Mapping.lookup <span class="free">m1</span> <span class="bound">k</span> <span class="main">=</span> Mapping.lookup <span class="free">m2</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Mapping_Exts-lookup_delete"><span class="command">lemma</span></span> lookup_delete<span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span>Mapping.delete <span class="free">k</span> <span class="free">m</span><span class="main">)</span> <span class="free">k'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">k</span> <span class="main">=</span> <span class="free">k'</span> <span class="keyword1">then</span> None <span class="keyword1">else</span> Mapping.lookup <span class="free">m</span> <span class="free">k'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Mapping_Exts-keys_map_values"><span class="command">lemma</span></span> keys_map_values<span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.keys <span class="main">(</span>map_values <span class="free">f</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> Mapping.keys <span class="free">m</span> <span class="main">-</span> <span class="main">{</span><span class="bound"><span class="bound">k</span></span><span class="main">∈</span>Mapping.keys <span class="free">m</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">(</span>the <span class="main">(</span>Mapping.lookup <span class="free">m</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bind_eq_Some_conv<span class="main">)</span>

<span class="keyword1" id="Mapping_Exts-map_default_eq"><span class="command">lemma</span></span> map_default_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.map_default <span class="free">k</span> <span class="free">v</span> <span class="free">f</span> <span class="free">m</span> <span class="main">=</span> <span class="free">m</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span> Mapping.lookup <span class="free">m</span> <span class="free">k</span> <span class="main">=</span> Some <span class="bound">v</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Mapping.map_default_def Mapping.default_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1" id="Mapping_Exts-lookup_update_cases"><span class="command">lemma</span></span> lookup_update_cases<span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span>Mapping.update <span class="free">k</span> <span class="free">v</span> <span class="free">m</span><span class="main">)</span> <span class="free">k'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">k</span><span class="main">=</span><span class="free">k'</span> <span class="keyword1">then</span> Some <span class="free">v</span> <span class="keyword1">else</span> Mapping.lookup <span class="free">m</span> <span class="free">k'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">=</span><span class="free">k'</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Mapping.lookup_update Mapping.lookup_update_neq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="RBT_Mapping_Exts">
<div class="head">
<h1>Theory RBT_Mapping_Exts</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      RBT_Mapping_Exts.thy
    Author:     Denis Lohner, Sebastian Ullrich
*)</span>

<span class="keyword1"><span class="command">theory</span></span> RBT_Mapping_Exts
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#Mapping_Exts">Mapping_Exts</a>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/RBT_Mapping.html">HOL-Library.RBT_Mapping</a>"</span>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/RBT_Set.html">HOL-Library.RBT_Set</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="RBT_Mapping_Exts-restrict_mapping_code"><span class="command">lemma</span></span> restrict_mapping_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"restrict_mapping <span class="free">f</span> <span class="main">(</span>RBT_Set.Set <span class="free">r</span><span class="main">)</span> <span class="main">=</span> RBT_Mapping.Mapping <span class="main">(</span>RBT.map <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> RBT_Set.Set_def restrict_map_def<span class="main">)</span>

<span class="keyword1" id="RBT_Mapping_Exts-map_keys_code"><span class="command">lemma</span></span> map_keys_code<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map_keys <span class="free">f</span> <span class="main">(</span>RBT_Mapping.Mapping <span class="free">t</span><span class="main">)</span> <span class="main">=</span> RBT.fold <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">v</span> <span class="bound">m</span><span class="main">.</span> Mapping.update <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">v</span> <span class="bound">m</span><span class="main">)</span> <span class="free">t</span> Mapping.empty"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="main">(</span>rev <span class="main">(</span>RBT.entries <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rev_map<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> distinct_rev<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> distinct_entries<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'c</span><span class="main">)</span> list"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">xs</span> <span class="main">⟹</span> Some <span class="skolem">v</span> <span class="main">=</span> foldr <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">↦</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="skolem">xs</span> Map.empty <span class="main">(</span><span class="free">f</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∉</span> fst <span class="main">`</span> set <span class="skolem">xs</span> <span class="main">⟹</span> None <span class="main">=</span> foldr <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">↦</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="skolem">xs</span> Map.empty <span class="main">(</span><span class="free">f</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free">f</span> <span class="main">`</span> UNIV <span class="main">⟹</span> None <span class="main">=</span> foldr <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">↦</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="skolem">xs</span> Map.empty <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> injD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> a <span class="main">=</span> this<span class="main">[</span><span class="operator">unfolded</span> foldr_conv_fold<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> xs3<span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"rev <span class="main"><span class="main"><span class="main">_</span></span></span>"</span></span></span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> RBT.fold_fold
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vimage_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"RBT.lookup <span class="free">t</span> <span class="improper">x</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_in_tree<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> a<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> lookup_in_tree<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> a<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> a<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RBT_Mapping_Exts-map_values_code"><span class="command">lemma</span></span> map_values_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_values <span class="free">f</span> <span class="main">(</span>RBT_Mapping.Mapping <span class="free">t</span><span class="main">)</span> <span class="main">=</span> RBT.fold <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">v</span> <span class="bound">m</span><span class="main">.</span> <span class="keyword1">case</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="bound">v</span><span class="main">)</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="bound">m</span> <span class="main">|</span> Some <span class="bound">v'</span> <span class="main">⇒</span> Mapping.update <span class="bound">x</span> <span class="bound">v'</span> <span class="bound">m</span><span class="main">)</span> <span class="free">t</span> Mapping.empty"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">m</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="main">(</span><span class="skolem">xs</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'c</span><span class="main">)</span> list<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fold <span class="main">(</span><span class="main">λ</span><span class="bound">p</span> <span class="bound">m</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free">f</span> <span class="main">(</span>fst <span class="bound">p</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">p</span><span class="main">)</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="bound">m</span> <span class="main">|</span> Some <span class="bound">v'</span> <span class="main">⇒</span> <span class="bound">m</span><span class="main">(</span>fst <span class="bound">p</span> <span class="main">↦</span> <span class="bound">v'</span><span class="main">)</span><span class="main">)</span> <span class="skolem">xs</span> <span class="skolem">m</span>
       <span class="main">=</span> <span class="skolem">m</span> <span class="main">++</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Option.bind <span class="main">(</span>map_of <span class="skolem">xs</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_image_eqI <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> bind_split option.splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_add_def fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> bind_map_of_fold <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> RBT.fold_fold
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bind_map_of_fold <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"RBT.entries <span class="free"><span class="free">t</span></span>"</span></span></span> <span class="quoted"><span class="quoted">Map.empty</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> RBT.distinct_entries distinct_map <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>RBT.keys <span class="free">t</span><span class="main">)</span> <span class="main">=</span> RBT_Set.Set <span class="main">(</span>RBT.map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">()</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> RBT_Set.Set_def RBT.keys_def_alt RBT.lookup_in_tree <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rev_image_eqI<span class="main">)</span>

<span class="keyword1" id="RBT_Mapping_Exts-mmap_rbt_code"><span class="command">lemma</span></span> mmap_rbt_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mmap <span class="free">f</span> <span class="main">(</span>RBT_Mapping.Mapping <span class="free">t</span><span class="main">)</span> <span class="main">=</span> RBT_Mapping.Mapping <span class="main">(</span>RBT.map <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">f</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mmap_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="RBT_Mapping_Exts-mapping_add_code"><span class="command">lemma</span></span> mapping_add_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mapping_add <span class="main">(</span>RBT_Mapping.Mapping <span class="free">t1</span><span class="main">)</span> <span class="main">(</span>RBT_Mapping.Mapping <span class="free">t2</span><span class="main">)</span> <span class="main">=</span> RBT_Mapping.Mapping <span class="main">(</span>RBT.union <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_union<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Graph_path">
<div class="head">
<h1>Theory Graph_path</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Graph_path.thy
    Author:     Sebastian Ullrich
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹SSA Representation›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Inductive Graph Paths›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We extend the Graph framework with inductively defined paths.
  We adopt the convention of separating locale definitions into assumption-less base locales.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Graph_path <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#FormalSSA_Misc">FormalSSA_Misc</a>
  <a href="../../dijkstra_shortest_path/theories/#GraphSpec">Dijkstra_Shortest_Path.GraphSpec</a>
  <a href="../../cava_automata/theories/#Digraph_Basic">CAVA_Automata.Digraph_Basic</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> <span class="quoted">"Omega_Words_Fun.prefix"</span> <span class="quoted">"Omega_Words_Fun.suffix"</span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'n</span><span class="main">,</span> <span class="tfree">'ed</span><span class="main">)</span> edge <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'n</span> <span class="main">×</span> <span class="tfree">'ed</span> <span class="main">×</span> <span class="tfree">'n</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">getFrom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'n</span><span class="main">,</span> <span class="tfree">'ed</span><span class="main">)</span> edge <span class="main">⇒</span> <span class="tfree">'n</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">getFrom</span> <span class="main">≡</span> fst"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">getData</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'n</span><span class="main">,</span> <span class="tfree">'ed</span><span class="main">)</span> edge <span class="main">⇒</span> <span class="tfree">'ed</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">getData</span> <span class="main">≡</span> fst <span class="main">∘</span> snd"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">getTo</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'n</span><span class="main">,</span> <span class="tfree">'ed</span><span class="main">)</span> edge <span class="main">⇒</span> <span class="tfree">'n</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">getTo</span> <span class="main">≡</span> snd <span class="main">∘</span> snd"</span></span>

<span class="keyword1" id="Graph_path-get_edge_simps"><span class="command">lemma</span></span> get_edge_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"getFrom <span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="quoted"><span class="quoted">"getData <span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
  <span class="quoted"><span class="quoted">"getTo <span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> getFrom_def getData_def getTo_def<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Predecessors of a node.›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">pred</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> graph <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">×</span><span class="tfree">'w</span><span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pred</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">v'</span><span class="main">,</span><span class="bound">w</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">∈</span>edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">}</span>"</span></span>

  <span class="keyword1" id="Graph_path-pred_finite"><span class="command">lemma</span></span> pred_finite<span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> finite <span class="main">(</span>pred <span class="free">G</span> <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pred_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> B<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">v</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span><span class="main">`</span>edges <span class="free">G</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1" id="Graph_path-pred_empty"><span class="command">lemma</span></span> pred_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pred empty <span class="free">v</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> empty_def pred_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> valid_graph<span class="main">)</span> pred_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"pred <span class="free">G</span> <span class="free">v</span> <span class="main">⊆</span> V<span class="main">×</span>UNIV"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pred_def <span class="keyword1"><span class="command">using</span></span> E_valid
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span><span class="main">)</span>

  <span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'V</span><span class="main">,</span><span class="tfree">'W</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">,</span><span class="tfree">'G</span><span class="main">)</span> graph_pred_it <span class="main">=</span>
    <span class="quoted"><span class="quoted">"<span class="tfree">'G</span> <span class="main">⇒</span> <span class="tfree">'V</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'V</span><span class="main">×</span><span class="tfree">'W</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> set_iterator"</span></span>

  <span class="keyword1"><span class="command">locale</span></span> graph_pred_it_defs <span class="main">=</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">pred_list_it</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'G</span> <span class="main">⇒</span> <span class="tfree">'V</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'V</span><span class="main">×</span><span class="tfree">'W</span><span class="main">,</span><span class="main">(</span><span class="tfree">'V</span><span class="main">×</span><span class="tfree">'W</span><span class="main">)</span> list<span class="main">)</span> set_iterator"</span></span>
  <span class="keyword2"><span class="keyword">begin</span></span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">pred_it</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> it_to_it <span class="main">(</span><span class="free">pred_list_it</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">end</span></span>

  <span class="keyword1"><span class="command">locale</span></span> graph_pred_it <span class="main">=</span> graph <span class="quoted"><span class="free">α</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="main">+</span> graph_pred_it_defs <span class="quoted"><span class="free">pred_list_it</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="free">α</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'G</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'V</span><span class="main">,</span><span class="tfree">'W</span><span class="main">)</span> graph"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">invar</span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">pred_list_it</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'G</span> <span class="main">⇒</span> <span class="tfree">'V</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'V</span><span class="main">×</span><span class="tfree">'W</span><span class="main">,</span><span class="main">(</span><span class="tfree">'V</span><span class="main">×</span><span class="tfree">'W</span><span class="main">)</span> list<span class="main">)</span> set_iterator"</span></span> <span class="main">+</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> pred_list_it_correct<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span> <span class="main">⟹</span> set_iterator <span class="main">(</span><span class="free">pred_list_it</span> <span class="free">g</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>pred <span class="main">(</span><span class="free">α</span> <span class="free">g</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">begin</span></span>
    <span class="keyword1" id="Graph_path-pred_it_correct"><span class="command">lemma</span></span> pred_it_correct<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span> <span class="main">⟹</span> set_iterator <span class="main">(</span>pred_it <span class="free">g</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>pred <span class="main">(</span><span class="free">α</span> <span class="free">g</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> pred_it_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> it_to_it_correct<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pred_list_it_correct<span class="main">)</span>

    <span class="keyword1" id="Graph_path-pi_pred_it"><span class="command">lemma</span></span> pi_pred_it<span class="main">[</span><span class="operator">icf_proper_iteratorI</span><span class="main">]</span><span class="main">:</span>
      <span class="quoted"><span class="quoted">"proper_it <span class="main">(</span>pred_it <span class="free">S</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>pred_it <span class="free">S</span> <span class="free">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> pred_it_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">icf_proper_iteratorI</span></span><span class="main">)</span>

    <span class="keyword1" id="Graph_path-pred_it_proper"><span class="command">lemma</span></span> pred_it_proper<span class="main">[</span><span class="operator">proper_it</span><span class="main">]</span><span class="main">:</span>
      <span class="quoted"><span class="quoted">"proper_it' <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> pred_it <span class="bound">S</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> pred_it <span class="bound">S</span> <span class="free">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> proper_it'I<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pi_pred_it<span class="main">)</span>
  <span class="keyword2"><span class="keyword">end</span></span>

  <span class="keyword1"><span class="command">record</span></span> <span class="main">(</span><span class="tfree">'V</span><span class="main">,</span><span class="tfree">'W</span><span class="main">,</span><span class="tfree">'G</span><span class="main">)</span> graph_ops <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'V</span><span class="main">,</span><span class="tfree">'W</span><span class="main">,</span><span class="tfree">'G</span><span class="main">)</span> GraphSpec.graph_ops"</span></span> <span class="main">+</span>
    gop_pred_list_it <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'G</span> <span class="main">⇒</span> <span class="tfree">'V</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'V</span><span class="main">×</span><span class="tfree">'W</span><span class="main">,</span><span class="main">(</span><span class="tfree">'V</span><span class="main">×</span><span class="tfree">'W</span><span class="main">)</span> list<span class="main">)</span> set_iterator"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> graph_pred_it<span class="main">)</span> pred_it_is_iterator<span class="main">[</span><span class="operator">refine_transfer</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span> <span class="main">⟹</span> set_iterator <span class="main">(</span>pred_it <span class="free">g</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>pred <span class="main">(</span><span class="free">α</span> <span class="free">g</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pred_it_correct<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> StdGraphDefs <span class="main">=</span> GraphSpec.StdGraphDefs <span class="quoted"><span class="free">ops</span></span>
  <span class="main">+</span> graph_pred_it_defs <span class="quoted"><span class="quoted">"gop_pred_list_it <span class="free">ops</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">ops</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'V</span><span class="main">,</span><span class="tfree">'W</span><span class="main">,</span><span class="tfree">'G</span><span class="main">,</span><span class="tfree">'m</span><span class="main">)</span> graph_ops_scheme"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">pred_list_it</span>  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pred_list_it</span> <span class="main">≡</span> gop_pred_list_it <span class="free">ops</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> StdGraph <span class="main">=</span> StdGraphDefs <span class="main">+</span> org<span class="main">:</span>StdGraph <span class="main">+</span>
  graph_pred_it <span class="quoted">α</span> <span class="quoted">invar</span> <span class="quoted">pred_list_it</span>

<span class="keyword1"><span class="command">locale</span></span> graph_path_base <span class="main">=</span>
  graph_nodes_it_defs <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> foldri <span class="main">(</span><span class="free">αn</span> <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="main">+</span>
  graph_pred_it_defs <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span> <span class="bound">n</span><span class="main">.</span> foldri <span class="main">(</span><span class="free">inEdges'</span> <span class="bound">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*
  abbreviation αe :: "'g ⇒ ('node × 'edgeD × 'node) set"
  where "αe g ≡ graph.edges (α g)"
  definition αn :: "'g ⇒ 'node list"
  where "αn g ≡ nodes_it g (λ_. True) (#) []"
*)</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">inEdges</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">inEdges</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">d</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">inEdges'</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">predecessors</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">predecessors</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> map getFrom <span class="main">(</span>inEdges <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">successors</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">successors</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">≡</span> <span class="main">[</span><span class="bound">n</span> <span class="main">.</span> n <span class="main">←</span> <span class="free">αn</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">]</span>"</span></span>


  <span class="keyword1"><span class="command">declare</span></span> predecessors_def <span class="main">[</span><span class="operator">code</span><span class="main">]</span>

  <span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">inductive_internals</span><span class="main">]</span><span class="main">]</span>
  <span class="keyword1"><span class="command">inductive</span></span> <span class="entity">path</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">g</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'g</span></span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    empty_path<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">;</span> <span class="free">invar</span> <span class="free">g</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">path</span> <span class="free">g</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">]</span>"</span></span>
    <span class="main">|</span> Cons_path<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">path</span> <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="main">(</span>hd <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">path</span> <span class="free">g</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n'</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">path2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'node</span> list <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊢</span> _<span class="keyword1">-</span>_<span class="keyword1">→</span>_"</span> <span class="main">[</span>51<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>51<span class="main">]</span> 80<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">path2</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">≡</span> path <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> hd <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> last <span class="free"><span class="bound"><span class="entity">ns</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">⦇</span>nodes <span class="main">=</span> set <span class="main">(</span><span class="free">αn</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">αe</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">⦈</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> graph_path <span class="main">=</span>
  graph_path_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="main">+</span>
  graph <span class="quoted">α</span> <span class="quoted"><span class="free">invar</span></span> <span class="main">+</span>
  ni<span class="main">:</span> graph_nodes_it <span class="quoted">α</span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> foldri <span class="main">(</span><span class="free">αn</span> <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="main">+</span>
  pi<span class="main">:</span> graph_pred_it <span class="quoted">α</span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span> <span class="bound">n</span><span class="main">.</span> foldri <span class="main">(</span><span class="free">inEdges'</span> <span class="bound">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="Graph_path-αn_correct"><span class="command">lemma</span></span> αn_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span> <span class="main">⟹</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊇</span> getFrom <span class="main">`</span> <span class="free">αe</span> <span class="free">g</span> <span class="main">∪</span> getTo <span class="main">`</span> <span class="free">αe</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">frule</span> valid<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> valid_graph.E_validD<span class="main">)</span>

  <span class="keyword1" id="Graph_path-αn_distinct"><span class="command">lemma</span></span> αn_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span> <span class="main">⟹</span> distinct <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">frule</span> ni.nodes_list_it_correct<span class="main">)</span>
      <span class="main">(</span><span class="operator">metis</span> foldri_cons_id iterate_to_list_correct iterate_to_list_def<span class="main">)</span>

  <span class="keyword1" id="Graph_path-inEdges_correct'"><span class="command">lemma</span></span> inEdges_correct'<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>inEdges <span class="free">g</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">d</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>pred <span class="main">(</span>α <span class="free">g</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> iterate_to_list_correct <span class="main">[</span><span class="operator">OF</span> pi.pred_list_it_correct <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_image_eqI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iterate_to_list_def pred_def inEdges_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-inEdges_correct"><span class="command">lemma</span></span> inEdges_correct <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span> <span class="main">⟹</span> set <span class="main">(</span>inEdges <span class="free">g</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="main">∩</span> <span class="free">αe</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inEdges_correct' pred_def<span class="main">)</span>

  <span class="keyword1" id="Graph_path-in_set_αnI1"><span class="command">lemma</span></span> in_set_αnI1 <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">invar</span> <span class="free">g</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> getFrom <span class="main">`</span> <span class="free">αe</span> <span class="free">g</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> αn_correct <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1" id="Graph_path-in_set_αnI2"><span class="command">lemma</span></span> in_set_αnI2 <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">invar</span> <span class="free">g</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> getTo <span class="main">`</span> <span class="free">αe</span> <span class="free">g</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> αn_correct <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(*

locale graph_path_base = graph_inEdges_base αe invar inEdges + graph_nodes_base αe invar αn
for
  αe :: "'g ⇒ ('node × 'edgeD × 'node) set" and
  αn :: "'g ⇒ 'node list" and
  invar :: "'g ⇒ bool" and
  inEdges :: "'g ⇒ 'node ⇒ ('node × 'edgeD × 'node) list"
begin
*)</span>

<span class="comment1">(*
end

locale graph_path = graph_path_base αe αn invar inEdges + graph_inEdges αe invar inEdges + graph_nodes αe invar αn
for
  αe :: "'g ⇒ ('node × 'edgeD × 'node) set" and
  αn :: "'g ⇒ 'node list" and
  invar :: "'g ⇒ bool" and
  inEdges :: "'g ⇒ 'node ⇒ ('node × 'edgeD × 'node) list"
begin
*)</span>

  <span class="keyword1" id="Graph_path-edge_to_node"><span class="command">lemma</span></span> edge_to_node<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> <span class="free">αe</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"getFrom <span class="free">e</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"getTo <span class="free">e</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> αn_correct <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">invar</span> <span class="free">g</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> 4 3 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_image_eqI<span class="main">)</span>

  <span class="keyword1" id="Graph_path-inEdge_to_edge"><span class="command">lemma</span></span> inEdge_to_edge<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> set <span class="main">(</span>inEdges <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">eD</span> <span class="free">n'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="free">eD</span><span class="main">,</span><span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">αe</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="Graph_path-edge_to_inEdge"><span class="command">lemma</span></span> edge_to_inEdge<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">eD</span><span class="main">,</span><span class="free">m</span><span class="main">)</span> <span class="main">∈</span> <span class="free">αe</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">eD</span><span class="main">,</span><span class="free">m</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>inEdges <span class="free">g</span> <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="Graph_path-edge_to_predecessors"><span class="command">lemma</span></span> edge_to_predecessors<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">eD</span><span class="main">,</span><span class="free">m</span><span class="main">)</span> <span class="main">∈</span> <span class="free">αe</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">atomize_elim</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">eD</span><span class="main">,</span><span class="free">m</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>inEdges <span class="free">g</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> edge_to_inEdge<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> predecessors_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> get_edge_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> image_eqI set_map<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-predecessor_is_node"><span class="command">lemma</span></span> predecessor_is_node<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n'</span><span class="main">)</span><span class="main">;</span> <span class="free">invar</span> <span class="free">g</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> predecessors_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_image_eqI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> getTo_def getFrom_def<span class="main">)</span>

  <span class="keyword1" id="Graph_path-successor_is_node"><span class="command">lemma</span></span> successor_is_node<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n'</span><span class="main">)</span><span class="main">;</span> <span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">;</span> <span class="free">invar</span> <span class="free">g</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">n'</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> predecessors_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_image_eqI<span class="main">)</span>

  <span class="keyword1" id="Graph_path-successors_predecessors"><span class="command">lemma</span></span> successors_predecessors<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span>successors <span class="free">g</span> <span class="free">m</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>successors_def predecessors_def<span class="main">)</span>


  <span class="keyword1" id="Graph_path-path_not_Nil"><span class="command">lemma</span></span> path_not_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="free">ns</span> <span class="main">⟹</span> <span class="free">ns</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> path.cases<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1" id="Graph_path-path2_not_Nil"><span class="command">lemma</span></span> path2_not_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span> <span class="main">⟹</span> <span class="free">ns</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="Graph_path-path2_not_Nil2"><span class="command">lemma</span></span> path2_not_Nil2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="main">[]</span><span class="main">→</span><span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="Graph_path-path2_not_Nil3"><span class="command">lemma</span></span> path2_not_Nil3<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span> <span class="main">⟹</span> length <span class="free">ns</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ns</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1" id="Graph_path-empty_path2"><span class="command">lemma</span></span> empty_path2<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">;</span> <span class="free">invar</span> <span class="free">g</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="main">[</span><span class="free">n</span><span class="main">]</span><span class="main">→</span><span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="Graph_path-Cons_path2"><span class="command">lemma</span></span> Cons_path2<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span><span class="main">;</span> <span class="free">n'</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">⊢</span> <span class="free">n'</span><span class="main">-</span><span class="free">n'</span><span class="main">#</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="Graph_path-path2_cases"><span class="command">lemma</span></span> path2_cases<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>empty_path<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">ns</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
          <span class="main">|</span> <span class="main">(</span>Cons_path<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> hd <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span><span class="main">-</span>tl <span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="main">(</span>hd <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">ns</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="free">ns</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> path2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>empty_path <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons_path <span class="skolem">ns</span> <span class="skolem">n'</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> path2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-path2_induct"><span class="command">lemma</span></span> path2_induct<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> empty_path Cons_path<span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">m</span> <span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ns</span> <span class="bound">n'</span> <span class="bound">n</span><span class="main">.</span> <span class="free">g</span> <span class="main">⊢</span> <span class="bound">n</span><span class="main">-</span><span class="bound">ns</span><span class="main">→</span><span class="free">m</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span> <span class="bound">ns</span> <span class="free">m</span> <span class="main">⟹</span> <span class="bound">n'</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n'</span> <span class="main">(</span><span class="bound">n'</span> <span class="main">#</span> <span class="bound">ns</span><span class="main">)</span> <span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">n</span> <span class="free">ns</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> path2_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>path.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty_path
    <span class="keyword1"><span class="command">with</span></span> empty <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons_path <span class="skolem">ns</span> <span class="skolem">n'</span> <span class="skolem">n''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span> <span class="main">=</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Cons_path Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-path_invar"><span class="command">lemma</span></span> path_invar<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="free">ns</span> <span class="main">⟹</span> <span class="free">invar</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>path.induct<span class="main">)</span>

  <span class="keyword1" id="Graph_path-path_in_αn"><span class="command">lemma</span></span> path_in_αn<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>path <span class="free">g</span> <span class="free">ns</span><span class="main">;</span> <span class="free">n</span> <span class="main">∈</span> set <span class="free">ns</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ns</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>path.induct<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1" id="Graph_path-path2_in_αn"><span class="command">lemma</span></span> path2_in_αn<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span><span class="main">;</span> <span class="free">l</span> <span class="main">∈</span> set <span class="free">ns</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">l</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="Graph_path-path2_hd_in_αn"><span class="command">lemma</span></span> path2_hd_in_αn<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="Graph_path-path2_tl_in_αn"><span class="command">lemma</span></span> path2_tl_in_αn<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="Graph_path-path2_forget_hd"><span class="command">lemma</span></span> path2_forget_hd<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">⊢</span> hd <span class="free">ns</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1" id="Graph_path-path2_forget_last"><span class="command">lemma</span></span> path2_forget_last<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span>last <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1" id="Graph_path-path_hd"><span class="command">lemma</span></span> path_hd<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="main">(</span><span class="free">n</span><span class="main">#</span><span class="free">ns</span><span class="main">)</span> <span class="main">⟹</span> path <span class="free">g</span> <span class="main">[</span><span class="free">n</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> empty_path<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>path.cases<span class="main">)</span>

  <span class="keyword1" id="Graph_path-path_by_tail"><span class="command">lemma</span></span> path_by_tail<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>path <span class="free">g</span> <span class="main">(</span><span class="free">n</span><span class="main">#</span><span class="free">n'</span><span class="main">#</span><span class="free">ns</span><span class="main">)</span><span class="main">;</span> path <span class="free">g</span> <span class="main">(</span><span class="free">n'</span><span class="main">#</span><span class="free">ns</span><span class="main">)</span> <span class="main">⟹</span> path <span class="free">g</span> <span class="main">(</span><span class="free">n'</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> path <span class="free">g</span> <span class="main">(</span><span class="free">n</span><span class="main">#</span><span class="free">n'</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> path.cases<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1" id="Graph_path-αn_in_αnE"><span class="command">lemma</span></span> αn_in_αnE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">m</span><span class="main">)</span> <span class="main">∈</span> <span class="free">αe</span> <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> edge_to_node<span class="main">)</span>

  <span class="keyword1" id="Graph_path-path_split"><span class="command">lemma</span></span> path_split<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="main">(</span><span class="free">ns</span><span class="main">@</span><span class="free">m</span><span class="main">#</span><span class="free">ns'</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="main">(</span><span class="free">ns</span><span class="main">@</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span><span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ns'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="main">(</span><span class="free">ns</span><span class="main">@</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ns</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">n</span> <span class="skolem">ns</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ns</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ns'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ns</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">n</span> <span class="skolem">ns</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>path.cases<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-path2_split"><span class="command">lemma</span></span> path2_split<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">@</span><span class="free">n'</span><span class="main">#</span><span class="free">ns'</span><span class="main">→</span><span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">@</span><span class="main">[</span><span class="free">n'</span><span class="main">]</span><span class="main">→</span><span class="free">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n'</span><span class="main">-</span><span class="free">n'</span><span class="main">#</span><span class="free">ns'</span><span class="main">→</span><span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>path_split <span class="quasi_keyword">iff</span><span class="main"><span class="main">:</span></span>hd_append<span class="main">)</span>

  <span class="keyword1" id="Graph_path-elem_set_implies_elem_tl_app_cons"><span class="command">lemma</span></span> elem_set_implies_elem_tl_app_cons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="main">(</span><span class="free">ys</span><span class="main">@</span><span class="free">y</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1" id="Graph_path-path2_split_ex"><span class="command">lemma</span></span> path2_split_ex<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">ns</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">ns<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">→</span><span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">x</span><span class="main">-</span><span class="free">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ns</span> <span class="main">=</span> <span class="free">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">@</span>tl <span class="free">ns<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ns</span> <span class="main">=</span> butlast <span class="free">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">@</span><span class="free">ns<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ns</span> <span class="main">=</span> <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">@</span><span class="free">x</span><span class="main">#</span><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">atomize_elim</span> <span class="main">(</span><span class="operator">rule</span> split_list<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">[</span><span class="operator">simplified</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>path2_split<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> path2_split<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> suffixI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-path2_split_ex'"><span class="command">lemma</span></span> path2_split_ex'<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">ns</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">ns<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">→</span><span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">x</span><span class="main">-</span><span class="free">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ns</span> <span class="main">=</span> butlast <span class="free">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">@</span><span class="free">ns<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> path2_split_ex<span class="main">)</span>

  <span class="keyword1" id="Graph_path-path_snoc"><span class="command">lemma</span></span> path_snoc<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="main">(</span><span class="free">ns</span><span class="main">@</span><span class="main">[</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="main">(</span><span class="free">ns</span><span class="main">@</span><span class="main">[</span><span class="free">n</span><span class="main">,</span><span class="free">m</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ns</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">l</span> <span class="skolem">ns</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="main">(</span><span class="skolem">ns</span> <span class="main">@</span> <span class="main">[</span><span class="free">n</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">l</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="main">(</span>hd <span class="main">(</span><span class="skolem">ns</span><span class="main">@</span><span class="main">[</span><span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l</span> <span class="main">#</span> <span class="skolem">ns</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">n</span><span class="main">]</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>path.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="main">(</span><span class="skolem">ns</span> <span class="main">@</span> <span class="main">[</span><span class="free">n</span><span class="main">,</span><span class="free">m</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>Cons.IH<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">#</span> <span class="skolem">ns</span> <span class="main">@</span> <span class="main">[</span><span class="free">n</span><span class="main">,</span><span class="free">m</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> Cons_path<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">ns</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-path2_snoc"><span class="command">lemma</span></span> path2_snoc<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">m'</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">@</span><span class="main">[</span><span class="free">m'</span><span class="main">]</span><span class="main">→</span><span class="free">m'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ns</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="main">(</span><span class="main">(</span>butlast <span class="free">ns</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>last <span class="free">ns</span><span class="main">,</span> <span class="free">m'</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> path_snoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="main">(</span><span class="main">(</span>butlast <span class="free">ns</span> <span class="main">@</span> <span class="main">[</span>last <span class="free">ns</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">m'</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="main">(</span><span class="free">ns</span> <span class="main">@</span> <span class="main">[</span><span class="free">m'</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-path_unsnoc"><span class="command">lemma</span></span> path_unsnoc<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ns</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="main">(</span>butlast <span class="free">ns</span><span class="main">)</span> <span class="main">∧</span> last <span class="main">(</span>butlast <span class="free">ns</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="main">(</span>last <span class="free">ns</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">atomize_elim</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induction</span> <span class="quoted"><span class="free">ns</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons_path <span class="skolem">ns</span> <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> length <span class="skolem">ns</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>butlast <span class="skolem">ns</span><span class="main">)</span> <span class="main">=</span> hd <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ns</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">#</span>butlast <span class="skolem">ns</span> <span class="main">=</span> butlast <span class="main">(</span><span class="skolem">n</span><span class="main">#</span><span class="skolem">ns</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="main">(</span>hd <span class="main">(</span>butlast <span class="skolem">ns</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="main">(</span>butlast <span class="skolem">ns</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="main">(</span><span class="skolem">n</span><span class="main">#</span>butlast <span class="skolem">ns</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">n</span><span class="main">#</span><span class="skolem">ns</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">from</span></span> Cons_path True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>butlast <span class="skolem">ns</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="main">(</span>last <span class="skolem">ns</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">n</span> <span class="main">#</span> <span class="skolem">ns</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="main">(</span>last <span class="main">(</span><span class="skolem">n</span> <span class="main">#</span> <span class="skolem">ns</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ns</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ns</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>path.cases<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">n'</span> <span class="skolem">ns'</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ns</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">n'</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ns'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="main">[</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">n'</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="Graph_path-path2_unsnoc"><span class="command">lemma</span></span> path2_unsnoc<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ns</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span>butlast <span class="free">ns</span><span class="main">→</span>last <span class="main">(</span>butlast <span class="free">ns</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>butlast <span class="free">ns</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_butlast_last_id hd_append2 path_not_Nil path_unsnoc<span class="main">)</span>

  <span class="keyword1" id="Graph_path-path2_rev_induct"><span class="command">lemma</span></span> path2_rev_induct<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> empty snoc<span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">n</span> <span class="main">[</span><span class="free">n</span><span class="main">]</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> snoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ns</span> <span class="bound">m'</span> <span class="bound">m</span><span class="main">.</span> <span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="bound">ns</span><span class="main">→</span><span class="bound">m'</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">n</span> <span class="bound">ns</span> <span class="bound">m'</span> <span class="main">⟹</span> <span class="bound">m'</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="bound">m</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">n</span> <span class="main">(</span><span class="bound">ns</span><span class="main">@</span><span class="main">[</span><span class="bound">m</span><span class="main">]</span><span class="main">)</span> <span class="bound">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">n</span> <span class="free">ns</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>length_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">ns</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ns</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ns</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">n'</span> <span class="skolem">ns'</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ns'</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ns'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> Cons 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> Cons <span class="quoted"><span class="quoted">‹<span class="skolem">ns'</span> <span class="main">=</span> <span class="main">[]</span>›</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>empty<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ns'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"butlast <span class="skolem">ns</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"last <span class="var">?ns'</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> last <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> True 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> ns'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="var">?ns'</span><span class="main">→</span><span class="var">?m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m'</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> path2_unsnoc<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> True <span class="quoted">"1.IH"</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">n</span> <span class="var">?ns'</span> <span class="var">?m'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> ns' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">n</span> <span class="main">(</span><span class="var">?ns'</span><span class="main">@</span><span class="main">[</span><span class="skolem">m</span><span class="main">]</span><span class="main">)</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> snoc<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> m 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-path2_hd"><span class="command">lemma</span></span> path2_hd<span class="main">[</span><span class="operator">elim</span><span class="main">,</span> <span class="operator">dest</span><span class="main"><span class="main"><span class="main">?</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">=</span> hd <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1" id="Graph_path-path2_hd_in_ns"><span class="command">lemma</span></span> path2_hd_in_ns<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> set <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="Graph_path-path2_last"><span class="command">lemma</span></span> path2_last<span class="main">[</span><span class="operator">elim</span><span class="main">,</span> <span class="operator">dest</span><span class="main"><span class="main"><span class="main">?</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">=</span> last <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1" id="Graph_path-path2_last_in_ns"><span class="command">lemma</span></span> path2_last_in_ns<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">∈</span> set <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="Graph_path-path_app"><span class="command">lemma</span></span> path_app<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="free">ms</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="free">ns</span> <span class="main">=</span> hd <span class="free">ms</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span> <span class="main">(</span><span class="free">ns</span><span class="main">@</span>tl <span class="free">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ns</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>path.induct<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1" id="Graph_path-path2_app"><span class="command">lemma</span></span> path2_app<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">m</span><span class="main">-</span><span class="free">ms</span><span class="main">→</span><span class="free">l</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">@</span>tl <span class="free">ms</span><span class="main">→</span><span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span><span class="free">ns</span> <span class="main">@</span> tl <span class="free">ms</span><span class="main">)</span> <span class="main">=</span> last <span class="free">ms</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> path2_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"tl <span class="free">ms</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">ms</span> <span class="main">=</span> <span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ms</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m'</span> <span class="skolem">ms'</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ms</span> <span class="main">=</span> hd <span class="free">ms</span><span class="main">#</span><span class="skolem">m'</span><span class="main">#</span><span class="skolem">ms'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-butlast_tl"><span class="command">lemma</span></span> butlast_tl<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"last <span class="free">xs</span> <span class="main">=</span> hd <span class="free">ys</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"butlast <span class="free">xs</span><span class="main">@</span><span class="free">ys</span> <span class="main">=</span> <span class="free">xs</span><span class="main">@</span>tl <span class="free">ys</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> append.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> append_assoc append_butlast_last_id assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list.collapse<span class="main">)</span>

  <span class="keyword1" id="Graph_path-path2_app'"><span class="command">lemma</span></span> path2_app'<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">m</span><span class="main">-</span><span class="free">ms</span><span class="main">→</span><span class="free">l</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span>butlast <span class="free">ns</span><span class="main">@</span><span class="free">ms</span><span class="main">→</span><span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"butlast <span class="free">ns</span><span class="main">@</span><span class="free">ms</span> <span class="main">=</span> <span class="free">ns</span><span class="main">@</span>tl <span class="free">ms</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> butlast_tl<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>path2_hd path2_last<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">@</span>tl <span class="free">ms</span><span class="main">→</span><span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> path2_app<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-path2_nontrivial"><span class="command">lemma</span></span> path2_nontrivial<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ns</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_1 le_antisym length_1_last_hd not_less_eq_eq path2_hd path2_last path2_not_Nil3<span class="main">)</span>

  <span class="keyword1" id="Graph_path-simple_path2_aux"><span class="command">lemma</span></span> simple_path2_aux<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns'</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">ns'</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ns'</span> <span class="main">⊆</span> set <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ns'</span> <span class="main">≤</span> length <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">atomize_elim</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>path2_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty_path
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons_path <span class="skolem">ns</span> <span class="skolem">n</span> <span class="skolem">n'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">n'</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">ns'</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ns'</span> <span class="main">⊆</span> set <span class="skolem">ns</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ns'</span> <span class="main">≤</span> length <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="skolem">ns'</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> ns' Cons_path<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">#</span><span class="skolem">ns'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> ns' <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">ns'<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> split<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ns'</span> <span class="main">=</span> <span class="skolem">ns'<span class="hidden">⇩</span><sub>1</sub></span><span class="main">@</span><span class="skolem">n</span><span class="main">#</span><span class="skolem">ns'<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> set <span class="skolem">ns'<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">atomize_elim</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> split_list_last<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> ns' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">n</span><span class="main">-</span><span class="skolem">n</span><span class="main">#</span><span class="skolem">ns'<span class="hidden">⇩</span><sub>2</sub></span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> path2_split<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> split ns' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">#</span><span class="skolem">ns'<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-simple_path2"><span class="command">lemma</span></span> simple_path2<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns'</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">ns'</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ns'</span> <span class="main">⊆</span> set <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ns'</span> <span class="main">≤</span>  length <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">ns'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="free">ns'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> simple_path2_aux<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_butlast_last_id distinct.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> distinct1_rotate hd_Cons_tl path2_hd path2_last path2_not_Nil rotate1.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

  <span class="keyword1" id="Graph_path-simple_path2_unsnoc"><span class="command">lemma</span></span> simple_path2_unsnoc<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns'</span><span class="main">→</span>last <span class="free">ns'</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="free">ns'</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">ns'</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ns'</span> <span class="main">⊆</span> set <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∉</span> set <span class="free">ns'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">ns'</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ns'</span> <span class="main">⊆</span> set <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ns'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> simple_path2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span>butlast <span class="skolem">ns'</span><span class="main">→</span>last <span class="main">(</span>butlast <span class="skolem">ns'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>butlast <span class="skolem">ns'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> path2_unsnoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"butlast <span class="skolem">ns'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>butlast <span class="skolem">ns'</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_butlastD subsetI subset_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>1 2 distinct_butlast<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-path2_split_first_last"><span class="command">lemma</span></span> path2_split_first_last<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">ns</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">ns<span class="hidden">⇩</span><sub>3</sub></span> <span class="free">ns<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ns</span> <span class="main">=</span> <span class="free">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">@</span><span class="free">ns<span class="hidden">⇩</span><sub>3</sub></span><span class="main">@</span><span class="free">ns<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span><span class="free">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">ns</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">→</span><span class="free">x</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> set <span class="free">ns<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">x</span><span class="main">-</span><span class="free">ns<span class="hidden">⇩</span><sub>3</sub></span><span class="main">→</span><span class="free">x</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">x</span><span class="main">-</span><span class="free">x</span><span class="main">#</span><span class="free">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> set <span class="free">ns<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ns</span> <span class="main">=</span> <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">@</span><span class="free">x</span><span class="main">#</span><span class="skolem">ns'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize_elim</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> split_list_first<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">→</span><span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">x</span><span class="main">-</span><span class="free">x</span><span class="main">#</span><span class="skolem">ns'</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">erule</span> path2_split<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> path2_split<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">#</span><span class="skolem">ns'</span> <span class="main">=</span> <span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span><span class="main">@</span><span class="free">x</span><span class="main">#</span><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize_elim</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> split_list_last<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> 3<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">x</span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">→</span><span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">x</span><span class="main">-</span><span class="free">x</span><span class="main">#</span><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">erule</span> path2_split<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> path2_split<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ 2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 4 3<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ns</span> <span class="main">=</span> <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="main">(</span><span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span> 3<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="free">ns</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">ns</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sublist.suffix_def suffix_order.order_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-path2_simple_loop"><span class="command">lemma</span></span> path2_simple_loop<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">∈</span> set <span class="free">ns</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns'</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">∈</span> set <span class="free">ns'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="main">(</span>butlast <span class="free">ns'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ns'</span> <span class="main">⊆</span> set <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"length <span class="free">ns</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ns</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_less_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ns'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tl <span class="main">(</span>butlast <span class="skolem">ns</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="var">?ns'</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted">"1.prems"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ns</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ns</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span>butlast <span class="skolem">ns</span><span class="main">→</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> path2_unsnoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">where</span></span> m'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">m'</span><span class="main">-</span><span class="var">?ns'</span><span class="main">→</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="skolem">m'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">erule</span> path2_cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> split<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">m'</span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">→</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ns'</span> <span class="main">=</span> <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">@</span>tl <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ns'</span> <span class="main">=</span> butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">@</span><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> path2_split_ex<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ns</span> <span class="main">=</span> butlast <span class="skolem">ns</span><span class="main">@</span><span class="main">[</span><span class="free">n</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="quoted">"1.prems"</span><span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> path2_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"butlast <span class="skolem">ns</span> <span class="main">=</span> <span class="free">n</span><span class="main">#</span>tl <span class="main">(</span>butlast <span class="skolem">ns</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 m<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> path2_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> split'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ns</span> <span class="main">=</span> <span class="free">n</span><span class="main">#</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">@</span>tl <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">@</span><span class="main">[</span><span class="free">n</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ns</span> <span class="main">=</span> <span class="free">n</span><span class="main">#</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">@</span><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">@</span><span class="main">[</span><span class="free">n</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> split<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">n</span><span class="main">#</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted">"1.hyps"</span><span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">#</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">n</span><span class="main">#</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">&lt;</span> length <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> split'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">n</span><span class="main">#</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> True<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> split<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> m'<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="quoted">"1.prems"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> split'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">from</span></span> False split'<span class="main">(</span>1<span class="main">)</span> <span class="quoted">"1.prems"</span><span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">@</span><span class="main">[</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted">"1.hyps"</span><span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">@</span><span class="main">[</span><span class="free">n</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">@</span><span class="main">[</span><span class="free">n</span><span class="main">]</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> split'<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">@</span><span class="main">[</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 5<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">@</span><span class="main">[</span><span class="free">n</span><span class="main">]</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> split<span class="main">(</span>2<span class="main">)</span> m<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> path2_snoc<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="quoted">"1.prems"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> split'<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-path2_split_first_prop"><span class="command">lemma</span></span> path2_split_first_prop<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">ns</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">m'</span> <span class="free">ns'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns'</span><span class="main">→</span><span class="free">m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="free">ns'</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span><span class="free">P</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"prefix <span class="free">ns'</span> <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns''</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ns</span> <span class="main">=</span> <span class="skolem">ns''</span><span class="main">@</span><span class="skolem">n'</span><span class="main">#</span><span class="skolem">ns'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="skolem">ns''</span><span class="main">.</span> <span class="main">¬</span><span class="free">P</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> split_list_first_propE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="skolem">ns''</span><span class="main">@</span><span class="main">[</span><span class="skolem">n'</span><span class="main">]</span><span class="main">→</span><span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> path2_split<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-path2_split_last_prop"><span class="command">lemma</span></span> path2_split_last_prop<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">ns</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">n'</span> <span class="free">ns'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n'</span><span class="main">-</span><span class="free">ns'</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">ns'</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span><span class="free">P</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">ns'</span> <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns''</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ns</span> <span class="main">=</span> <span class="skolem">ns''</span><span class="main">@</span><span class="skolem">n'</span><span class="main">#</span><span class="skolem">ns'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="skolem">ns'</span><span class="main">.</span> <span class="main">¬</span><span class="free">P</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> split_list_last_propE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">n'</span><span class="main">-</span><span class="skolem">n'</span><span class="main">#</span><span class="skolem">ns'</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> path2_split<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sublist.suffix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-path2_prefix"><span class="command">lemma</span></span> path2_prefix<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span><span class="free">ns'</span><span class="main">@</span><span class="main">[</span><span class="free">m'</span><span class="main">]</span><span class="main">)</span> <span class="free">ns</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns'</span><span class="main">@</span><span class="main">[</span><span class="free">m'</span><span class="main">]</span><span class="main">→</span><span class="free">m'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">erule</span> prefixE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> path2_split<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

  <span class="keyword1" id="Graph_path-path2_prefix_ex"><span class="command">lemma</span></span> path2_prefix_ex<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">∈</span> set <span class="free">ns</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns'</span><span class="main">→</span><span class="free">m'</span>"</span></span> <span class="quoted"><span class="quoted">"prefix <span class="free">ns'</span> <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="free">ns'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span><span class="skolem">ns'</span><span class="main">@</span><span class="main">[</span><span class="free">m'</span><span class="main">]</span><span class="main">)</span> <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">∉</span> set <span class="skolem">ns'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prefix_split_first<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-path2_strict_prefix_ex"><span class="command">lemma</span></span> path2_strict_prefix_ex<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="free">ns</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns'</span><span class="main">→</span><span class="free">m'</span>"</span></span> <span class="quoted"><span class="quoted">"strict_prefix <span class="free">ns'</span> <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="free">ns'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns'<span class="main">:</span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span><span class="skolem">ns'</span><span class="main">@</span><span class="main">[</span><span class="free">m'</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>butlast <span class="free">ns</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">∉</span> set <span class="skolem">ns'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prefix_split_first<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"strict_prefix <span class="main">(</span><span class="skolem">ns'</span><span class="main">@</span><span class="main">[</span><span class="free">m'</span><span class="main">]</span><span class="main">)</span> <span class="free">ns</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> strict_prefix_butlast<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> ns'<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-path2_nontriv"><span class="command">lemma</span></span> path2_nontriv<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span><span class="main">;</span> <span class="free">n</span> <span class="main">≠</span> <span class="free">m</span><span class="main">⟧</span> <span class="main">⟹</span> length <span class="free">ns</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hd_Cons_tl last_appendR last_snoc length_greater_0_conv length_tl path2_def path_not_Nil zero_less_diff<span class="main">)</span>

  <span class="keyword1"><span class="command">declare</span></span> path_not_Nil <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
  <span class="keyword1"><span class="command">declare</span></span> path2_not_Nil <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
  <span class="keyword1"><span class="command">declare</span></span> path2_not_Nil3 <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Domination›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We fix an entry node per graph and use it to define node domination.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> graph_Entry_base <span class="main">=</span> graph_path_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span>
<span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Entry</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">dominates</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">dominates</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ns</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">-</span><span class="bound">ns</span><span class="main">→</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∈</span> set <span class="bound">ns</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">strict_dom</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">∧</span> dominates <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> graph_Entry <span class="main">=</span> graph_Entry_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span>
  <span class="main">+</span> graph_path <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Entry</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span>
<span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span> Entry_in_graph<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Entry</span> <span class="free">g</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> Entry_unreachable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span> <span class="main">⟹</span> inEdges <span class="free">g</span> <span class="main">(</span><span class="free">Entry</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> Entry_reaches<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">;</span> <span class="free">invar</span> <span class="free">g</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">ns</span><span class="main">.</span> <span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="bound">ns</span><span class="main">→</span><span class="free">n</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="Graph_path-Entry_dominates"><span class="command">lemma</span></span> Entry_dominates<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">invar</span> <span class="free">g</span><span class="main">;</span> <span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> dominates <span class="free">g</span> <span class="main">(</span><span class="free">Entry</span> <span class="free">g</span><span class="main">)</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dominates_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="Graph_path-Entry_iff_unreachable"><span class="command">lemma</span></span> Entry_iff_unreachable<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"predecessors <span class="free">g</span> <span class="free">n</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> <span class="free">n</span> <span class="main">=</span> <span class="free">Entry</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"predecessors <span class="free">g</span> <span class="free">n</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="free">Entry</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> Entry_reaches<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>simple_path2_unsnoc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>assms Entry_unreachable predecessors_def<span class="main">)</span>

  <span class="keyword1" id="Graph_path-Entry_loop"><span class="command">lemma</span></span> Entry_loop<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">Entry</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ns</span><span class="main">=</span><span class="main">[</span><span class="free">Entry</span> <span class="free">g</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="free">ns</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>butlast <span class="free">ns</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="main">(</span><span class="free">Entry</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> path2_unsnoc<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Entry_unreachable<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>predecessors_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_leI hd_Cons_tl impossible_Cons le_less length_greater_0_conv numeral_2_eq_2 path2_hd path2_not_Nil<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-simple_Entry_path"><span class="command">lemma</span></span> simple_Entry_path<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="free">ns</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">atomize_elim</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Entry_reaches<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> p <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ns'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> path2_split_first_last<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-dominatesI"><span class="command">lemma</span></span> dominatesI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">ns</span><span class="main">.</span> <span class="main">⟦</span><span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="bound">ns</span><span class="main">→</span><span class="free">m</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> set <span class="bound">ns</span><span class="main">⟧</span> <span class="main">⟹</span> dominates <span class="free">g</span> <span class="free">n</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dominates_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1" id="Graph_path-dominatesE"><span class="command">lemma</span></span> dominatesE<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n</span> <span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ns</span><span class="main">.</span> <span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="bound">ns</span><span class="main">→</span><span class="free">m</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> set <span class="bound">ns</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> dominates_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n</span> <span class="free">m</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dominatesE<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">atomize_elim</span> <span class="main">(</span><span class="operator">rule</span> Entry_reaches<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>dominatesE<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-strict_domE"><span class="command">lemma</span></span> strict_domE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_dom <span class="free">g</span> <span class="free">n</span> <span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ns</span><span class="main">.</span> <span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="bound">ns</span><span class="main">→</span><span class="free">m</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="bound">ns</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dominates_def path2_def path_not_Nil rotate1.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> set_ConsD set_rotate1 snoc_eq_iff_butlast<span class="main">)</span>

  <span class="keyword1" id="Graph_path-dominates_refl"><span class="command">lemma</span></span> dominates_refl<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">invar</span> <span class="free">g</span><span class="main">;</span> <span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> dominates <span class="free">g</span> <span class="free">n</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="Graph_path-dominates_trans"><span class="command">lemma</span></span> dominates_trans<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> part1<span class="main">:</span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n</span> <span class="free">n'</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> part2<span class="main">:</span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n'</span> <span class="free">n''</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n</span> <span class="free">n''</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> part2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n''</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ns</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'node</span> list"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="free">n''</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> part2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">erule</span> dominatesE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="keyword2"><span class="keyword">where</span></span> prefix<span class="main">:</span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span><span class="skolem">as</span><span class="main">@</span><span class="main">[</span><span class="free">n'</span><span class="main">]</span><span class="main">)</span> <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>prefix_split_first<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="main">(</span><span class="skolem">as</span><span class="main">@</span><span class="main">[</span><span class="free">n'</span><span class="main">]</span><span class="main">)</span><span class="main">→</span><span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> part1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">as</span><span class="main">@</span><span class="main">[</span><span class="free">n'</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dominates_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> prefix <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-dominates_antisymm"><span class="command">lemma</span></span> dominates_antisymm<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> dom1<span class="main">:</span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n</span> <span class="free">n'</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> dom2<span class="main">:</span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n'</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">n'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="free">n'</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> dom2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">invar</span> <span class="free">g</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ns</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> simple_Entry_path<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> dom2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">erule</span> dominatesE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="keyword2"><span class="keyword">where</span></span> prefix<span class="main">:</span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span><span class="skolem">as</span><span class="main">@</span><span class="main">[</span><span class="free">n'</span><span class="main">]</span><span class="main">)</span> <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>prefix_split_first<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">as</span><span class="main">@</span><span class="main">[</span><span class="free">n'</span><span class="main">]</span><span class="main">→</span><span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> path2_prefix<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> dom1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">as</span><span class="main">@</span><span class="main">[</span><span class="free">n'</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dominates_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">≠</span> <span class="free">n'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="skolem">as</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="main">(</span><span class="skolem">as</span><span class="main">@</span><span class="main">[</span><span class="free">n'</span><span class="main">]</span><span class="main">)</span> <span class="skolem">ns</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ns</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">erule</span> prefixE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">iff</span><span class="main"><span class="main">:</span></span>butlast_append<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ns</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-dominates_unsnoc"><span class="command">lemma</span></span> dominates_unsnoc<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n</span> <span class="free">m'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ns</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="free">m'</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">@</span><span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>dominatesE<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-dominates_unsnoc'"><span class="command">lemma</span></span> dominates_unsnoc'<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">m'</span><span class="main">-</span><span class="free">ms</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">ms</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n</span> <span class="free">m'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>path2_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty_path
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons_path <span class="skolem">ms</span> <span class="skolem">m''</span> <span class="skolem">m'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons_path<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n</span> <span class="skolem">m'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cons_path.IH in_set_tlD<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> Cons_path<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> set <span class="skolem">ms</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">≠</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons_path<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons_path<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> dominates_unsnoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-dominates_path"><span class="command">lemma</span></span> dominates_path<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">atomize_elim</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">atomize_elim</span> <span class="main">(</span><span class="operator">rule</span> Entry_reaches<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">erule</span> dominatesE<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> ns <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ns</span><span class="main">.</span> <span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="bound">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> path2_split_ex<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-dominates_antitrans"><span class="command">lemma</span></span> dominates_antitrans<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
          <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> dominatesI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ns</span>
      <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="free">n<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dominates_path<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="hidden">⇩</span><sub>2</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">⊆</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> simple_path2<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> asm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">@</span>tl <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ns</span><span class="main">@</span>tl <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">erule</span> dominatesE<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> ns<span class="hidden">⇩</span><sub>2</sub>'<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">erule</span> path2_split_ex<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> path2_not_Nil<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ns'</span>
          <span class="keyword3"><span class="command">assume</span></span> ns'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="free">n<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> ns<span class="hidden">⇩</span><sub>3</sub><span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">@</span>tl <span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ns'</span><span class="main">@</span>tl <span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">erule</span> dominatesE<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> ns<span class="hidden">⇩</span><sub>3</sub><span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> set <span class="skolem">ns'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-dominates_extend"><span class="command">lemma</span></span> dominates_extend<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n</span> <span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">m'</span><span class="main">-</span><span class="free">ms</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">ms</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n</span> <span class="free">m'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> dominatesI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ms'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ms'</span><span class="main">→</span><span class="free">m'</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ms'</span><span class="main">@</span>tl <span class="free">ms</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ms'</span><span class="main">@</span>tl <span class="free">ms</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">erule</span> dominatesE<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="skolem">ms'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">dominators</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'node</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">dominators</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">m</span></span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">.</span> dominates <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">m</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">isIdom</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">⟷</span> strict_dom <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m'</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">.</span> strict_dom <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">m'</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟶</span> dominates <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">m'</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">idom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">idom</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="keyword1">THE</span> <span class="bound">m</span><span class="main">.</span> isIdom <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="bound">m</span>"</span></span>

  <span class="keyword1" id="Graph_path-idom_ex"><span class="command">lemma</span></span> idom_ex<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="free">Entry</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">m</span><span class="main">.</span> isIdom <span class="free">g</span> <span class="free">n</span> <span class="bound">m</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ex_ex1I<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">m'</span></span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> strict_dom <span class="free">g</span> <span class="bound">m'</span> <span class="free">n</span> <span class="main">∧</span> strict_dom <span class="free">g</span> <span class="bound">m</span> <span class="bound">m'</span><span class="main">}</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">m</span><span class="main">.</span> finite <span class="bound">A</span> <span class="main">⟹</span> <span class="bound">A</span> <span class="main">=</span> <span class="var">?A</span> <span class="bound">m</span> <span class="main">⟹</span> strict_dom <span class="free">g</span> <span class="bound">m</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">m'</span><span class="main">.</span> isIdom <span class="free">g</span> <span class="free">n</span> <span class="bound">m'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">m</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span> <span class="main">⟹</span> <span class="skolem">A</span> <span class="main">=</span> <span class="var">?A</span> <span class="skolem">m</span> <span class="main">⟹</span> strict_dom <span class="free">g</span> <span class="skolem">m</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">m'</span><span class="main">.</span> isIdom <span class="free">g</span> <span class="free">n</span> <span class="bound">m'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="skolem">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>finite_psubset_induct<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>psubset <span class="skolem">A</span> <span class="skolem">m</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m'</span>
            <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_dom <span class="free">g</span> <span class="skolem">m'</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">with</span></span> True psubset.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>strict_dom <span class="free">g</span> <span class="skolem">m</span> <span class="skolem">m'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="skolem">m'</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dominates_antitrans<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">m'</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> asm psubset.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> psubset.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>isIdom_def<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> psubset.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> m'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"strict_dom <span class="free">g</span> <span class="skolem">m'</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"strict_dom <span class="free">g</span> <span class="skolem">m</span> <span class="skolem">m'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="skolem">m'</span> <span class="main">⊂</span> <span class="var">?A</span> <span class="skolem">m</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="skolem">m'</span> <span class="main">≠</span> <span class="var">?A</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="skolem">m'</span> <span class="main">⊆</span> <span class="var">?A</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m' dominates_antisymm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">m'</span></span><span class="main">]</span> dominates_trans<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> psubset.IH<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">m'</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> psubset.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m'<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> isIdom <span class="free">g</span> <span class="free">n</span> <span class="bound">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">(</span><span class="free">Entry</span> <span class="free">g</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">m'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"isIdom <span class="free">g</span> <span class="free">n</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"isIdom <span class="free">g</span> <span class="free">n</span> <span class="skolem">m'</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="skolem">m'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> dominates_antisymm<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>isIdom_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-idom"><span class="command">lemma</span></span> idom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">invar</span> <span class="free">g</span><span class="main">;</span> <span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">Entry</span> <span class="free">g</span><span class="main">}</span><span class="main">⟧</span> <span class="main">⟹</span> isIdom <span class="free">g</span> <span class="free">n</span> <span class="main">(</span>idom <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> idom_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> theI'<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> idom_ex<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1" id="Graph_path-dominates_mid"><span class="command">lemma</span></span> dominates_mid<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">x</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">x</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="hidden">⇩</span><sub>0</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>0</sub></span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> simple_Entry_path<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>0</sub></span><span class="main">@</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>0</sub></span><span class="main">@</span><span class="free">ns</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>dominatesE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> ns<span class="hidden">⇩</span><sub>0</sub> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>0</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="hidden">⇩</span><sub>0</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">→</span><span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">erule</span> path2_split_ex<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>in_set_butlastD <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> butlast_append <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ns<span class="hidden">⇩</span><sub>0</sub>' strict_domE<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">shortestPath</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">shortestPath</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">l</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ns</span><span class="main">.</span> length <span class="bound">ns</span> <span class="main">=</span> <span class="bound">l</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">-</span><span class="bound">ns</span><span class="main">→</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="Graph_path-shortestPath_ex"><span class="command">lemma</span></span> shortestPath_ex<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ns</span> <span class="main">=</span> shortestPath <span class="free">g</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">atomize_elim</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Entry_reaches<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sns</span></span> <span class="keyword2"><span class="keyword">where</span></span> sns<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">sns</span> <span class="main">=</span> shortestPath <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">sns</span><span class="main">→</span><span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> shortestPath_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">atomize_elim</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> LeastI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> sns'<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">sns'</span> <span class="main">≤</span> shortestPath <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">sns'</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">sns'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> simple_path2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> sns'<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shortestPath <span class="free">g</span> <span class="free">n</span> <span class="main">≤</span> length <span class="skolem">sns'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> shortestPath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">;</span> <span class="free">invar</span> <span class="free">g</span><span class="main">⟧</span> <span class="main">⟹</span> shortestPath <span class="free">g</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_0_conv path2_not_Nil2 shortestPath_ex<span class="main">)</span>

  <span class="keyword1" id="Graph_path-shortestPath_upper_bound"><span class="command">lemma</span></span> shortestPath_upper_bound<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"shortestPath <span class="free">g</span> <span class="free">n</span> <span class="main">≤</span> length <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ns</span> <span class="main">=</span> shortestPath <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shortestPath_ex<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"shortestPath <span class="free">g</span> <span class="free">n</span> <span class="main">=</span> length <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card <span class="main">(</span>set <span class="skolem">ns</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ns<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> distinct_card<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> card <span class="main">(</span>set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ns<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> card_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> length <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_length<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-shortestPath_predecessor"><span class="command">lemma</span></span> shortestPath_predecessor<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">Entry</span> <span class="free">g</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">n'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>shortestPath <span class="free">g</span> <span class="free">n'</span><span class="main">)</span> <span class="main">=</span> shortestPath <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sns</span></span> <span class="keyword2"><span class="keyword">where</span></span> sns<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">sns</span> <span class="main">=</span> shortestPath <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">sns</span><span class="main">→</span><span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> shortestPath_ex<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>butlast <span class="skolem">sns</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> sns<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">sns</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> prefix<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span>butlast <span class="skolem">sns</span><span class="main">→</span>last <span class="main">(</span>butlast <span class="skolem">sns</span><span class="main">)</span> <span class="main">∧</span> last <span class="main">(</span>butlast <span class="skolem">sns</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sns <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> path2_unsnoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"shortestPath <span class="free">g</span> <span class="var">?n'</span> <span class="main">≤</span> length <span class="main">(</span>butlast <span class="skolem">sns</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> shortestPath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> Least_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"butlast <span class="skolem">sns</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 1 sns<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"shortestPath <span class="free">g</span> <span class="var">?n'</span> <span class="main">&lt;</span> shortestPath <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>shortestPath <span class="free">g</span> <span class="var">?n'</span><span class="main">)</span> <span class="main">≠</span> shortestPath <span class="free">g</span> <span class="free">n</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> sns'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">sns'</span><span class="main">→</span><span class="var">?n'</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">sns'</span> <span class="main">=</span> shortestPath <span class="free">g</span> <span class="var">?n'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> shortestPath_ex<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">sns'</span><span class="main">@</span><span class="main">[</span><span class="free">n</span><span class="main">]</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> asm 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>shortestPath <span class="free">g</span> <span class="var">?n'</span><span class="main">)</span> <span class="main">&lt;</span> shortestPath <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> shortestPath_def<span class="main">,</span> <span class="operator">THEN</span> not_less_Least<span class="main">,</span> <span class="operator">folded</span> shortestPath_def<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">THEN</span> spec<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sns'</span><span class="main">@</span><span class="main">[</span><span class="free">n</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> sns'<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">with</span></span> prefix <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-successor_in_αn"><span class="command">lemma</span></span> successor_in_αn<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"predecessors <span class="free">g</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"predecessors <span class="free">g</span> <span class="free">n</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">m'</span><span class="main">,</span><span class="skolem">e</span><span class="main">,</span><span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">αe</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inEdges_correct<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">,</span> <span class="operator">THEN</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(`)</span> getTo"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> predecessors_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> inEdges_correct<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> predecessors_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-shortestPath_single_predecessor"><span class="command">lemma</span></span> shortestPath_single_predecessor<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"predecessors <span class="free">g</span> <span class="free">n</span> <span class="main">=</span> <span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"shortestPath <span class="free">g</span> <span class="free">m</span> <span class="main">&lt;</span> shortestPath <span class="free">g</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">Entry</span> <span class="free">g</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> predecessors_def Entry_unreachable<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shortestPath_predecessor<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-strict_dom_shortestPath_order"><span class="command">lemma</span></span> strict_dom_shortestPath_order<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_dom <span class="free">g</span> <span class="free">n</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"shortestPath <span class="free">g</span> <span class="free">n</span> <span class="main">&lt;</span> shortestPath <span class="free">g</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sns</span></span> <span class="keyword2"><span class="keyword">where</span></span> sns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">sns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">sns</span> <span class="main">=</span> shortestPath <span class="free">g</span> <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> shortestPath_ex<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> sns<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> sns'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">sns'</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">sns'</span> <span class="skolem">sns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">erule</span> path2_prefix_ex<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>dominatesE<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"shortestPath <span class="free">g</span> <span class="free">n</span> <span class="main">≤</span> length <span class="skolem">sns'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> shortestPath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> Least_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">sns'</span> <span class="main">&lt;</span> length <span class="skolem">sns</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> sns<span class="main">(</span>1<span class="main">)</span> sns'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sns'</span> <span class="main">≠</span> <span class="skolem">sns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">drule</span> path2_last<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> path2_last<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> sns'<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_prefix <span class="skolem">sns'</span> <span class="skolem">sns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prefix_length_less<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sns<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-dominates_shortestPath_order"><span class="command">lemma</span></span> dominates_shortestPath_order<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"shortestPath <span class="free">g</span> <span class="free">n</span> <span class="main">≤</span> shortestPath <span class="free">g</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">m</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>strict_dom_shortestPath_order<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> less_imp_le<span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1" id="Graph_path-strict_dom_trans"><span class="command">lemma</span></span> strict_dom_trans<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_dom <span class="free">g</span> <span class="free">n</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"strict_dom <span class="free">g</span> <span class="free">m</span> <span class="free">m'</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strict_dom <span class="free">g</span> <span class="free">n</span> <span class="free">m'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> notI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">m'</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">m'</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">m'</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> dominates_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> dominates_antisymm<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="free">n</span> <span class="free">m'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> dominates_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">inductive</span></span> <span class="entity">EntryPath</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    EntryPath_triv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">EntryPath</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">]</span>"</span></span>
  <span class="main">|</span> EntryPath_snoc<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">EntryPath</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">⟹</span> shortestPath <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> Suc <span class="main">(</span>shortestPath <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span>last <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">EntryPath</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">@</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"EntryPath <span class="free">g</span> <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"prefix <span class="free">ns'</span> <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ns'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"EntryPath <span class="free">g</span> <span class="free">ns'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="operator">induction</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>EntryPath_triv <span class="skolem">ns</span> <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ns'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="Graph_path-EntryPath_suffix"><span class="command">lemma</span></span> EntryPath_suffix<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"EntryPath <span class="free">g</span> <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">ns'</span> <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ns'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"EntryPath <span class="free">g</span> <span class="free">ns'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ns'</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> EntryPath_triv
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> EntryPath.EntryPath_triv append_Nil append_is_Nil_conv list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> Sublist.suffix_def tl_append2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>EntryPath_snoc <span class="skolem">g</span> <span class="skolem">ns</span> <span class="skolem">m</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> EntryPath_snoc.prems <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ns'</span> <span class="main">=</span> <span class="skolem">ns''</span><span class="main">@</span><span class="main">[</span><span class="skolem">m</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">erule</span> suffix_unsnoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ns''</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">from</span></span> EntryPath_snoc.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">ns''</span> <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sublist.suffix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">ns''</span> <span class="main">=</span> last <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sublist.suffix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"EntryPath <span class="skolem">g</span> <span class="skolem">ns''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> EntryPath_snoc.prems<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> EntryPath_snoc.IH<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sublist.suffix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> EntryPath_snoc.hyps<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> EntryPath.EntryPath_snoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Graph_path-EntryPath_butlast_less_last"><span class="command">lemma</span></span> EntryPath_butlast_less_last<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"EntryPath <span class="free">g</span> <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="free">ns</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"shortestPath <span class="free">g</span> <span class="free">z</span> <span class="main">&lt;</span> shortestPath <span class="free">g</span> <span class="main">(</span>last <span class="free">ns</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>EntryPath_snoc <span class="skolem">g</span> <span class="skolem">ns</span> <span class="skolem">m</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ns</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> not_in_butlast<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

  <span class="keyword1" id="Graph_path-EntryPath_distinct"><span class="command">lemma</span></span> EntryPath_distinct<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"EntryPath <span class="free">g</span> <span class="free">ns</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>EntryPath_snoc <span class="skolem">g</span> <span class="skolem">ns</span> <span class="skolem">m</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>non_distinct<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="skolem">ns</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">m</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="skolem">ns</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">m</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> non_distinct
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"EntryPath <span class="skolem">g</span> <span class="main">(</span><span class="skolem">ns</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">m</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> EntryPath_snoc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> EntryPath.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> non_distinct
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
       <span class="keyword1"><span class="command">using</span></span> EntryPath_butlast_less_last butlast_snoc last_snoc less_not_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

  <span class="keyword1" id="Graph_path-Entry_reachesE"><span class="command">lemma</span></span> Entry_reachesE<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"EntryPath <span class="free">g</span> <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"shortestPath <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">l</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> Suc.prems<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="free">Entry</span> <span class="free">g</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> n'<span class="main">:</span> <span class="quoted"><span class="quoted">"shortestPath <span class="free">g</span> <span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc.hyps<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> shortestPath_predecessor<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ns</span>
        <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"EntryPath <span class="free">g</span> <span class="skolem">ns</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> n' Suc.hyps<span class="main">(</span>2<span class="main">)</span> path2_last<span class="main">[</span><span class="operator">OF</span> asm<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">ns</span><span class="main">@</span><span class="main">[</span><span class="skolem">n</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="SSA_CFG">
<div class="head">
<h1>Theory SSA_CFG</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      SSA_CFG.thy
    Author:     Sebastian Ullrich, Denis Lohner
*)</span>

<span class="keyword1"><span class="command">theory</span></span> SSA_CFG
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Graph_path">Graph_path</a> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Sublist.html">HOL-Library.Sublist</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹CFG›</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_base <span class="main">=</span> graph_Entry_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Entry</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span><span class="main">::</span>linorder set"</span></span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">vars</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> fold <span class="main">(∪)</span> <span class="main">(</span>map <span class="main">(</span><span class="free">uses</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">αn</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">defAss'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">defAss'</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ns</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">-</span><span class="bound">ns</span><span class="main">→</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> set <span class="bound">ns</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> <span class="free">defs</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">defAss'Uses</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">defAss'Uses</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">m</span><span class="main">.</span> defAss' <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">m</span> <span class="bound">v</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG <span class="main">=</span> CFG_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span>
<span class="main">+</span> graph_Entry <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Entry</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span> <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span> defs_uses_disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span> <span class="main">∩</span> <span class="free">uses</span> <span class="free">g</span> <span class="free">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> defs_finite<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">defs</span> <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> uses_in_αn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> uses_finite<span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">uses</span> <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> invar<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="free">g</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="SSA_CFG-vars_finite"><span class="command">lemma</span></span> vars_finite<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>vars <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>vars_def<span class="main">)</span>

  <span class="keyword1" id="SSA_CFG-Entry_no_predecessor"><span class="command">lemma</span></span> Entry_no_predecessor<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"predecessors <span class="free">g</span> <span class="main">(</span><span class="free">Entry</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Entry_unreachable
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>predecessors_def<span class="main">)</span>

  <span class="keyword1" id="SSA_CFG-uses_in_vars"><span class="command">lemma</span></span> uses_in_vars<span class="main">[</span><span class="operator">elim</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="free">n</span> <span class="main">⟹</span>  <span class="free">v</span> <span class="main">∈</span> vars <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>vars_def uses_in_αn <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fold_union_elemI<span class="main">)</span>

  <span class="keyword1" id="SSA_CFG-varsE"><span class="command">lemma</span></span> varsE<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> vars <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">n</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>vars_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>fold_union_elem<span class="main">)</span>

  <span class="keyword1" id="SSA_CFG-defs_uses_disjoint'"><span class="command">lemma</span></span> defs_uses_disjoint'<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="free">n</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">using</span></span> defs_uses_disjoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> CFG
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="SSA_CFG-defAss'E"><span class="command">lemma</span></span> defAss'E<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"defAss' <span class="free">g</span> <span class="free">m</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">n</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> defAss'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">lemmas</span></span> defAss'I <span class="main">=</span> defAss'_def<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>

  <span class="keyword1" id="SSA_CFG-defAss'_extend"><span class="command">lemma</span></span> defAss'_extend<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"defAss' <span class="free">g</span> <span class="free">m</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span><span class="main">.</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"defAss' <span class="free">g</span> <span class="free">n</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> defAss'_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ns'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">@</span>tl <span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> n'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ns'</span><span class="main">@</span>tl <span class="free">ns</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">erule</span> defAss'E<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> n' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> set <span class="skolem">ns'</span><span class="main">.</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A CFG is well-formed if it satisfies definite assignment.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_wf <span class="main">=</span> CFG <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Entry</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span> <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span> def_ass_uses<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="bound">m</span><span class="main">.</span> defAss' <span class="free">g</span> <span class="bound">m</span> <span class="bound">v</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹SSA CFG›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'val</span> <span class="main">⇀</span> <span class="tfree">'val</span> list"</span></span>

<span class="keyword1"><span class="command">declare</span></span> in_set_zipE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> zip_same<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> CFG_SSA_base <span class="main">=</span> CFG_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Entry</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span> set"</span></span> <span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">phis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">phiDefs</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> dom <span class="main">(</span><span class="free">phis</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span><span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">allDefs</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="free">defs</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∪</span> phiDefs <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span><span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phiUses</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span>
    <span class="main">⋃</span><span class="bound">n'</span> <span class="main">∈</span> set <span class="main">(</span>successors <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">v'</span> <span class="main">∈</span> phiDefs <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n'</span><span class="main">.</span> snd <span class="main">`</span> Set.filter <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">n''</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>set <span class="main">(</span>zip <span class="main">(</span>predecessors <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n'</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span><span class="free">phis</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span><span class="bound">n'</span><span class="main">,</span><span class="bound">v'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span><span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">allUses</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="free">uses</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∪</span> phiUses <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span><span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">allVars</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">⋃</span><span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">.</span> allDefs <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span> <span class="main">∪</span> allUses <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">defAss</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">defAss</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ns</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">-</span><span class="bound">ns</span><span class="main">→</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> set <span class="bound">ns</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> allDefs <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">lemmas</span></span> CFG_SSA_defs <span class="main">=</span> phiDefs_def allDefs_def phiUses_def allUses_def allVars_def defAss_def
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_SSA <span class="main">=</span> CFG <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="main">+</span> CFG_SSA_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Entry</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="free">phis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis"</span></span> <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span> phis_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>dom <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> phis_in_αn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">vs</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> phis_wf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">args</span> <span class="main">⟹</span> length <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> length <span class="free">args</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> simpleDefs_phiDefs_disjoint<span class="main">:</span>             
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span> <span class="main">∩</span> phiDefs <span class="free">g</span> <span class="free">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> allDefs_disjoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">;</span> <span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">;</span> <span class="free">n</span> <span class="main">≠</span> <span class="free">m</span><span class="main">⟧</span> <span class="main">⟹</span> allDefs <span class="free">g</span> <span class="free">n</span> <span class="main">∩</span> allDefs <span class="free">g</span> <span class="free">m</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="SSA_CFG-phis_disj"><span class="command">lemma</span></span> phis_disj<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">vs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">vs'</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">n'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">=</span> <span class="free">vs'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> phis_in_αn<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> allDefs_disjoint <span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">n'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> allDefs_def phiDefs_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">=</span> <span class="free">vs'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-allDefs_disjoint'"><span class="command">lemma</span></span> allDefs_disjoint'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">;</span> <span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="free">n</span><span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="free">m</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> allDefs_disjoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="SSA_CFG-phiUsesI"><span class="command">lemma</span></span> phiUsesI<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n'</span><span class="main">)</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">∈</span> set <span class="main">(</span>successors <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> phiDefs <span class="free">g</span> <span class="free">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phiDefs_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span><span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="free">n'</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">vs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> phiUses_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> UN_I<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> UN_I<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>image_def Set.filter_def assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 3<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-phiUsesE"><span class="command">lemma</span></span> phiUsesE<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span>  <span class="free">n'</span> <span class="free">v'</span> <span class="free">vs</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">∈</span> set <span class="main">(</span>successors <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n'</span><span class="main">)</span> <span class="free">vs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="free">n'</span><span class="main">,</span> <span class="free">v'</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">vs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">∈</span>set <span class="main">(</span>successors <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span><span class="main">∈</span>phiDefs <span class="free">g</span> <span class="skolem">n'</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> snd <span class="main">`</span> Set.filter <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">n''</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">=</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>set <span class="main">(</span>zip <span class="main">(</span>predecessors <span class="free">g</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span><span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>phiUses_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">n'</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span><span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">n'</span><span class="main">,</span><span class="skolem">v'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>phiDefs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-defs_in_allDefs"><span class="command">lemma</span></span> defs_in_allDefs<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>allDefs_def<span class="main">)</span>
  <span class="keyword1" id="SSA_CFG-phiDefs_in_allDefs"><span class="command">lemma</span></span> phiDefs_in_allDefs<span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> phiDefs <span class="free">g</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>allDefs_def<span class="main">)</span>
  <span class="keyword1" id="SSA_CFG-uses_in_allUses"><span class="command">lemma</span></span> uses_in_allUses<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>allUses_def<span class="main">)</span>
  <span class="keyword1" id="SSA_CFG-phiUses_in_allUses"><span class="command">lemma</span></span> phiUses_in_allUses<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>allUses_def<span class="main">)</span>
  <span class="keyword1" id="SSA_CFG-allDefs_in_allVars"><span class="command">lemma</span></span> allDefs_in_allVars<span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="free">n</span><span class="main">;</span> <span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>allVars_def<span class="main">)</span>
  <span class="keyword1" id="SSA_CFG-allUses_in_allVars"><span class="command">lemma</span></span> allUses_in_allVars<span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">v</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="free">n</span><span class="main">;</span> <span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>allVars_def<span class="main">)</span>

  <span class="keyword1" id="SSA_CFG-phiDefs_finite"><span class="command">lemma</span></span> phiDefs_finite<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>phiDefs <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> phiDefs_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_surj<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">snd</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> phis_finite<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">g</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> snd <span class="main">`</span> dom <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> domI imageI snd_conv<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> dom <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> snd <span class="main">`</span> dom <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-phiUses_finite"><span class="command">lemma</span></span> phiUses_finite<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>phiUses <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>phiUses_def Set.filter_def<span class="main">)</span>

  <span class="keyword1" id="SSA_CFG-allDefs_finite"><span class="command">lemma</span></span> allDefs_finite<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> finite <span class="main">(</span>allDefs <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>allDefs_def<span class="main">)</span>
  <span class="keyword1" id="SSA_CFG-allUses_finite"><span class="command">lemma</span></span> allUses_finite<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> finite <span class="main">(</span>allUses <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>allUses_def<span class="main">)</span>
  <span class="keyword1" id="SSA_CFG-allVars_finite"><span class="command">lemma</span></span> allVars_finite<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>allVars <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>allVars_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemmas</span></span> defAssI <span class="main">=</span> defAss_def<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>
  <span class="keyword1"><span class="command">lemmas</span></span> defAssD <span class="main">=</span> defAss_def<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>

  <span class="keyword1" id="SSA_CFG-defAss_extend"><span class="command">lemma</span></span> defAss_extend<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"defAss <span class="free">g</span> <span class="free">m</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span><span class="main">.</span> <span class="free">v</span> <span class="main">∉</span> allDefs <span class="free">g</span> <span class="bound">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"defAss <span class="free">g</span> <span class="free">n</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> defAss_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ns'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">@</span>tl <span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> n'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ns'</span><span class="main">@</span>tl <span class="free">ns</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>defAssD<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> n' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> set <span class="skolem">ns'</span><span class="main">.</span> <span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-defAss_dominating"><span class="command">lemma</span></span> defAss_dominating<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"defAss <span class="free">g</span> <span class="free">n</span> <span class="free">v</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> dominates <span class="free">g</span> <span class="bound">m</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"defAss <span class="free">g</span> <span class="free">n</span> <span class="free">v</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> defAssD<span class="main">[</span><span class="operator">OF</span> asm this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="skolem">m</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ns'</span>
      <span class="keyword3"><span class="command">assume</span></span> ns'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> defAssD<span class="main">[</span><span class="operator">OF</span> asm this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">where</span></span> m'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> set <span class="skolem">ns'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="skolem">m'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> m ns ns' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allDefs_disjoint'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> m' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="skolem">ns'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> m ns <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">∈</span>set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> dominates <span class="free">g</span> <span class="bound">m</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="bound">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> dominates <span class="free">g</span> <span class="bound">m</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="bound">m</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="skolem">m</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"defAss <span class="free">g</span> <span class="free">n</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> defAssI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ns</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> m<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> dominates_mid<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> m<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">∈</span>set <span class="skolem">ns</span><span class="main">.</span> <span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_SSA_wf_base <span class="main">=</span> CFG_SSA_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Entry</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">phis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Using the SSA properties, we can map every value to its unique defining node and
    remove the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'node</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> parameter of the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">phis</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> map.›</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">defNode</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'val</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    defNode_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">defNode</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> hd <span class="main">[</span><span class="bound">n</span> <span class="main">←</span> <span class="free">αn</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> allDefs <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span><span class="main">]</span>"</span></span>

  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">def_dominates</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> dominates <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span>defNode <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">)</span> <span class="main">(</span>defNode <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">strict_def_dom</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> defNode <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="main">≠</span> defNode <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∧</span> def_dominates <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">phi</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="free">phis</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span>defNode <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phiArg</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">vs</span><span class="main">.</span> phi <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Some <span class="bound">vs</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="main">∈</span> set <span class="bound">vs</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span><span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">isTrivialPhi</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∧</span>
    <span class="main">(</span><span class="keyword1">case</span> phi <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">of</span>
      Some <span class="bound">vs</span> <span class="main">⇒</span> set <span class="bound">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">}</span> <span class="main">∨</span> set <span class="bound">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">}</span>
    <span class="main">|</span> None <span class="main">⇒</span> False<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span><span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">trivial</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">v'</span> <span class="main">∈</span> allVars <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">.</span> isTrivialPhi <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="bound">v'</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span><span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">redundant</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> allVars <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">.</span> trivial <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">v</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">defAssUses</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> allUses <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span><span class="main">.</span> defAss <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span> <span class="bound">v</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹'liveness' of an SSA value is defined inductively starting from simple uses so that
    a circle of \pf s is not considered live.›</span></span>

  <span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">inductive_internals</span><span class="main">]</span><span class="main">]</span>
  <span class="keyword1"><span class="command">inductive</span></span> <span class="entity">liveVal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'val</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">g</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'g</span></span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    liveSimple<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">val</span></span></span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">liveVal</span> <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">val</span></span></span>"</span></span>
  <span class="main">|</span> livePhi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">liveVal</span> <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">;</span> phiArg <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">liveVal</span> <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">pruned</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">val</span><span class="main">.</span> <span class="bound">val</span> <span class="main">∈</span> phiDefs <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span> <span class="main">⟶</span> liveVal <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">val</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">lemmas</span></span> <span class="quoted">"CFG_SSA_wf_defs"</span> <span class="main">=</span> CFG_SSA_defs defNode_code phi_def isTrivialPhi_def trivial_def redundant_def liveVal_def pruned_def
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_SSA_wf <span class="main">=</span> CFG_SSA <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span> <span class="main">+</span> CFG_SSA_wf_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Entry</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">phis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> allUses_def_ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">v</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="free">n</span><span class="main">;</span> <span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> defAss <span class="free">g</span> <span class="free">n</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Entry_no_phis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="free">Entry</span> <span class="free">g</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="SSA_CFG-allVars_in_allDefs"><span class="command">lemma</span></span> allVars_in_allDefs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allVars <span class="free">g</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> <span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> allVars_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> allUses_def_ass<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> defAss_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Entry_reaches<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1" id="SSA_CFG-phiDefs_Entry_empty"><span class="command">lemma</span></span> phiDefs_Entry_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"phiDefs <span class="free">g</span> <span class="main">(</span><span class="free">Entry</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phiDefs_def<span class="main">)</span>

  <span class="keyword1" id="SSA_CFG-phi_Entry_empty"><span class="command">lemma</span></span> phi_Entry_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> <span class="free">Entry</span> <span class="free">g</span> <span class="main">⟹</span> phi <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> None"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phi_def<span class="main">)</span>

  <span class="keyword1" id="SSA_CFG-defNode_ex1"><span class="command">lemma</span></span> defNode_ex1<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ex_ex1I<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="skolem">n</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>allVars_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="skolem">n</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">from</span></span> n<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize_elim</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Entry_reaches<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> allUses_def_ass<span class="main">[</span><span class="operator">OF</span> True n<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">drule</span> defAssD<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> ns this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> path2_in_αn<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> n<span class="main">(</span>1<span class="main">)</span> m <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="bound">n</span> <span class="main">⟹</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="bound">m</span> <span class="main">⟹</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> allDefs_disjoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-defNode_def"><span class="command">lemma</span></span> defNode_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allVars <span class="free">g</span> <span class="main">⟹</span> defNode <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> defNode_code <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> the1_list<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> defNode_ex1<span class="main">)</span>

  <span class="keyword1" id="SSA_CFG-defNode"><span class="command">lemma</span></span> defNode<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>defNode <span class="free">g</span> <span class="free">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> defNode_def<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> theI'<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> defNode_ex1<span class="main">)</span>

  <span class="keyword1" id="SSA_CFG-defNode_eq"><span class="command">lemma</span></span> defNode_eq<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> defNode_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allDefs_in_allVars<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> the1_equality<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> defNode_ex1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allDefs_in_allVars<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">n</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>assms<span class="main">)</span>

  <span class="keyword1" id="SSA_CFG-defNode_cases"><span class="command">lemma</span></span> defNode_cases<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>simpleDef<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="free">v</span><span class="main">)</span>"</span></span>
          <span class="main">|</span> <span class="main">(</span>phi<span class="main">)</span>       <span class="quoted"><span class="quoted">"phi <span class="free">g</span> <span class="free">v</span> <span class="main">≠</span> None"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="free">v</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> simpleDef<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">[</span><span class="operator">THEN</span> defNode<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phi<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> allDefs_def phiDefs_def phi_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-phi_phiDefs"><span class="command">lemma</span></span> phi_phiDefs<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"phi <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> Some <span class="free">vs</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> phiDefs <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>phiDefs_def phi_def<span class="main">)</span>

  <span class="keyword1" id="SSA_CFG-simpleDef_not_phi"><span class="command">lemma</span></span> simpleDef_not_phi<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"phi <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> simpleDefs_phiDefs_disjoint <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phi_def phiDefs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-phi_wf"><span class="command">lemma</span></span> phi_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"phi <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> Some <span class="free">vs</span> <span class="main">⟹</span> length <span class="main">(</span>predecessors <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="free">vs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phis_wf<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phi_def<span class="main">)</span>

  <span class="keyword1" id="SSA_CFG-phi_finite"><span class="command">lemma</span></span> phi_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>dom <span class="main">(</span>phi <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="bound">v</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"phi <span class="free">g</span> <span class="main">=</span> <span class="free">phis</span> <span class="free">g</span> <span class="main">∘</span> <span class="var">?f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phi_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="var">?f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>injI<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>dom <span class="main">(</span><span class="free">phis</span> <span class="free">g</span> <span class="main">∘</span> <span class="var">?f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> finite_dom_comp<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phis_finite inj_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-phiUses_exI"><span class="command">lemma</span></span> phiUses_exI<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">v'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> set <span class="free">vs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> predecessors <span class="free">g</span> <span class="free">n</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> phis_wf <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">vs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phi_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> i assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiUsesI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phiUses_def phi_def set_zip<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>i<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> phis_wf<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-phiArg_exI"><span class="command">lemma</span></span> phiArg_exI<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"phi <span class="free">g</span> <span class="free">v</span> <span class="main">≠</span> None"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">v'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"phiArg <span class="free">g</span> <span class="free">v</span> <span class="free">v'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"phi <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> Some <span class="skolem">vs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiUses_exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>that <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phi_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-phiUses_exI'"><span class="command">lemma</span></span> phiUses_exI'<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"phiArg <span class="free">g</span> <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">m</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"phi <span class="free">g</span> <span class="free">p</span> <span class="main">=</span> Some <span class="skolem">vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="skolem">vs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">vs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth phiArg_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> phis_wf <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>predecessors <span class="free">g</span> <span class="var">?n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phi_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> vs i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="main">(</span>predecessors <span class="free">g</span> <span class="var">?n</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiUsesI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phiUses_def phi_def set_zip<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>i<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> phis_wf<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-phiArg_in_allVars"><span class="command">lemma</span></span> phiArg_in_allVars<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"phiArg <span class="free">g</span> <span class="free">v</span> <span class="free">v'</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"phi <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> Some <span class="skolem">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> set <span class="skolem">vs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">m</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>predecessors <span class="free">g</span> <span class="var">?n</span><span class="main">)</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> set_zip_leftI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> phi_wf<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> vs<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> phi_def phis_in_αn<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> m <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> n m vs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiUsesI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phi_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allUses_in_allVars<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>allUses_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-defAss_defNode"><span class="command">lemma</span></span> defAss_defNode<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"defAss <span class="free">g</span> <span class="free">m</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span> <span class="main">∈</span> set <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>defAss_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> defNode <span class="free">g</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> defNode_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> n <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span> <span class="main">∈</span> set <span class="free">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>defAss_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-defUse_path_ex"><span class="command">lemma</span></span> defUse_path_ex<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="free">v</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"EntryPath <span class="free">g</span> <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defAss <span class="free">g</span> <span class="free">m</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allUses_def_ass<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"EntryPath <span class="free">g</span> <span class="skolem">ns</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">atomize_elim</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Entry_reachesE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> defAss_defNode<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> ns<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="free">v</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">ns'</span> <span class="skolem">ns</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> path2_split_ex'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sublist.suffix_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> ns<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> EntryPath_suffix<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-defUse_path_dominated"><span class="command">lemma</span></span> defUse_path_dominated<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="free">v</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">∈</span> set <span class="free">ns</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="free">v</span><span class="main">)</span> <span class="free">n'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> dominatesI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">es</span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">es</span><span class="main">→</span><span class="free">n'</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n'</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">ns'</span> <span class="free">ns</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> path2_split_ex<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sublist.suffix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defAss <span class="free">g</span> <span class="free">n</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allUses_def_ass<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> asm ns'<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">es</span><span class="main">@</span>tl <span class="skolem">ns'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> defAss_defNode<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> suffix_tl_subset<span class="main">[</span><span class="operator">OF</span> ns'<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span> <span class="main">∈</span> set <span class="skolem">es</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-allUses_dominated"><span class="command">lemma</span></span> allUses_dominated<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="free">v</span><span class="main">)</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="free">v</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> defUse_path_ex<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> simple_path2<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> defUse_path_dominated<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-phiArg_path_ex'"><span class="command">lemma</span></span> phiArg_path_ex'<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"phiArg <span class="free">g</span> <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns</span> <span class="free">m</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="free">q</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"EntryPath <span class="free">g</span> <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phiUses_exI'<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="free">q</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"EntryPath <span class="free">g</span> <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> defUse_path_ex<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> m <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-phiArg_path_ex"><span class="command">lemma</span></span> phiArg_path_ex<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"phiArg <span class="free">g</span> <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="free">q</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span>defNode <span class="free">g</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ns</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phiArg_path_ex'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1" id="SSA_CFG-phiArg_tranclp_path_ex"><span class="command">lemma</span></span> phiArg_tranclp_path_ex<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> <span class="free">r</span> <span class="bound">p</span> <span class="bound">q</span> <span class="main">⟹</span> phiArg <span class="free">g</span> <span class="bound">p</span> <span class="bound">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="free">q</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span>defNode <span class="free">g</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ns</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="free">ns</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span> <span class="bound">q</span> <span class="bound">m</span> <span class="bound">ns'</span><span class="main">.</span> <span class="free">r</span> <span class="bound">p</span> <span class="bound">q</span> <span class="main">∧</span> <span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="bound">q</span><span class="main">-</span><span class="bound">ns'</span><span class="main">→</span><span class="bound">m</span> <span class="main">∧</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="bound">q</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="bound">ns'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="bound">m</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="bound">ns'</span> <span class="main">∧</span> set <span class="bound">ns'</span> <span class="main">⊆</span> set <span class="free">ns</span> <span class="main">∧</span> defNode <span class="free">g</span> <span class="bound">p</span> <span class="main">∈</span> set <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_tranclp_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> base.hyps base.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="free">q</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">q</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiArg_path_ex'<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> simple_path2<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="free">q</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">@</span><span class="main">[</span>defNode <span class="free">g</span> <span class="skolem">p</span><span class="main">]</span><span class="main">→</span>defNode <span class="free">g</span> <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">ns'</span><span class="main">@</span><span class="main">[</span>defNode <span class="free">g</span> <span class="skolem">p</span><span class="main">]</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> base.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> ns<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">ns'</span> <span class="main">@</span> <span class="main">[</span>defNode <span class="free">g</span> <span class="skolem">p</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> base.hyps ns'
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="skolem">p</span> <span class="free">q</span> <span class="main">∧</span>
          <span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="free">q</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="skolem">m</span> <span class="main">∧</span>
          defNode <span class="free">g</span> <span class="free">q</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns'</span><span class="main">)</span> <span class="main">∧</span>
          <span class="free">q</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">m</span> <span class="main">∧</span>
          <span class="skolem">m</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">∈</span> set <span class="skolem">ns'</span> <span class="main">∧</span> set <span class="skolem">ns'</span> <span class="main">⊆</span> set <span class="main">(</span><span class="skolem">ns'</span> <span class="main">@</span> <span class="main">[</span>defNode <span class="free">g</span> <span class="skolem">p</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> defNode <span class="free">g</span> <span class="skolem">p</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ns'</span> <span class="main">@</span> <span class="main">[</span>defNode <span class="free">g</span> <span class="skolem">p</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">p</span> <span class="skolem">p'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> step.prems<span class="main">(</span>2<span class="main">)</span> step.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns'<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="skolem">p'</span><span class="main">-</span><span class="skolem">ns'<span class="hidden">⇩</span><sub>2</sub></span><span class="main">→</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">p'</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns'<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiArg_path_ex'<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> simple_path2<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="skolem">p'</span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">→</span>defNode <span class="free">g</span> <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">ns'<span class="hidden">⇩</span><sub>2</sub></span><span class="main">@</span><span class="main">[</span>defNode <span class="free">g</span> <span class="skolem">p</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize_elim</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> step.IH<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ns</span>
      <span class="keyword3"><span class="command">assume</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="free">q</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span>defNode <span class="free">g</span> <span class="skolem">p'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> length <span class="skolem">ns</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>set <span class="main">(</span>butlast <span class="skolem">ns</span><span class="main">)</span><span class="main">.</span>
             <span class="main">∃</span><span class="bound">p</span> <span class="bound">q</span> <span class="bound">m</span> <span class="bound">ns'</span><span class="main">.</span>
                <span class="free">r</span> <span class="bound">p</span> <span class="bound">q</span> <span class="main">∧</span>
                <span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="bound">q</span><span class="main">-</span><span class="bound">ns'</span><span class="main">→</span><span class="bound">m</span> <span class="main">∧</span>
                defNode <span class="free">g</span> <span class="bound">q</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="bound">ns'</span><span class="main">)</span> <span class="main">∧</span>
                <span class="bound">q</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="bound">m</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="bound">ns'</span> <span class="main">∧</span> set <span class="bound">ns'</span> <span class="main">⊆</span> set <span class="skolem">ns</span> <span class="main">∧</span> defNode <span class="free">g</span> <span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?path</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">ns</span><span class="main">@</span>tl <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> ns_ns<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="free">q</span><span class="main">-</span><span class="var">?path</span><span class="main">→</span>defNode <span class="free">g</span> <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> length <span class="var">?path</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ns ns<span class="hidden">⇩</span><sub>2</sub><span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> step.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> ns_ns<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
        <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="var">?path</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span> <span class="bound">q</span> <span class="bound">m</span> <span class="bound">ns'a</span><span class="main">.</span>
          <span class="free">r</span> <span class="bound">p</span> <span class="bound">q</span> <span class="main">∧</span>
          <span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="bound">q</span><span class="main">-</span><span class="bound">ns'a</span><span class="main">→</span><span class="bound">m</span> <span class="main">∧</span>
          defNode <span class="free">g</span> <span class="bound">q</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="bound">ns'a</span><span class="main">)</span> <span class="main">∧</span>
          <span class="bound">q</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="bound">m</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">∈</span> set <span class="bound">ns'a</span> <span class="main">∧</span> set <span class="bound">ns'a</span> <span class="main">⊆</span> set <span class="var">?path</span> <span class="main">∧</span> defNode <span class="free">g</span> <span class="bound">p</span> <span class="main">∈</span> set <span class="var">?path</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ns</span><span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> IH <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"
                <span class="free">r</span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">∧</span>
                <span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="skolem">q</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="skolem">m</span> <span class="main">∧</span>
                defNode <span class="free">g</span> <span class="skolem">q</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns'</span><span class="main">)</span> <span class="main">∧</span>
                <span class="skolem">q</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="skolem">m</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">∈</span> set <span class="skolem">ns'</span> <span class="main">∧</span> set <span class="skolem">ns'</span> <span class="main">⊆</span> set <span class="skolem">ns</span> <span class="main">∧</span> defNode <span class="free">g</span> <span class="skolem">p</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">from</span></span> ns ns<span class="hidden">⇩</span><sub>2</sub> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?path</span> <span class="main">=</span> butlast <span class="skolem">ns</span><span class="main">@</span><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> concat_join<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> path2_def<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> ns<span class="hidden">⇩</span><sub>2</sub><span class="main">(</span>1<span class="main">)</span> n False 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> butlast_append path2_not_Nil<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> step.hyps ns'<span class="hidden">⇩</span><sub>2</sub> ns<span class="hidden">⇩</span><sub>2</sub><span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">subst</span> 1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">p</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">p'</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> path2_not_Nil<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> step.prems<span class="main">(</span>2<span class="main">)</span> step.hyps<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-non_dominated_predecessor"><span class="command">lemma</span></span> non_dominated_predecessor<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="free">Entry</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">m</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>dominates <span class="free">g</span> <span class="free">n</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize_elim</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Entry_reaches<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ns'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> simple_path2<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>butlast <span class="skolem">ns'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> ns'<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span>butlast <span class="skolem">ns'</span><span class="main">→</span><span class="var">?m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> path2_unsnoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> m<span class="main">(</span>1<span class="main">)</span> ns'<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>dominatesE<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemmas</span></span> dominates_trans'<span class="main">[</span><span class="operator">trans</span><span class="main">,</span> <span class="operator">elim</span><span class="main">]</span> <span class="main">=</span> dominates_trans<span class="main">[</span><span class="operator">OF</span> invar<span class="main">]</span>
  <span class="keyword1"><span class="command">lemmas</span></span> strict_dom_trans'<span class="main">[</span><span class="operator">trans</span><span class="main">,</span> <span class="operator">elim</span><span class="main">]</span> <span class="main">=</span> strict_dom_trans<span class="main">[</span><span class="operator">OF</span> invar<span class="main">]</span>
  <span class="keyword1"><span class="command">lemmas</span></span> dominates_refl'<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> dominates_refl<span class="main">[</span><span class="operator">OF</span> invar<span class="main">]</span>
  <span class="keyword1"><span class="command">lemmas</span></span> dominates_antisymm'<span class="main">[</span><span class="operator">dest</span><span class="main">]</span> <span class="main">=</span> dominates_antisymm<span class="main">[</span><span class="operator">OF</span> invar<span class="main">]</span>

  <span class="keyword1" id="SSA_CFG-liveVal_in_allVars"><span class="command">lemma</span></span> liveVal_in_allVars<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"liveVal <span class="free">g</span> <span class="free">v</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> liveVal.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> allUses_in_allVars<span class="main">)</span>

  <span class="keyword1" id="SSA_CFG-phi_no_closed_loop"><span class="command">lemma</span></span> phi_no_closed_loop<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"phi <span class="free">g</span> <span class="free">p</span> <span class="main">=</span> Some <span class="free">vs</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">≠</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">p</span> <span class="main">=</span> <span class="free">Entry</span> <span class="free">g</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">p</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="var">?n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ns</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> simple_Entry_path<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>butlast <span class="skolem">ns</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> ns False <span class="keyword3"><span class="command">obtain</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span>butlast <span class="skolem">ns</span><span class="main">→</span><span class="var">?m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="var">?n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> path2_unsnoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiUses_exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>phi_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"defAss <span class="free">g</span> <span class="var">?m</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allUses_def_ass<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ns</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">drule</span> defAssD<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="var">?n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allDefs_disjoint'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> ns l m <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-phis_phi"><span class="command">lemma</span></span> phis_phi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">vs</span> <span class="main">⟹</span> phi <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> Some <span class="free">vs</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> phi_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> defNode_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> allDefs_def phi_def phiDefs_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> phis_in_αn<span class="main">)</span>

  <span class="keyword1" id="SSA_CFG-trivial_phi"><span class="command">lemma</span></span> trivial_phi<span class="main">:</span> <span class="quoted"><span class="quoted">"trivial <span class="free">g</span> <span class="free">v</span> <span class="main">⟹</span> phi <span class="free">g</span> <span class="free">v</span> <span class="main">≠</span> None"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trivial_def isTrivialPhi_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

  <span class="keyword1" id="SSA_CFG-trivial_finite"><span class="command">lemma</span></span> trivial_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">v</span><span class="main">.</span> trivial <span class="free">g</span> <span class="bound">v</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ phi_finite<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> trivial_phi<span class="main">)</span>

  <span class="keyword1" id="SSA_CFG-trivial_in_allVars"><span class="command">lemma</span></span> trivial_in_allVars<span class="main">:</span> <span class="quoted"><span class="quoted">"trivial <span class="free">g</span> <span class="free">v</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> trivial_phi<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> allDefs_def phiDefs_def image_def phi_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> phis_in_αn <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> allDefs_in_allVars<span class="main">)</span>

  <span class="keyword1"><span class="command">declare</span></span> phiArg_def <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bundling of CFG and Equivalent SSA CFG›</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_SSA_Transformed_base <span class="main">=</span> old<span class="main">:</span> CFG_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="main">+</span> CFG_SSA_wf_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Entry</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">oldDefs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">oldUses</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">phis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'val</span> <span class="main">⇒</span> <span class="tfree">'var</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_SSA_Transformed <span class="main">=</span> CFG_SSA_Transformed_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span> <span class="quoted"><span class="free">var</span></span>
  <span class="main">+</span> old<span class="main">:</span> CFG_wf <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="main">+</span> CFG_SSA_wf <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Entry</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">oldDefs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">oldUses</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">phis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'val</span> <span class="main">⇒</span> <span class="tfree">'var</span>"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> oldDefs_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">oldDefs</span> <span class="free">g</span> <span class="free">n</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="main">`</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> oldUses_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">oldUses</span> <span class="free">g</span> <span class="free">n</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="main">`</span> <span class="free">uses</span> <span class="free">g</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> conventional<span class="main">:</span> <span class="quoted"><span class="quoted">"
<span class="main">⟦</span><span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span><span class="main">;</span> <span class="free">n</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span><span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="free">n</span><span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="free">m</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span><span class="main">;</span> <span class="free">v'</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="free">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v'</span> <span class="main">≠</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> phis_same_var<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">vs</span> <span class="main">⟹</span> <span class="free">v'</span> <span class="main">∈</span> set <span class="free">vs</span> <span class="main">⟹</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v'</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> allDefs_var_disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="free">n</span><span class="main">;</span> <span class="free">v'</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="free">n</span><span class="main">;</span> <span class="free">v</span> <span class="main">≠</span> <span class="free">v'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v'</span> <span class="main">≠</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="SSA_CFG-conventional'"><span class="command">lemma</span></span> conventional'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span><span class="main">;</span> <span class="free">n</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span><span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="free">n</span><span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="free">m</span><span class="main">;</span> <span class="free">v'</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="free">x</span><span class="main">;</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v'</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conventional <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="SSA_CFG-conventional''"><span class="command">lemma</span></span> conventional''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="free">v</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span><span class="main">;</span> defNode <span class="free">g</span> <span class="free">v</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span><span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="free">m</span><span class="main">;</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v'</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v</span><span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> allVars <span class="free">g</span><span class="main">;</span> <span class="free">v'</span> <span class="main">∈</span> allVars <span class="free">g</span><span class="main">⟧</span> <span class="main">⟹</span> defNode <span class="free">g</span> <span class="free">v'</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conventional'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> v<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">v</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> v'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">v'</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1" id="SSA_CFG-phiArg_same_var"><span class="command">lemma</span></span> phiArg_same_var<span class="main">:</span> <span class="quoted"><span class="quoted">"phiArg <span class="free">g</span> <span class="free">p</span> <span class="free">q</span> <span class="main">⟹</span> <span class="free">var</span> <span class="free">g</span> <span class="free">q</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> phiArg_def phi_def phis_same_var<span class="main">)</span>

  <span class="keyword1" id="SSA_CFG-oldDef_defAss"><span class="command">lemma</span></span> oldDef_defAss<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">m</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ns</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> length_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">ns</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>2-<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">v</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> defAss_defNode<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allUses_def_ass<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> defNode_cases<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> simpleDef
      <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted">"1.prems"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> oldDefs_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> phi
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"phi <span class="free">g</span> <span class="skolem">v</span> <span class="main">=</span> Some <span class="skolem">vs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>3<span class="main">)</span> 2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="var">?V</span>"</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">ns'</span> <span class="skolem">ns</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> old.path2_split_ex<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>butlast <span class="skolem">ns'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> ns' phi <span class="keyword1"><span class="command">have</span></span> nontriv<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ns'</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_nontrivial<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span>butlast <span class="skolem">ns'</span><span class="main">→</span><span class="var">?V'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?V'</span> <span class="main">∈</span> set <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="var">?V</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ns'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> old.path2_unsnoc<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> phi vs <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="var">?V'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v'</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiArg_exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phi_def phis_same_var phiArg_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted">"1.IH"</span><span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>butlast <span class="skolem">ns'</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ns' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ns'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> old.path2_not_Nil2 <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prefix_length_le<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="var">?V'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ns'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v'</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span>
          <span class="keyword1"><span class="command">using</span></span> ns'<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> set_mono_prefix<span class="main">]</span> v'<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted">"1.prems"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_set_butlastD<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-allDef_path_from_simpleDef"><span class="command">lemma</span></span> allDef_path_from_simpleDef<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">n</span> <span class="free">ns</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span>defNode <span class="free">g</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"old.EntryPath <span class="free">g</span> <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="var">?V</span>"</span></span> <span class="quoted"><span class="quoted">"old.EntryPath <span class="free">g</span> <span class="skolem">ns</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.Entry_reachesE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">v</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> defNode_cases<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> simpleDef
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> oldDefs_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> phi
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"phi <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> Some <span class="skolem">vs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>butlast <span class="skolem">ns</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> ns phi <span class="keyword1"><span class="command">have</span></span> nontriv<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ns</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_nontrivial<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span>butlast <span class="skolem">ns</span><span class="main">→</span><span class="var">?V'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?V'</span> <span class="main">∈</span> set <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="var">?V</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ns<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> old.path2_unsnoc<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> phi vs <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="var">?V'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v'</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiArg_exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phi_def phis_same_var phiArg_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 3<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ns</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v'</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> oldDef_defAss<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="free">g</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> ns <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">n</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="var">?V</span>"</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">ns'</span> <span class="skolem">ns</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_split_ex'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ns<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> in_set_butlastD <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sublist.suffix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> n<span class="main">(</span>2<span class="main">)</span> v'<span class="main">(</span>2<span class="main">)</span> ns<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> old.EntryPath_suffix<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-defNode_var_disjoint"><span class="command">lemma</span></span> defNode_var_disjoint<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">p</span> <span class="main">=</span> defNode <span class="free">g</span> <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">p</span> <span class="main">≠</span> <span class="free">var</span> <span class="free">g</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allDefs_var_disjoint<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="free">g</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-phiArg_distinct_nodes"><span class="command">lemma</span></span> phiArg_distinct_nodes<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"phiArg <span class="free">g</span> <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">p</span> <span class="main">≠</span> defNode <span class="free">g</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">p</span> <span class="main">=</span> defNode <span class="free">g</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">p</span> <span class="main">≠</span> <span class="free">var</span> <span class="free">g</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> defNode_var_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">q</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phiArg_same_var<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-phiArgs_def_distinct"><span class="command">lemma</span></span> phiArgs_def_distinct<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"phiArg <span class="free">g</span> <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"phiArg <span class="free">g</span> <span class="free">p</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">q</span> <span class="main">≠</span> defNode <span class="free">g</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">q</span> <span class="main">=</span> defNode <span class="free">g</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">q</span> <span class="main">≠</span> <span class="free">var</span> <span class="free">g</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> defNode_var_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> phiArg_same_var<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> phiArg_same_var<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-defNode_not_on_defUse_path"><span class="command">lemma</span></span> defNode_not_on_defUse_path<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="free">p</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">p</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">p</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">q</span> <span class="main">∉</span> set <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">q</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">≠</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> defNode_var_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> conventional'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> p<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> p<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ns</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> old.path2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-defUse_paths_disjoint"><span class="command">lemma</span></span> defUse_paths_disjoint<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="free">p</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">p</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="free">q</span><span class="main">-</span><span class="free">ms</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">q</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">ms</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">p</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ns</span> <span class="main">∩</span> set <span class="free">ms</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> equals0I<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="free">ns</span> <span class="main">∩</span> set <span class="free">ms</span>"</span></span>

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">ns</span> <span class="skolem">n</span>
      <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="skolem">p</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">p</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> p<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> dom<span class="main">:</span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allUses_dominated<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">y</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">ns'</span> <span class="skolem">ns</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> old.path2_split_first_last<span class="main"><span class="main">[</span></span><span class="operator">OF</span> p<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> y<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> suffix_tl_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ns'</span></span> <span class="quoted"><span class="skolem">ns</span></span><span class="main">]</span> p<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.dominates_extend<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ms<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ns'</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms y <span class="keyword1"><span class="command">have</span></span> dom<span class="main">:</span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="free">q</span><span class="main">)</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">ns</span> <span class="skolem">n</span> <span class="skolem">q</span> <span class="skolem">ms</span> <span class="skolem">m</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">q</span>"</span></span>

      <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="skolem">p</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">p</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="var">?P</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="skolem">q</span><span class="main">-</span><span class="skolem">ms</span><span class="main">→</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">q</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ms</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="var">?Q</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="skolem">ms</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">p</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> dom<span class="main">:</span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="var">?P</span> <span class="var">?Q</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pqs</span></span> <span class="keyword2"><span class="keyword">where</span></span> pqs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?P</span><span class="main">-</span><span class="skolem">pqs</span><span class="main">→</span><span class="var">?Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">pqs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> old.dominates_path<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> old.simple_path2<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> p <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">y</span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">→</span><span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_split_first_last<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> q <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ms<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> ms<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?Q</span><span class="main">-</span><span class="skolem">ms<span class="hidden">⇩</span><sub>1</sub></span><span class="main">→</span><span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">ms<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">ms</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_split_first_last<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">q</span> <span class="main">≠</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conventional<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ p<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?path</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">pqs</span><span class="main">@</span>tl <span class="skolem">ms<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">@</span>tl <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?P</span><span class="main">-</span><span class="var">?path</span><span class="main">→</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pqs ms<span class="hidden">⇩</span><sub>1</sub> ns<span class="hidden">⇩</span><sub>2</sub>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>append_assoc <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>old.path2_app<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p<span class="main">(</span>2<span class="main">)</span> ns<span class="hidden">⇩</span><sub>2</sub><span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> suffix_tl_subset<span class="main">,</span> <span class="operator">THEN</span> subsetD<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ms</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> conventional'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> v'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> v<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">q</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ms<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ms<span class="hidden">⇩</span><sub>1</sub><span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">THEN</span> prefix_tl_subset<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="var">?path</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pqs<span class="main">(</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> set_tl_append'<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">≠</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> defNode_var_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">pqs</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pqs <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_nontriv<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">pqs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pqs <span class="keyword1"><span class="command">unfolding</span></span> old.path2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>last_in_tl<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pqs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="var">?path</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">OF</span> p _ _ q<span class="main">]</span> this<span class="main">[</span><span class="operator">OF</span> q _ _ p<span class="main">]</span> y dom <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.dominates_antitrans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ dom<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-oldDefsI"><span class="command">lemma</span></span> oldDefsI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> oldDefs_def<span class="main">)</span>
 
  <span class="keyword1" id="SSA_CFG-simpleDefs_phiDefs_var_disjoint"><span class="command">lemma</span></span> simpleDefs_phiDefs_var_disjoint<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> phiDefs <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v''</span></span> <span class="keyword2"><span class="keyword">where</span></span> v''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v''</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v''</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> oldDefs_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v''</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> simpleDefs_phiDefs_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phiArg_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> v'' assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> allDefs_var_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">v''</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SSA_CFG-liveVal_use_path"><span class="command">lemma</span></span> liveVal_use_path<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"liveVal <span class="free">g</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns</span> <span class="free">m</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="free">v</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">oldUses</span> <span class="free">g</span> <span class="free">m</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>liveSimple <span class="skolem">m</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> liveSimple.hyps <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allUses_in_allVars<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> liveSimple.hyps <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="skolem">v</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">v</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> defUse_path_ex<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> uses_in_allUses <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> old.simple_path2<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> liveSimple.prems<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">oldUses</span> <span class="free">g</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> liveSimple.hyps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> oldUses_def<span class="main">)</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">ns</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v'</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> oldDefs_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> asm liveSimple.hyps <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> conventional<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ns<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> notE<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">ns</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span> <span class="main">∉</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>livePhi <span class="skolem">v</span> <span class="skolem">v'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> livePhi.hyps <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v'</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> phiArg_same_var<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> livePhi.IH<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ns</span> <span class="skolem">m</span>
      <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="skolem">v</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">oldUses</span> <span class="free">g</span> <span class="skolem">m</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">ns</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span> <span class="main">∉</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> livePhi.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="skolem">v'</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="skolem">m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">m'</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> set <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">v'</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phiArg_path_ex'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> old.simple_path2<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> livePhi.prems<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="skolem">v'</span><span class="main">-</span><span class="main">(</span><span class="skolem">ns'</span><span class="main">@</span><span class="main">[</span>defNode <span class="free">g</span> <span class="skolem">v</span><span class="main">]</span><span class="main">)</span><span class="main">@</span>tl <span class="skolem">ns</span><span class="main">→</span><span class="skolem">m</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> old.path2_app<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> old.path2_snoc<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ns'<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>3<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asm<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v'</span> <span class="main">∈</span> <span class="free">oldUses</span> <span class="free">g</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
          <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">ns'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v''</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v''</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> oldDefs_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> asm ns'<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> conventional<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ns'<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">v''</span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> notE<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="main">(</span><span class="main">(</span><span class="skolem">ns'</span><span class="main">@</span><span class="main">[</span>defNode <span class="free">g</span> <span class="skolem">v</span><span class="main">]</span><span class="main">)</span><span class="main">@</span>tl <span class="skolem">ns</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">v'</span> <span class="main">∉</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> simpleDefs_phiDefs_var_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">v</span>"</span></span><span class="main">]</span> livePhi.hyps<span class="main">(</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_tl_append'<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> subsetD<span class="main"><span class="main">]</span></span> asm<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phiArg_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Minimality">
<div class="head">
<h1>Theory Minimality</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Minimality.thy
    Author:     Sebastian Ullrich
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Minimality›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We show that every reducible CFG without trivial \pf s is minimal, recreating the proof in~\cite{braun13cc}.
  The original proof is inlined as prose text.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Minimality
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#SSA_CFG">SSA_CFG</a> <a href="#Serial_Rel">Serial_Rel</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> graph_path
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Cytron's definition of path convergence›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">pathsConverge</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">→</span><span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">→</span><span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">∧</span> length <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">∧</span> length <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> length <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">}</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">!</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="bound">j</span> <span class="main">=</span> length <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">-</span> <span class="main">1</span> <span class="main">∨</span> <span class="bound">k</span> <span class="main">=</span> length <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Simplified definition›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">pathsConverge'</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">→</span><span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">→</span><span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">∧</span> length <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">∧</span> length <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span>
    set <span class="main">(</span>butlast <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>butlast <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

  <span class="keyword1" id="Minimality-pathsConverge'"><span class="command">lemma</span></span> pathsConverge'<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pathsConverge <span class="free">g</span> <span class="free">x</span> <span class="free">xs</span> <span class="free">y</span> <span class="free">ys</span> <span class="free">z</span> <span class="main">⟷</span> pathsConverge' <span class="free">g</span> <span class="free">x</span> <span class="free">xs</span> <span class="free">y</span> <span class="free">ys</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> length <span class="free">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">ys</span><span class="main">}</span><span class="main">.</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">!</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="bound">j</span> <span class="main">=</span> length <span class="free">xs</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∨</span> <span class="bound">k</span> <span class="main">=</span> length <span class="free">ys</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>
          <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x'</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="free">xs</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y'</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="free">ys</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">≠</span> <span class="bound">y'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">ys</span><span class="main">}</span><span class="main">.</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">!</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="bound">j</span> <span class="main">=</span> length <span class="free">xs</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∨</span> <span class="bound">k</span> <span class="main">=</span> length <span class="free">ys</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x'</span><span class="main">∈</span>set <span class="main">(</span>butlast <span class="free">xs</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y'</span><span class="main">∈</span>set <span class="main">(</span>butlast <span class="free">ys</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">≠</span> <span class="bound">y'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x'</span> <span class="skolem">y'</span>
        <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="free">ys</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">y'</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">x'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> butlast_idx<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> j <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">=</span> <span class="skolem">y'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="free">ys</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> butlast_idx<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> k <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">[</span><span class="operator">THEN</span> bspec<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">j</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">THEN</span> bspec<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x'</span><span class="main">∈</span>set <span class="main">(</span>butlast <span class="free">xs</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y'</span><span class="main">∈</span>set <span class="main">(</span>butlast <span class="free">ys</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">≠</span> <span class="bound">y'</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">xs</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">ys</span><span class="main">}</span><span class="main">.</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">!</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="bound">j</span> <span class="main">=</span> length <span class="free">xs</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∨</span> <span class="bound">k</span> <span class="main">=</span> length <span class="free">ys</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="skolem">k</span>
        <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="free">ys</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">!</span> <span class="skolem">k</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> length <span class="free">xs</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">∨</span> <span class="skolem">k</span> <span class="main">=</span> length <span class="free">ys</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> length <span class="free">xs</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">≠</span> length <span class="free">ys</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">!</span> <span class="skolem">k</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1<span class="main">)</span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x'</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> butlast_idx'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>2<span class="main">)</span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y'</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="free">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> butlast_idx'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x'</span> <span class="main">≠</span> <span class="var">?y'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>pathsConverge_def pathsConverge'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Minimality-pathsConvergeI"><span class="command">lemma</span></span> pathsConvergeI<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">x</span><span class="main">-</span><span class="free">xs</span><span class="main">→</span><span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">y</span><span class="main">-</span><span class="free">ys</span><span class="main">→</span><span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>butlast <span class="free">xs</span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>butlast <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pathsConverge <span class="free">g</span> <span class="free">x</span> <span class="free">xs</span> <span class="free">y</span> <span class="free">ys</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_is_Nil_conv disjoint_iff_not_equal length_butlast list.collapse list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> nth_Cons_0 nth_butlast nth_mem path2_def split_list zero_less_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>pathsConverge'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A (control) flow graph G is reducible iff for each cycle C of G there is a node of C that dominates all other nodes in C.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> graph_Entry<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">reducible</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">n</span> <span class="bound">ns</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">⊢</span> <span class="bound">n</span><span class="main">-</span><span class="bound">ns</span><span class="main">→</span><span class="bound">n</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="main">∈</span> set <span class="bound">ns</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set <span class="bound">ns</span><span class="main">.</span> dominates <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">m</span> <span class="bound">n</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> CFG_SSA_Transformed
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A $\phi$ function for variable v is necessary in block Z iff two non-null paths $X \rightarrow^+ Z$ and $Y \rightarrow^+ Z$ converge at a block Z,
    such that the blocks X and Y contain assignments to v.›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">necessaryPhi</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">n</span> <span class="bound">ns</span> <span class="bound">m</span> <span class="bound">ms</span><span class="main">.</span> old.pathsConverge <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span> <span class="bound">ns</span> <span class="bound">m</span> <span class="bound">ms</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">m</span>"</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">necessaryPhi'</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">val</span></span></span> <span class="main">≡</span> necessaryPhi <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span><span class="free">var</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">val</span></span></span><span class="main">)</span> <span class="main">(</span>defNode <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">val</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">unnecessaryPhi</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">val</span></span></span> <span class="main">≡</span> phi <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">val</span></span></span> <span class="main">≠</span> None <span class="main">∧</span> <span class="main">¬</span>necessaryPhi' <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">val</span></span></span>"</span></span>

  <span class="keyword1" id="Minimality-necessaryPhiI"><span class="command">lemma</span></span> necessaryPhiI<span class="main">:</span> <span class="quoted"><span class="quoted">"old.pathsConverge <span class="free">g</span> <span class="free">n</span> <span class="free">ns</span> <span class="free">m</span> <span class="free">ms</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="free">m</span> <span class="main">⟹</span> necessaryPhi <span class="free">g</span> <span class="free">v</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> necessaryPhi_def<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A program with only necessary $\phi$ functions is in minimal SSA form.›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">cytronMinimal</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> allVars <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">.</span> phi <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">v</span> <span class="main">≠</span> None <span class="main">⟶</span> necessaryPhi' <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">v</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Let p be a $\phi$ function in a block P. Furthermore, let q in a block Q
and r in a block R be two operands of p, such that p, q and r are pairwise distinct.
Then at least one of Q and R does not dominate P.›</span></span>
  <span class="keyword1" id="Minimality-2"><span class="command">lemma</span></span> 2<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"phiArg <span class="free">g</span> <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"phiArg <span class="free">g</span> <span class="free">p</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="free">p</span><span class="main">,</span> <span class="free">q</span><span class="main">,</span> <span class="free">r</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>def_dominates <span class="free">g</span> <span class="free">q</span> <span class="free">p</span> <span class="main">∧</span> def_dominates <span class="free">g</span> <span class="free">r</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main">)</span>
    <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Proof. Assume that Q and R dominate P, i.e., every path from the start block to P contains Q and R.›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"def_dominates <span class="free">g</span> <span class="free">q</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"def_dominates <span class="free">g</span> <span class="free">r</span> <span class="free">p</span>"</span></span>

    <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Since immediate dominance forms a tree, Q dominates R or R dominates Q.›</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"def_dominates <span class="free">g</span> <span class="free">q</span> <span class="free">r</span> <span class="main">∨</span> def_dominates <span class="free">g</span> <span class="free">r</span> <span class="free">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.dominates_antitrans<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">r</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Without loss of generality, let Q dominate R.›</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="skolem">r</span>
      <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span> <span class="quoted"><span class="quoted">"phiArg <span class="free">g</span> <span class="free">p</span> <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"phiArg <span class="free">g</span> <span class="free">p</span> <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="free">p</span><span class="main">,</span> <span class="skolem">q</span><span class="main">,</span> <span class="skolem">r</span><span class="main">]</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"def_dominates <span class="free">g</span> <span class="skolem">q</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"def_dominates <span class="free">g</span> <span class="skolem">r</span> <span class="free">p</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> wlog<span class="main">:</span> <span class="quoted"><span class="quoted">"def_dominates <span class="free">g</span> <span class="skolem">q</span> <span class="skolem">r</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">q</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> phiArg_same_var<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> phiArg_same_var<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Furthermore, let S be the corresponding predecessor block of P where p is using q.›</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> set <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phiUses_exI'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

      <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Then there is a path from the start block crossing Q then R and S.›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">p</span> <span class="main">≠</span> defNode <span class="free">g</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiArg_distinct_nodes<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> S <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">S</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allUses_dominated<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="skolem">q</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">ns</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> old.dominates_path<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> old.simple_path2<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">r</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">ns</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">r</span> <span class="main">≠</span> defNode <span class="free">g</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiArgs_def_distinct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">ns</span> <span class="main">≠</span> defNode <span class="free">g</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ns <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>old.path2_def<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">p</span> <span class="main">≠</span> defNode <span class="free">g</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiArg_distinct_nodes<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> S<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="skolem">S</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.dominates_unsnoc<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">p</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>wlog asm assms<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> wlog <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">r</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ns<span class="main">(</span>1<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> old.dominates_mid<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil in_set_conv_decomp list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> tl_append2<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹This violates the SSA property.›</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms S<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms S<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">r</span> <span class="main">≠</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> conventional<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>old.path2_def distinct_hd_tl<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Minimality-convergence_prop"><span class="command">lemma</span></span> convergence_prop<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"necessaryPhi <span class="free">g</span> <span class="main">(</span><span class="free">var</span> <span class="free">g</span> <span class="free">v</span><span class="main">)</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∉</span> allDefs <span class="free">g</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">≠</span> None"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> defNode<span class="main">)</span>

    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> allDefs <span class="free">g</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>allDefs_def phiDefs_def<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="skolem"><span class="skolem">v<span class="hidden">⇩</span><sub>a</sub></span></span> <span class="skolem"><span class="skolem">v<span class="hidden">⇩</span><sub>b</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span>
      a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">a</span><span class="main">-</span><span class="skolem">as</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">b</span><span class="main">-</span><span class="skolem">bs</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> length <span class="skolem">as</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> length <span class="skolem">bs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>butlast <span class="skolem">as</span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>butlast <span class="skolem">bs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>necessaryPhi_def old.pathsConverge'_def oldDefs_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="free">v</span><span class="main">)</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allUses_dominated<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> dom<span class="main">:</span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="free">v</span><span class="main">)</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> 1
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.dominates_unsnoc'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"old.strict_dom <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="free">v</span><span class="main">)</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v<span class="hidden">⇩</span><sub>a</sub></span> <span class="skolem">a</span> <span class="skolem">as</span> <span class="skolem">v<span class="hidden">⇩</span><sub>b</sub></span> <span class="skolem">b</span> <span class="skolem">bs</span>
      <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">a</span><span class="main">-</span><span class="skolem">as</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">as</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> bs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">b</span><span class="main">-</span><span class="skolem">bs</span><span class="main">→</span><span class="free">n</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>butlast <span class="skolem">as</span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>butlast <span class="skolem">bs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span> <span class="main">≠</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> contr<span class="main">:</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">as</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> as <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>old.path2_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>hd_in_butlast<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> conv<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 2 contr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> last <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>old.path2_def<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> set <span class="skolem">bs</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">subst</span> append_butlast_last_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> old.path2_not_Nil<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bs<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="skolem">v<span class="hidden">⇩</span><sub>a</sub></span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="skolem">v<span class="hidden">⇩</span><sub>a</sub></span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="skolem">v<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="skolem">v<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
            <span class="keyword1"><span class="command">with</span></span> asm<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> b<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> asm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> as bs a<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allDefs_disjoint'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> conv<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ebs</span></span> <span class="keyword2"><span class="keyword">where</span></span> ebs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ebs</span><span class="main">→</span><span class="skolem">b</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> bs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span>butlast <span class="skolem">ebs</span><span class="main">@</span><span class="skolem">bs</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ebs</span><span class="main">@</span><span class="skolem">bs</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.dominatesE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> dom<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> contr<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ebs</span><span class="main">)</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="skolem">ebs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_set_butlastD<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> ebs <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">abs</span></span> <span class="keyword2"><span class="keyword">where</span></span> abs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">a</span><span class="main">-</span><span class="skolem">abs</span><span class="main">→</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">abs</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> old.path2_split_first_last<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?path</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">abs</span><span class="main">@</span>tl <span class="skolem">bs</span><span class="main">)</span><span class="main">@</span>tl <span class="free">ns</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">≠</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">v<span class="hidden">⇩</span><sub>a</sub></span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conventional<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">a</span><span class="main">-</span><span class="var">?path</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abs<span class="main">(</span>1<span class="main">)</span> bs assms<span class="main">(</span>2<span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_app<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> old.path2_app<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>in_set_tlD<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 2 contr assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="var">?path</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abs conv<span class="main">(</span>2<span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">subst</span> tl_append2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> old.path2_not_Nil<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">abs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abs<span class="main">(</span>1<span class="main">)</span> conv<span class="main">(</span>1<span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>old.path2_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>last_in_tl nonsimple_length_gt_1<span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="var">?path</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abs<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> old.path2_not_Nil<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a b<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> a b <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">with</span></span> 4 5 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">v</span> <span class="main">≠</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">v<span class="hidden">⇩</span><sub>a</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a as 1 contr <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allDefs_var_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> a<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">eas</span></span> <span class="keyword2"><span class="keyword">where</span></span> eas<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">eas</span><span class="main">→</span><span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> as <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">eas</span><span class="main">@</span>tl <span class="skolem">as</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> as <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">eas</span><span class="main">@</span>tl <span class="skolem">as</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.dominatesE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> dom<span class="main"><span class="main">]</span></span><span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">as</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">as</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> 4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span> <span class="main">∈</span> set <span class="skolem">eas</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">eas'</span></span> <span class="keyword2"><span class="keyword">where</span></span> eas'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="free">v</span><span class="main">-</span>defNode <span class="free">g</span> <span class="free">v</span><span class="main">#</span><span class="skolem">eas'</span><span class="main">→</span><span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span> <span class="main">∉</span> set <span class="skolem">eas'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eas
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_split_first_last<span class="main">)</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?path</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>defNode <span class="free">g</span> <span class="free">v</span><span class="main">#</span><span class="skolem">eas'</span><span class="main">)</span><span class="main">@</span>tl <span class="skolem">as</span><span class="main">)</span><span class="main">@</span>tl <span class="free">ns</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">≠</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conventional<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="free">v</span><span class="main">-</span><span class="var">?path</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eas' as assms<span class="main">(</span>2<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>append_Cons append_assoc <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> old.path2_app<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="var">?path</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eas' 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>old.path2_def<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="var">?path</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> 1 eas'<span class="main">(</span>2<span class="main">)</span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>1 assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> a<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> a<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span> <span class="main">≠</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">as</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> as subsetD<span class="main">[</span><span class="operator">OF</span> set_tl<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="skolem">as</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> in_set_butlastI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>old.path2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">note</span></span> def_in_as <span class="main">=</span> this
    <span class="keyword1"><span class="command">from</span></span> def_in_as<span class="main">[</span><span class="operator">OF</span> a conv<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> b conv<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> def_in_as<span class="main">[</span><span class="operator">OF</span> b conv<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> a conv<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> conv<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Minimality-convergence_prop'"><span class="command">lemma</span></span> convergence_prop'<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"necessaryPhi <span class="free">g</span> <span class="free">v</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">var</span> <span class="free">g</span> <span class="main">`</span> allUses <span class="free">g</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">ns</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">val</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">val</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">val</span><span class="main">)</span> <span class="main">≠</span> None"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"length <span class="free">ns</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ns</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> less
    <span class="keyword1"><span class="command">from</span></span> less.prems<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">val</span></span> <span class="keyword2"><span class="keyword">where</span></span> val<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">val</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">val</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m'</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">ns</span><span class="main">)</span><span class="main">.</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">var</span> <span class="free">g</span> <span class="main">`</span> phiDefs <span class="free">g</span> <span class="bound">m'</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> less.prems<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">ns</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">val</span> <span class="main">∉</span> allDefs <span class="free">g</span> <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> allDefs_def val<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> oldDefs_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_set_tlD<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> less.prems<span class="main">(</span>3<span class="main">,</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">val</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> oldDefs_def val<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> old.path2_hd_in_ns<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> less.prems
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="main">[</span></span><span class="operator">OF</span> val<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> convergence_prop<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> val<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> less.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">where</span></span> m'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="skolem">m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">var</span> <span class="free">g</span> <span class="main">`</span> phiDefs <span class="free">g</span> <span class="skolem">m'</span>"</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">ns'</span> <span class="skolem">ns</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">erule</span> old.path2_split_first_prop<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">var</span> <span class="free">g</span> <span class="main">`</span> phiDefs <span class="free">g</span> <span class="bound">m</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_set_tlD<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">=</span> <span class="free">n</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> m'<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phiDefs_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> that<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> m'<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m''</span></span> <span class="keyword2"><span class="keyword">where</span></span> m''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span>butlast <span class="skolem">ns'</span><span class="main">→</span><span class="skolem">m''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m''</span> <span class="main">∈</span> set <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="skolem">m'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_unsnoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> less.hyps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"butlast <span class="skolem">ns'</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> _<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>butlast <span class="skolem">ns'</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="skolem">ns</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> m''<span class="main">(</span>1<span class="main">)</span> m'<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ns'</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prefix_length_le<span class="main">)</span>

          <span class="keyword1"><span class="command">from</span></span> m'<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">val</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">m'</span><span class="main">,</span><span class="skolem">val</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">val</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phiDefs_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> m'' <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">val'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">val'</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">m''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">val'</span> <span class="main">∈</span> set <span class="skolem">vs</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiUses_exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phiDefs_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> vs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">val'</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="skolem">m''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">val'</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">var</span> <span class="free">g</span> <span class="main">`</span> allUses <span class="free">g</span> <span class="skolem">m''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

          <span class="keyword1"><span class="command">from</span></span> m'<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ns'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> less.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> in_set_butlastD<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> less.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> m''<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Minimality-nontrivialE"><span class="command">lemma</span></span> nontrivialE<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>trivial <span class="free">g</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"phi <span class="free">g</span> <span class="free">p</span> <span class="main">≠</span> None"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">r</span> <span class="free">s</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"phiArg <span class="free">g</span> <span class="free">p</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"phiArg <span class="free">g</span> <span class="free">p</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="free">p</span><span class="main">,</span> <span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"phi <span class="free">g</span> <span class="free">p</span> <span class="main">=</span> Some <span class="skolem">vs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="skolem">vs</span> <span class="main">-</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span><span class="main">)</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="skolem">vs</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Entry_no_phis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> phi_wf<span class="main">[</span><span class="operator">OF</span> vs<span class="main">]</span> vs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>phi_def invar<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">≠</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vs <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phi_no_closed_loop<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="skolem">vs</span> <span class="main">-</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> List.finite_set card_0_eq insert_Diff_single insert_absorb removeAll_id set_removeAll<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="skolem">vs</span> <span class="main">-</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="skolem">vs</span> <span class="main">-</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">q</span><span class="main">}</span> <span class="main">=</span> set <span class="skolem">vs</span> <span class="main">-</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">erule</span> card_eq_1_singleton<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"isTrivialPhi <span class="free">g</span> <span class="free">p</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>isTrivialPhi_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>option.split<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"phiArg <span class="free">g</span> <span class="free">p</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q vs <span class="keyword1"><span class="command">unfolding</span></span> phiArg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>trivial_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≠</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> set <span class="skolem">vs</span> <span class="main">-</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="skolem">vs</span> <span class="main">-</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_take_two<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vs <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phiArg_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Minimality-paths_converge_prefix"><span class="command">lemma</span></span> paths_converge_prefix<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">x</span><span class="main">-</span><span class="free">xs</span><span class="main">→</span><span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">y</span><span class="main">-</span><span class="free">ys</span><span class="main">→</span><span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="free">ys</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">xs'</span> <span class="free">ys'</span> <span class="free">z'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"old.pathsConverge <span class="free">g</span> <span class="free">x</span> <span class="free">xs'</span> <span class="free">y</span> <span class="free">ys'</span> <span class="free">z'</span>"</span></span> <span class="quoted"><span class="quoted">"prefix <span class="free">xs'</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"prefix <span class="free">ys'</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">z</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nat_less_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>old.path2_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>butlast <span class="skolem">xs</span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>butlast <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>2-<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"old.pathsConverge <span class="free">g</span> <span class="free">x</span> <span class="skolem">xs</span> <span class="free">y</span> <span class="skolem">ys</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> old.pathsConverge'_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted">"1.prems"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs'</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">x</span><span class="main">-</span><span class="skolem">xs'</span><span class="main">→</span><span class="skolem">z'</span>"</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">xs'</span> <span class="main">(</span>butlast <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">xs'</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ys</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>2<span class="main">,</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_split_first_prop<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"butlast <span class="skolem">xs</span>"</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ys</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> old.path2_unsnoc<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> xs'<span class="main">(</span>3<span class="main">)</span> <span class="quoted">"1.prems"</span><span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ys'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">y</span><span class="main">-</span><span class="skolem">ys'</span><span class="main">→</span><span class="skolem">z'</span>"</span></span> <span class="quoted"><span class="quoted">"strict_prefix <span class="skolem">ys'</span> <span class="skolem">ys</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_strict_prefix_ex<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted">"1.hyps"</span><span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> _ _ _ xs'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ys'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs'</span> <span class="main">&lt;</span> length <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xs'<span class="main">(</span>2<span class="main">)</span> xs'<span class="main">(</span>1<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> prefix_length_less<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> strict_prefix_butlast<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>1<span class="main">)</span> prefix_order.dual_order.strict_implies_order prefix_order.dual_order.trans
          prefix_butlastD xs'<span class="main">(</span>2<span class="main">)</span> ys'<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">xs''</span> <span class="bound">ys''</span> <span class="bound">z''</span><span class="main">.</span> old.pathsConverge <span class="free">g</span> <span class="free">x</span> <span class="bound">xs''</span> <span class="free">y</span> <span class="bound">ys''</span> <span class="bound">z''</span> <span class="main">⟹</span> prefix <span class="bound">xs''</span> <span class="skolem">xs'</span> <span class="main">⟹</span> prefix <span class="bound">ys''</span> <span class="skolem">ys'</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs'</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xs' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs'</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">with</span></span> xs'<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ys</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>old.path2_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>One_nat_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>singleton_list_hd_last<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ys'</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ys'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ys' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ys'</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">with</span></span> ys'<span class="main">(</span>1<span class="main">)</span> xs'<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">xs</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>old.path2_def old.path_not_Nil <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>One_nat_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>singleton_list_hd_last<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">xs'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span>  xs'<span class="main">(</span>2<span class="main">)</span> <span class="quoted">"1.prems"</span><span class="main">(</span>8<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_prefix in_set_butlastD<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ys'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1.prems"</span><span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> in_set_butlast_appendI strict_prefixE' ys'<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Minimality-ununnecessaryPhis_disjoint_paths_aux"><span class="command">lemma</span></span> ununnecessaryPhis_disjoint_paths_aux<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>unnecessaryPhi <span class="free">g</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">ns<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">ns<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="free">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">→</span>defNode <span class="free">g</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span><span class="main">-</span><span class="free">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">→</span>defNode <span class="free">g</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"set <span class="main">(</span>butlast <span class="free">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>butlast <span class="free">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"phi <span class="free">g</span> <span class="free">r</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> None
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">r</span>"</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">r</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> oldDefsI <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> defNode_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">g</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Some
    <span class="keyword1"><span class="command">with</span></span> assms that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unnecessaryPhi_def necessaryPhi_def old.pathsConverge'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Minimality-ununnecessaryPhis_disjoint_paths"><span class="command">lemma</span></span> ununnecessaryPhis_disjoint_paths<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>unnecessaryPhi <span class="free">g</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>unnecessaryPhi <span class="free">g</span> <span class="free">s</span>"</span></span>
      <span class="comment1">(* and rs: "phiArg p r" "phiArg p s" "distinct [p, r, s]" *)</span>
      <span class="keyword2"><span class="keyword">and</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">r</span> <span class="main">≠</span> defNode <span class="free">g</span> <span class="free">s</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">r</span> <span class="main">=</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">s</span> <span class="main">=</span> <span class="free">V</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">n</span> <span class="free">ns</span> <span class="free">m</span> <span class="free">ms</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span>defNode <span class="free">g</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">m</span><span class="main">-</span><span class="free">ms</span><span class="main">→</span>defNode <span class="free">g</span> <span class="free">s</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ns</span> <span class="main">∩</span> set <span class="free">ms</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span>
      ns<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">n<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">n<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">→</span>defNode <span class="free">g</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">r</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      ns<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">→</span>defNode <span class="free">g</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">r</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      ns<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span>
        ns<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">n<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">n<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">→</span>defNode <span class="free">g</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        ns<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">→</span>defNode <span class="free">g</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        ns<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> ununnecessaryPhis_disjoint_paths_aux<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> ns<span class="hidden">⇩</span><sub>1</sub> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="hidden">⇩</span><sub>1</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">n<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">→</span>defNode <span class="free">g</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">r</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">⊆</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> old.simple_path2<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> ns<span class="hidden">⇩</span><sub>2</sub> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="hidden">⇩</span><sub>2</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">→</span>defNode <span class="free">g</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">r</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub>'</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">⊆</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> old.simple_path2<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> equals0I<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> set_butlast_distinct<span class="main">[</span><span class="operator">OF</span> ns<span class="hidden">⇩</span><sub>1</sub>'<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> ns<span class="hidden">⇩</span><sub>1</sub>'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> defNode <span class="free">g</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>old.path2_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> 1 ns<span class="hidden">⇩</span><sub>1</sub>'<span class="main">(</span>4<span class="main">)</span> ns<span class="hidden">⇩</span><sub>2</sub>'<span class="main">(</span>4<span class="main">)</span> ns<span class="hidden">⇩</span><sub>1</sub><span class="main">(</span>2<span class="main">)</span> ns<span class="hidden">⇩</span><sub>2</sub><span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>in_set_butlastI <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>in_set_butlastD <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>old.path2_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> ns <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="skolem">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ns<span class="hidden">⇩</span><sub>1</sub><span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span> ns<span class="hidden">⇩</span><sub>1</sub>'<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span> ns<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span> ns<span class="hidden">⇩</span><sub>2</sub>'<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">ms</span></span> <span class="keyword2"><span class="keyword">where</span></span> ms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">m</span><span class="main">-</span><span class="skolem">ms</span><span class="main">→</span>defNode <span class="free">g</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">r</span> <span class="main">∉</span> set <span class="skolem">ms</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">ms<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">m<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="skolem"><span class="skolem">ms<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span>
        ms<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">m<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">m<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="skolem">ms<span class="hidden">⇩</span><sub>1</sub></span><span class="main">→</span>defNode <span class="free">g</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        ms<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">m<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">m<span class="hidden">⇩</span><sub>2</sub></span><span class="main">-</span><span class="skolem">ms<span class="hidden">⇩</span><sub>2</sub></span><span class="main">→</span>defNode <span class="free">g</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        ms<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>butlast <span class="skolem">ms<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>butlast <span class="skolem">ms<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> ununnecessaryPhis_disjoint_paths_aux<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="skolem">thesis</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">r</span> <span class="main">∈</span> set <span class="skolem">ms<span class="hidden">⇩</span><sub>1</sub></span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> ms<span class="hidden">⇩</span><sub>1</sub> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="skolem">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">r</span> <span class="main">∉</span> set <span class="skolem">ms<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">r</span> <span class="main">∈</span> set <span class="skolem">ms<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹defNode <span class="free">g</span> <span class="free">r</span> <span class="main">≠</span> defNode <span class="free">g</span> <span class="free">s</span>›</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">r</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ms<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">r</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ms<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True ms<span class="hidden">⇩</span><sub>1</sub><span class="main">(</span>2<span class="main">)</span> ms<span class="hidden">⇩</span><sub>2</sub><span class="main">(</span>2<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>old.path2_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>in_set_butlastI<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> ms <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">with</span></span> ms<span class="hidden">⇩</span><sub>2</sub> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="skolem">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">∩</span> set <span class="skolem">ms</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> ns<span class="hidden">⇩</span><sub>1</sub> ms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="skolem"><span class="skolem">ms'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ms'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">m'</span><span class="main">-</span><span class="skolem">ms'</span><span class="main">→</span>defNode <span class="free">g</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>tl <span class="skolem">ms'</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>set <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">ms'</span> <span class="skolem">ms</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_split_last_prop<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>4<span class="main">)</span> ms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">r</span> <span class="main">∉</span> set <span class="skolem">ms'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> set_mono_suffix<span class="main">)</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span>
        <span class="keyword3"><span class="command">assume</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> ns<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">n<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">n<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">→</span>defNode <span class="free">g</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">r</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> ns<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">→</span>defNode <span class="free">g</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">r</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> ms'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">m'</span><span class="main">-</span><span class="skolem">ms'</span><span class="main">→</span>defNode <span class="free">g</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>tl <span class="skolem">ms'</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>set <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">from</span></span> ms'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> set <span class="skolem">ms'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">r</span> <span class="main">≠</span> <span class="skolem">m'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> 4 ns<span class="hidden">⇩</span><sub>1</sub><span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> in_set_butlastI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>old.path2_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">with</span></span> ns<span class="hidden">⇩</span><sub>1</sub><span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="hidden">⇩</span><sub>1</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">n<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">→</span><span class="skolem">m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"strict_prefix <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_strict_prefix_ex<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="free">thesis</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ns<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> ns<span class="hidden">⇩</span><sub>1</sub><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">@</span>tl <span class="skolem">ms'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">n<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">@</span> tl <span class="skolem">ms'</span><span class="main">→</span>defNode <span class="free">g</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ns<span class="hidden">⇩</span><sub>1</sub>'<span class="main">(</span>1<span class="main">)</span> ms'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∩</span> set <span class="main">(</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">@</span> tl <span class="skolem">ms'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> equals0I<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
            <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∩</span> set <span class="main">(</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">@</span> tl <span class="skolem">ms'</span><span class="main">)</span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ns<span class="hidden">⇩</span><sub>1</sub>'<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>set_mono_strict_prefix<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> ns<span class="hidden">⇩</span><sub>1</sub><span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> defNode <span class="free">g</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> ns<span class="hidden">⇩</span><sub>2</sub><span class="main">(</span>2<span class="main">)</span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> in_set_butlastI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>old.path2_def<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> 4 ns <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">with</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">ms'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> x ms'<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">note</span></span> 4 <span class="main">=</span> this
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ns<span class="hidden">⇩</span><sub>1</sub> ns<span class="hidden">⇩</span><sub>2</sub> ns ms'<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 4<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> ms'<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ns ms'<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> 4<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ ns<span class="hidden">⇩</span><sub>2</sub> ns<span class="hidden">⇩</span><sub>1</sub><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 3. If a $\phi$ function p in a block P for a variable v is unnecessary, but non-trivial, then it has an operand q in a block Q,
    such that q is an unnecessary $\phi$ function and Q does not dominate P.›</span></span>
  <span class="keyword1" id="Minimality-3"><span class="command">lemma</span></span> 3<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unnecessaryPhi <span class="free">g</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>trivial <span class="free">g</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">q</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"phiArg <span class="free">g</span> <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"unnecessaryPhi <span class="free">g</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>def_dominates <span class="free">g</span> <span class="free">q</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">note</span></span> unnecessaryPhi_def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">p</span>"</span></span>

    <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹The node p must have at least two different operands r and s, which are not p itself. Otherwise, p is trivial.›</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"phiArg <span class="free">g</span> <span class="free">p</span> <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"phiArg <span class="free">g</span> <span class="free">p</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="free">p</span><span class="main">,</span> <span class="skolem">r</span><span class="main">,</span> <span class="skolem">s</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> nontrivialE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">r</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">s</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phiArg_same_var<span class="main">)</span>

    <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹They can either be:
      <span class="antiquoted"><span class="antiquoted">▪</span></span> The result of a direct assignment to v.
      <span class="antiquoted"><span class="antiquoted">▪</span></span> The result of a necessary $\phi$ function r' . This however means that r' was
        reachable by at least two different direct assignments to v. So there is a path
        from a direct assignment of v to p.
      <span class="antiquoted"><span class="antiquoted">▪</span></span> Another unnecessary $\phi$ function.›</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">s</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">≠</span> <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rs <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiArgs_def_distinct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> one_unnec<span class="main">:</span> <span class="quoted"><span class="quoted">"unnecessaryPhi <span class="free">g</span> <span class="skolem">r</span> <span class="main">∨</span> unnecessaryPhi <span class="free">g</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> de_Morgan_disj not_not<span class="main">)</span>

      <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Assume neither r in a block R nor s in a block S is an unnecessary $\phi$ function.›</span></span>
      <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>unnecessaryPhi <span class="free">g</span> <span class="skolem">r</span> <span class="main">∧</span> <span class="main">¬</span>unnecessaryPhi <span class="free">g</span> <span class="skolem">s</span>"</span></span>

      <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Then a path from an assignment to v in a block n crosses R and a path from an assignment to v in a block m crosses S.›</span></span>
      <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹AMENDMENT: ...so that the paths are disjoint!›</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">ms</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">p</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">n</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="var">?R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> ms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">p</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">m</span><span class="main">-</span><span class="skolem">ms</span><span class="main">→</span>defNode <span class="free">g</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ms</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> ns_ms<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ns</span> <span class="main">∩</span> set <span class="skolem">ms</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">ms</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">p</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">n</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="var">?R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">p</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">m</span><span class="main">-</span><span class="skolem">ms</span><span class="main">→</span><span class="var">?S</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> ns_ms<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ns</span> <span class="main">∩</span> set <span class="skolem">ms</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> asm<span class="main">[</span><span class="operator">THEN</span> conjunct1<span class="main">]</span> asm<span class="main">[</span><span class="operator">THEN</span> conjunct2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ununnecessaryPhis_disjoint_paths<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ns <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">n</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="var">?R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ns'</span> <span class="main">⊆</span> set <span class="skolem">ns</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> old.simple_path2<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ms'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">m</span><span class="main">-</span><span class="skolem">ms'</span><span class="main">→</span><span class="var">?S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ms'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ms'</span> <span class="main">⊆</span> set <span class="skolem">ms</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> old.simple_path2<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="skolem">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">ns'</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">ms'</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">from</span></span> ns<span class="main">(</span>1<span class="main">)</span> ms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v'</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>oldDefs_def<span class="main">)</span>

      <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹They converge at P or earlier.›</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?R</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">∈</span> set <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="var">?P</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phiArg_path_ex'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> old.simple_path2<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ms'</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ms'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?S</span><span class="main">-</span><span class="skolem">ms'</span><span class="main">→</span><span class="skolem">m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> set <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="var">?P</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ms'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phiArg_path_ex'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> old.simple_path2<span class="main">)</span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?left</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ns</span><span class="main">@</span>tl <span class="skolem">ns'</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="var">?P</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?right</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ms</span><span class="main">@</span>tl <span class="skolem">ms'</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="var">?P</span><span class="main">]</span>"</span></span>

      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns''</span></span> <span class="skolem"><span class="skolem">ms''</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"old.pathsConverge <span class="free">g</span> <span class="skolem">n</span> <span class="skolem">ns''</span> <span class="skolem">m</span> <span class="skolem">ms''</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">ns''</span> <span class="var">?left</span>"</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">ms''</span> <span class="var">?right</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> paths_converge_prefix<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ns ms ns_ms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">n</span><span class="main">-</span><span class="var">?left</span><span class="main">→</span><span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ns ns'
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_snoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> old.path2_app<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?left</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ns <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">m</span><span class="main">-</span><span class="var">?right</span><span class="main">→</span><span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ms ms'
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_snoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> old.path2_app<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?right</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> set <span class="skolem">ms</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ns_ms ns <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ms'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v rs<span class="main">(</span>2<span class="main">)</span> ms'<span class="main">(</span>2<span class="main">)</span> asm
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> conventional'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ms'<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="var">?right</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>append_assoc<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∉</span> set <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ns_ms ms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v' rs<span class="main">(</span>1<span class="main">)</span> ns'<span class="main">(</span>2<span class="main">)</span> asm
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> conventional'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ns'<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="var">?left</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>append_assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> ns<span class="main">(</span>1<span class="main">)</span> ms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> necessary<span class="main">:</span> <span class="quoted"><span class="quoted">"necessaryPhi <span class="free">g</span> <span class="main">(</span><span class="free">var</span> <span class="free">g</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> necessaryPhiI<span class="main">)</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="var">?P</span>"</span></span><span class="main">)</span>

        <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Convergence at P is not possible because p is unnecessary.›</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> necessary <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>

        <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹An earlier convergence would imply a necessary $\phi$ function at this point, which violates the SSA property.›</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">from</span></span> z<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> set <span class="skolem">ns''</span> <span class="main">∩</span> set <span class="skolem">ms''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> old.pathsConverge'_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ns</span><span class="main">@</span>tl <span class="skolem">ns'</span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span><span class="skolem">ms</span><span class="main">@</span>tl <span class="skolem">ms'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> z<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> set_mono_prefix<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>set_mono_prefix<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> z_on<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">ns'</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>tl <span class="skolem">ms'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ns_ms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">ns'</span> <span class="skolem">n'</span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">r</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> ns'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?R</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">∈</span> set <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="main">(</span><span class="var">?P</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns'</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">r</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">p</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">ns'</span><span class="main">)</span>"</span></span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">zs</span></span> <span class="keyword2"><span class="keyword">where</span></span> zs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">z</span><span class="main">-</span><span class="skolem">zs</span><span class="main">→</span><span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>tl <span class="skolem">zs</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>tl <span class="skolem">ns'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_split_ex<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ns'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> old.path2_not_Nil <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> set_tl<span class="main"><span class="main">]</span></span><span class="main">)</span>

            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">z</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">≠</span> None"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> convergence_prop<span class="main"><span class="main">[</span></span><span class="operator">OF</span> necessary<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> rs<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span> zs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ns'<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="skolem">z</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span>
                <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="skolem">z</span>"</span></span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zs <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> defNode_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
                <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ns'<span class="main">(</span>4<span class="main">)</span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">zs</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">zs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ns'<span class="main">(</span>4<span class="main">)</span> zs<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∉</span> allDefs <span class="free">g</span> <span class="skolem">x</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> defNode_eq old.path2_in_αn set_tl subset_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zs<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> defNode_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>allDefs_def phiDefs_def<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ns'<span class="main">(</span>4<span class="main">)</span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">note</span></span> z_not_on <span class="main">=</span> this

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> z_not_on<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ns'<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ms'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> z_not_on<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ms'<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> z_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹
So r or s must be an unnecessary $\phi$ function. Without loss of generality, let
this be r.›</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">s</span>
      <span class="keyword3"><span class="command">assume</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"unnecessaryPhi <span class="free">g</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">r</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">p</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">s</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">p</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"phiArg <span class="free">g</span> <span class="free">p</span> <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"phiArg <span class="free">g</span> <span class="free">p</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="free">p</span><span class="main">,</span> <span class="skolem">r</span><span class="main">,</span> <span class="skolem">s</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">s</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">≠</span> <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rs <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiArgs_def_distinct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="free">thesis</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="var">?R</span> <span class="var">?P</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False

        <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹If R does not dominate P, then r is the sought-after q.›</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> r rs<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True

        <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹So let R dominate P.
Due to Lemma 2, S does not dominate P.›</span></span>
        <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>old.dominates <span class="free">g</span> <span class="var">?S</span> <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2<span class="main">[</span><span class="operator">OF</span> rs<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Employing the SSA property, r /= p
yields R /= P.›</span></span>
        <span class="comment1">(* actually not SSA property *)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">≠</span> <span class="var">?P</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allDefs_var_disjoint<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rs<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rs<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Thus, R strictly dominates P.›</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"old.strict_dom <span class="free">g</span> <span class="var">?R</span> <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹This implies that R dominates all
predecessors of P, which contain the uses of p, especially the predecessor S' that
contains the use of s.›</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ss'</span></span> <span class="skolem"><span class="skolem">S'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ss'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?S</span><span class="main">-</span><span class="skolem">ss'</span><span class="main">→</span><span class="skolem">S'</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> S'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">S'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S'</span> <span class="main">∈</span> set <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="var">?P</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phiArg_path_ex'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="var">?R</span> <span class="skolem">S'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.dominates_unsnoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

        <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Due to the SSA property, there is a path from S to S' that
does not contain R.›</span></span>
        <span class="keyword1"><span class="command">from</span></span> ss' <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ss'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ss'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?S</span><span class="main">-</span><span class="skolem">ss'</span><span class="main">→</span><span class="skolem">S'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ss'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> old.simple_path2<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ss'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rs<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> S'<span class="main">(</span>1<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> conventional'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> v<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> v'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">r</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> phiArg_def<span class="main">)</span>

        <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Employing R dominates S' this yields R dominates S.›</span></span>
        <span class="keyword1"><span class="command">hence</span></span> dom<span class="main">:</span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="var">?R</span> <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 5 ss' <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.dominates_extend<span class="main">)</span>

        <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Now assume that s is necessary.›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unnecessaryPhi <span class="free">g</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>unnecessaryPhi <span class="free">g</span> <span class="skolem">s</span>"</span></span>

          <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Let X contain the most recent definition of v on a path from the start block to R.›</span></span>
          <span class="keyword1"><span class="command">from</span></span> rs<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">X</span><span class="main">-</span><span class="skolem">xs</span><span class="main">→</span><span class="var">?R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">r</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"old.EntryPath <span class="free">g</span> <span class="skolem">xs</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allDef_path_from_simpleDef<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="free">g</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> phiArg_def<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">X</span><span class="main">-</span><span class="skolem">xs</span><span class="main">→</span><span class="var">?R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">r</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">xs</span><span class="main">)</span><span class="main">.</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">r</span> <span class="main">∉</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"old.EntryPath <span class="free">g</span> <span class="skolem">xs</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_split_last_prop<span class="main"><span class="main">[</span></span><span class="operator">OF</span> xs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">r</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="bound">x</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> old.EntryPath_suffix<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> oldDefs_def old.path2_def<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> defNode <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xs <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> defNode_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> xs <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">X</span><span class="main">-</span><span class="skolem">xs</span><span class="main">→</span><span class="var">?R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"old.EntryPath <span class="free">g</span> <span class="skolem">xs</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.simple_path2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> old.EntryPath_suffix<span class="main">)</span>

          <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹By Definition 2 there are two definitions
of v that render s necessary. Since R dominates S, the SSA property yields that
one of these definitions is contained in a block Y on a path $R \rightarrow^+ S$.›</span></span>
          <span class="comment1">(* actually not SSA property *)</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="skolem"><span class="skolem">ys'</span></span> <span class="keyword2"><span class="keyword">where</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">s</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">Y</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> ys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">Y</span><span class="main">-</span><span class="skolem">ys</span><span class="main">→</span><span class="var">?S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">∉</span> set <span class="skolem">ys</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> ys'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?R</span><span class="main">-</span><span class="skolem">ys'</span><span class="main">→</span><span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ys'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"phi <span class="free">g</span> <span class="skolem">s</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> None
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> defNode_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="free">g</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?R</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="var">?S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dom
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.dominates_path<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> old.simple_path2<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="skolem">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ys1<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="var">?S</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> oldDefsI<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> Some
            <span class="keyword1"><span class="command">with</span></span> s <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">ys<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">Y<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="skolem"><span class="skolem">ys<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">s</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">Y<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">Y<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="skolem">ys<span class="hidden">⇩</span><sub>1</sub></span><span class="main">→</span><span class="var">?S</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">s</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">Y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">Y<span class="hidden">⇩</span><sub>2</sub></span><span class="main">-</span><span class="skolem">ys<span class="hidden">⇩</span><sub>2</sub></span><span class="main">→</span><span class="var">?S</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> ys<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>butlast <span class="skolem">ys<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>butlast <span class="skolem">ys<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">Y<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>necessaryPhi_def old.pathsConverge'_def<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ys<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ys<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∨</span> <span class="var">?R</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ys<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> ys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">s</span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">Y</span><span class="main">-</span><span class="skolem">ys</span><span class="main">→</span><span class="var">?S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">es</span></span> <span class="keyword2"><span class="keyword">where</span></span> es<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">es</span><span class="main">→</span><span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ys<span class="main">(</span>2<span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">atomize_elim</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> old.Entry_reaches<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">es</span><span class="main">@</span><span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> old.path2_app'<span class="main">[</span><span class="operator">OF</span> es ys<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.dominatesE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> dom<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">≠</span> last <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> old.path2_last<span class="main">[</span><span class="operator">OF</span> ys<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">∉</span> set <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ys<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_set_butlastI<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">es</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?R</span><span class="main">-</span><span class="skolem">ys'</span><span class="main">→</span><span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ys'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> es
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_split_ex<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> in_set_butlastD<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> old.simple_path2<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="skolem">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> ys<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">Y</span></span> <span class="quoted"><span class="skolem">ys</span></span> <span class="quoted"><span class="skolem">ys'</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>

          <span class="keyword1"><span class="command">from</span></span> Y <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> oldDefs_def<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> defNode <span class="free">g</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ys <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> defNode_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rr'</span></span> <span class="skolem"><span class="skolem">R'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?R</span><span class="main">-</span><span class="skolem">rr'</span><span class="main">→</span><span class="skolem">R'</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> R'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">R'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R'</span> <span class="main">∈</span> set <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="var">?P</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phiArg_path_ex'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rr'</span></span> <span class="keyword2"><span class="keyword">where</span></span> rr'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?R</span><span class="main">-</span><span class="skolem">rr'</span><span class="main">→</span><span class="skolem">R'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">rr'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.simple_path2<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> R' <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rr</span></span> <span class="keyword2"><span class="keyword">where</span></span> rr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?R</span><span class="main">-</span><span class="skolem">rr</span><span class="main">→</span><span class="var">?P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rr</span> <span class="main">=</span> <span class="skolem">rr'</span> <span class="main">@</span> <span class="main">[</span><span class="var">?P</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> old.path2_snoc<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> ss' S' <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="keyword2"><span class="keyword">where</span></span> ss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?S</span><span class="main">-</span><span class="skolem">ss</span><span class="main">→</span><span class="var">?P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ss</span> <span class="main">=</span> <span class="skolem">ss'</span> <span class="main">@</span> <span class="main">[</span><span class="var">?P</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> old.path2_snoc<span class="main">)</span>

          <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Thus, there are paths $X \rightarrow^+ P$ and $Y \rightarrow^+ P$ rendering p necessary. Since this is a
contradiction, s is unnecessary and the sought-after q.›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"old.pathsConverge <span class="free">g</span> <span class="skolem">X</span> <span class="main">(</span>butlast <span class="skolem">xs</span><span class="main">@</span><span class="skolem">rr</span><span class="main">)</span> <span class="skolem">Y</span> <span class="main">(</span><span class="skolem">ys</span><span class="main">@</span>tl <span class="skolem">ss</span><span class="main">)</span> <span class="var">?P</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> old.pathsConvergeI<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">X</span><span class="main">-</span>butlast <span class="skolem">xs</span><span class="main">@</span><span class="skolem">rr</span><span class="main">→</span><span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xs rr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">Y</span><span class="main">-</span><span class="skolem">ys</span><span class="main">@</span>tl <span class="skolem">ss</span><span class="main">→</span><span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ys ss <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

            <span class="keyword1"><span class="command">{</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="var">?P</span>"</span></span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> phiDefs <span class="free">g</span> <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>phiDefs_def phi_def<span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> simpleDefs_phiDefs_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">X</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> allDefs_var_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">X</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">p</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
            <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>butlast <span class="skolem">xs</span><span class="main">@</span><span class="skolem">rr</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xs rr <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_nontriv<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

            <span class="keyword1"><span class="command">{</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> <span class="var">?P</span>"</span></span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> phiDefs <span class="free">g</span> <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>phiDefs_def phi_def<span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> simpleDefs_phiDefs_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Y</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> allDefs_var_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Y</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">p</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
            <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">ys</span><span class="main">@</span>tl <span class="skolem">ss</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ys ss <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_nontriv<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>butlast <span class="main">(</span>butlast <span class="skolem">xs</span> <span class="main">@</span><span class="skolem">rr</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">ys</span> <span class="main">@</span> tl <span class="skolem">ss</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> equals0I<span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="main">(</span>butlast <span class="skolem">xs</span><span class="main">@</span><span class="skolem">rr</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">ys</span><span class="main">@</span>tl <span class="skolem">ss</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
                <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> set <span class="skolem">ys</span>"</span></span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"old.shortestPath <span class="free">g</span> <span class="skolem">z</span> <span class="main">&lt;</span> old.shortestPath <span class="free">g</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm<span class="main">(</span>1<span class="main">)</span> xs<span class="main">(</span>3<span class="main">)</span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">subst</span> old.path2_last<span class="main"><span class="main">[</span></span><span class="operator">OF</span> xs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> old.EntryPath_butlast_less_last<span class="main">)</span>
                <span class="keyword1"><span class="command">moreover</span></span>
                <span class="keyword1"><span class="command">from</span></span> ys asm<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ys'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">z</span><span class="main">-</span><span class="skolem">ys'</span><span class="main">→</span><span class="var">?S</span>"</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">ys'</span> <span class="skolem">ys</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_split_ex<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sublist.suffix_def<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="var">?R</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ys<span class="main">(</span>2<span class="main">)</span> set_tl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">]</span> suffix_tl_subset<span class="main">[</span><span class="operator">OF</span> ys'<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.dominates_extend<span class="main"><span class="main">[</span></span><span class="operator">OF</span> dom ys'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"old.shortestPath <span class="free">g</span> <span class="var">?R</span> <span class="main">≤</span> old.shortestPath <span class="free">g</span> <span class="skolem">z</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> old.dominates_shortestPath_order<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
                <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
                <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">ss'</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"old.shortestPath <span class="free">g</span> <span class="skolem">z</span> <span class="main">&lt;</span> old.shortestPath <span class="free">g</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm<span class="main">(</span>1<span class="main">)</span> xs<span class="main">(</span>3<span class="main">)</span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">subst</span> old.path2_last<span class="main"><span class="main">[</span></span><span class="operator">OF</span> xs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> old.EntryPath_butlast_less_last<span class="main">)</span>
                <span class="keyword1"><span class="command">moreover</span></span>
                <span class="keyword1"><span class="command">from</span></span> asm<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ss<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> ss<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">z</span><span class="main">-</span><span class="skolem">ss<span class="hidden">⇩</span><sub>2</sub></span><span class="main">→</span><span class="skolem">S'</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>tl <span class="skolem">ss<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>tl <span class="skolem">ss'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> set_tl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ss'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_split_ex<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ss'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> old.path2_not_Nil <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_set_butlastD<span class="main">)</span>
                <span class="keyword1"><span class="command">from</span></span> S'<span class="main">(</span>1<span class="main">)</span> ss'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="var">?S</span> <span class="skolem">S'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allUses_dominated<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="var">?S</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ss'<span class="main">(</span>2<span class="main">)</span> ss<span class="hidden">⇩</span><sub>2</sub><span class="main">(</span>2<span class="main">)</span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.dominates_extend<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ ss<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
                <span class="keyword1"><span class="command">with</span></span> dom <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="var">?R</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"old.shortestPath <span class="free">g</span> <span class="var">?R</span> <span class="main">≤</span> old.shortestPath <span class="free">g</span> <span class="skolem">z</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.dominates_shortestPath_order<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
                <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">moreover</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">≠</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ys <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>old.path2_def<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> ys'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ys'</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> old.path2_nontriv<span class="main">)</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> set <span class="skolem">rr'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> set <span class="skolem">ys</span>"</span></span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> ys<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">Y</span><span class="main">-</span><span class="skolem">ys<span class="hidden">⇩</span><sub>1</sub></span><span class="main">→</span><span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">ys<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">ys</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_split_ex<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ys<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
                <span class="keyword1"><span class="command">from</span></span> asm <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rr<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> rr<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">z</span><span class="main">-</span><span class="skolem">rr<span class="hidden">⇩</span><sub>2</sub></span><span class="main">→</span><span class="skolem">R'</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>tl <span class="skolem">rr<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>tl <span class="skolem">rr'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_split_ex<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rr'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> old.path2_not_Nil<span class="main">)</span>
                <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?path</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys'</span><span class="main">@</span>tl <span class="main">(</span><span class="skolem">ys<span class="hidden">⇩</span><sub>1</sub></span><span class="main">@</span>tl <span class="skolem">rr<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">r</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conventional<span class="main">)</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?R</span><span class="main">-</span><span class="var">?path</span><span class="main">→</span><span class="skolem">R'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ys' ys<span class="hidden">⇩</span><sub>1</sub> rr<span class="hidden">⇩</span><sub>2</sub> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> old.path2_app<span class="main">)</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="skolem">R'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> R' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="var">?path</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ys'<span class="main">(</span>1<span class="main">)</span> 1
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>old.path2_def old.path2_not_Nil <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>last_in_tl<span class="main">)</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">r</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="var">?path</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> ys' ys<span class="hidden">⇩</span><sub>1</sub><span class="main">(</span>1<span class="main">)</span> ys<span class="main">(</span>2<span class="main">)</span> rr<span class="hidden">⇩</span><sub>2</sub><span class="main">(</span>2<span class="main">)</span> rr'<span class="main">(</span>2<span class="main">)</span> prefix_tl_subset<span class="main">[</span><span class="operator">OF</span> ys<span class="hidden">⇩</span><sub>1</sub><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> set_tl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> old.path2_not_Nil<span class="main">)</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
                <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> set <span class="skolem">rr'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">ss'</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ss'<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> ss'<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?S</span><span class="main">-</span><span class="skolem">ss'<span class="hidden">⇩</span><sub>1</sub></span><span class="main">→</span><span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">ss'<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">ss'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ss'
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_split_ex<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ss'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
                <span class="keyword1"><span class="command">from</span></span> asm <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rr'<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> rr'<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">z</span><span class="main">-</span><span class="skolem">rr'<span class="hidden">⇩</span><sub>2</sub></span><span class="main">→</span><span class="skolem">R'</span>"</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">rr'<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">rr'</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> rr' <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_split_ex<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sublist.suffix_def<span class="main">)</span>
                <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?path</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"butlast <span class="skolem">ys'</span><span class="main">@</span><span class="main">(</span><span class="skolem">ys</span><span class="main">@</span>tl <span class="main">(</span><span class="skolem">ss'<span class="hidden">⇩</span><sub>1</sub></span><span class="main">@</span>tl <span class="skolem">rr'<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">s</span> <span class="main">≠</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">r</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conventional<span class="main">)</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?R</span><span class="main">-</span><span class="var">?path</span><span class="main">→</span><span class="skolem">R'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ys' ys ss'<span class="hidden">⇩</span><sub>1</sub> rr'<span class="hidden">⇩</span><sub>2</sub><span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> old.path2_app old.path2_app'<span class="main">)</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="skolem">R'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> R' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"butlast <span class="skolem">ys'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="var">?path</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ys<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rs<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ss'</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> rs S'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> conventional''<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ss'<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
                  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">r</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="var">?path</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> ys<span class="main">(</span>1<span class="main">)</span> ss'<span class="hidden">⇩</span><sub>1</sub><span class="main">(</span>1<span class="main">)</span> suffix_tl_subset<span class="main">[</span><span class="operator">OF</span> rr'<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> ys'<span class="main">(</span>2<span class="main">)</span> ys<span class="main">(</span>2<span class="main">)</span> rr'<span class="main">(</span>2<span class="main">)</span> prefix_tl_subset<span class="main">[</span><span class="operator">OF</span> ss'<span class="hidden">⇩</span><sub>1</sub><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> List.butlast_tl<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> old.path2_not_Nil <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_set_butlastD<span class="main">)</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> rr'<span class="main">(</span>1<span class="main">)</span> ss'<span class="main">(</span>1<span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> append_assoc <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> append_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> old.path2_not_Nil <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_set_tlD<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"necessaryPhi' <span class="free">g</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xs oldDefsI<span class="main">[</span><span class="operator">OF</span> x<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> x<span class="main">(</span>2<span class="main">)</span> oldDefsI<span class="main">[</span><span class="operator">OF</span> y<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> y<span class="main">(</span>2<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> necessaryPhiI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> v<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">p</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>old.path2_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rs<span class="main">(</span>2<span class="main">)</span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">from</span></span> one_unnec this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> rs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 1. A program in SSA form with a reducible CFG G without any trivial $\phi$ functions is in minimal SSA form.›</span></span>
  <span class="keyword1"><span class="command">theorem</span></span> reducible_nonredundant_imp_minimal<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"old.reducible <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>redundant <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cytronMinimal <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cytronMinimal_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
    <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹
Proof. Assume G is not in minimal SSA form and contains no trivial $\phi$ functions.
We choose an unnecessary $\phi$ function p.›</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
    <span class="keyword3"><span class="command">assume</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> phi<span class="main">:</span> <span class="quoted"><span class="quoted">"phi <span class="free">g</span> <span class="skolem">p</span> <span class="main">≠</span> None"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"necessaryPhi' <span class="free">g</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>necessaryPhi' <span class="free">g</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> phi <span class="keyword1"><span class="command">have</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"unnecessaryPhi <span class="free">g</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unnecessaryPhi_def<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> allVars <span class="free">g</span> <span class="main">∧</span> unnecessaryPhi <span class="free">g</span> <span class="bound">p</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="var">?A</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">∈</span> <span class="var">?A</span> <span class="main">∧</span> phiArg <span class="free">g</span> <span class="bound">p</span> <span class="bound">q</span> <span class="main">∧</span> <span class="main">¬</span>def_dominates <span class="free">g</span> <span class="bound">q</span> <span class="bound">p</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">q</span><span class="main">)</span><span class="main">.</span> <span class="var">?r</span> <span class="bound">p</span> <span class="bound">q</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">note</span></span> phiArg_def<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

      <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Due to Lemma 3, p has an operand q,
which is unnecessary and does not dominate p. By induction q has an unnecessary
$\phi$ function as operand as well and so on. Since the program only has a finite
number of operations, there must be a cycle when following the q chain.›</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?r'</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> serial_on_finite_cycle<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"serial_on <span class="var">?A</span> <span class="var">?r'</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> serial_onI<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"unnecessaryPhi <span class="free">g</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"phiArg <span class="free">g</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>def_dominates <span class="free">g</span> <span class="skolem">y</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> redundant_def<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span> <span class="main">∈</span> <span class="var">?A</span><span class="main">.</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?r'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹A cycle in the $\phi$ functions implies a cycle in G.›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="skolem">q</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span>defNode <span class="free">g</span> <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ns</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ns</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span> <span class="bound">q</span> <span class="bound">m</span> <span class="bound">ns'</span><span class="main">.</span> <span class="var">?r</span> <span class="bound">p</span> <span class="bound">q</span> <span class="main">∧</span> <span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="bound">q</span><span class="main">-</span><span class="bound">ns'</span><span class="main">→</span><span class="bound">m</span> <span class="main">∧</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="bound">q</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="bound">ns'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="bound">m</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="bound">ns'</span> <span class="main">∧</span> set <span class="bound">ns'</span> <span class="main">⊆</span> set <span class="skolem">ns</span> <span class="main">∧</span> defNode <span class="free">g</span> <span class="bound">p</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiArg_tranclp_path_ex<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> r<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="var">?r</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tranclp_unfold<span class="main">)</span>

      <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹As G is reducible, the control flow
cycle contains one entry block, which dominates all other blocks in the cycle.›</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span> <span class="main">∈</span> set <span class="skolem">ns</span><span class="main">.</span> old.dominates <span class="free">g</span> <span class="skolem">n</span> <span class="bound">m</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> old.reducible_def<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> ns<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Without loss of generality, let q be in the entry block, which means it dominates p.›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ns</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> last <span class="skolem">ns</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> n<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_set_butlastI<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> ns<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> hd <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> old.path2_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> ns<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> hd_in_butlast<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">p</span> <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> defNode <span class="free">g</span> <span class="skolem">q</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">q</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="skolem">ns'</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ns'</span> <span class="main">⊆</span> set <span class="skolem">ns</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">p</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">drule</span> ns<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> bspec<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> defUse_path_dominated<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ns' n<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> n_dom<span class="main">:</span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="skolem">n</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="skolem">n</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>bspec<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Therefore, our assumption is wrong and G is either in minimal SSA form or there exist trivial $\phi$ functions.›</span></span>
      <span class="keyword1"><span class="command">with</span></span> ns'<span class="main">(</span>1<span class="main">)</span> n_dom<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> CFG_SSA_Transformed
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">phiCount</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="free">var</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> dom <span class="main">(</span><span class="free">phis</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="Minimality-phiCount"><span class="command">lemma</span></span> phiCount<span class="main">:</span> <span class="quoted"><span class="quoted">"phiCount <span class="free">g</span> <span class="main">=</span> card <span class="main">(</span>dom <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">v'</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">≠</span> None"</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">≠</span> None"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">v'</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="skolem">v</span> <span class="skolem">v'</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> asm <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phiDefs_def allDefs_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> asm <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phis_in_αn<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="skolem">v'</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> asm <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allDefs_var_disjoint<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> notE<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> phiCount_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> card_image<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> 1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">theorem</span></span> phi_count_minimal<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cytronMinimal <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"pruned <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"CFG_SSA_Transformed <span class="free">αe</span> <span class="free">αn</span> <span class="free">invar</span> <span class="free">inEdges'</span> <span class="free">Entry</span> <span class="free">oldDefs</span> <span class="free">oldUses</span> <span class="free">defs'</span> <span class="free">uses'</span> <span class="free">phis'</span> <span class="free">var'</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>dom <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span>dom <span class="main">(</span><span class="free">phis'</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">interpret</span></span> other<span class="main">:</span> CFG_SSA_Transformed <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="free">defs'</span></span> <span class="quoted"><span class="free">uses'</span></span> <span class="quoted"><span class="free">phis'</span></span> <span class="quoted"><span class="free">var'</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">v</span>
      <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">from</span></span> asm <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> phiDefs <span class="free">g</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phiDefs_def allDefs_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> asm <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phis_in_αn<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> asm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"liveVal <span class="free">g</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹pruned <span class="free">g</span>›</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> pruned_def<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> bspec<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">n</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">oldUses</span> <span class="free">g</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">ns</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span> <span class="main">∉</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> liveVal_use_path<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="free">phis'</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="bound">v'</span><span class="main">)</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span> <span class="main">=</span> <span class="free">var'</span> <span class="free">g</span> <span class="bound">v'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> other.convergence_prop'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ ns<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> asm <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"necessaryPhi <span class="free">g</span> <span class="main">(</span><span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹cytronMinimal <span class="free">g</span>›</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> cytronMinimal_def<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> bspec<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
            <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cytronMinimal_def phi_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> allDefs_in_allVars<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> ns<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">var'</span> <span class="free">g</span> <span class="main">`</span> other.allUses <span class="free">g</span> <span class="skolem">m</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> other.oldUses_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def allUses_def other.oldUses_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bexI<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span> <span class="main">∉</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> simpleDefs_phiDefs_var_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="skolem">ns</span> <span class="main">⟹</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span> <span class="main">∉</span> <span class="free">oldDefs</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ns<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">=</span> hd <span class="skolem">ns</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ns<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> not_hd_in_tl <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> old.path2_hd<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">note</span></span> 1 <span class="main">=</span> this

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"phiCount <span class="free">g</span> <span class="main">≤</span> other.phiCount <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> phiCount_def other.phiCount_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> card_mono<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> other.phis_finite<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dom_def image_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> not_None_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> 1<span class="main">)</span>

    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> phiCount other.phiCount<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Construct_SSA">
<div class="head">
<h1>Theory Construct_SSA</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Construct_SSA.thy
    Author:     Sebastian Ullrich
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹SSA Construction›</span></span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹CFG to SSA CFG›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Construct_SSA <span class="keyword2"><span class="keyword">imports</span></span> <a href="#SSA_CFG">SSA_CFG</a>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/While_Combinator.html">HOL-Library.While_Combinator</a>"</span>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Product_Lexorder.html">HOL-Library.Product_Lexorder</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">datatype</span></span> Def <span class="main">=</span> SimpleDef <span class="main">|</span> PhiDef
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">)</span> ssaVal <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> <span class="main">×</span> <span class="tfree">'node</span> <span class="main">×</span> Def"</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Def <span class="main">::</span> <span class="quoted">linorder</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> SimpleDef <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> PhiDef"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">less_eq_Def</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::</span> Def<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">metis</span> Def.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> less_Def_def less_eq_Def_def Def.exhaust<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_Construct <span class="main">=</span> CFG <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Entry</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">phiDefNodes_aux</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'var</span> <span class="main">⇒</span> <span class="tfree">'node</span> list <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'node</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">phiDefNodes_aux</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">unvisited</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span><span class="main">(</span>
        <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∉</span> set <span class="free"><span class="bound"><span class="entity">unvisited</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> <span class="free">defs</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="main">{}</span>
        <span class="keyword1">else</span> fold <span class="main">(∪)</span>
          <span class="main">[</span><span class="free">phiDefNodes_aux</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>removeAll <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">unvisited</span></span></span><span class="main">)</span> <span class="bound">m</span> <span class="main">.</span> m <span class="main">←</span> predecessors <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">]</span>
          <span class="main">(</span><span class="keyword1">if</span> length <span class="main">(</span>predecessors <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>
    <span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">phiDefNodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'var</span> <span class="main">⇒</span> <span class="tfree">'node</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">phiDefNodes</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> fold <span class="main">(∪)</span>
      <span class="main">[</span>phiDefNodes_aux <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="free">αn</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="bound">n</span> <span class="main">.</span> n <span class="main">←</span> <span class="free">αn</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> <span class="free">uses</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span><span class="main">]</span>
      <span class="main">{}</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">)</span> ssaVal <span class="main">⇒</span> <span class="tfree">'var</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> fst"</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">defNode</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">)</span> ssaVal <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">defNode</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> fst <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">defKind</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">)</span> ssaVal <span class="main">⇒</span> Def"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">defKind</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> snd <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">declare</span></span> var_def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

  <span class="keyword1"><span class="command">function</span></span> <span class="entity">lookupDef</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">)</span> ssaVal"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">lookupDef</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span><span class="main">(</span>
        <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∉</span> set <span class="main">(</span><span class="free">αn</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="keyword1">then</span> undefined
        <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> <span class="free">defs</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span>SimpleDef<span class="main">)</span>
        <span class="keyword1">else</span> <span class="keyword1">case</span> predecessors <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">of</span>
          <span class="main">[</span><span class="bound">m</span><span class="main">]</span> <span class="main">⇒</span> <span class="free">lookupDef</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">m</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>
          <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span>PhiDef<span class="main">)</span>
    <span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">n</span><span class="main">,</span><span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">.</span> shortestPath <span class="bound">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>shortestPath_predecessor<span class="main">)</span>
  <span class="keyword1"><span class="command">declare</span></span> lookupDef.simps <span class="main">[</span><span class="operator">code</span><span class="main">]</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">defs'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">)</span> ssaVal set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">defs'</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span>SimpleDef<span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">defs</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">uses'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">)</span> ssaVal set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">uses'</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> lookupDef <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">`</span> <span class="free">uses</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">phis'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">)</span> ssaVal<span class="main">)</span> phis"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">phis'</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">g</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="main">(</span><span class="bound">v</span><span class="main">,</span><span class="bound">m</span><span class="main">,</span><span class="bound">def</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
      <span class="keyword1">if</span> <span class="bound">m</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">∈</span> phiDefNodes <span class="bound">g</span> <span class="bound">v</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> vars <span class="bound">g</span> <span class="main">∧</span> <span class="bound">def</span> <span class="main">=</span> PhiDef <span class="keyword1">then</span>
        Some <span class="main">[</span>lookupDef <span class="bound">g</span> <span class="bound">m</span> <span class="bound">v</span> <span class="main">.</span> m <span class="main">←</span> predecessors <span class="bound">g</span> <span class="bound">n</span><span class="main">]</span>
      <span class="keyword1">else</span> None"</span></span>
  <span class="keyword1"><span class="command">declare</span></span> uses'_def <span class="main">[</span><span class="operator">code</span><span class="main">]</span> defs'_def <span class="main">[</span><span class="operator">code</span><span class="main">]</span> phis'_def <span class="main">[</span><span class="operator">code</span><span class="main">]</span>

  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">lookupDefNode</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> defNode <span class="main">(</span>lookupDef <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">declare</span></span> lookupDef.simps <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
  <span class="keyword1"><span class="command">declare</span></span> phiDefNodes_aux.simps <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

  <span class="keyword1" id="Construct_SSA-phiDefNodes_aux_cases"><span class="command">lemma</span></span> phiDefNodes_aux_cases<span class="main">:</span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>nonrec<span class="main">)</span> <span class="quoted"><span class="quoted">"phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="free">unvisited</span> <span class="free">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span> <span class="main">∉</span> set <span class="free">unvisited</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="main">|</span> <span class="main">(</span>rec<span class="main">)</span> <span class="quoted"><span class="quoted">"phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="free">unvisited</span> <span class="free">n</span> <span class="main">=</span> fold union <span class="main">(</span>map <span class="main">(</span>phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="main">(</span>removeAll <span class="free">n</span> <span class="free">unvisited</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span><span class="keyword1">if</span> length <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="free">unvisited</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="free">unvisited</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rec <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phiDefNodes_aux.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> nonrec <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phiDefNodes_aux.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA-phiDefNode_aux_is_join_node"><span class="command">lemma</span></span> phiDefNode_aux_is_join_node<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="free">un</span> <span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">un</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>removeAll_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">un</span> <span class="skolem">m</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">un</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>phiDefNodes_aux_cases<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> rec
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>fold_union_elem <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA-phiDefNode_is_join_node"><span class="command">lemma</span></span> phiDefNode_is_join_node<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> phiDefNodes <span class="free">g</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> phiDefNodes_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>fold_union_elem <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>phiDefNode_aux_is_join_node<span class="main">)</span>

  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">unvisitedPath</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'node</span> list <span class="main">⇒</span> <span class="tfree">'node</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">unvisitedPath</span> <span class="free"><span class="bound"><span class="entity">un</span></span></span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">≡</span> distinct <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">∧</span> set <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">⊆</span> set <span class="free"><span class="bound"><span class="entity">un</span></span></span>"</span></span>

  <span class="keyword1" id="Construct_SSA-unvisitedPath_removeLast"><span class="command">lemma</span></span> unvisitedPath_removeLast<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unvisitedPath <span class="free">un</span> <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ns</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unvisitedPath <span class="main">(</span>removeAll <span class="main">(</span>last <span class="free">ns</span><span class="main">)</span> <span class="free">un</span><span class="main">)</span> <span class="main">(</span>butlast <span class="free">ns</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"last <span class="free">ns</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ns'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"butlast <span class="free">ns</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?un'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"removeAll <span class="var">?n</span> <span class="free">un</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"last <span class="var">?ns'</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?n</span> <span class="main">=</span> <span class="free">ns</span> <span class="main">!</span> <span class="main">(</span>length <span class="free">ns</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> last_conv_nth<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="var">?ns'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> distinct_butlast<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?ns'</span> <span class="main">⊆</span> set <span class="var">?un'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
      <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="var">?ns'</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="var">?ns'</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="var">?ns'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>in_set_conv_nth<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="free">ns</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ns</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nth_butlast<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="var">?n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">iff</span><span class="main"><span class="main">:</span></span>nth_eq_iff_index_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> i assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="free">un</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> set <span class="var">?ns'</span>›</span></span> assms<span class="main">(</span>1<span class="main">)</span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="var">?un'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA-phiDefNodes_auxI"><span class="command">lemma</span></span> phiDefNodes_auxI<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"unvisitedPath <span class="free">un</span> <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set <span class="free">ns</span><span class="main">.</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">n</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="free">un</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">un</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">ns</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>removeAll_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">un</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">un</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>phiDefNodes_aux_cases<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> nonrec
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> nonrec <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> rec
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rec assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">subst</span> rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fold_union_elemI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">m</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ns'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"butlast <span class="skolem">ns</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"last <span class="var">?ns'</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> last <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>2<span class="main">)</span> False <span class="keyword1"><span class="command">have</span></span> ns'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="var">?ns'</span><span class="main">→</span><span class="var">?m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m'</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> path2_unsnoc<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="main">(</span>removeAll <span class="skolem">m</span> <span class="skolem">un</span><span class="main">)</span> <span class="var">?m'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> rec<span class="main">(</span>2<span class="main">)</span> ns'
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted">"1.IH"</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>1<span class="main">)</span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ns</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">=</span> last <span class="skolem">ns</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"unvisitedPath <span class="main">(</span>removeAll <span class="skolem">m</span> <span class="skolem">un</span><span class="main">)</span> <span class="var">?ns'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">=</span> last <span class="skolem">ns</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> unvisitedPath_removeLast<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set <span class="var">?ns'</span><span class="main">.</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>in_set_butlastD<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">with</span></span> ns'<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">subst</span> rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fold_union_elemI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA-phiDefNodes_auxE"><span class="command">lemma</span></span> phiDefNodes_auxE<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="free">un</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set <span class="free">ns</span><span class="main">.</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">n</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"unvisitedPath <span class="free">un</span> <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">atomize_elim</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induction</span> <span class="quoted"><span class="free">un</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>removeAll_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">un</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">un</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>phiDefNodes_aux_cases<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> nonrec
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> rec
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">if</span> length <span class="main">(</span>predecessors <span class="free">g</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">{</span><span class="skolem">m</span><span class="main">}</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>2<span class="main">)</span> rec True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> rec <span class="quoted">"1.prems"</span><span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">where</span></span> m'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="main">(</span>removeAll <span class="skolem">m</span> <span class="skolem">un</span><span class="main">)</span> <span class="skolem">m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>fold_union_elem<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"1.IH"</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">m'</span></span><span class="main">]</span> m' rec <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="skolem">m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set <span class="skolem">ns</span><span class="main">.</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">n</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"unvisitedPath <span class="main">(</span>removeAll <span class="skolem">m</span> <span class="skolem">un</span><span class="main">)</span> <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> m' rec <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA-phiDefNodesE"><span class="command">lemma</span></span> phiDefNodesE<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> phiDefNodes <span class="free">g</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns</span> <span class="free">m</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set <span class="free">ns</span><span class="main">.</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>phiDefNodes_auxE <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>fold_union_elem <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>phiDefNodes_def<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA-phiDefNodes_αn"><span class="command">lemma</span></span> phiDefNodes_αn<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> phiDefNodes <span class="free">g</span> <span class="free">v</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> phiDefNodesE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1" id="Construct_SSA-phiDefNodesI"><span class="command">lemma</span></span> phiDefNodesI<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set <span class="free">ns</span><span class="main">.</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">n</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> phiDefNodes <span class="free">g</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> path2_in_αn<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">ns'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set <span class="skolem">ns'</span><span class="main">.</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> simple_path2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> phiDefNodes_auxI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>path2_in_αn<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> phiDefNodes_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> fold_union_elemI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA-lookupDef_cases"><span class="command">lemma</span></span> lookupDef_cases<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>SimpleDef<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"lookupDef <span class="free">g</span> <span class="free">n</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">n</span><span class="main">,</span>SimpleDef<span class="main">)</span>"</span></span>
          <span class="main">|</span> <span class="main">(</span>PhiDef<span class="main">)</span>    <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"lookupDef <span class="free">g</span> <span class="free">n</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">n</span><span class="main">,</span>PhiDef<span class="main">)</span>"</span></span>
          <span class="main">|</span> <span class="main">(</span>rec<span class="main">)</span> <span class="free">m</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"predecessors <span class="free">g</span> <span class="free">n</span> <span class="main">=</span> <span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"lookupDef <span class="free">g</span> <span class="free">n</span> <span class="free">v</span> <span class="main">=</span> lookupDef <span class="free">g</span> <span class="free">m</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> assms SimpleDef <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lookupDef.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"predecessors <span class="free">g</span> <span class="free">n</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">m</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"predecessors <span class="free">g</span> <span class="free">n</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> False rec assms m <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> lookupDef.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> predecessor_is_node<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span>›</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> PhiDef<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> lookupDef.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>list.split<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA-lookupDef_cases'"><span class="command">lemma</span></span> lookupDef_cases'<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>SimpleDef<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"defNode <span class="main">(</span>lookupDef <span class="free">g</span> <span class="free">n</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"defKind <span class="main">(</span>lookupDef <span class="free">g</span> <span class="free">n</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> SimpleDef"</span></span>
          <span class="main">|</span> <span class="main">(</span>PhiDef<span class="main">)</span>    <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"lookupDefNode <span class="free">g</span> <span class="free">n</span> <span class="free">v</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"defKind <span class="main">(</span>lookupDef <span class="free">g</span> <span class="free">n</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> PhiDef"</span></span>
          <span class="main">|</span> <span class="main">(</span>rec<span class="main">)</span> <span class="free">m</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"predecessors <span class="free">g</span> <span class="free">n</span> <span class="main">=</span> <span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"lookupDef <span class="free">g</span> <span class="free">n</span> <span class="free">v</span> <span class="main">=</span> lookupDef <span class="free">g</span> <span class="free">m</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lookupDef_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">v</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>

  <span class="keyword1" id="Construct_SSA-lookupDefE"><span class="command">lemma</span></span> lookupDefE<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lookupDef <span class="free">g</span> <span class="free">n</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>SimpleDef<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">n</span><span class="main">,</span>SimpleDef<span class="main">)</span>"</span></span>
          <span class="main">|</span> <span class="main">(</span>PhiDef<span class="main">)</span>    <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">n</span><span class="main">,</span>PhiDef<span class="main">)</span>"</span></span>
          <span class="main">|</span> <span class="main">(</span>rec<span class="main">)</span> <span class="free">m</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"predecessors <span class="free">g</span> <span class="free">n</span> <span class="main">=</span> <span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">=</span> lookupDef <span class="free">g</span> <span class="free">m</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">atomize_elim</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>lookupDef_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">v</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1" id="Construct_SSA-lookupDef_induct"><span class="command">lemma</span></span> lookupDef_induct<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> SimpleDef PhiDef rec<span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">n</span><span class="main">;</span> lookupDef <span class="free">g</span> <span class="bound">n</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="bound">n</span><span class="main">,</span>SimpleDef<span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">;</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">n</span><span class="main">;</span> length <span class="main">(</span>predecessors <span class="free">g</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span><span class="main">;</span> lookupDef <span class="free">g</span> <span class="bound">n</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="bound">n</span><span class="main">,</span>PhiDef<span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">m</span><span class="main">.</span> <span class="main">⟦</span><span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">n</span><span class="main">;</span> predecessors <span class="free">g</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">[</span><span class="bound">m</span><span class="main">]</span><span class="main">;</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">;</span> lookupDef <span class="free">g</span> <span class="bound">n</span> <span class="free">v</span> <span class="main">=</span> lookupDef <span class="free">g</span> <span class="bound">m</span> <span class="free">v</span><span class="main">;</span> <span class="free">P</span> <span class="bound">m</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>lookupDef.induct<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g'</span> <span class="bound">n</span> <span class="bound">v'</span><span class="main">.</span> <span class="bound">g'</span><span class="main">=</span><span class="free">g</span> <span class="main">∧</span> <span class="bound">v'</span><span class="main">=</span><span class="free">v</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">n</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="quasi_keyword"><span class="quasi_keyword">no_asm</span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> mp<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> v<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">v</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> lookupDef_cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> assms lookupDef_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

  <span class="keyword1" id="Construct_SSA-lookupDef_induct'"><span class="command">lemma</span></span> lookupDef_induct'<span class="main">[</span><span class="operator">consumes</span> 2<span class="main">,</span> <span class="operator">case_names</span> SimpleDef PhiDef rec<span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"lookupDef <span class="free">g</span> <span class="free">n</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">n'</span><span class="main">,</span><span class="free">def</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">v</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n'</span><span class="main">;</span> <span class="free">def</span> <span class="main">=</span> SimpleDef<span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">n'</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n'</span><span class="main">;</span> length <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n'</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span><span class="main">;</span> <span class="free">def</span> <span class="main">=</span> PhiDef<span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">n'</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">m</span><span class="main">.</span> <span class="main">⟦</span><span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">n</span><span class="main">;</span> predecessors <span class="free">g</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">[</span><span class="bound">m</span><span class="main">]</span><span class="main">;</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">;</span> lookupDef <span class="free">g</span> <span class="bound">n</span> <span class="free">v</span> <span class="main">=</span> lookupDef <span class="free">g</span> <span class="bound">m</span> <span class="free">v</span><span class="main">;</span> <span class="free">P</span> <span class="bound">m</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>lookupDef_induct<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> v<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">v</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>SimpleDef <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="free">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">def</span> <span class="main">=</span> SimpleDef"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> SimpleDef assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>PhiDef <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="free">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">def</span> <span class="main">=</span> PhiDef"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> PhiDef assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

  <span class="keyword1" id="Construct_SSA-lookupDef_looksup"><span class="command">lemma</span></span> lookupDef_looksup<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lookupDef <span class="free">g</span> <span class="free">n</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">n'</span><span class="main">,</span><span class="free">def</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>lookupDef.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>lookupDefE<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA-lookupDef_looksup'"><span class="command">lemma</span></span> lookupDef_looksup'<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">n'</span><span class="main">,</span><span class="free">def</span><span class="main">)</span> <span class="main">=</span> lookupDef <span class="free">g</span> <span class="free">n</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lookupDef_looksup<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA-lookupDef_looksup''"><span class="command">lemma</span></span> lookupDef_looksup''<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">n'</span> <span class="quoted">"<span class="free">def</span>"</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"lookupDef <span class="free">g</span> <span class="free">n</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">n'</span><span class="main">,</span><span class="free">def</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">atomize_elim</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>lookupDef.induct<span class="main">)</span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>lookupDef_cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1" id="Construct_SSA-lookupDef_fst"><span class="command">lemma</span></span> lookupDef_fst<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> fst <span class="main">(</span>lookupDef <span class="free">g</span> <span class="free">n</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_conv lookupDef_looksup''<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA-lookupDef_to_αn"><span class="command">lemma</span></span> lookupDef_to_αn<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lookupDef <span class="free">g</span> <span class="free">n</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">n'</span><span class="main">,</span><span class="free">def</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>lookupDef_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">v</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>

  <span class="keyword1" id="Construct_SSA-lookupDef_to_αn'"><span class="command">lemma</span></span> lookupDef_to_αn'<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lookupDef <span class="free">g</span> <span class="free">n</span> <span class="free">v</span> <span class="main">=</span> <span class="free">val</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">val</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">val</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>lookupDef_to_αn<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA-lookupDef_induct''"><span class="command">lemma</span></span> lookupDef_induct''<span class="main">[</span><span class="operator">consumes</span> 2<span class="main">,</span> <span class="operator">case_names</span> SimpleDef PhiDef rec<span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lookupDef <span class="free">g</span> <span class="free">n</span> <span class="free">v</span> <span class="main">=</span> <span class="free">val</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">v</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="main">(</span>defNode <span class="free">val</span><span class="main">)</span><span class="main">;</span> defKind <span class="free">val</span> <span class="main">=</span> SimpleDef<span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>defNode <span class="free">val</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="main">(</span>defNode <span class="free">val</span><span class="main">)</span><span class="main">;</span> length <span class="main">(</span>predecessors <span class="free">g</span> <span class="main">(</span>defNode <span class="free">val</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span><span class="main">;</span> defKind <span class="free">val</span> <span class="main">=</span> PhiDef<span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>defNode <span class="free">val</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">m</span><span class="main">.</span> <span class="main">⟦</span><span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">n</span><span class="main">;</span> predecessors <span class="free">g</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">[</span><span class="bound">m</span><span class="main">]</span><span class="main">;</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">;</span> lookupDef <span class="free">g</span> <span class="bound">n</span> <span class="free">v</span> <span class="main">=</span> lookupDef <span class="free">g</span> <span class="bound">m</span> <span class="free">v</span><span class="main">;</span> <span class="free">P</span> <span class="bound">m</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">val</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> lookupDef_induct'<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="Construct_SSA-defs'_finite"><span class="command">lemma</span></span> defs'_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>defs' <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> defs'_def <span class="keyword1"><span class="command">using</span></span> defs_finite
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1" id="Construct_SSA-uses'_finite"><span class="command">lemma</span></span> uses'_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>uses' <span class="free">g</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> uses'_def <span class="keyword1"><span class="command">using</span></span> uses_finite
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1" id="Construct_SSA-defs'_uses'_disjoint"><span class="command">lemma</span></span> defs'_uses'_disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> defs' <span class="free">g</span> <span class="free">n</span> <span class="main">∩</span> uses' <span class="free">g</span> <span class="free">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> defs'_def uses'_def <span class="keyword1"><span class="command">using</span></span> defs_uses_disjoint
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>lookupDef_looksup'<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA-allDefs'_disjoint"><span class="command">lemma</span></span> allDefs'_disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">≠</span> <span class="free">m</span>
    <span class="main">⟹</span> <span class="main">(</span>defs' <span class="free">g</span> <span class="free">n</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> dom <span class="main">(</span>phis' <span class="free">g</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>defs' <span class="free">g</span> <span class="free">m</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="free">m</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> dom <span class="main">(</span>phis' <span class="free">g</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> defs'_def phis'_def<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA-phiDefNodes_aux_finite"><span class="command">lemma</span></span> phiDefNodes_aux_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="free">un</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">un</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>removeAll_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">un</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">un</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>phiDefNodes_aux_cases<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA-phis'_finite"><span class="command">lemma</span></span> phis'_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>dom <span class="main">(</span>phis' <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?super</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">×</span> vars <span class="free">g</span> <span class="main">×</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">×</span> <span class="main">{</span>PhiDef<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?super</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?super</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>phis'_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA-phis'_wf"><span class="command">lemma</span></span> phis'_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"phis' <span class="free">g</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">args</span> <span class="main">⟹</span> length <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> length <span class="free">args</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> phis'_def predecessors_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>prod.splits if_split_asm<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA-simpleDefs_phiDefs_disjoint"><span class="command">lemma</span></span> simpleDefs_phiDefs_disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> defs' <span class="free">g</span> <span class="free">n</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> dom <span class="main">(</span>phis' <span class="free">g</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> phis'_def defs'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="Construct_SSA-oldDefs_correct"><span class="command">lemma</span></span> oldDefs_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">defs</span> <span class="free">g</span> <span class="free">n</span> <span class="main">=</span> var <span class="free">g</span> <span class="main">`</span> defs' <span class="free">g</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>defs'_def image_image<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA-oldUses_correct"><span class="command">lemma</span></span> oldUses_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">uses</span> <span class="free">g</span> <span class="free">n</span> <span class="main">=</span> var <span class="free">g</span> <span class="main">`</span> uses' <span class="free">g</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>uses'_def image_image<span class="main">)</span>

  <span class="keyword1"><span class="command">lemmas</span></span> base_SSA_defs <span class="main">=</span> CFG_SSA_base.CFG_SSA_defs

  <span class="keyword1"><span class="command">sublocale</span></span> braun_ssa<span class="main">:</span> CFG_SSA <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted">defs'</span> <span class="quoted">uses'</span> <span class="quoted">phis'</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> defs'_uses'_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> defs'_finite<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uses'_def uses_in_αn<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> uses'_finite<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> invar<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> phis'_finite<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phis'_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> phis'_wf<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> base_SSA_defs<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> simpleDefs_phiDefs_disjoint<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> allDefs'_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> CFG<span class="main">)</span> invar<span class="main">[</span><span class="operator">rule</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> CFG<span class="main">)</span> Entry_no_predecessor<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">context</span></span> CFG_Construct
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">declare</span></span> invar<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">declare</span></span> Entry_no_predecessor<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

  <span class="keyword1" id="Construct_SSA-no_disjoint_cycle"><span class="command">lemma</span></span> no_disjoint_cycle<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">ns</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ns</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> path2_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distinct.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hd_Cons_tl last_in_set last_tl path_not_Nil<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA-lookupDef_path"><span class="command">lemma</span></span> lookupDef_path<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns</span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> lookupDefNode <span class="free">g</span> <span class="free">m</span> <span class="free">v</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span><span class="main">.</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">atomize_elim</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>lookupDef_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">v</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>SimpleDef <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">n</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>PhiDef <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">n</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>rec <span class="skolem">m</span> <span class="skolem">m'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> lookupDefNode <span class="free">g</span> <span class="skolem">m</span> <span class="free">v</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="skolem">m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">ns</span><span class="main">)</span><span class="main">.</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> rec.hyps<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ns</span><span class="main">@</span><span class="main">[</span><span class="skolem">m</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> path2_not_Nil<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA-lookupDef_path_conventional"><span class="command">lemma</span></span> lookupDef_path_conventional<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> lookupDefNode <span class="free">g</span> <span class="free">m</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> braun_ssa.allDefs <span class="free">g</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"var <span class="free">g</span> <span class="free">v'</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-4<span class="main">)</span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>path2_rev_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword1"><span class="command">from</span></span> empty.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">ns</span> <span class="skolem">m</span> <span class="skolem">m'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> snoc.prems<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> snoc.hyps <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="skolem">ns</span><span class="main">@</span><span class="main">[</span><span class="skolem">m'</span><span class="main">]</span><span class="main">→</span><span class="skolem">m'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>lookupDef_cases'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">m'</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">v</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> SimpleDef
      <span class="keyword1"><span class="command">with</span></span> snoc.prems<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tl_append <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>list.split_asm<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> PhiDef
      <span class="keyword1"><span class="command">with</span></span> snoc.prems<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tl_append <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>list.split_asm<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>rec <span class="skolem">m<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> snoc.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">ns</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> rec<span class="main">(</span>4<span class="main">)</span> snoc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> snoc.IH<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tl_append <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>list.split_asm<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> snoc.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">m'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tl_append <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>list.split_asm<span class="main">)</span>

        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> defs' <span class="free">g</span> <span class="free">x</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> rec<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>defs'_def<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> braun_ssa.phiDefs <span class="free">g</span> <span class="skolem">m'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>braun_ssa.allDefs_def<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> phiDefNodes <span class="free">g</span> <span class="main">(</span>fst <span class="free">v'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> braun_ssa.phiDefs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> phis'_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>prod.split_asm if_split_asm<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> rec<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>phiDefNode_is_join_node<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA-allUse_lookupDef"><span class="command">lemma</span></span> allUse_lookupDef<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> braun_ssa.allUses <span class="free">g</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lookupDef <span class="free">g</span> <span class="free">m</span> <span class="main">(</span>var <span class="free">g</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> uses' <span class="free">g</span> <span class="free">m</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> lookupDef <span class="free">g</span> <span class="free">m</span> <span class="skolem">v'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>uses'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"var <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> <span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> var_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lookupDef_fst<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> v' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span>  <span class="skolem"><span class="skolem">m'</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>predecessors <span class="free">g</span> <span class="skolem">m'</span><span class="main">)</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"phis' <span class="free">g</span> <span class="main">(</span><span class="skolem">m'</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">vs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>braun_ssa.allUses_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>braun_ssa.phiUsesE<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> lookupDef <span class="free">g</span> <span class="free">m</span> <span class="main">(</span>var <span class="free">g</span> <span class="skolem">v'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phis'_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>prod.split_asm if_split_asm <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>in_set_zip_map<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"var <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> var <span class="free">g</span> <span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> var_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lookupDef_fst<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> l <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA-phis'_fst"><span class="command">lemma</span></span> phis'_fst<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"phis' <span class="free">g</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> set <span class="free">vs</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"var <span class="free">g</span> <span class="free">v'</span> <span class="main">=</span> var <span class="free">g</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>lookupDef_fst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>phiDefNodes_αn <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phis'_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>prod.split_asm if_split_asm<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA-allUse_simpleUse"><span class="command">lemma</span></span> allUse_simpleUse<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> braun_ssa.allUses <span class="free">g</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ms</span> <span class="free">m'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">m</span><span class="main">-</span><span class="free">ms</span><span class="main">→</span><span class="free">m'</span>"</span></span> <span class="quoted"><span class="quoted">"var <span class="free">g</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="free">m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">ms</span><span class="main">)</span><span class="main">.</span> var <span class="free">g</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> uses' <span class="free">g</span> <span class="free">m</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> lookupDef <span class="free">g</span> <span class="free">m</span> <span class="skolem">v'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>uses'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"var <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> <span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> var_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lookupDef_fst<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> v' assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span>  <span class="skolem"><span class="skolem">m'</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> phi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>predecessors <span class="free">g</span> <span class="skolem">m'</span><span class="main">)</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"phis' <span class="free">g</span> <span class="main">(</span><span class="skolem">m'</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">vs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>braun_ssa.allUses_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>braun_ssa.phiUsesE<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> m'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> phiDefNodes <span class="free">g</span> <span class="main">(</span>var <span class="free">g</span> <span class="skolem">v'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phis'_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>prod.split_asm if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> phi <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"var <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> var <span class="free">g</span> <span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phis'_fst<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> m' <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m''</span></span> <span class="skolem"><span class="skolem">ms</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">m'</span><span class="main">-</span><span class="skolem">ms</span><span class="main">→</span><span class="skolem">m''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="skolem">ms</span><span class="main">.</span> var <span class="free">g</span> <span class="skolem">v'</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"var <span class="free">g</span> <span class="skolem">v'</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="skolem">m''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> phiDefNodesE<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> phi<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">#</span><span class="skolem">ms</span>"</span></span> <span class="quoted"><span class="skolem">m''</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>var_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA-defs'"><span class="command">lemma</span></span> defs'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> defs' <span class="free">g</span> <span class="free">n</span> <span class="main">⟷</span> var <span class="free">g</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span> <span class="main">∧</span> defKind <span class="free">v</span> <span class="main">=</span> SimpleDef <span class="main">∧</span> defNode <span class="free">v</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>defs'_def<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA-use_implies_allDef"><span class="command">lemma</span></span> use_implies_allDef<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lookupDef <span class="free">g</span> <span class="free">m</span> <span class="main">(</span>var <span class="free">g</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"var <span class="free">g</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="free">m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">m</span><span class="main">-</span><span class="free">ms</span><span class="main">→</span><span class="free">m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">ms</span><span class="main">)</span><span class="main">.</span> var <span class="free">g</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> braun_ssa.allDefs <span class="free">g</span> <span class="main">(</span>defNode <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">ms</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>lookupDef_induct''<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> SimpleDef
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> defs' <span class="free">g</span> <span class="main">(</span>defNode <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>defs'<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>braun_ssa.allDefs_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> PhiDef
      <span class="keyword1"><span class="command">from</span></span> PhiDef.prems<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> vars<span class="main">:</span> <span class="quoted"><span class="quoted">"var <span class="free">g</span> <span class="free">v</span> <span class="main">∈</span> vars <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> PhiDef.hyps<span class="main">(</span>1<span class="main">)</span> PhiDef.prems<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>set <span class="skolem">ms</span><span class="main">.</span> var <span class="free">g</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hd_Cons_tl path2_def path2_not_Nil set_ConsD<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> PhiDef <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">v</span> <span class="main">∈</span> phiDefNodes <span class="free">g</span> <span class="main">(</span>var <span class="free">g</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiDefNodesI<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> PhiDef.hyps<span class="main">(</span>3<span class="main">)</span> vars <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> braun_ssa.phiDefs <span class="free">g</span> <span class="main">(</span>defNode <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> braun_ssa.phiDefs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> phis'_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>prod.split<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>braun_ssa.allDefs_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>rec <span class="skolem">n</span> <span class="skolem">m</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> rec.hyps<span class="main">(</span>1<span class="main">)</span> rec.prems<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>set <span class="skolem">ms</span><span class="main">.</span> var <span class="free">g</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hd_Cons_tl path2_def path2_not_Nil set_ConsD<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> rec <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> rec.IH<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA-allUse_defNode_in_αn"><span class="command">lemma</span></span> allUse_defNode_in_αn<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> braun_ssa.allUses <span class="free">g</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="main">(</span>lookupDef <span class="free">g</span> <span class="free">m</span> <span class="main">(</span>var <span class="free">g</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"lookupDef <span class="free">g</span> <span class="free">m</span> <span class="main">(</span>var <span class="free">g</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> allUse_lookupDef<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?n</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> lookupDef_path<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> l <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA-allUse_implies_allDef"><span class="command">lemma</span></span> allUse_implies_allDef<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> braun_ssa.allUses <span class="free">g</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> braun_ssa.allDefs <span class="free">g</span> <span class="main">(</span>defNode <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="main">(</span>lookupDef <span class="free">g</span> <span class="free">m</span> <span class="main">(</span>var <span class="free">g</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"lookupDef <span class="free">g</span> <span class="free">m</span> <span class="main">(</span>var <span class="free">g</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> allUse_lookupDef<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?n</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">ns</span><span class="main">)</span><span class="main">.</span> var <span class="free">g</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> lookupDef_path<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ms</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">m</span><span class="main">-</span><span class="skolem">ms</span><span class="main">→</span><span class="skolem">m'</span>"</span></span> <span class="quoted"><span class="quoted">"var <span class="free">g</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="skolem">m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">ms</span><span class="main">)</span><span class="main">.</span> var <span class="free">g</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allUse_simpleUse<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> braun_ssa.allDefs <span class="free">g</span> <span class="main">(</span>defNode <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ns assms<span class="main">(</span>2<span class="main">)</span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> use_implies_allDef<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> l <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA-conventional"><span class="command">lemma</span></span> conventional<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> braun_ssa.allDefs <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> braun_ssa.allUses <span class="free">g</span> <span class="free">m</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> braun_ssa.allDefs <span class="free">g</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"var <span class="free">g</span> <span class="free">v'</span> <span class="main">≠</span> var <span class="free">g</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lookupDef <span class="free">g</span> <span class="free">m</span> <span class="main">(</span>var <span class="free">g</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allUse_lookupDef<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> braun_ssa.allDefs <span class="free">g</span> <span class="main">(</span>defNode <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allUse_implies_allDef<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> braun_ssa.allDefs_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">v</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"defNode <span class="free">v</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> braun_ssa.allDefs_disjoint'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> lookupDef_path_conventional<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">m</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>uses'_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>var_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA-allDefs_var_disjoint_aux"><span class="command">lemma</span></span> allDefs_var_disjoint_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∉</span> phiDefNodes <span class="free">g</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>phiDefNodesE <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>path2_hd_in_ns<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA-allDefs_var_disjoint"><span class="command">lemma</span></span> allDefs_var_disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> braun_ssa.allDefs <span class="free">g</span> <span class="free">n</span><span class="main">;</span> <span class="free">v'</span> <span class="main">∈</span> braun_ssa.allDefs <span class="free">g</span> <span class="free">n</span><span class="main">;</span> <span class="free">v</span> <span class="main">≠</span> <span class="free">v'</span><span class="main">⟧</span> <span class="main">⟹</span> var <span class="free">g</span> <span class="free">v'</span> <span class="main">≠</span> var <span class="free">g</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> braun_ssa.allDefs_def braun_ssa.phiDefs_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> defs'_def phis'_def allDefs_var_disjoint_aux <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>prod.splits if_split_asm<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span> <span class="main">⟹</span> lookupDefNode <span class="free">g</span> <span class="free">n</span> <span class="free">v</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>lookupDef_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">v</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> length <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span> <span class="main">⟹</span> lookupDefNode <span class="free">g</span> <span class="free">n</span> <span class="free">v</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>lookupDef_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">v</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>

  <span class="keyword1" id="Construct_SSA-lookupDef_idem"><span class="command">lemma</span></span> lookupDef_idem<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lookupDef <span class="free">g</span> <span class="main">(</span>lookupDefNode <span class="free">g</span> <span class="free">n</span> <span class="free">v</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> lookupDef <span class="free">g</span> <span class="free">n</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>lookupDef_induct''<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">v</span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>assms<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_Construct_wf <span class="main">=</span> CFG_Construct <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="main">+</span> CFG_wf <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Entry</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="Construct_SSA-def_ass_allUses_aux"><span class="command">lemma</span></span> def_ass_allUses_aux<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lookupDefNode <span class="free">g</span> <span class="free">n</span> <span class="main">(</span>var <span class="free">g</span> <span class="free">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">ns</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>lookupDef_induct''<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"var <span class="free">g</span> <span class="free">v</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> refl<span class="main"><span class="main">,</span></span> <span class="operator">consumes</span> 1<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">m</span> <span class="skolem">m'</span> <span class="skolem">ns</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ns</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"3.prems"</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="free">Entry</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> path2_nontrivial<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"3.hyps"</span><span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"3.prems"</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span>butlast <span class="skolem">ns</span><span class="main">→</span><span class="skolem">m'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> path2_unsnoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="quoted">"3.hyps"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"3.hyps"</span> <span class="quoted">"3.IH"</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"butlast <span class="skolem">ns</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>in_set_butlastD<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA-def_ass_allUses"><span class="command">lemma</span></span> def_ass_allUses<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> braun_ssa.allUses <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"braun_ssa.defAss <span class="free">g</span> <span class="free">n</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> braun_ssa.defAssI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ns</span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lookupDefNode <span class="free">g</span> <span class="free">n</span> <span class="main">(</span>var <span class="free">g</span> <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> asm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> def_ass_allUses_aux<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms allUse_lookupDef <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">=</span> defNode <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms allUse_implies_allDef <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> braun_ssa.allDefs <span class="free">g</span> <span class="main">(</span>defNode <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">∈</span>set <span class="skolem">ns</span><span class="main">.</span> <span class="free">v</span> <span class="main">∈</span> braun_ssa.allDefs <span class="free">g</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA-Empty_no_phis"><span class="command">lemma</span></span> Empty_no_phis<span class="main">:</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"phis' <span class="free">g</span> <span class="main">(</span><span class="free">Entry</span> <span class="free">g</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="free">Entry</span> <span class="free">g</span> <span class="main">∉</span> phiDefNodes <span class="free">g</span> <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> phiDefNodesE<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">ns</span> <span class="skolem">m</span>
      <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>set <span class="skolem">ns</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> def_ass_uses<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">,</span> <span class="operator">THEN</span> bspec<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ this<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">THEN</span> bspec<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ asm<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> asm
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>defAss'E<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>phis'_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>prod.split<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA-braun_ssa_CFG_SSA_wf"><span class="command">lemma</span></span> braun_ssa_CFG_SSA_wf<span class="main">:</span>
    <span class="quoted"><span class="quoted">"CFG_SSA_wf <span class="free">αe</span> <span class="free">αn</span> <span class="free">invar</span> <span class="free">inEdges'</span> <span class="free">Entry</span> defs' uses' phis'"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> def_ass_allUses<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Empty_no_phis<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">sublocale</span></span> braun_ssa<span class="main">:</span> CFG_SSA_wf <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted">defs'</span> <span class="quoted">uses'</span> <span class="quoted">phis'</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> braun_ssa_CFG_SSA_wf<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA-braun_ssa_CFG_SSA_Transformed"><span class="command">lemma</span></span> braun_ssa_CFG_SSA_Transformed<span class="main">:</span>
    <span class="quoted"><span class="quoted">"CFG_SSA_Transformed <span class="free">αe</span> <span class="free">αn</span> <span class="free">invar</span> <span class="free">inEdges'</span> <span class="free">Entry</span> <span class="free">defs</span> <span class="free">uses</span> defs' uses' phis' var"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> oldDefs_correct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> oldUses_correct<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> conventional<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> phis'_fst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> allDefs_var_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">sublocale</span></span> braun_ssa<span class="main">:</span> CFG_SSA_Transformed <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted">defs'</span> <span class="quoted">uses'</span> <span class="quoted">phis'</span> <span class="quoted">var</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> braun_ssa_CFG_SSA_Transformed<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA-PhiDef_defNode_eq"><span class="command">lemma</span></span> PhiDef_defNode_eq<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> phiDefNodes <span class="free">g</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> vars <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"braun_ssa.defNode <span class="free">g</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">n</span><span class="main">,</span>PhiDef<span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> braun_ssa.defNode_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> braun_ssa.allDefs_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> braun_ssa.phiDefs_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phis'_def<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA-phiDefNodes_aux_pruned_aux"><span class="command">lemma</span></span> phiDefNodes_aux_pruned_aux<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="free">nUse</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="free">nUse</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span><span class="free">m</span><span class="main">-</span><span class="free">ms</span><span class="main">→</span><span class="free">nUse</span>"</span></span> <span class="quoted"><span class="quoted">"braun_ssa.liveVal <span class="free">g</span> <span class="main">(</span>lookupDef <span class="free">g</span> <span class="free">m</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ns</span><span class="main">@</span><span class="free">ms</span><span class="main">)</span><span class="main">.</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"braun_ssa.liveVal <span class="free">g</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">n</span><span class="main">,</span>PhiDef<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3-<span class="main">)</span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">ns</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">ms</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>path2_rev_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookupDef <span class="free">g</span> <span class="free">n</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">n</span><span class="main">,</span>PhiDef<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">drule</span> phiDefNode_aux_is_join_node<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>lookupDef_cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> empty.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">ns</span> <span class="skolem">m</span> <span class="skolem">m'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> snoc.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>lookupDef_cases<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> v<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">v</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> SimpleDef
      <span class="keyword1"><span class="command">with</span></span> snoc.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"braun_ssa.liveVal <span class="free">g</span> <span class="main">(</span>lookupDef <span class="free">g</span> <span class="skolem">m</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> snoc.IH<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> snoc.prems<span class="main">(</span>1<span class="main">)</span> snoc.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">m</span><span class="main">-</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">→</span><span class="free">nUse</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> snoc.prems<span class="main">(</span>3<span class="main">)</span> snoc.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span> set<span class="main">(</span><span class="skolem">ns</span> <span class="main">@</span> <span class="skolem">m</span> <span class="main">#</span> <span class="skolem">ms</span><span class="main">)</span><span class="main">.</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">case</span></span> rec
        <span class="keyword1"><span class="command">from</span></span> snoc.hyps<span class="main">(</span>2<span class="main">)</span> rec<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"predecessors <span class="free">g</span> <span class="skolem">m'</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">m</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> rec snoc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"braun_ssa.liveVal <span class="free">g</span> <span class="main">(</span>lookupDef <span class="free">g</span> <span class="skolem">m</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> step <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> PhiDef
        <span class="keyword1"><span class="command">with</span></span> snoc assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> phiDefNode<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> phiDefNodes <span class="free">g</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> phiDefNodesI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> vars<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> vars <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"braun_ssa.liveVal <span class="free">g</span> <span class="main">(</span>lookupDef <span class="free">g</span> <span class="skolem">m</span> <span class="free">v</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> braun_ssa.livePhi<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> PhiDef<span class="main">(</span>3<span class="main">)</span> snoc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"braun_ssa.liveVal <span class="free">g</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="skolem">m'</span><span class="main">,</span>PhiDef<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> phiDefNode snoc.hyps<span class="main">(</span>2<span class="main">)</span> vars <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"braun_ssa.phiArg <span class="free">g</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="skolem">m'</span><span class="main">,</span>PhiDef<span class="main">)</span> <span class="main">(</span>lookupDef <span class="free">g</span> <span class="skolem">m</span> <span class="free">v</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> braun_ssa.phiArg_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> braun_ssa.phi_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> PhiDef_defNode_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phis'_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> step<span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA-phiDefNodes_aux_pruned"><span class="command">lemma</span></span> phiDefNodes_aux_pruned<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"braun_ssa.liveVal <span class="free">g</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">m</span><span class="main">,</span> PhiDef<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">m</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set <span class="skolem">ns</span><span class="main">.</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phiDefNodes_auxE<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>path2_last <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> path2_not_Nil<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> ns assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> phiDefNodes_aux_pruned_aux<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"braun_ssa.liveVal <span class="free">g</span> <span class="main">(</span>lookupDef <span class="free">g</span> <span class="free">n</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> braun_ssa.liveSimple<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>uses'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">theorem</span></span> phis'_pruned<span class="main">:</span> <span class="quoted"><span class="quoted">"braun_ssa.pruned <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> braun_ssa.pruned_def braun_ssa.phiDefs_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> phis'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>prod.splits if_split_asm <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phiDefNodes_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>fold_union_elem phiDefNodes_aux_pruned<span class="main">)</span>

  <span class="keyword1"><span class="command">declare</span></span> var_def<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

  <span class="keyword1"><span class="command">declare</span></span> no_disjoint_cycle <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
  <span class="keyword1"><span class="command">declare</span></span> lookupDef_looksup <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

  <span class="keyword1"><span class="command">declare</span></span> lookupDef.simps <span class="main">[</span><span class="operator">code</span><span class="main">]</span>
  <span class="keyword1"><span class="command">declare</span></span> phiDefNodes_aux.simps <span class="main">[</span><span class="operator">code</span><span class="main">]</span>
  <span class="keyword1"><span class="command">declare</span></span> phiDefNodes_def <span class="main">[</span><span class="operator">code</span><span class="main">]</span>
  <span class="keyword1"><span class="command">declare</span></span> defs'_def <span class="main">[</span><span class="operator">code</span><span class="main">]</span>
  <span class="keyword1"><span class="command">declare</span></span> uses'_def <span class="main">[</span><span class="operator">code</span><span class="main">]</span>
  <span class="keyword1"><span class="command">declare</span></span> phis'_def <span class="main">[</span><span class="operator">code</span><span class="main">]</span>
  <span class="keyword1"><span class="command">declare</span></span> predecessors_def <span class="main">[</span><span class="operator">code</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Construct_SSA_notriv">
<div class="head">
<h1>Theory Construct_SSA_notriv</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Construct_SSA_notriv_code.thy
    Author:     Sebastian Ullrich, Denis Lohner
*)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Inductive Removal of Trivial Phi Functions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Construct_SSA_notriv
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#SSA_CFG">SSA_CFG</a> <a href="#Minimality">Minimality</a> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/While_Combinator.html">HOL-Library.While_Combinator</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_SSA_Transformed_notriv_base <span class="main">=</span> CFG_SSA_Transformed_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span> <span class="quoted"><span class="free">var</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Entry</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">oldDefs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">oldUses</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">phis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'val</span> <span class="main">⇒</span> <span class="tfree">'var</span>"</span></span> <span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">chooseNext_all</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis <span class="main">⇒</span> <span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'val</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">chooseNext</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> snd <span class="main">(</span><span class="free">chooseNext_all</span> <span class="main">(</span><span class="free">uses</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">phis</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">chooseNext'</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="free">chooseNext_all</span> <span class="main">(</span><span class="free">uses</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">phis</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">substitution</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="keyword1">THE</span> <span class="bound">v'</span><span class="main">.</span> isTrivialPhi <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span>chooseNext <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="bound">v'</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">substNext</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">v</span> <span class="main">=</span> chooseNext <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="keyword1">then</span> substitution <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="keyword1">else</span> <span class="bound">v</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">uses'</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> substNext <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">`</span> <span class="free">uses</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phis'</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">⇒</span> <span class="keyword1">if</span> <span class="bound">v</span> <span class="main">=</span> chooseNext <span class="free"><span class="bound"><span class="entity">g</span></span></span>
    <span class="keyword1">then</span> None
    <span class="keyword1">else</span> map_option <span class="main">(</span>map <span class="main">(</span>substNext <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">phis</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_SSA_Transformed_notriv <span class="main">=</span> CFG_SSA_Transformed <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span> <span class="quoted"><span class="free">var</span></span>
  <span class="main">+</span> CFG_SSA_Transformed_notriv_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">chooseNext_all</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Entry</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">oldDefs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">oldUses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">phis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'val</span> <span class="main">⇒</span> <span class="tfree">'var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">chooseNext_all</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis <span class="main">⇒</span> <span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'val</span><span class="main">)</span>"</span></span> <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span> chooseNext_all<span class="main">:</span> <span class="quoted"><span class="quoted">"CFG_SSA_Transformed <span class="free">αe</span> <span class="free">αn</span> <span class="free">invar</span> <span class="free">inEdges'</span> <span class="free">Entry</span> <span class="free">oldDefs</span> <span class="free">oldUses</span> <span class="free">defs</span> <span class="free">u</span> <span class="free">p</span> <span class="free">var</span> <span class="main">⟹</span>
  CFG_SSA_wf_base.redundant <span class="free">αn</span> <span class="free">inEdges'</span> <span class="free">defs</span> <span class="free">u</span> <span class="free">p</span> <span class="free">g</span> <span class="main">⟹</span>
  <span class="free">chooseNext_all</span> <span class="main">(</span><span class="free">u</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="free">g</span><span class="main">)</span> <span class="free">g</span> <span class="main">∈</span> dom <span class="main">(</span><span class="free">p</span> <span class="free">g</span><span class="main">)</span> <span class="main">∧</span>
  CFG_SSA_wf_base.trivial <span class="free">αn</span> <span class="free">inEdges'</span> <span class="free">defs</span> <span class="free">u</span> <span class="free">p</span> <span class="free">g</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">chooseNext_all</span> <span class="main">(</span><span class="free">u</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="free">g</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="Construct_SSA_notriv-chooseNext'"><span class="command">lemma</span></span> chooseNext'<span class="main">:</span><span class="quoted"><span class="quoted">"redundant <span class="free">g</span> <span class="main">⟹</span> chooseNext' <span class="free">g</span> <span class="main">∈</span> dom <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="main">∧</span> trivial <span class="free">g</span> <span class="main">(</span>chooseNext <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> chooseNext_all<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv-chooseNext"><span class="command">lemma</span></span> chooseNext<span class="main">:</span> <span class="quoted"><span class="quoted">"redundant <span class="free">g</span> <span class="main">⟹</span> chooseNext <span class="free">g</span> <span class="main">∈</span> allVars <span class="free">g</span> <span class="main">∧</span> trivial <span class="free">g</span> <span class="main">(</span>chooseNext <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> chooseNext'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trivial_in_allVars<span class="main">)</span>

  <span class="keyword1"><span class="command">lemmas</span></span> chooseNext_in_allVars<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> chooseNext<span class="main">[</span><span class="operator">THEN</span> conjunct1<span class="main">]</span>

  <span class="keyword1" id="Construct_SSA_notriv-isTrivialPhi_det"><span class="command">lemma</span></span> isTrivialPhi_det<span class="main">:</span> <span class="quoted"><span class="quoted">"trivial <span class="free">g</span> <span class="free">v</span> <span class="main">⟹</span> <span class="main">∃!</span><span class="bound">v'</span><span class="main">.</span> isTrivialPhi <span class="free">g</span> <span class="free">v</span> <span class="bound">v'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ex_ex1I<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v'</span> <span class="skolem">v''</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"isTrivialPhi <span class="free">g</span> <span class="free">v</span> <span class="skolem">v'</span>"</span></span> <span class="quoted"><span class="quoted">"isTrivialPhi <span class="free">g</span> <span class="free">v</span> <span class="skolem">v''</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> isTrivialPhi_def<span class="main">,</span> <span class="operator">THEN</span> conjunct2<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">=</span> <span class="skolem">v''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>isTrivialPhi_def doubleton_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trivial_def<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv-trivialPhi_strict_dom"><span class="command">lemma</span></span> trivialPhi_strict_dom<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> triv<span class="main">:</span> <span class="quoted"><span class="quoted">"isTrivialPhi <span class="free">g</span> <span class="free">v</span> <span class="free">v'</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strict_def_dom <span class="free">g</span> <span class="free">v'</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v'</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> triv <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"phi <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> Some <span class="skolem">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="skolem">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">v'</span><span class="main">}</span> <span class="main">∨</span> set <span class="skolem">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>isTrivialPhi_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n</span> <span class="main">≠</span> <span class="free">Entry</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> other_preds_dominated<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="var">?n</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">v'</span> <span class="main">∉</span> phiUses <span class="free">g</span> <span class="bound">m</span> <span class="main">⟹</span> old.dominates <span class="free">g</span> <span class="var">?n</span> <span class="bound">m</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
      <span class="keyword3"><span class="command">assume</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="var">?n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∉</span> phiUses <span class="free">g</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="var">?n</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">m</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> allUses_dominated<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> vs <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiUses_exI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> m<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>phi_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> m<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n'</span> <span class="main">≠</span> <span class="var">?n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?n'</span> <span class="main">=</span> <span class="var">?n</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="var">?n</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">v'</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="bound">m</span> <span class="main">⟹</span> old.dominates <span class="free">g</span> <span class="var">?n</span> <span class="bound">m</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="var">?n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">m</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="var">?n'</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allUses_dominated<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>asm<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> non_dominated_predecessor<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> other_preds_dominated <span class="quoted"><span class="quoted">‹<span class="var">?n</span> <span class="main">≠</span> <span class="free">Entry</span> <span class="free">g</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="var">?n'</span> <span class="var">?n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ns</span>
      <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="var">?n</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?n</span> <span class="main">≠</span> <span class="free">Entry</span> <span class="free">g</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">ns'</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> ns'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="var">?n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n</span> <span class="main">∉</span> set <span class="skolem">ns'</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ns'</span> <span class="main">⊆</span> set <span class="skolem">ns</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.simple_path2_unsnoc<span class="main"><span class="main">[</span></span><span class="operator">OF</span> asm<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> ns' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>old.dominates <span class="free">g</span> <span class="var">?n</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>old.dominatesE<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> other_preds_dominated<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> ns'<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="var">?n'</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allUses_dominated<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> ns'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n'</span> <span class="main">∈</span> set <span class="skolem">ns'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">erule</span> old.dominatesE<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> ns'<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n'</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_notriv-isTrivialPhi_asymmetric"><span class="command">lemma</span></span> isTrivialPhi_asymmetric<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isTrivialPhi <span class="free">g</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"isTrivialPhi <span class="free">g</span> <span class="free">b</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹isTrivialPhi <span class="free">g</span> <span class="free">a</span> <span class="free">b</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> isTrivialPhi_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> phiArg_in_allVars <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phiArg_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹isTrivialPhi <span class="free">g</span> <span class="free">b</span> <span class="free">a</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> isTrivialPhi_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> phiArg_in_allVars <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phiArg_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> trivialPhi_strict_dom <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> allVars <span class="free">g</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
       trivialPhi_strict_dom <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> allVars <span class="free">g</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_notriv-substitution"><span class="command">lemma</span></span> substitution<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"redundant <span class="free">g</span> <span class="main">⟹</span> isTrivialPhi <span class="free">g</span> <span class="main">(</span>chooseNext <span class="free">g</span><span class="main">)</span> <span class="main">(</span>substitution <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> substitution_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> theI'<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> isTrivialPhi_det<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chooseNext<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv-trivialPhi_in_allVars"><span class="command">lemma</span></span> trivialPhi_in_allVars<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isTrivialPhi <span class="free">g</span> <span class="free">v</span> <span class="free">v'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"phiArg <span class="free">g</span> <span class="free">v</span> <span class="free">v'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> phiArg_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>isTrivialPhi_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>option.splits<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiArg_in_allVars<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_notriv-substitution_in_allVars"><span class="command">lemma</span></span> substitution_in_allVars<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"redundant <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"substitution <span class="free">g</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> trivialPhi_in_allVars<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv-defs_uses_disjoint_inv"><span class="command">lemma</span></span> defs_uses_disjoint_inv<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"redundant <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span> <span class="free">g</span> <span class="free">n</span> <span class="main">∩</span> uses' <span class="free">g</span> <span class="free">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> equals0I<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v'</span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span> <span class="main">∩</span> uses' <span class="free">g</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">=</span> substNext <span class="free">g</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> chooseNext <span class="free">g</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> v v' defs_uses_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>substNext_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> True
      <span class="keyword1"><span class="command">from</span></span> v' <span class="keyword1"><span class="command">have</span></span> n_defNode<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> defNode <span class="free">g</span> <span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> defNode_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> v<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allUses_in_allVars<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">n</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"old.strict_dom <span class="free">g</span> <span class="free">n</span> <span class="var">?n'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>n_defNode v<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> trivialPhi_strict_dom<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>substNext_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> v<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="var">?n'</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allUses_dominated<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> CFG_SSA_wf
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">inductive</span></span> <span class="entity">liveVal'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'val</span> list <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">g</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'g</span></span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    liveSimple'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">val</span></span></span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">liveVal'</span> <span class="free">g</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">val</span></span></span><span class="main">]</span>"</span></span>
  <span class="main">|</span> livePhi'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">liveVal'</span> <span class="free">g</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main">;</span> phiArg <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">liveVal'</span> <span class="free">g</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="Construct_SSA_notriv-liveVal'_suffix"><span class="command">lemma</span></span> liveVal'_suffix<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"liveVal' <span class="free">g</span> <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">vs'</span> <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"liveVal' <span class="free">g</span> <span class="free">vs'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="operator">induction</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>liveSimple' <span class="skolem">n</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> liveSimple'.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs'</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil butlast.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> suffixI suffix_order.order_antisym suffix_unsnoc<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> liveSimple'.hyps <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> liveVal'.liveSimple'<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>livePhi' <span class="skolem">v</span> <span class="skolem">vs</span> <span class="skolem">v'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">vs'</span> <span class="main">=</span> <span class="skolem">v'</span> <span class="main">#</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> livePhi' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> liveVal'.livePhi'<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> livePhi'.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suffix <span class="free">vs'</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">vs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> self_append_conv2 suffixI suffix_take tl_append2<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> livePhi'.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> livePhi'.IH<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_notriv-liveVal'I"><span class="command">lemma</span></span> liveVal'I<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"liveVal <span class="free">g</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">vs</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"liveVal' <span class="free">g</span> <span class="main">(</span><span class="free">v</span><span class="main">#</span><span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="operator">induction</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>liveSimple <span class="skolem">n</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> liveSimple<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> liveSimple'<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>livePhi <span class="skolem">v</span> <span class="skolem">v'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> livePhi.IH<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">vs</span>
      <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"liveVal' <span class="free">g</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">vs</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">vs</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> livePhi.hyps asm <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> livePhi.prems<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> livePhi'<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span><span class="skolem">v'</span><span class="main">#</span><span class="skolem">vs'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">vs</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">drule</span> split_list_last<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sublist.suffix_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> asm <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> livePhi.prems<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> liveVal'_suffix<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_notriv-liveVal'D"><span class="command">lemma</span></span> liveVal'D<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"liveVal' <span class="free">g</span> <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">=</span> <span class="free">v</span><span class="main">#</span><span class="free">vs'</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"liveVal <span class="free">g</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">vs'</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>liveSimple' <span class="skolem">n</span> <span class="skolem">vs</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> liveSimple<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>livePhi' <span class="skolem">v<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">vs</span> <span class="skolem">v'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> livePhi<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_SSA_step <span class="main">=</span> CFG_SSA_Transformed_notriv <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">chooseNext_all</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Entry</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">oldDefs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">oldUses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">phis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'val</span> <span class="main">⇒</span> <span class="tfree">'var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">chooseNext_all</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis <span class="main">⇒</span> <span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'val</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span>"</span></span> <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span> redundant<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"redundant <span class="free">g</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">u_g</span> <span class="main">≡</span> <span class="free">uses</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span>uses' <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">p_g</span> <span class="main">≡</span> <span class="free">phis</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span>phis' <span class="free">g</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">sublocale</span></span> step<span class="main">:</span> CFG_SSA_Transformed_notriv_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted">u_g</span> <span class="quoted">p_g</span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">chooseNext_all</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1" id="Construct_SSA_notriv-simpleDefs_phiDefs_disjoint_inv"><span class="command">lemma</span></span> simpleDefs_phiDefs_disjoint_inv<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span> <span class="free">g</span> <span class="free">n</span> <span class="main">∩</span> step.phiDefs <span class="free">g</span> <span class="free">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> simpleDefs_phiDefs_disjoint<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phiDefs_def step.phiDefs_def dom_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>option.splits<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv-allDefs_disjoint_inv"><span class="command">lemma</span></span> allDefs_disjoint_inv<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"step.allDefs <span class="free">g</span> <span class="free">n</span> <span class="main">∩</span> step.allDefs <span class="free">g</span> <span class="free">m</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> allDefs_disjoint<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_defs step.CFG_SSA_defs dom_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>option.splits<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv-phis_finite_inv"><span class="command">lemma</span></span> phis_finite_inv<span class="main">:</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>dom <span class="main">(</span>phis' <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> phis_finite<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv-phis_wf_inv"><span class="command">lemma</span></span> phis_wf_inv<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"phis' <span class="free">g</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">args</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> length <span class="free">args</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> phis_wf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>


  <span class="keyword1"><span class="command">sublocale</span></span> step<span class="main">:</span> CFG_SSA <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted">u_g</span> <span class="quoted">p_g</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> g'<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">g'</span><span class="main">=</span><span class="free">g</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>defs_uses_disjoint_inv<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>defs_uses_disjoint<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> defs_finite<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uses_in_αn <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> g' n<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">g'</span><span class="main">=</span><span class="free">g</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> invar<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> g'<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">g'</span><span class="main">=</span><span class="free">g</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phis_finite_inv<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phis_finite<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phis_in_αn <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> g' n v args<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">g'</span><span class="main">=</span><span class="free">g</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phis_wf_inv<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phis_wf<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> g'<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">g'</span><span class="main">=</span><span class="free">g</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> simpleDefs_phiDefs_disjoint_inv<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> simpleDefs_phiDefs_disjoint<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> CFG_SSA_defs<span class="main"><span class="main">]</span></span> step.CFG_SSA_defs <span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> g' m<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">g'</span><span class="main">=</span><span class="free">g</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> allDefs_disjoint_inv<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> allDefs_disjoint<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> CFG_SSA_defs<span class="main"><span class="main">]</span></span> step.CFG_SSA_defs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="Construct_SSA_notriv-allUses_narrows"><span class="command">lemma</span></span> allUses_narrows<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"step.allUses <span class="free">g</span> <span class="free">n</span> <span class="main">⊆</span> substNext <span class="free">g</span> <span class="main">`</span> allUses <span class="free">g</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n'</span> <span class="bound">v'</span> <span class="bound">z</span> <span class="bound">b</span><span class="main">.</span> <span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="bound">n'</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">z</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="bound">n'</span><span class="main">)</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∉</span> phiUses <span class="free">g</span> <span class="free">n</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n'</span> <span class="skolem">v'</span> <span class="skolem">z</span> <span class="skolem">b</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">::</span> <span class="tfree">'val</span> list<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">z</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">b</span> <span class="main">∉</span> phiUses <span class="free">g</span> <span class="free">n</span> <span class="main">⟹</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>phiUsesI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>step.allUses_def allUses_def zip_map2 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>imageI <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>step.phiUsesE phiUsesE <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_notriv-allDefs_narrows"><span class="command">lemma</span></span> allDefs_narrows<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> step.allDefs <span class="free">g</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>step.allDefs_def step.phiDefs_def phiDefs_def allDefs_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv-allUses_def_ass_inv"><span class="command">lemma</span></span> allUses_def_ass_inv<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> step.allUses <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"step.defAss <span class="free">g</span> <span class="free">n</span> <span class="free">v'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> step.defAssI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ns</span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="free">n</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">=</span> substNext <span class="free">g</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> allUses_narrows <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allUses_in_allVars<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>substNext_def v'<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n<span class="hidden">⇩</span><sub>v</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>'</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="free">v'</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> asm <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?n<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> allUses_def_ass<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>defAss_defNode<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>v</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="hidden">⇩</span><sub>v</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span><span class="skolem">ns<span class="hidden">⇩</span><sub>v</sub></span><span class="main">@</span><span class="main">[</span><span class="var">?n<span class="hidden">⇩</span><sub>v</sub></span><span class="main">]</span><span class="main">)</span> <span class="skolem">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prefix_split_first<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> asm <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>v</sub></span><span class="main">@</span><span class="main">[</span><span class="var">?n<span class="hidden">⇩</span><sub>v</sub></span><span class="main">]</span><span class="main">→</span><span class="var">?n<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> set <span class="skolem">ns</span><span class="main">.</span> <span class="free">v'</span> <span class="main">∈</span> step.allDefs <span class="free">g</span> <span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> chooseNext <span class="free">g</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> dom<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_def_dom <span class="free">g</span> <span class="free">v'</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> substitution<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> trivialPhi_strict_dom<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>substNext_def v'<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="var">?n<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>'</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> step.allDefs <span class="free">g</span> <span class="var">?n<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>'</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> step.allDefs_def step.phiDefs_def allDefs_def phiDefs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>True<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> dom <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"def_dominates <span class="free">g</span> <span class="free">v'</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ns<span class="hidden">⇩</span><sub>v</sub></span><span class="main">@</span><span class="main">[</span><span class="var">?n<span class="hidden">⇩</span><sub>v</sub></span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">erule</span> old.dominatesE<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> ns<span class="hidden">⇩</span><sub>v</sub> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> False
      <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>v' substNext_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="var">?n<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?n<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>'</sub></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>allDefs_def step.allDefs_def step.phiDefs_def 1 phiDefs_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_notriv-Entry_no_phis_inv"><span class="command">lemma</span></span> Entry_no_phis_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"phis' <span class="free">g</span> <span class="main">(</span><span class="free">Entry</span> <span class="free">g</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Entry_no_phis<span class="main">)</span>

  <span class="keyword1"><span class="command">sublocale</span></span> step<span class="main">:</span> CFG_SSA_wf <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted">u_g</span> <span class="quoted">p_g</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> g' n<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">g'</span><span class="main">=</span><span class="free">g</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>allUses_def_ass_inv<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>allUses_def_ass<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> CFG_SSA_defs<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span> step.CFG_SSA_defs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> g' v<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">g'</span><span class="main">=</span><span class="free">g</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Entry_no_phis_inv<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="Construct_SSA_notriv-chooseNext_eliminated"><span class="command">lemma</span></span> chooseNext_eliminated<span class="main">:</span> <span class="quoted"><span class="quoted">"chooseNext <span class="free">g</span> <span class="main">∉</span> step.allDefs <span class="free">g</span> <span class="main">(</span>defNode <span class="free">g</span> <span class="main">(</span>chooseNext <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"chooseNext <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="var">?v</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> chooseNext<span class="main">[</span><span class="operator">OF</span> redundant<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∈</span> phiDefs <span class="free">g</span> <span class="var">?n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trivial_def isTrivialPhi_def phiDefs_def phi_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="var">?n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> simpleDefs_phiDefs_disjoint<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>step.allDefs_def step.phiDefs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_notriv-oldUses_inv"><span class="command">lemma</span></span> oldUses_inv<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">oldUses</span> <span class="free">g</span> <span class="free">n</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="main">`</span> u_g <span class="free">g</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="main">(</span>substitution <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="main">(</span>chooseNext <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> substitution<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiArg_same_var<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> isTrivialPhi_def phiArg_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> substNext_def oldUses_def image_Un<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_notriv-conventional_inv"><span class="command">lemma</span></span> conventional_inv<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> step.allDefs <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> step.allUses <span class="free">g</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> step.allDefs <span class="free">g</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">v'</span> <span class="main">≠</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> defNode <span class="free">g</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> defNode_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="hidden">⇩</span><sub>0</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> substNext <span class="free">g</span> <span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> allUses_narrows<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> chooseNext <span class="free">g</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> v<span class="hidden">⇩</span><sub>0</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>substNext_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assms v<span class="hidden">⇩</span><sub>0</sub> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> conventional<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> dom<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_def_dom <span class="free">g</span> <span class="free">v</span> <span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> substitution<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> trivialPhi_strict_dom<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>substNext_def v<span class="hidden">⇩</span><sub>0</sub><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> v<span class="hidden">⇩</span><sub>0</sub><span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allUses_dominated<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> dom <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> set <span class="free">ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.dominates_mid<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span>
        ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ns</span> <span class="main">=</span> <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">@</span><span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span><span class="main">@</span><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        ns<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">@</span><span class="main">[</span><span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">]</span><span class="main">→</span><span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∉</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        ns<span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span><span class="main">→</span><span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        ns<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">-</span><span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">#</span><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∉</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> old.path2_split_first_last<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">ns</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> ns<span class="hidden">⇩</span><sub>3</sub> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>ns old.path2_def<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> defNode <span class="free">g</span> <span class="free">v</span>›</span></span> dom<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">@</span><span class="main">[</span><span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">]</span><span class="main">)</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> ns<span class="hidden">⇩</span><sub>1</sub> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">→</span>last <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> set <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">erule</span> old.path2_unsnoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> old.path2_unsnoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> chooseNext <span class="free">g</span>›</span></span> v<span class="hidden">⇩</span><sub>0</sub> <span class="keyword1"><span class="command">have</span></span> triv<span class="main">:</span> <span class="quoted"><span class="quoted">"isTrivialPhi <span class="free">g</span> <span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> substitution<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>substNext_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"phi <span class="free">g</span> <span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> Some <span class="skolem">vs</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="main">∨</span> set <span class="skolem">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>isTrivialPhi_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>option.splits<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiArg_same_var<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phiArg_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="main">(</span>last <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> vs ns<span class="hidden">⇩</span><sub>1</sub> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="main">(</span>last <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="main">(</span>last <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiUses_exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"last <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="free">g</span></span> <span class="var"><span class="quoted"><span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span></span></span> <span class="quoted"><span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="quoted"><span class="skolem">vs</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>phi_def<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∉</span> phiUses <span class="free">g</span> <span class="main">(</span>last <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="main">(</span>last <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> last_in_set<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_in_αn<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ns<span class="hidden">⇩</span><sub>1</sub><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> asm ns<span class="hidden">⇩</span><sub>1</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"old.dominates <span class="free">g</span> <span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span>last <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allUses_dominated<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_def_dom <span class="free">g</span> <span class="free">v</span> <span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> triv <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> trivialPhi_strict_dom<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.dominates_mid<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> ns<span class="hidden">⇩</span><sub>1</sub><span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> conventional<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>ns<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">v'</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> True
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
            <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>6<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> allDefs_narrows<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> defNode <span class="free">g</span> <span class="free">v'</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> ns<span class="hidden">⇩</span><sub>3</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> defNode_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
            <span class="keyword1"><span class="command">{</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">=</span> <span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> chooseNext <span class="free">g</span>›</span></span> simpleDefs_phiDefs_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> vs<span class="main">(</span>1<span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> step.allDefs_def step.phiDefs_def<span class="main">)</span>
            <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">≠</span> <span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> allDefs_var_disjoint<span class="main">[</span><span class="operator">OF</span> _ assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> allDefs_narrows<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span></span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> ns<span class="hidden">⇩</span><sub>3</sub> asm ns <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span><span class="main">→</span><span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⊆</span> set <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_simple_loop<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> empty_iff graph_path_base.path2_def hd_Cons_tl insert_iff length_greater_0_conv length_tl list.set<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zero_less_diff<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> ns<span class="hidden">⇩</span><sub>3</sub> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ns'</span> <span class="main">=</span> butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_unsnoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> vs ns<span class="hidden">⇩</span><sub>3</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">m</span> <span class="main">∨</span> <span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">m</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiUses_exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="free">g</span></span> <span class="var"><span class="quoted"><span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span></span></span> <span class="quoted"><span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="quoted"><span class="skolem">vs</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>phi_def<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
                <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">m</span>"</span></span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conventional<span class="main">)</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="skolem">ns'</span><span class="main">→</span><span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> old.path2_app'<span class="main">[</span><span class="operator">OF</span> ns<span class="hidden">⇩</span><sub>1</sub><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ns'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ns assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∉</span> set <span class="skolem">ns'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ns'<span class="main">(</span>3<span class="main">)</span> ns<span class="hidden">⇩</span><sub>3</sub><span class="main">(</span>4<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_set_butlastD<span class="main">)</span>
                  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="main">(</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="skolem">ns'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="main">(</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="skolem">ns'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ns'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> old.path2_def<span class="main">)</span>
                <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">m</span>›</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
                <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="skolem">m</span>"</span></span>
                <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ns<span class="hidden">⇩</span><sub>3</sub><span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> old.path2_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> in_set_butlastI<span class="main">)</span>
                <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">v'</span> <span class="main">≠</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>6<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> allDefs_narrows<span class="main">]</span> ns<span class="hidden">⇩</span><sub>3</sub><span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> ns'<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> conventional<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ns'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">v'</span> <span class="main">≠</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∉</span> step.allDefs <span class="free">g</span> <span class="var">?n<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">‹<span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> chooseNext <span class="free">g</span>›</span></span> chooseNext_eliminated<span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>6<span class="main">)</span> vs<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allDefs_var_disjoint<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">g</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span> assms<span class="main">(</span>5<span class="main">)</span> asm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>ns<span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>6<span class="main">)</span> v<span class="hidden">⇩</span><sub>0</sub><span class="main">(</span>2<span class="main">)</span> ns<span class="hidden">⇩</span><sub>2</sub><span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> conventional<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ns<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>ns<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="main">(</span>substNext <span class="free">g</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> substitution<span class="main">[</span><span class="operator">OF</span> redundant<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>substNext_def isTrivialPhi_def phi_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>option.splits<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv-phis_same_var_inv"><span class="command">lemma</span></span> phis_same_var_inv<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"phis' <span class="free">g</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> set <span class="free">vs</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="free">v'</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="skolem"><span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">vs<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> set <span class="skolem">vs<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">=</span> substNext <span class="free">g</span> <span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_notriv-allDefs_var_disjoint_inv"><span class="command">lemma</span></span> allDefs_var_disjoint_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> step.allDefs <span class="free">g</span> <span class="free">n</span><span class="main">;</span> <span class="free">v'</span> <span class="main">∈</span> step.allDefs <span class="free">g</span> <span class="free">n</span><span class="main">;</span> <span class="free">v</span> <span class="main">≠</span> <span class="free">v'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v'</span> <span class="main">≠</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> allDefs_var_disjoint
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>step.allDefs_def<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv-step_CFG_SSA_Transformed_notriv"><span class="command">lemma</span></span> step_CFG_SSA_Transformed_notriv<span class="main">:</span> <span class="quoted"><span class="quoted">"CFG_SSA_Transformed_notriv <span class="free">αe</span> <span class="free">αn</span> <span class="free">invar</span> <span class="free">inEdges'</span> <span class="free">Entry</span> <span class="free">oldDefs</span> <span class="free">oldUses</span> <span class="free">defs</span> u_g p_g <span class="free">var</span> <span class="free">chooseNext_all</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> oldDefs_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> g'<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">g'</span><span class="main">=</span><span class="free">g</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>oldUses_inv<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>oldUses_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> g' n ns m v x v'<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">g'</span><span class="main">=</span><span class="free">g</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>conventional_inv<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>conventional<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> CFG_SSA_defs<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span> step.CFG_SSA_defs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> g' n v vs v'<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">g'</span><span class="main">=</span><span class="free">g</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phis_same_var_inv<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phis_same_var<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> g' v v'<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">g'</span><span class="main">=</span><span class="free">g</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>allDefs_var_disjoint_inv<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>allDefs_var_disjoint<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> allDefs_def phiDefs_def<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span> step.allDefs_def step.phiDefs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> chooseNext_all<span class="main">)</span>

  <span class="keyword1"><span class="command">sublocale</span></span> step<span class="main">:</span> CFG_SSA_Transformed_notriv <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted">u_g</span> <span class="quoted">p_g</span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">chooseNext_all</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> step_CFG_SSA_Transformed_notriv<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv-step_defNode"><span class="command">lemma</span></span> step_defNode<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allVars <span class="free">g</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">≠</span> chooseNext <span class="free">g</span> <span class="main">⟹</span> step.defNode <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> defNode <span class="free">g</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> step.CFG_SSA_wf_defs dom_def CFG_SSA_wf_defs<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv-step_phi"><span class="command">lemma</span></span> step_phi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allVars <span class="free">g</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">≠</span> chooseNext <span class="free">g</span> <span class="main">⟹</span> step.phi <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> map_option <span class="main">(</span>map <span class="main">(</span>substNext <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>phi <span class="free">g</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> step.phi_def step_defNode phi_def<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv-liveVal'_inv"><span class="command">lemma</span></span> liveVal'_inv<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"liveVal' <span class="free">g</span> <span class="main">(</span><span class="free">v</span><span class="main">#</span><span class="free">vs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> chooseNext <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">vs'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"step.liveVal' <span class="free">g</span> <span class="main">(</span><span class="free">v</span><span class="main">#</span><span class="free">vs'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"length <span class="free">vs</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_less_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">vs</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>liveSimple' <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted">"1.prems"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> step.liveSimple'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> substNext_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>livePhi' <span class="skolem">v'</span> <span class="skolem">vs'</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">drule</span> liveVal'D<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> liveVal_in_allVars<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"chooseNext <span class="free">g</span> <span class="main">=</span> <span class="skolem">v'</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted">"1.hyps"</span><span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="skolem">vs'</span>"</span></span> <span class="quoted"><span class="skolem">vs'</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">vs'<span class="hidden">⇩</span><sub>2</sub></span>
          <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"step.liveVal' <span class="free">g</span> <span class="main">(</span><span class="skolem">v'</span><span class="main">#</span><span class="skolem">vs'<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"step.phiArg <span class="free">g</span> <span class="skolem">v'</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> livePhi'<span class="main">(</span>3<span class="main">)</span> False <span class="quoted">"1.prems"</span><span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> step.phiArg_def phiArg_def step_phi substNext_def<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted">"1.prems"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> step.livePhi'<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> asm<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> livePhi' False<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> True
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trivial <span class="free">g</span> <span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> chooseNext<span class="main">[</span><span class="operator">OF</span> redundant<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹phiArg <span class="free">g</span> <span class="skolem">v'</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isTrivialPhi <span class="free">g</span> <span class="skolem">v'</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phiArg_def trivial_def isTrivialPhi_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"substitution <span class="free">g</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> substitution_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> the1_equality<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> isTrivialPhi_det<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> trivial_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
  
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs'<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> vs'<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"suffix <span class="main">(</span><span class="skolem">v'</span><span class="main">#</span><span class="skolem">vs'<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span><span class="skolem">v'</span><span class="main">#</span><span class="skolem">vs'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∉</span> set <span class="skolem">vs'<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> split_list_last<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span><span class="main">#</span><span class="skolem">vs'</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sublist.suffix_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹liveVal' <span class="free">g</span> <span class="main">(</span><span class="skolem">v'</span><span class="main">#</span><span class="skolem">vs'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"liveVal' <span class="free">g</span> <span class="main">(</span><span class="skolem">v'</span><span class="main">#</span><span class="skolem">vs'<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> liveVal'_suffix<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> liveVal'.cases<span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>liveSimple' <span class="skolem">n</span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> uses' <span class="free">g</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> substNext_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> liveSimple' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted">"1.prems"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> step.liveSimple'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>livePhi' <span class="skolem">v''</span> <span class="skolem">vs''</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v''</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">drule</span> liveVal'D<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> liveVal_in_allVars<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> vs'<span class="hidden">⇩</span><sub>2</sub><span class="main">(</span>2<span class="main">)</span> livePhi'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v''</span> <span class="main">≠</span> <span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted">"1.hyps"</span><span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="skolem">vs''</span>"</span></span> <span class="quoted"><span class="skolem">vs''</span></span> <span class="quoted"><span class="skolem">v''</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">vs''</span> <span class="main">&lt;</span> length <span class="skolem">vs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs</span> <span class="main">=</span> <span class="skolem">v'</span><span class="main">#</span><span class="skolem">vs'</span>›</span></span> livePhi'<span class="main">(</span>1<span class="main">)</span> vs'<span class="hidden">⇩</span><sub>2</sub><span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> suffix_ConsD2<span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sublist.suffix_def<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">vs''<span class="hidden">⇩</span><sub>2</sub></span>
            <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"step.liveVal' <span class="free">g</span> <span class="main">(</span><span class="skolem">v''</span><span class="main">#</span><span class="skolem">vs''<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> livePhi' <span class="quoted"><span class="quoted">‹phiArg <span class="free">g</span> <span class="skolem">v'</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"step.phiArg <span class="free">g</span> <span class="skolem">v''</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phiArg_def step.phiArg_def step_phi substNext_def<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted">"1.prems"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> step.livePhi'<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> asm<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> livePhi'<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_notriv-liveVal_inv"><span class="command">lemma</span></span> liveVal_inv<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"liveVal <span class="free">g</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> chooseNext <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"step.liveVal <span class="free">g</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> liveVal'I<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> liveVal'_inv<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> step.liveVal'D<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

  <span class="keyword1" id="Construct_SSA_notriv-pruned_inv"><span class="command">lemma</span></span> pruned_inv<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pruned <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"step.pruned <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> step.pruned_def<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> step.phiDefs <span class="free">g</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> phiDefs <span class="free">g</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> chooseNext <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> step.CFG_SSA_defs CFG_SSA_defs <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"liveVal <span class="free">g</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pruned_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"step.liveVal <span class="free">g</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">≠</span> chooseNext <span class="free">g</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> liveVal_inv<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> CFG_SSA_Transformed_notriv_base
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">inst</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> CFG_SSA_Transformed_notriv <span class="free">αe</span> <span class="free">αn</span> <span class="free">invar</span> <span class="free">inEdges'</span> <span class="free">Entry</span> <span class="free">oldDefs</span> <span class="free">oldUses</span> <span class="free">defs</span> <span class="main">(</span><span class="free">uses</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">:=</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">phis</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">:=</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free">var</span> <span class="free">chooseNext_all</span>"</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">inst'</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">.</span> inst <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">u</span> <span class="bound">p</span>"</span></span>

  <span class="keyword1"><span class="command">interpretation</span></span> uninst<span class="main">:</span> CFG_SSA_Transformed_notriv_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">chooseNext_all</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">u</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">p</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>


  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">cond</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">.</span> uninst.redundant <span class="main">(</span><span class="free">uses</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">:=</span><span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">phis</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">:=</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">step</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>uninst.uses' <span class="main">(</span><span class="free">uses</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">:=</span><span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">phis</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">:=</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">,</span>
                                uninst.phis' <span class="main">(</span><span class="free">uses</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">:=</span><span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">phis</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">:=</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span><span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">substAll</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> while <span class="main">(</span>cond <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">(</span>step <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">uses</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">,</span><span class="free">phis</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span><span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">uses'_all</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> fst <span class="main">(</span>substAll <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span><span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phis'_all</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> snd <span class="main">(</span>substAll <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="Construct_SSA_notriv-uninst_allVars_simps"><span class="command">lemma</span></span> uninst_allVars_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"uninst.allVars <span class="free">u</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">p</span> <span class="free">g</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> uninst.allVars <span class="free">u</span> <span class="free">p</span> <span class="free">g</span>"</span></span>
    <span class="quoted"><span class="quoted">"uninst.allVars <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">u</span> <span class="free">g</span><span class="main">)</span> <span class="free">p</span> <span class="free">g</span> <span class="main">=</span> uninst.allVars <span class="free">u</span> <span class="free">p</span> <span class="free">g</span>"</span></span>
    <span class="quoted"><span class="quoted">"uninst.allVars <span class="main">(</span><span class="free">uses</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="free">u</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span> <span class="free">g</span> <span class="main">=</span> uninst.allVars <span class="free">u</span> <span class="free">p</span> <span class="free">g</span>"</span></span>
    <span class="quoted"><span class="quoted">"uninst.allVars <span class="free">u</span> <span class="main">(</span><span class="free">phis</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="free">p</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> uninst.allVars <span class="free">u</span> <span class="free">p</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> uninst.allVars_def uninst.allDefs_def uninst.allUses_def uninst.phiDefs_def uninst.phiUses_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

  <span class="keyword1" id="Construct_SSA_notriv-uninst_trivial_simps"><span class="command">lemma</span></span> uninst_trivial_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"uninst.trivial <span class="free">u</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">p</span> <span class="free">g</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> uninst.trivial <span class="free">u</span> <span class="free">p</span> <span class="free">g</span>"</span></span>
    <span class="quoted"><span class="quoted">"uninst.trivial <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">u</span> <span class="free">g</span><span class="main">)</span> <span class="free">p</span> <span class="free">g</span> <span class="main">=</span> uninst.trivial <span class="free">u</span> <span class="free">p</span> <span class="free">g</span>"</span></span>
    <span class="quoted"><span class="quoted">"uninst.trivial <span class="main">(</span><span class="free">uses</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="free">u</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span> <span class="free">g</span> <span class="main">=</span> uninst.trivial <span class="free">u</span> <span class="free">p</span> <span class="free">g</span>"</span></span>
    <span class="quoted"><span class="quoted">"uninst.trivial <span class="free">u</span> <span class="main">(</span><span class="free">phis</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="free">p</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> uninst.trivial <span class="free">u</span> <span class="free">p</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> uninst.trivial_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> uninst.isTrivialPhi_def uninst.phi_def uninst.defNode_code
      uninst.allDefs_def uninst.phiDefs_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> CFG_SSA_Transformed_notriv
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">declare</span></span> fun_upd_apply<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> fun_upd_same<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

  <span class="keyword1" id="Construct_SSA_notriv-substAll_wf"><span class="command">lemma</span></span> substAll_wf<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"redundant <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>dom <span class="main">(</span>phis' <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span>dom <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> psubset_card_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"chooseNext <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> chooseNext<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="var">?v</span><span class="main">)</span> <span class="main">∈</span> dom <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trivial_def isTrivialPhi_def phi_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="var">?v</span><span class="main">)</span> <span class="main">∉</span> dom <span class="main">(</span>phis' <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>phis' <span class="free">g</span><span class="main">)</span> <span class="main">≠</span> dom <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>phis' <span class="free">g</span><span class="main">)</span> <span class="main">⊂</span> dom <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> phis_finite<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv-step_preserves_inst"><span class="command">lemma</span></span> step_preserves_inst<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inst' <span class="free">g</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"CFG_SSA_wf_base.redundant <span class="free">αn</span> <span class="free">inEdges'</span> <span class="free">defs</span> <span class="main">(</span><span class="free">uses</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">phis</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inst' <span class="free">g</span> <span class="main">(</span>step <span class="free">g</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">interpret</span></span> i<span class="main">:</span> CFG_SSA_Transformed_notriv <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="free">u</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="free">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">var</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">interpret</span></span> step<span class="main">:</span> CFG_SSA_step <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="free">u</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="free">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">chooseNext_all</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> step.step_CFG_SSA_Transformed_notriv<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> step_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_notriv-substAll"><span class="command">lemma</span></span> substAll<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">uses</span> <span class="free">g</span><span class="main">,</span> <span class="free">phis</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> inst' <span class="free">g</span> <span class="bound">x</span> <span class="main">⟹</span> cond <span class="free">g</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>step <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> inst' <span class="free">g</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="main">¬</span>cond <span class="free">g</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inst <span class="free">g</span> <span class="main">(</span>uses'_all <span class="free">g</span><span class="main">)</span> <span class="main">(</span>phis'_all <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span>uses'_all <span class="free">g</span><span class="main">)</span> <span class="main">(</span>phis'_all <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">note</span></span> uses'_def<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
    <span class="keyword1"><span class="command">note</span></span> phis'_def<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">,</span> snd <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inst' <span class="free">g</span> <span class="main">(</span>substAll <span class="free">g</span><span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span>uses'_all <span class="free">g</span><span class="main">)</span> <span class="main">(</span>phis'_all <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> substAll_def uses'_all_def phis'_all_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> while_rule<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inst' <span class="free">g</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cond_def step_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> step_preserves_inst <span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> step_def<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
         <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>inst' <span class="free">g</span> <span class="bound">x</span> <span class="main">∧</span> cond <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> step <span class="free">g</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wf_if_measure<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">.</span> card <span class="main">(</span>dom <span class="bound">p</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cond_def step_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>prod.split<span class="main">)</span>
         <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
           <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">p</span>
           <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"inst <span class="free">g</span> <span class="skolem">u</span> <span class="skolem">p</span>"</span></span>
           <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> i<span class="main">:</span> CFG_SSA_Transformed_notriv <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
           <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"i.redundant <span class="free">g</span>"</span></span>
           <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>dom <span class="main">(</span>i.phis' <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span>dom <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i.substAll_wf<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command">qed</span></span>
       <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"inst <span class="free">g</span> <span class="main">(</span>uses'_all <span class="free">g</span><span class="main">)</span> <span class="main">(</span>phis'_all <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span>uses'_all <span class="free">g</span><span class="main">)</span> <span class="main">(</span>phis'_all <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uses'_all_def phis'_all_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1"><span class="command">sublocale</span></span> notriv<span class="main">:</span> CFG_SSA_Transformed <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted">uses'_all</span> <span class="quoted">phis'_all</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">interpret</span></span> ssa<span class="main">:</span> CFG_SSA <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted">uses'_all</span> <span class="quoted">phis'_all</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
      <span class="keyword1"><span class="command">interpret</span></span> i<span class="main">:</span> CFG_SSA_Transformed_notriv <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span><span class="main">(</span><span class="skolem">g</span><span class="main">:=</span>uses'_all <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis</span><span class="main">(</span><span class="skolem">g</span><span class="main">:=</span>phis'_all <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">var</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> substAll<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">interpret</span></span> uninst<span class="main">:</span> CFG_SSA_Transformed_notriv_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">chooseNext_all</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">p</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">v</span> <span class="skolem">args</span> <span class="skolem">m</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">defs</span> <span class="skolem">g</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> defs_finite<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> uses'_all <span class="skolem">g</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i.uses_in_αn<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">g</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>uses'_all <span class="skolem">g</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i.uses_finite<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">invar</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> invar<span class="main">)</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>dom <span class="main">(</span>phis'_all <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i.phis_finite<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"phis'_all <span class="skolem">g</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">args</span> <span class="main">⟹</span> <span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i.phis_in_αn<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"phis'_all <span class="skolem">g</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">args</span> <span class="main">⟹</span> length <span class="main">(</span>old.predecessors <span class="skolem">g</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">args</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i.phis_wf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">defs</span> <span class="skolem">g</span> <span class="skolem">n</span> <span class="main">∩</span> uninst.phiDefs phis'_all <span class="skolem">g</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i.simpleDefs_phiDefs_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uninst.CFG_SSA_defs<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="skolem">m</span> <span class="main">⟹</span> uninst.allDefs phis'_all <span class="skolem">g</span> <span class="skolem">n</span> <span class="main">∩</span> uninst.allDefs phis'_all <span class="skolem">g</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i.allDefs_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uninst.CFG_SSA_defs<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">defs</span> <span class="skolem">g</span> <span class="skolem">n</span> <span class="main">∩</span> uses'_all <span class="skolem">g</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i.defs_uses_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">interpret</span></span> uninst<span class="main">:</span> CFG_SSA_Transformed_notriv_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">chooseNext_all</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">p</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"CFG_SSA_Transformed <span class="free">αe</span> <span class="free">αn</span> <span class="free">invar</span> <span class="free">inEdges'</span> <span class="free">Entry</span> <span class="free">oldDefs</span> <span class="free">oldUses</span> <span class="free">defs</span> uses'_all phis'_all <span class="free">var</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="skolem">n</span> <span class="skolem">v</span> <span class="skolem">ns</span> <span class="skolem">m</span> <span class="skolem">x</span> <span class="skolem">v'</span> <span class="skolem">vs</span>
      <span class="keyword1"><span class="command">interpret</span></span> i<span class="main">:</span> CFG_SSA_Transformed_notriv <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span><span class="main">(</span><span class="skolem">g</span><span class="main">:=</span>uses'_all <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis</span><span class="main">(</span><span class="skolem">g</span><span class="main">:=</span>phis'_all <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">var</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> substAll<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">oldDefs</span> <span class="skolem">g</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">var</span> <span class="skolem">g</span> <span class="main">`</span> <span class="free">defs</span> <span class="skolem">g</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> oldDefs_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">oldUses</span> <span class="skolem">g</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">var</span> <span class="skolem">g</span> <span class="main">`</span> uses'_all <span class="skolem">g</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i.oldUses_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> ssa.allUses <span class="skolem">g</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⟹</span> ssa.defAss <span class="skolem">g</span> <span class="skolem">n</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i.allUses_def_ass<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uninst.CFG_SSA_defs<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"old.path2 <span class="skolem">g</span> <span class="skolem">n</span> <span class="skolem">ns</span> <span class="skolem">m</span> <span class="main">⟹</span> <span class="skolem">n</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">v</span> <span class="main">∈</span> ssa.allDefs <span class="skolem">g</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="skolem">v</span> <span class="main">∈</span> ssa.allUses <span class="skolem">g</span> <span class="skolem">m</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="skolem">ns</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">v'</span> <span class="main">∈</span> ssa.allDefs <span class="skolem">g</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="free">var</span> <span class="skolem">g</span> <span class="skolem">v'</span> <span class="main">≠</span> <span class="free">var</span> <span class="skolem">g</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i.conventional<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">ns</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uninst.CFG_SSA_defs<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"phis'_all <span class="skolem">g</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">vs</span> <span class="main">⟹</span> <span class="skolem">v'</span> <span class="main">∈</span> set <span class="skolem">vs</span> <span class="main">⟹</span> <span class="free">var</span> <span class="skolem">g</span> <span class="skolem">v'</span> <span class="main">=</span> <span class="free">var</span> <span class="skolem">g</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i.phis_same_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">v</span> <span class="main">∈</span> ssa.allDefs <span class="skolem">g</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="skolem">v'</span> <span class="main">∈</span> ssa.allDefs <span class="skolem">g</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="skolem">v</span> <span class="main">≠</span> <span class="skolem">v'</span> <span class="main">⟹</span> <span class="free">var</span> <span class="skolem">g</span> <span class="skolem">v'</span> <span class="main">≠</span> <span class="free">var</span> <span class="skolem">g</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i.allDefs_var_disjoint <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uninst.CFG_SSA_defs<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"phis'_all <span class="skolem">g</span> <span class="main">(</span><span class="free">Entry</span> <span class="skolem">g</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> None"</span></span> <span class="keyword1"><span class="command">using</span></span> i.Entry_no_phis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">theorem</span></span> not_redundant<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>notriv.redundant <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">interpret</span></span> uninst<span class="main">:</span> CFG_SSA_Transformed_notriv_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">chooseNext_all</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">p</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span> <span class="bound">p</span><span class="main">.</span> uninst.redundant <span class="main">(</span><span class="free">uses</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="bound">u</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">phis</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="bound">p</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="main">⟷</span> uninst.redundant <span class="bound">u</span> <span class="bound">p</span> <span class="free">g</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uninst.CFG_SSA_wf_defs<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> substAll<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">u</span> <span class="bound">p</span><span class="main">.</span> <span class="main">¬</span>uninst.redundant <span class="main">(</span><span class="free">uses</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">phis</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> True"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> g<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">g</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> cond_def substAll_def 1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">corollary</span></span> minimal<span class="main">:</span> <span class="quoted"><span class="quoted">"old.reducible <span class="free">g</span> <span class="main">⟹</span> notriv.cytronMinimal <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> notriv.reducible_nonredundant_imp_minimal<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> not_redundant<span class="main">)</span>

  <span class="keyword1"><span class="command">theorem</span></span> pruned_invariant<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pruned <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"notriv.pruned <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">p</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"inst <span class="free">g</span> <span class="skolem">u</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> i<span class="main">:</span> CFG_SSA_Transformed_notriv <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">chooseNext_all</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"i.redundant <span class="free">g</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> i<span class="main">:</span> CFG_SSA_step <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">chooseNext_all</span></span> <span class="quoted"><span class="free">g</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

      <span class="keyword1"><span class="command">interpret</span></span> uninst<span class="main">:</span> CFG_SSA_Transformed_notriv_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">chooseNext_all</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">p</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"i.pruned <span class="free">g</span>"</span></span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"uninst.pruned <span class="main">(</span><span class="free">uses</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span>i.uses' <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">phis</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span>i.phis' <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i.pruned_inv<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">note</span></span> 1 <span class="main">=</span> this

    <span class="keyword1"><span class="command">interpret</span></span> uninst<span class="main">:</span> CFG_SSA_Transformed_notriv_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">chooseNext_all</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">p</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span> <span class="bound">u'</span> <span class="bound">p</span> <span class="bound">p'</span> <span class="bound">g</span><span class="main">.</span> uninst.pruned <span class="main">(</span><span class="bound">u'</span><span class="main">(</span><span class="bound">g</span><span class="main">:=</span><span class="bound">u</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">p'</span><span class="main">(</span><span class="bound">g</span><span class="main">:=</span><span class="bound">p</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="bound">g</span> <span class="main">⟷</span> uninst.pruned <span class="bound">u</span> <span class="bound">p</span> <span class="bound">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uninst.CFG_SSA_wf_defs<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> 1 assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> substAll<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">.</span> uninst.pruned <span class="main">(</span><span class="free">uses</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">phis</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">u</span> <span class="bound">p</span><span class="main">.</span> uninst.pruned <span class="main">(</span><span class="free">uses</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">phis</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> g<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">g</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> 2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
          <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cond_def step_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SSA_Semantics">
<div class="head">
<h1>Theory SSA_Semantics</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      SSA_Semantics.thy
    Author:     Sebastian Ullrich
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Proof of Semantic Equivalence›</span></span>

<span class="keyword1"><span class="command">theory</span></span> SSA_Semantics <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Construct_SSA">Construct_SSA</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">)</span> state <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> <span class="main">⇀</span> <span class="tfree">'node</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> CFG_SSA_Transformed
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">declare</span></span> invar<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">step</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">)</span> state <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">)</span> state"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">step</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> <span class="free">oldDefs</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">then</span> Some <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">inductive</span></span> <span class="entity">bs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">)</span> state <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊢</span> _<span class="keyword1">⇓</span>_"</span> <span class="main">[</span>50<span class="main">,</span> 50<span class="main">,</span> 50<span class="main">]</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">→</span>last <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main"><span class="free">⇓</span></span><span class="main">(</span>fold <span class="main">(</span>step <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> Map.empty<span class="main">)</span>"</span></span>


  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">ssaStep</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> state <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> state"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ssaStep</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span>
      <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> <span class="free">defs</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">then</span>
        Some <span class="free"><span class="bound"><span class="entity">m</span></span></span>
      <span class="keyword1">else</span>
        <span class="keyword1">case</span> <span class="free">phis</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="keyword1">of</span>
          Some <span class="bound">phiParams</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="bound">phiParams</span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>
        <span class="main">|</span> None <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">inductive</span></span> <span class="entity">ssaBS</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> state <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊢</span> _<span class="keyword1">⇓<span class="hidden">⇩</span><sub>s</sub></span> _"</span> <span class="main">[</span>50<span class="main">,</span> 50<span class="main">,</span> 50<span class="main">]</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="entity">g</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'g</span></span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main"><span class="free">⊢</span></span> <span class="main">[</span><span class="free">Entry</span> <span class="free">g</span><span class="main">]</span><span class="keyword1"><span class="free">⇓<span class="hidden">⇩</span><sub>s</sub></span></span><span class="main">(</span>ssaStep <span class="free">g</span> <span class="main">(</span><span class="free">Entry</span> <span class="free">g</span><span class="main">)</span> <span class="main">0</span> Map.empty<span class="main">)</span>"</span></span>
  <span class="main">|</span> snoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">g</span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="keyword1"><span class="free">⇓<span class="hidden">⇩</span><sub>s</sub></span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> last <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">=</span> old.predecessors <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> length <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
            <span class="free">g</span> <span class="main"><span class="free">⊢</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">@</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">]</span><span class="main">)</span><span class="keyword1"><span class="free">⇓<span class="hidden">⇩</span><sub>s</sub></span></span><span class="main">(</span>ssaStep <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="SSA_Semantics-ssaBS_I"><span class="command">lemma</span></span> ssaBS_I<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">s</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">ns</span><span class="keyword1">⇓<span class="hidden">⇩</span><sub>s</sub></span><span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">atomize_elim</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>old.path2_rev_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">ns</span> <span class="skolem">m'</span> <span class="skolem">m</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">ns</span><span class="keyword1">⇓<span class="hidden">⇩</span><sub>s</sub></span><span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> snoc.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">=</span> old.predecessors <span class="free">g</span> <span class="skolem">m</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>in_set_conv_nth<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> snoc.hyps snoc.prems s <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> ssaBS.snoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>old.path2_last<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ssaBS.empty<span class="main">)</span>

  <span class="keyword1" id="SSA_Semantics-ssaBS_nonempty"><span class="command">lemma</span></span> ssaBS_nonempty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">g</span> <span class="main">⊢</span> <span class="main">[]</span><span class="keyword1">⇓<span class="hidden">⇩</span><sub>s</sub></span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ssaBS.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1" id="SSA_Semantics-ssaBS_hd"><span class="command">lemma</span></span> ssaBS_hd<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">ns</span><span class="keyword1">⇓<span class="hidden">⇩</span><sub>s</sub></span><span class="free">s</span> <span class="main">⟹</span> hd <span class="free">ns</span> <span class="main">=</span> <span class="free">Entry</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ssaBS.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hd_append<span class="main">)</span>


  <span class="keyword1" id="SSA_Semantics-equiv_aux"><span class="command">lemma</span></span> equiv_aux<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">ns</span><span class="main">⇓</span><span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">ns</span><span class="keyword1">⇓<span class="hidden">⇩</span><sub>s</sub></span><span class="free">s'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> last <span class="free">ns</span><span class="main">-</span><span class="free">ms</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> allUses <span class="free">g</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">ms</span><span class="main">)</span><span class="main">.</span> <span class="free">var</span> <span class="free">g</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">var</span> <span class="free">g</span> <span class="main">`</span> allDefs <span class="free">g</span> <span class="bound">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span><span class="free">var</span> <span class="free">g</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">s'</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>1<span class="main">,</span>3-<span class="main">)</span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">ms</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="main">(</span><span class="free">Entry</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> empty.prems<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defAss <span class="free">g</span> <span class="skolem">m</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allUses_def_ass<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> empty.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="skolem">ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">drule</span> defAssD<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> empty.prems<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ms</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> empty.prems<span class="main">(</span>2<span class="main">)</span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="free">Entry</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ms</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> old.path2_hd<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> n<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> allDefs_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> empty.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">erule</span> bs.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> step_def ssaStep_def oldDefs_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">ns</span> <span class="skolem">s'</span> <span class="skolem">n</span> <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> snoc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> snoc.prems<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> allVars <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allUses_in_allVars<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> snoc.hyps<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="free">Entry</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Entry_no_predecessor<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">var</span> <span class="free">g</span> <span class="main">`</span> allDefs <span class="free">g</span> <span class="skolem">n</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True

      <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> True <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> allDefs <span class="free">g</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v'</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> snoc.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defAss <span class="free">g</span> <span class="skolem">m</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> allUses_def_ass<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> snoc.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ns'</span> <span class="main">⊆</span> set <span class="main">(</span><span class="skolem">ns</span><span class="main">@</span><span class="main">[</span><span class="skolem">n</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">ns'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bs.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> old.simple_path2<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ns'</span><span class="main">@</span>tl <span class="skolem">ms</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> snoc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">drule</span> defAss_defNode<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bs.cases <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> old.path2_app<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>butlast <span class="skolem">ns'</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?n<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∈</span> set <span class="main">(</span>butlast <span class="skolem">ns'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> ns'<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?n<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">≠</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ns'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> old.path2_last<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> ns'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ns'</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> ns' <span class="keyword1"><span class="command">have</span></span> bns'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span>butlast <span class="skolem">ns'</span><span class="main">→</span><span class="var">?n''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n''</span> <span class="main">∈</span> set <span class="main">(</span>old.predecessors <span class="free">g</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> old.path2_unsnoc<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> asm <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?n<span class="hidden">⇩</span><sub>v</sub></span><span class="main">-</span><span class="skolem">ns''</span><span class="main">→</span><span class="var">?n''</span>"</span></span> <span class="quoted"><span class="quoted">"suffix <span class="skolem">ns''</span> <span class="main">(</span>butlast <span class="skolem">ns'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="skolem">ns''</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_split_first_last<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> bns' snoc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="var">?n<span class="hidden">⇩</span><sub>v</sub></span><span class="main">-</span><span class="main">(</span><span class="skolem">ns''</span><span class="main">@</span><span class="main">[</span><span class="skolem">n</span><span class="main">]</span><span class="main">)</span><span class="main">@</span>tl <span class="skolem">ms</span><span class="main">→</span><span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_app<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"defNode <span class="free">g</span> <span class="skolem">v'</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="main">(</span><span class="skolem">ns''</span><span class="main">@</span><span class="main">[</span><span class="skolem">n</span><span class="main">]</span><span class="main">@</span>tl <span class="skolem">ms</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> v' snoc.prems<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> bns'<span class="main">(</span>2<span class="main">)</span> ns''<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> conventional''<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> old.path2_app <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> old.path2_not_Nil<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> ns' ns''<span class="main">(</span>1<span class="main">)</span> v'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> old.path2_not_Nil<span class="main">)</span>
        <span class="keyword1"><span class="command">}</span></span> 
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> snoc.prems<span class="main">(</span>4<span class="main">)</span> ns'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ns'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> old.path2_last<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> allVars <span class="free">g</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> defNode_cases<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> simpleDef
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> snoc.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">erule</span> bs.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> step_def ssaStep_def oldDefs_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> phi
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v'</span>
          <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> <span class="free">defs</span> <span class="free">g</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span> <span class="main">=</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">v'</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> phi <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> allDefs_var_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> phi_phiDefs<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> asm<span class="main">(</span>1<span class="main">)</span> phi <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> simpleDefs_phiDefs_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> phi_phiDefs<span class="main">)</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">note</span></span> 1 <span class="main">=</span> this
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">vs</span>
          <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">n</span><span class="main">]</span><span class="main">→</span><span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span> <span class="main">∉</span> <span class="free">var</span> <span class="free">g</span> <span class="main">`</span> <span class="free">defs</span> <span class="free">g</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"last <span class="skolem">ns</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> asm<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ns</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ns</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> old.path2_def<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">Entry</span> <span class="free">g</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="var">?n'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> old.path2_unsnoc<span class="main"><span class="main">[</span></span><span class="operator">OF</span> asm<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∈</span> phiUses <span class="free">g</span> <span class="var">?n'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> snoc.hyps<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> phis_wf<span class="main">[</span><span class="operator">OF</span> asm<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> phiUsesI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ asm<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_zip<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fold <span class="main">(</span>step <span class="free">g</span><span class="main">)</span> <span class="skolem">ns</span> Map.empty <span class="main">(</span><span class="free">var</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">vs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">s'</span> <span class="main">(</span><span class="skolem">vs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> snoc.IH<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ms1<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="var">?n'</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> m1<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="var">?n'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bs.intros<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fold <span class="main">(</span>step <span class="free">g</span><span class="main">)</span> <span class="skolem">ns</span> Map.empty <span class="main">(</span><span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">s'</span> <span class="main">(</span><span class="skolem">vs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> phis_same_var<span class="main">[</span><span class="operator">OF</span> asm<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span><span class="main">]</span> snoc.hyps<span class="main">(</span>4<span class="main">)</span> phis_wf<span class="main">[</span><span class="operator">OF</span> asm<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> phi snoc.prems<span class="main">(</span>1<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">erule</span> bs.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> 1 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> step_def ssaStep_def oldDefs_def phi_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> None"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> allDefs_def phiDefs_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fold <span class="main">(</span>step <span class="free">g</span><span class="main">)</span> <span class="skolem">ns</span> Map.empty <span class="main">(</span><span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">s'</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> snoc.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ns</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ns</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> snoc.prems<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set <span class="skolem">ms</span><span class="main">.</span> <span class="free">var</span> <span class="free">g</span> <span class="skolem">v</span> <span class="main">∉</span> <span class="free">var</span> <span class="free">g</span> <span class="main">`</span> allDefs <span class="free">g</span> <span class="bound">n</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ms</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phiDefs_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> old.path2_hd<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> snoc.prems<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> snoc.IH<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ms1<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"last <span class="skolem">ns</span><span class="main">#</span><span class="skolem">ms</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bs.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bs.intros <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> old.path2_unsnoc <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> old.Cons_path2<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> snoc.prems<span class="main">(</span>1<span class="main">)</span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">erule</span> bs.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> step_def ssaStep_def oldDefs_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">theorem</span></span> equiv<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">ns</span><span class="main">⇓</span><span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">ns</span><span class="keyword1">⇓<span class="hidden">⇩</span><sub>s</sub></span><span class="free">s'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="main">(</span>last <span class="free">ns</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span><span class="free">var</span> <span class="free">g</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">s'</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> equiv_aux<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ms<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">[</span>last <span class="free">ns</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bs.cases<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="While_Combinator_Exts">
<div class="head">
<h1>Theory While_Combinator_Exts</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      While_Combinator_Exts.thy
    Author:     Denis Lohner
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Code Generation›</span></span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹While Combinator Extensions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> While_Combinator_Exts <span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/While_Combinator.html">HOL-Library.While_Combinator</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1" id="While_Combinator_Exts-while_option_None_invD"><span class="command">lemma</span></span> while_option_None_invD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"while_option <span class="free">b</span> <span class="free">c</span> <span class="free">s</span> <span class="main">=</span> None"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="main">⟦</span> <span class="free">I</span> <span class="bound">s</span><span class="main">;</span> <span class="free">b</span> <span class="bound">s</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">(</span><span class="free">c</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="main">⟦</span> <span class="free">I</span> <span class="bound">s</span><span class="main">;</span> <span class="free">b</span> <span class="bound">s</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">c</span> <span class="bound">s</span><span class="main">,</span> <span class="bound">s</span> <span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">drule</span> wf_rel_while_option_Some <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="While_Combinator_Exts-while_option_NoneD"><span class="command">lemma</span></span> while_option_NoneD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"while_option <span class="free">b</span> <span class="free">c</span> <span class="free">s</span> <span class="main">=</span> None"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free">b</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">c</span> <span class="bound">s</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> while_option_None_invD<span class="main">)</span>

<span class="keyword1" id="While_Combinator_Exts-while_option_sim"><span class="command">lemma</span></span> while_option_sim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> start<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">(</span>Some <span class="free">s1</span><span class="main">)</span> <span class="main">(</span>Some <span class="free">s2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="main">⟦</span> <span class="free">R</span> <span class="main">(</span>Some <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>Some <span class="bound">s2</span><span class="main">)</span><span class="main">;</span> <span class="free">I</span> <span class="bound">s1</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">b1</span> <span class="bound">s1</span> <span class="main">=</span> <span class="free">b2</span> <span class="bound">s2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> step <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="main">⟦</span> <span class="free">R</span> <span class="main">(</span>Some <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>Some <span class="bound">s2</span><span class="main">)</span><span class="main">;</span> <span class="free">I</span> <span class="bound">s1</span><span class="main">;</span> <span class="free">b1</span> <span class="bound">s1</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">R</span> <span class="main">(</span>Some <span class="main">(</span><span class="free">c1</span> <span class="bound">s1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span><span class="free">c2</span> <span class="bound">s2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> diverge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> None None"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> inv_start<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="free">s1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> inv_step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span><span class="main">.</span> <span class="main">⟦</span> <span class="free">I</span> <span class="bound">s1</span><span class="main">;</span> <span class="free">b1</span> <span class="bound">s1</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">(</span><span class="free">c1</span> <span class="bound">s1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">(</span>while_option <span class="free">b1</span> <span class="free">c1</span> <span class="free">s1</span><span class="main">)</span> <span class="main">(</span>while_option <span class="free">b2</span> <span class="free">c2</span> <span class="free">s2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k'</span></span> <span class="main">&lt;</span> <span class="skolem">k</span><span class="main">.</span> <span class="free">b1</span> <span class="main">(</span><span class="main">(</span><span class="free">c1</span> <span class="main">^^</span> <span class="bound">k'</span><span class="main">)</span> <span class="free">s1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> start cond step inv_start inv_step
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b1</span> <span class="main">(</span><span class="main">(</span><span class="free">c1</span> <span class="main">^^</span> <span class="skolem">k</span><span class="main">)</span> <span class="free">s1</span><span class="main">)</span> <span class="main">=</span> <span class="free">b2</span> <span class="main">(</span><span class="main">(</span><span class="free">c2</span> <span class="main">^^</span> <span class="skolem">k</span><span class="main">)</span> <span class="free">s2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span><span class="main">(</span><span class="free">c1</span> <span class="main">^^</span> <span class="skolem">k</span><span class="main">)</span> <span class="free">s1</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">(</span>Some <span class="main">(</span><span class="main">(</span><span class="free">c1</span> <span class="main">^^</span> <span class="skolem">k</span><span class="main">)</span> <span class="free">s1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span><span class="main">(</span><span class="free">c2</span> <span class="main">^^</span> <span class="skolem">k</span><span class="main">)</span> <span class="free">s2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">b1</span> <span class="main">(</span><span class="main">(</span><span class="free">c1</span> <span class="main">^^</span> <span class="skolem">k</span><span class="main">)</span> <span class="free">s1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k'</span></span> <span class="main">&lt;</span> <span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="main">¬</span> <span class="free">b1</span> <span class="main">(</span><span class="main">(</span><span class="free">c1</span> <span class="main">^^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">s1</span><span class="main">)</span><span class="main">.</span> <span class="free">b1</span> <span class="main">(</span><span class="main">(</span><span class="free">c1</span> <span class="main">^^</span> <span class="bound">k'</span><span class="main">)</span> <span class="free">s1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> not_less_Least<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">b2</span> <span class="main">(</span><span class="main">(</span><span class="free">c2</span> <span class="main">^^</span> <span class="skolem">k</span><span class="main">)</span> <span class="free">s2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k'</span></span> <span class="main">&lt;</span> <span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="main">¬</span> <span class="free">b2</span> <span class="main">(</span><span class="main">(</span><span class="free">c2</span> <span class="main">^^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">s2</span><span class="main">)</span><span class="main">.</span> <span class="free">b2</span> <span class="main">(</span><span class="main">(</span><span class="free">c2</span> <span class="main">^^</span> <span class="bound">k'</span><span class="main">)</span> <span class="free">s2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> not_less_Least<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">¬</span> <span class="free">b1</span> <span class="main">(</span><span class="main">(</span><span class="free">c1</span> <span class="main">^^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">s1</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">¬</span> <span class="free">b2</span> <span class="main">(</span><span class="main">(</span><span class="free">c2</span> <span class="main">^^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">s2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> not_cond_Least<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">b1</span> <span class="main">(</span><span class="main">(</span><span class="free">c1</span> <span class="main">^^</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="main">¬</span> <span class="free">b1</span> <span class="main">(</span><span class="main">(</span><span class="free">c1</span> <span class="main">^^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">s1</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">b2</span> <span class="main">(</span><span class="main">(</span><span class="free">c2</span> <span class="main">^^</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="main">¬</span> <span class="free">b2</span> <span class="main">(</span><span class="main">(</span><span class="free">c2</span> <span class="main">^^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">s2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">s2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">drule</span> LeastI_ex<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k'</span></span> <span class="main">&lt;</span> <span class="skolem">k</span><span class="main">.</span> <span class="free">b1</span> <span class="main">(</span><span class="main">(</span><span class="free">c1</span> <span class="main">^^</span> <span class="bound">k'</span><span class="main">)</span> <span class="free">s1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> calculation<span class="main">(</span>1<span class="main">)</span> dual_order.strict_trans
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k'</span></span> <span class="main">&lt;</span> <span class="skolem">k</span><span class="main">.</span> <span class="free">b2</span> <span class="main">(</span><span class="main">(</span><span class="free">c2</span> <span class="main">^^</span> <span class="bound">k'</span><span class="main">)</span> <span class="free">s2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k'</span><span class="main">.</span> <span class="main">¬</span> <span class="free">b1</span> <span class="main">(</span><span class="main">(</span><span class="free">c1</span> <span class="main">^^</span> <span class="bound">k'</span><span class="main">)</span> <span class="free">s1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k'</span><span class="main">.</span> <span class="main">¬</span> <span class="free">b2</span> <span class="main">(</span><span class="main">(</span><span class="free">c2</span> <span class="main">^^</span> <span class="bound">k'</span><span class="main">)</span> <span class="free">s2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> not_cond_Least calculation<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span> less_linear<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> calculation<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">(</span>Some <span class="main">(</span><span class="main">(</span><span class="free">c1</span> <span class="main">^^</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="main">¬</span> <span class="free">b1</span> <span class="main">(</span><span class="main">(</span><span class="free">c1</span> <span class="main">^^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">s1</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>Some <span class="main">(</span><span class="main">(</span><span class="free">c2</span> <span class="main">^^</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="main">¬</span> <span class="free">b2</span> <span class="main">(</span><span class="main">(</span><span class="free">c2</span> <span class="main">^^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">s2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">s2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> diverge
    <span class="keyword1"><span class="command">unfolding</span></span> while_option_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> if_split<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> if_split<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> if_split<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> LeastI_ex<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SSA_CFG_code">
<div class="head">
<h1>Theory SSA_CFG_code</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      SSA_CFG_code.thy
    Author:     Denis Lohner, Sebastian Ullrich
*)</span>

<span class="keyword1"><span class="command">theory</span></span> SSA_CFG_code <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#SSA_CFG">SSA_CFG</a>
  <a href="#Mapping_Exts">Mapping_Exts</a>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Product_Lexorder.html">HOL-Library.Product_Lexorder</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Union_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Union_of</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="main">⋃</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SSA_CFG_code-Union_of_alt_def"><span class="command">lemma</span></span> Union_of_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"Union_of <span class="free">f</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Union_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis_code <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'val</span> list<span class="main">)</span> mapping"</span></span>

<span class="keyword1"><span class="command">context</span></span> CFG_base <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">addN</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'var</span><span class="main">,</span> <span class="tfree">'node</span> set<span class="main">)</span> mapping <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'var</span><span class="main">,</span> <span class="tfree">'node</span> set<span class="main">)</span> mapping"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">addN</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> fold <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> Mapping.map_default <span class="bound">v</span> <span class="main">{}</span> <span class="main">(</span>insert <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sorted_list_of_set <span class="main">(</span><span class="free">uses</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">addN'</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> fold <span class="main">(</span><span class="main">λ</span><span class="bound">v</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span><span class="main">(</span><span class="bound">v</span> <span class="main">↦</span> case_option <span class="main">{</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span> <span class="main">(</span>insert <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">m</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sorted_list_of_set <span class="main">(</span><span class="free">uses</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="SSA_CFG_code-addN_transfer"><span class="command">lemma</span></span> addN_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"rel_fun <span class="main">(=)</span> <span class="main">(</span>rel_fun <span class="main">(=)</span> <span class="main">(</span>rel_fun <span class="main">(</span>pcr_mapping <span class="main">(=)</span> <span class="main">(=)</span><span class="main">)</span> <span class="main">(</span>pcr_mapping <span class="main">(=)</span> <span class="main">(=)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> addN' addN"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> addN_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> addN'_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
      Mapping.map_default_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> Mapping.default_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mapping.pcr_cr_eq rel_fun_def cr_mapping_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> fold_cong<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">useNodes_of</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> fold <span class="main">(</span>addN <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">αn</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> Mapping.empty"</span></span>
  <span class="keyword1"><span class="command">lemmas</span></span> useNodes_of_code <span class="main">=</span> useNodes_of_def <span class="main">[</span><span class="operator">unfolded</span> addN_def <span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">declare</span></span> useNodes_of_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span>

  <span class="keyword1" id="SSA_CFG_code-lookup_useNodes_of'"><span class="command">lemma</span></span> lookup_useNodes_of'<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> finite <span class="main">(</span><span class="free">uses</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span>useNodes_of <span class="free">g</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">then</span> Some <span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="bound">n</span><span class="main">}</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">xs</span> <span class="skolem">v</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span>fold <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> Mapping.map_default <span class="main">(</span><span class="bound">v</span><span class="main">::</span><span class="tfree">'var</span><span class="main">)</span> <span class="main">{}</span> <span class="main">(</span>insert <span class="main">(</span><span class="skolem">n</span><span class="main">::</span><span class="tfree">'node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">xs</span> <span class="skolem">m</span><span class="main">)</span> <span class="skolem">v</span><span class="main">=</span>
        <span class="main">(</span><span class="keyword1">case</span> Mapping.lookup <span class="skolem">m</span> <span class="skolem">v</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">v</span> <span class="main">∈</span> set <span class="skolem">xs</span> <span class="keyword1">then</span> Some <span class="main">{</span><span class="skolem">n</span><span class="main">}</span> <span class="keyword1">else</span> None<span class="main">)</span>
          <span class="main">|</span> Some <span class="bound">N</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">v</span> <span class="main">∈</span> set <span class="skolem">xs</span> <span class="keyword1">then</span> Some <span class="main">(</span>insert <span class="skolem">n</span> <span class="bound">N</span><span class="main">)</span> <span class="keyword1">else</span> Some <span class="bound">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Mapping_lookup_map_default <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">note</span></span> addN_conv <span class="main">=</span> this <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="quoted">"sorted_list_of_set <span class="main">(</span><span class="free">uses</span> <span class="skolem">g</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">g</span> <span class="skolem">n</span><span class="main">,</span> <span class="operator">folded</span> addN_def<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">m</span> <span class="skolem">v</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span>fold <span class="main">(</span>addN <span class="free">g</span><span class="main">)</span> <span class="skolem">xs</span> <span class="skolem">m</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> Mapping.lookup <span class="skolem">m</span> <span class="skolem">v</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">∈</span>set <span class="skolem">xs</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">then</span> Some <span class="main">{</span><span class="bound"><span class="bound">n</span></span><span class="main">∈</span>set <span class="skolem">xs</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="bound">n</span><span class="main">}</span> <span class="keyword1">else</span> None
        <span class="main">|</span> Some <span class="bound">N</span> <span class="main">⇒</span> Some <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">n</span></span><span class="main">∈</span>set <span class="skolem">xs</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="bound">n</span><span class="main">}</span> <span class="main">∪</span> <span class="bound">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> addN_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">note</span></span> this <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">αn</span> <span class="free">g</span>"</span></span> <span class="quoted">Mapping.empty</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> useNodes_of_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> CFG <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> useNodes_of' <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'var</span><span class="main">,</span> <span class="tfree">'node</span> set<span class="main">)</span> mapping"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span> <span class="bound">v</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="bound">g</span><span class="main">)</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="bound">g</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">then</span> Some <span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="bound">g</span><span class="main">)</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="bound">g</span> <span class="bound">n</span><span class="main">}</span> <span class="keyword1">else</span> None"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1" id="SSA_CFG_code-useNodes_of'"><span class="command">lemma</span></span> useNodes_of'<span class="main">:</span> <span class="quoted"><span class="quoted">"useNodes_of' <span class="main">=</span> useNodes_of"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">xs</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fold <span class="main">(</span><span class="main">λ</span><span class="bound">v</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span><span class="main">(</span><span class="bound">v</span><span class="main">::</span><span class="tfree">'var</span> <span class="main">↦</span> <span class="keyword1">case</span> <span class="bound">m</span> <span class="bound">v</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="main">{</span><span class="skolem">n</span><span class="main">::</span><span class="tfree">'node</span><span class="main">}</span> <span class="main">|</span> Some <span class="bound">x</span> <span class="main">⇒</span> insert <span class="skolem">n</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">xs</span> <span class="skolem">m</span> <span class="main">=</span>
        <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="keyword1">case</span> <span class="skolem">m</span> <span class="bound">v</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">v</span> <span class="main">∈</span> set <span class="skolem">xs</span> <span class="keyword1">then</span> Some <span class="main">{</span><span class="skolem">n</span><span class="main">}</span> <span class="keyword1">else</span> None<span class="main">)</span>
          <span class="main">|</span> Some <span class="bound">N</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">v</span> <span class="main">∈</span> set <span class="skolem">xs</span> <span class="keyword1">then</span> Some <span class="main">(</span>insert <span class="skolem">n</span> <span class="bound">N</span><span class="main">)</span> <span class="keyword1">else</span> Some <span class="bound">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">note</span></span> addN'_conv <span class="main">=</span> this <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="quoted">"sorted_list_of_set <span class="main">(</span><span class="free">uses</span> <span class="skolem">g</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">g</span> <span class="skolem">n</span><span class="main">,</span> <span class="operator">folded</span> addN'_def<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">m</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fold <span class="main">(</span>addN' <span class="skolem">g</span><span class="main">)</span> <span class="skolem">xs</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="keyword1">case</span> <span class="skolem">m</span> <span class="bound">v</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">∈</span>set <span class="skolem">xs</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">then</span> Some <span class="main">{</span><span class="bound"><span class="bound">n</span></span><span class="main">∈</span>set <span class="skolem">xs</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="skolem">g</span> <span class="bound">n</span><span class="main">}</span> <span class="keyword1">else</span> None
        <span class="main">|</span> Some <span class="bound">N</span> <span class="main">⇒</span> Some <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">n</span></span><span class="main">∈</span>set <span class="skolem">xs</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="skolem">g</span> <span class="bound">n</span><span class="main">}</span> <span class="main">∪</span> <span class="bound">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> 4 4 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> addN'_conv <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">note</span></span> this <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">αn</span> <span class="skolem">g</span>"</span></span> <span class="quoted">Map.empty</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"useNodes_of' <span class="skolem">g</span> <span class="main">=</span> useNodes_of <span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mmap_def useNodes_of_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">g</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">declare</span></span> useNodes_of'.transfer <span class="main">[</span><span class="operator">unfolded</span> useNodes_of'<span class="main">,</span> <span class="operator">transfer_rule</span><span class="main">]</span>

  <span class="keyword1" id="SSA_CFG_code-lookup_useNodes_of"><span class="command">lemma</span></span> lookup_useNodes_of<span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span>useNodes_of <span class="free">g</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">then</span> Some <span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="bound">n</span><span class="main">}</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span> <span class="main">(</span><span class="operator">transfer'</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> CFG_SSA_base <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">phis_addN</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis_addN</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> fold <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> Mapping.map_default <span class="bound">v</span> <span class="main">{}</span> <span class="main">(</span>insert <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>case_option <span class="main">[]</span> id <span class="main">(</span><span class="free">phis</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">phidefNodes</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">phidefNodes</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> fold <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> Mapping.update <span class="bound">v</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>sorted_list_of_set <span class="main">(</span>dom <span class="main">(</span><span class="free">phis</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> Mapping.empty"</span></span>

  <span class="keyword1" id="SSA_CFG_code-keys_phidefNodes"><span class="command">lemma</span></span> keys_phidefNodes<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>dom <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Mapping.keys <span class="main">(</span>phidefNodes <span class="free">g</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">`</span> dom <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">m</span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fold <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span><span class="main">(</span><span class="bound">b</span> <span class="main">↦</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">::</span><span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'val</span><span class="main">)</span> list<span class="main">)</span> <span class="skolem">m</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">∈</span> snd <span class="main">`</span> set <span class="skolem">xs</span> <span class="keyword1">then</span> <span class="main">(</span>Some <span class="main">∘</span> fst<span class="main">)</span> <span class="main">(</span>last <span class="main">[</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">←</span><span class="skolem">xs</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">else</span> <span class="skolem">m</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filter_empty_conv <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_image_eqI<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sorted_list_of_set <span class="main">(</span>dom <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted">Map.empty</span><span class="main">]</span> assms
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> phidefNodes_def keys_dom_lookup
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">phis</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dom_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_image_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">phiNodes_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'val</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'val</span><span class="main">)</span> set<span class="main">)</span> mapping"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">phiNodes_of</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> fold <span class="main">(</span>phis_addN <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">(</span>sorted_list_of_set <span class="main">(</span>dom <span class="main">(</span><span class="free">phis</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> Mapping.empty"</span></span>

  <span class="keyword1" id="SSA_CFG_code-lookup_phiNodes_of"><span class="command">lemma</span></span> lookup_phiNodes_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>dom <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span>phiNodes_of <span class="free">g</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> dom <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> <span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>the <span class="main">(</span><span class="free">phis</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> Some <span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> dom <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> <span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>the <span class="main">(</span><span class="free">phis</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">xs</span> <span class="skolem">v</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span>fold <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> Mapping.map_default <span class="bound">v</span> <span class="main">{}</span> <span class="main">(</span>insert <span class="main">(</span><span class="skolem">n</span><span class="main">::</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'val</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">(</span><span class="skolem">m</span><span class="main">::</span><span class="main">(</span><span class="tfree">'val</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'val</span><span class="main">)</span> set<span class="main">)</span> mapping<span class="main">)</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">case</span> Mapping.lookup <span class="skolem">m</span> <span class="skolem">v</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">v</span> <span class="main">∈</span> set <span class="skolem">xs</span> <span class="keyword1">then</span> Some <span class="main">{</span><span class="skolem">n</span><span class="main">}</span> <span class="keyword1">else</span> None<span class="main">)</span>
        <span class="main">|</span> Some <span class="bound">N</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">v</span> <span class="main">∈</span> set <span class="skolem">xs</span> <span class="keyword1">then</span> Some <span class="main">(</span>insert <span class="skolem">n</span> <span class="bound">N</span><span class="main">)</span> <span class="keyword1">else</span> Some <span class="bound">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Mapping_lookup_map_default <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> phis_addN_conv <span class="main">=</span> this <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="quoted">"case_option <span class="main">[]</span> id <span class="main">(</span><span class="free">phis</span> <span class="free">g</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">n</span><span class="main">,</span> <span class="operator">folded</span> phis_addN_def<span class="main">]</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">m</span> <span class="skolem">v</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span>fold <span class="main">(</span>phis_addN <span class="free">g</span><span class="main">)</span> <span class="skolem">xs</span> <span class="skolem">m</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">case</span> Mapping.lookup <span class="skolem">m</span> <span class="skolem">v</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> set <span class="skolem">xs</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">∈</span> set <span class="main">(</span>case_option <span class="main">[]</span> id <span class="main">(</span><span class="free">phis</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> Some <span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> set <span class="skolem">xs</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">∈</span> set <span class="main">(</span>case_option <span class="main">[]</span> id <span class="main">(</span><span class="free">phis</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">else</span> None
        <span class="main">|</span> Some <span class="bound">N</span> <span class="main">⇒</span> Some <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> set <span class="skolem">xs</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">∈</span> set <span class="main">(</span>case_option <span class="main">[]</span> id <span class="main">(</span><span class="free">phis</span> <span class="free">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="bound">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phis_addN_conv <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> this <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sorted_list_of_set <span class="main">(</span>dom <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> phiNodes_of_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemmas</span></span> phiNodes_of_code <span class="main">=</span> phiNodes_of_def <span class="main">[</span><span class="operator">unfolded</span> phis_addN_def <span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">declare</span></span> phiNodes_of_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span>

<span class="keyword1" id="SSA_CFG_code-phis_transfer"><span class="command">lemma</span></span> phis_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">includes</span></span> lifting_syntax
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(=)</span> <span class="main">===&gt;</span> pcr_mapping <span class="main">(=)</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">phis</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.Mapping <span class="main">(</span><span class="free">phis</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mapping.pcr_cr_eq rel_fun_def cr_mapping_def Mapping.Mapping_inverse<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> CFG_SSA <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">declare</span></span> lookup_phiNodes_of <span class="main">[</span><span class="operator">OF</span> phis_finite<span class="main">,</span> <span class="operator">simp</span><span class="main">]</span>
  <span class="keyword1"><span class="command">declare</span></span> keys_phidefNodes <span class="main">[</span><span class="operator">OF</span> phis_finite<span class="main">,</span> <span class="operator">simp</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_SSA_ext_base <span class="main">=</span> CFG_SSA_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Entry</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span><span class="main">::</span>linorder set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">phis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">cache</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> Mapping.tabulate <span class="main">(</span><span class="free">αn</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

  <span class="keyword1" id="SSA_CFG_code-lookup_cache"><span class="command">lemma</span></span> lookup_cache<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> Mapping.lookup <span class="main">(</span>cache <span class="free">g</span> <span class="free">f</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Map.map_of_map_restrict<span class="main">)</span>

  <span class="keyword1" id="SSA_CFG_code-lookup_cacheD"><span class="command">lemma</span></span> lookup_cacheD <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span>cache <span class="free">g</span> <span class="free">f</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Some <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Map.map_of_map_restrict restrict_map_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

  <span class="keyword1" id="SSA_CFG_code-lookup_cache_usesD"><span class="command">lemma</span></span> lookup_cache_usesD<span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span>cache <span class="free">g</span> <span class="main">(</span><span class="free">uses</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> Some <span class="free">vs</span> <span class="main">⟹</span> <span class="free">vs</span> <span class="main">=</span> <span class="free">uses</span> <span class="free">g</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">usesOf</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> case_option <span class="main">{}</span> id <span class="main">(</span>Mapping.lookup <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_SSA_ext <span class="main">=</span> CFG_SSA_ext_base  <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span>
  <span class="main">+</span> CFG_SSA <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Entry</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span><span class="main">::</span>linorder set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">phis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="SSA_CFG_code-usesOf_cache"><span class="command">lemma</span></span> usesOf_cache<span class="main">[</span><span class="operator">abs_def</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"usesOf <span class="main">(</span>cache <span class="free">g</span> <span class="main">(</span><span class="free">uses</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="free">uses</span> <span class="free">g</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uses_in_αn <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> lookup_cache_usesD <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_SSA_base_code <span class="main">=</span> CFG_SSA_ext_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"usesOf <span class="main">∘</span> <span class="free">uses</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Entry</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span><span class="main">::</span>linorder set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span> set<span class="main">)</span> mapping"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">phis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis_code"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">declare</span></span> phis_transfer <span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">transfer_rule</span><span class="main">]</span>

  <span class="keyword1" id="SSA_CFG_code-phiDefs_code"><span class="command">lemma</span></span> phiDefs_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"phiDefs <span class="free">g</span> <span class="free">n</span> <span class="main">=</span> snd <span class="main">`</span> Set.filter <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">n'</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">=</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> phiDefs_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> 4 3 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_image_eqI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Set.filter_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemmas</span></span> phiUses_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span> <span class="main">=</span> phiUses_def <span class="main">[</span><span class="operator">folded</span> Union_of_alt_def<span class="main">]</span>
  <span class="keyword1"><span class="command">declare</span></span> allUses_def <span class="main">[</span><span class="operator">code</span><span class="main">]</span>
  <span class="keyword1"><span class="command">lemmas</span></span> allVars_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span> <span class="main">=</span> allVars_def <span class="main">[</span><span class="operator">folded</span> Union_of_alt_def<span class="main">]</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_SSA_code <span class="main">=</span> CFG_SSA_base_code  <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span>
  <span class="main">+</span> CFG_SSA_ext <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"usesOf <span class="main">∘</span> <span class="free">uses</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Entry</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span><span class="main">::</span>linorder set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span> set<span class="main">)</span> mapping"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">phis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis_code"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">the_trivial</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>foldl <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">good</span><span class="main">,</span><span class="bound">v'</span><span class="main">)</span> <span class="bound">w</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">w</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="bound">good</span><span class="main">,</span><span class="bound">v'</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="keyword1">case</span> <span class="bound">v'</span> <span class="keyword1">of</span> Some <span class="bound">v'</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">good</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">=</span> <span class="bound">v'</span><span class="main">,</span> Some <span class="bound">v'</span><span class="main">)</span>
        <span class="main">|</span> None <span class="main">⇒</span> <span class="main">(</span><span class="bound">good</span><span class="main">,</span> Some <span class="bound">w</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>True<span class="main">,</span> None<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span>
  <span class="keyword1">of</span> <span class="main">(</span>False<span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span> <span class="main">⇒</span> None <span class="main">|</span> <span class="main">(</span>True<span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">v</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SSA_CFG_code-the_trivial_Nil"><span class="command">lemma</span></span> the_trivial_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"the_trivial <span class="free">x</span> <span class="main">[]</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> the_trivial_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="SSA_CFG_code-the_trivialI"><span class="command">lemma</span></span> the_trivialI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span> <span class="free">v'</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"the_trivial <span class="free">v</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> set <span class="free">vs</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span> <span class="keyword1">then</span> None <span class="keyword1">else</span> Some <span class="free">v'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">vx</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> set <span class="free">vs</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span> <span class="free">v'</span><span class="main">}</span><span class="main">;</span> <span class="free">v'</span> <span class="main">≠</span> <span class="free">v</span><span class="main">;</span> <span class="skolem">vx</span> <span class="main">∈</span> <span class="main">{</span>None<span class="main">,</span> Some <span class="free">v'</span><span class="main">}</span> <span class="main">⟧</span>
    <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">case</span> foldl <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">good</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="bound">w</span><span class="main">.</span>
                    <span class="keyword1">if</span> <span class="bound">w</span> <span class="main">=</span> <span class="free">v</span> <span class="keyword1">then</span> <span class="main">(</span><span class="bound">good</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span>
                    <span class="keyword1">else</span> <span class="keyword1">case</span> <span class="bound">v'</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="main">(</span><span class="bound">good</span><span class="main">,</span> Some <span class="bound">w</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">v'</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">good</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">=</span> <span class="bound">v'</span><span class="main">,</span> Some <span class="bound">v'</span><span class="main">)</span><span class="main">)</span>
           <span class="main">(</span>True<span class="main">,</span> <span class="skolem">vx</span><span class="main">)</span> <span class="free">vs</span> <span class="keyword1">of</span>
     <span class="main">(</span>True<span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">x</span> <span class="main">|</span> <span class="main">(</span>False<span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> None<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> set <span class="free">vs</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span> <span class="keyword1">then</span> <span class="skolem">vx</span> <span class="keyword1">else</span> Some <span class="free">v'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">vs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">vx</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">vx</span></span></span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> the_trivial_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SSA_CFG_code-the_trivial_conv"><span class="command">lemma</span></span> the_trivial_conv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"the_trivial <span class="free">v</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">v'</span> <span class="main">∈</span> set <span class="free">vs</span><span class="main">.</span> <span class="bound">v'</span> <span class="main">≠</span> <span class="free">v</span> <span class="main">∧</span> set <span class="free">vs</span> <span class="main">-</span> <span class="main">{</span><span class="bound">v'</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span> <span class="keyword1">then</span> Some <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">v'</span><span class="main">.</span> <span class="bound">v'</span> <span class="main">∈</span> set <span class="free">vs</span> <span class="main">∧</span> <span class="bound">v'</span> <span class="main">≠</span> <span class="free">v</span> <span class="main">∧</span> set <span class="free">vs</span> <span class="main">-</span> <span class="main">{</span><span class="bound">v'</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">a</span> <span class="skolem">vs</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="free">v</span>
       <span class="main">⟹</span> foldl <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">good</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="bound">w</span><span class="main">.</span>
                     <span class="keyword1">if</span> <span class="bound">w</span> <span class="main">=</span> <span class="free">v</span> <span class="keyword1">then</span> <span class="main">(</span><span class="bound">good</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span>
                     <span class="keyword1">else</span> <span class="keyword1">case</span> <span class="bound">v'</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="main">(</span><span class="bound">good</span><span class="main">,</span> Some <span class="bound">w</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">v'</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">good</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">=</span> <span class="bound">v'</span><span class="main">,</span> Some <span class="bound">v'</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> Some <span class="skolem">a</span><span class="main">)</span> <span class="skolem">vs</span> <span class="main">=</span>
           <span class="main">(</span><span class="skolem">b</span> <span class="main">∧</span> set <span class="skolem">vs</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span> <span class="skolem">a</span><span class="main">}</span><span class="main">,</span> Some <span class="skolem">a</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> this<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">vx</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="skolem">vx</span> <span class="main">∈</span> insert None <span class="main">(</span>Some <span class="main">`</span> set <span class="free">vs</span><span class="main">)</span><span class="main">;</span> case_option True <span class="main">(</span><span class="main">λ</span><span class="bound">vx</span><span class="main">.</span> <span class="bound">vx</span> <span class="main">≠</span> <span class="free">v</span><span class="main">)</span> <span class="skolem">vx</span> <span class="main">⟧</span>
    <span class="main">⟹</span> foldl <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">good</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="bound">w</span><span class="main">.</span>
                    <span class="keyword1">if</span> <span class="bound">w</span> <span class="main">=</span> <span class="free">v</span> <span class="keyword1">then</span> <span class="main">(</span><span class="bound">good</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span>
                    <span class="keyword1">else</span> <span class="keyword1">case</span> <span class="bound">v'</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="main">(</span><span class="bound">good</span><span class="main">,</span> Some <span class="bound">w</span><span class="main">)</span> <span class="main">|</span> Some <span class="bound">v'</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">good</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">=</span> <span class="bound">v'</span><span class="main">,</span> Some <span class="bound">v'</span><span class="main">)</span><span class="main">)</span>
        <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">vx</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">vx</span> <span class="keyword1">of</span> Some <span class="bound">w</span> <span class="main">⇒</span> set <span class="free">vs</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span> <span class="bound">w</span><span class="main">}</span> <span class="main">|</span> None <span class="main">⇒</span> <span class="main">∃</span><span class="bound">w</span><span class="main">.</span> set <span class="free">vs</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span> <span class="bound">w</span><span class="main">}</span><span class="main">)</span><span class="main">,</span>
        <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">vx</span> <span class="keyword1">of</span> Some <span class="bound">w</span> <span class="main">⇒</span> Some <span class="bound">w</span> <span class="main">|</span> None <span class="main">⇒</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v'</span><span class="main">∈</span>set <span class="free">vs</span><span class="main">.</span> <span class="bound">v'</span> <span class="main">≠</span> <span class="free">v</span><span class="main">)</span> <span class="keyword1">then</span> Some <span class="main">(</span>hd <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">v'</span><span class="main">.</span> <span class="bound">v'</span> <span class="main">≠</span> <span class="free">v</span><span class="main">)</span> <span class="free">vs</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">vs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">vx</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"the_trivial <span class="free">v</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">v'</span> <span class="main">∈</span> set <span class="free">vs</span><span class="main">.</span> <span class="bound">v'</span> <span class="main">≠</span> <span class="free">v</span> <span class="main">∧</span> set <span class="free">vs</span> <span class="main">-</span> <span class="main">{</span><span class="bound">v'</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span> <span class="keyword1">then</span> Some <span class="main">(</span>hd <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">v'</span><span class="main">.</span> <span class="bound">v'</span> <span class="main">≠</span> <span class="free">v</span><span class="main">)</span> <span class="free">vs</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> the_trivial_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> bool.splits<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> the_equality <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">P</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem"><span class="skolem">P</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">vs</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SSA_CFG_code-the_trivial_SomeE"><span class="command">lemma</span></span> the_trivial_SomeE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"the_trivial <span class="free">v</span> <span class="free">vs</span> <span class="main">=</span> Some <span class="free">v'</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">v'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">v'</span><span class="main">}</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">v'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">atomize_elim</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> the_trivial_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> if_splits<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">v'</span><span class="main">.</span> <span class="bound">v'</span> <span class="main">∈</span> set <span class="free">vs</span> <span class="main">∧</span> <span class="bound">v'</span> <span class="main">≠</span> <span class="free">v</span> <span class="main">∧</span> set <span class="free">vs</span> <span class="main">-</span> <span class="main">{</span><span class="bound">v'</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">v'</span><span class="main">.</span> <span class="bound">v'</span> <span class="main">≠</span> <span class="free">v</span><span class="main">)</span> <span class="free">vs</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_double_filter_hd set_single_hd set_minus_one<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_SSA_wf_base_code <span class="main">=</span> CFG_SSA_base_code <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span>
  <span class="main">+</span> CFG_SSA_wf_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"usesOf <span class="main">∘</span> <span class="free">uses</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Entry</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span><span class="main">::</span>linorder set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span> set<span class="main">)</span> mapping"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">phis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis_code"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">trivial_code</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">::</span><span class="tfree">'val</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">=</span> <span class="main">(</span>the_trivial <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">≠</span> None<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span><span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">trivial_phis</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> Set.filter <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> trivial_code <span class="bound">v</span> <span class="main">(</span>the <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">redundant_code</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span>trivial_phis <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_SSA_wf_code <span class="main">=</span> CFG_SSA_code <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span>
  <span class="main">+</span> CFG_SSA_wf_base_code <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span>
  <span class="main">+</span> CFG_SSA_wf <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"usesOf <span class="main">∘</span> <span class="free">uses</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Entry</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span><span class="main">::</span>linorder set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span> set<span class="main">)</span> mapping"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">phis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis_code"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="SSA_CFG_code-trivial_code"><span class="command">lemma</span></span> trivial_code<span class="main">:</span>
    <span class="quoted"><span class="quoted">"phi <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> Some <span class="free">vs</span> <span class="main">⟹</span> trivial <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> trivial_code <span class="free">v</span> <span class="free">vs</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> trivial_def trivial_code_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> isTrivialPhi_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> the_trivial_conv <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> the_trivial_conv <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> the_trivial_SomeE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> phiArg_in_allVars<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phiArg_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> v'<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">v'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> phiArg_in_allVars<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phiArg_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="SSA_CFG_code-trivial_phis"><span class="command">lemma</span></span> trivial_phis<span class="main">:</span>
    <span class="quoted"><span class="quoted">"trivial_phis <span class="free">g</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">≠</span> None <span class="main">∧</span> trivial <span class="free">g</span> <span class="bound">v</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> trivial_phis_def Set.filter_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> phi_def keys_dom_lookup<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> trivial_code<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def trivial_in_allVars phis_phi<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> trivial_phi<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trivial_code phi_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> phis_phi<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="SSA_CFG_code-redundant_code"><span class="command">lemma</span></span> redundant_code<span class="main">:</span>
    <span class="quoted"><span class="quoted">"redundant <span class="free">g</span> <span class="main">=</span> redundant_code <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> redundant_def redundant_code_def trivial_phis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def trivial_in_allVars<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> trivial_phi<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phi_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="SSA_CFG_code-trivial_code_mapI"><span class="command">lemma</span></span> trivial_code_mapI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> trivial_code <span class="free">v</span> <span class="free">vs</span><span class="main">;</span> <span class="free">f</span> <span class="main">`</span> <span class="main">(</span>set <span class="free">vs</span> <span class="main">-</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span> <span class="main">;</span> <span class="free">f</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v</span> <span class="main">⟧</span> <span class="main">⟹</span> trivial_code <span class="free">v</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> trivial_code_def the_trivial_conv
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

  <span class="keyword1" id="SSA_CFG_code-trivial_code_map_conv"><span class="command">lemma</span></span> trivial_code_map_conv<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v</span> <span class="main">⟹</span> trivial_code <span class="free">v</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">vs</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v'</span><span class="main">∈</span>set <span class="free">vs</span><span class="main">.</span> <span class="free">f</span> <span class="bound">v'</span> <span class="main">≠</span> <span class="free">v</span> <span class="main">∧</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> set <span class="free">vs</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span> <span class="bound">v'</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> trivial_code_def the_trivial_conv
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_SSA_Transformed_code <span class="main">=</span> ssa<span class="main">:</span> CFG_SSA_wf_code <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span>
   <span class="main">+</span>
   CFG_SSA_Transformed <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"usesOf <span class="main">∘</span> <span class="free">uses</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">var</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Entry</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">oldDefs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">oldUses</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span> set<span class="main">)</span> mapping"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">phis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis_code"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'val</span> <span class="main">⇒</span> <span class="tfree">'var</span>"</span></span>
<span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span> dom_uses_in_graph<span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.keys <span class="main">(</span><span class="free">uses</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Construct_SSA_code">
<div class="head">
<h1>Theory Construct_SSA_code</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Construct_SSA_code.thy
    Author:     Denis Lohner, Sebastian Ullrich
*)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Code Equations for SSA Construction›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Construct_SSA_code <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#SSA_CFG_code">SSA_CFG_code</a>
  <a href="#Construct_SSA">Construct_SSA</a>
  <a href="#Mapping_Exts">Mapping_Exts</a>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Product_Lexorder.html">HOL-Library.Product_Lexorder</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span><span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">lookup_multimap</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span> <span class="main">(</span>case_option <span class="main">{}</span> id <span class="main">(</span>Mapping.lookup <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_Construct_linorder <span class="main">=</span> CFG_Construct_wf <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Entry</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'var</span><span class="main">::</span>linorder<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'n</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> sparse_phis <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'n</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'n</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> ssaVal list<span class="main">)</span> mapping"</span></span>

  <span class="keyword1"><span class="command">function</span></span> <span class="entity">readVariableRecursive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'var</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">)</span> sparse_phis <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">)</span> ssaVal <span class="main">×</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">)</span> sparse_phis<span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">readArgs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'var</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">)</span> sparse_phis <span class="main">⇒</span> <span class="tfree">'node</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">)</span> sparse_phis <span class="main">×</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">)</span> ssaVal list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span><span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">readVariableRecursive</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">phis</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> <span class="free">defs</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span>SimpleDef<span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">phis</span></span></span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="keyword1">case</span> predecessors <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">of</span>
      <span class="main">[]</span>  <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span>PhiDef<span class="main">)</span><span class="main">,</span> Mapping.update <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">phis</span></span></span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span><span class="bound">m</span><span class="main">]</span> <span class="main">⇒</span> <span class="free">readVariableRecursive</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="bound">m</span> <span class="free"><span class="bound"><span class="entity">phis</span></span></span>
    <span class="main">|</span> <span class="bound">ms</span>  <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> Mapping.lookup <span class="free"><span class="bound"><span class="entity">phis</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="keyword1">of</span>
        Some <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span>PhiDef<span class="main">)</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">phis</span></span></span><span class="main">)</span>
      <span class="main">|</span> None <span class="main">⇒</span>
        <span class="keyword1">let</span> <span class="bound">phis</span> <span class="main">=</span> Mapping.update <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">phis</span></span></span> <span class="keyword1">in</span>
        <span class="keyword1">let</span> <span class="main">(</span><span class="bound">phis</span><span class="main">,</span><span class="bound">args</span><span class="main">)</span> <span class="main">=</span> <span class="free">readArgs</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="bound">phis</span> <span class="bound">ms</span> <span class="keyword1">in</span>
        <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span>PhiDef<span class="main">)</span><span class="main">,</span> Mapping.update <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="bound">args</span> <span class="bound">phis</span><span class="main">)</span>
  <span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">readArgs</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">phis</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">phis</span></span></span><span class="main">,</span><span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">readArgs</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">phis</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ms</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
      <span class="keyword1">let</span> <span class="main">(</span><span class="bound">phis</span><span class="main">,</span><span class="bound">args</span><span class="main">)</span> <span class="main">=</span> <span class="free">readArgs</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">phis</span></span></span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span> <span class="keyword1">in</span>
      <span class="keyword1">let</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span><span class="bound">phis</span><span class="main">)</span> <span class="main">=</span> <span class="free">readVariableRecursive</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="bound">phis</span> <span class="keyword1">in</span>
      <span class="main">(</span><span class="bound">phis</span><span class="main">,</span><span class="bound">v</span><span class="main">#</span><span class="bound">args</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>

  <span class="keyword1" id="Construct_SSA_code-length_filter_less2"><span class="command">lemma</span></span> length_filter_less2<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">P</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>filter <span class="free">P</span> <span class="free">xs</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>filter <span class="free">Q</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">P</span> <span class="free">xs</span> <span class="main">=</span> filter <span class="free">P</span> <span class="main">(</span>filter <span class="free">Q</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="main">...</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>filter <span class="free">Q</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> length_filter_less<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_code-length_filter_le2"><span class="command">lemma</span></span> length_filter_le2<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>filter <span class="free">P</span> <span class="free">xs</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span>filter <span class="free">Q</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">P</span> <span class="free">xs</span> <span class="main">=</span> filter <span class="free">P</span> <span class="main">(</span>filter <span class="free">Q</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="main">...</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span>filter <span class="free">Q</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> length_filter_le<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis_measure</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">phis</span></span></span> <span class="main">≡</span> length <span class="main">[</span><span class="bound">n</span> <span class="main">←</span> <span class="free">αn</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">.</span> Mapping.lookup <span class="free"><span class="bound"><span class="entity">phis</span></span></span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">=</span> None<span class="main">]</span>"</span></span>

  <span class="keyword1" id="Construct_SSA_code-phis_measure_update_le"><span class="command">lemma</span></span> phis_measure_update_le<span class="main">:</span> <span class="quoted"><span class="quoted">"phis_measure <span class="free">g</span> <span class="free">v</span> <span class="main">(</span>Mapping.update <span class="free">k</span> <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> phis_measure <span class="free">g</span> <span class="free">v</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> length_filter_le2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="improper">x</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_update lookup_update_neq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="Construct_SSA_code-phis_measure_update_le'"><span class="command">lemma</span></span> phis_measure_update_le'<span class="main">:</span> <span class="quoted"><span class="quoted">"phis_measure <span class="free">g</span> <span class="free">v</span> <span class="free">p</span> <span class="main">≤</span> phis_measure <span class="free">g</span> <span class="free">v</span> <span class="main">(</span>Mapping.update <span class="free">k</span> <span class="main">[]</span> <span class="free">phis</span><span class="main">)</span> <span class="main">⟹</span>
       phis_measure <span class="free">g</span> <span class="free">v</span> <span class="main">(</span>Mapping.update <span class="free">k</span> <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> phis_measure <span class="free">g</span> <span class="free">v</span> <span class="free">phis</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> phis_measure_update_le<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> phis_measure_update_le<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="Construct_SSA_code-readArgs_phis_le"><span class="command">lemma</span></span> readArgs_phis_le<span class="main">:</span>
    <span class="quoted"><span class="quoted">"readVariableRecursive_readArgs_dom <span class="main">(</span>Inl <span class="main">(</span><span class="free">g</span><span class="main">,</span> <span class="free">v</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">phis</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">val</span><span class="main">,</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> readVariableRecursive <span class="free">g</span> <span class="free">v</span> <span class="free">n</span> <span class="free">phis</span> <span class="main">⟹</span> phis_measure <span class="free">g</span> <span class="free">v</span> <span class="free">p</span> <span class="main">≤</span> phis_measure <span class="free">g</span> <span class="free">v</span> <span class="free">phis</span>"</span></span>
    <span class="quoted"><span class="quoted">"readVariableRecursive_readArgs_dom <span class="main">(</span>Inr <span class="main">(</span><span class="free">g</span><span class="main">,</span> <span class="free">v</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">phis</span><span class="main">,</span> <span class="free">ms</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">u</span><span class="main">)</span> <span class="main">=</span> readArgs <span class="free">g</span> <span class="free">v</span> <span class="free">n</span> <span class="free">phis</span> <span class="free">ms</span> <span class="main">⟹</span> phis_measure <span class="free">g</span> <span class="free">v</span> <span class="free">p</span> <span class="main">≤</span> phis_measure <span class="free">g</span> <span class="free">v</span> <span class="free">phis</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">val</span></span> <span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> readVariableRecursive_readArgs.pinduct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">g</span> <span class="skolem">v</span> <span class="skolem">n</span> <span class="skolem">phis</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.IH"</span><span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="quoted">"1.prems"</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> readVariableRecursive.psimps Let_def phis_measure_update_le <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm list.splits option.splits prod.splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"phis_measure <span class="skolem">g</span> <span class="skolem">v</span> <span class="improper">x1</span> <span class="main">≤</span> phis_measure <span class="skolem">g</span> <span class="skolem">v</span> <span class="main">(</span>Mapping.update <span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">[]</span> <span class="skolem">phis</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted">"1.IH"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phis_measure_update_le'<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">g</span> <span class="skolem">v</span> <span class="skolem">n</span> <span class="skolem">m</span> <span class="skolem">ms</span> <span class="skolem">phis</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"3.IH"</span><span class="main">(</span>1<span class="main">)</span> <span class="quoted">"3.prems"</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> readArgs.psimps <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted">"3.IH"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted">"3.IH"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> readArgs.psimps <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>

  <span class="keyword1"><span class="command">termination</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measures <span class="main">[</span>
    <span class="main">λ</span><span class="bound">args</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">v</span><span class="main">,</span><span class="bound">phis</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">case</span> <span class="bound">args</span> <span class="keyword1">of</span> Inl<span class="main">(</span><span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">v</span><span class="main">,</span><span class="bound">n</span><span class="main">,</span><span class="bound">phis</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">v</span><span class="main">,</span><span class="bound">phis</span><span class="main">)</span> <span class="main">|</span> Inr<span class="main">(</span><span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">v</span><span class="main">,</span><span class="bound">n</span><span class="main">,</span><span class="bound">phis</span><span class="main">,</span><span class="bound">ms</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">v</span><span class="main">,</span><span class="bound">phis</span><span class="main">)</span> <span class="keyword1">in</span>
      phis_measure <span class="bound">g</span> <span class="bound">v</span> <span class="bound">phis</span><span class="main">,</span>
    <span class="main">λ</span><span class="bound">args</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">args</span> <span class="keyword1">of</span> Inl<span class="main">(</span><span class="main"><span class="bound">_</span></span><span class="main">)</span> <span class="main">⇒</span> <span class="main">0</span> <span class="main">|</span> Inr<span class="main">(</span><span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">v</span><span class="main">,</span><span class="bound">n</span><span class="main">,</span><span class="bound">phis</span><span class="main">,</span><span class="bound">ms</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> length <span class="bound">ms</span><span class="main">,</span>
    <span class="main">λ</span><span class="bound">args</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">case</span> <span class="bound">args</span> <span class="keyword1">of</span> Inl<span class="main">(</span><span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">v</span><span class="main">,</span><span class="bound">n</span><span class="main">,</span><span class="bound">phis</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">|</span> Inr<span class="main">(</span><span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">v</span><span class="main">,</span><span class="bound">n</span><span class="main">,</span><span class="bound">ms</span><span class="main">,</span><span class="bound">phis</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="keyword1">in</span>
      shortestPath <span class="bound">g</span> <span class="bound">n</span>
    <span class="main">]</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> shortestPath_single_predecessor<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> length_filter_less2<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> successor_in_αn<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_update<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span><span class="main">=</span><span class="improper">n</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_update_neq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> readArgs_phis_le<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">declare</span></span> readVariableRecursive.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> readArgs.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword">del</span></span><span class="main">]</span>

  <span class="keyword1" id="Construct_SSA_code-fst_readVariableRecursive"><span class="command">lemma</span></span> fst_readVariableRecursive<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>readVariableRecursive <span class="free">g</span> <span class="free">v</span> <span class="free">n</span> <span class="free">phis</span><span class="main">)</span> <span class="main">=</span> lookupDef <span class="free">g</span> <span class="free">n</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> lookupDef_induct<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> v<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">v</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> readVariableRecursive.simps<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> readVariableRecursive.simps<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> split_def Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.split option.split<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> readVariableRecursive.simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis'_aux</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">phis</span></span></span><span class="main">::</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span><span class="tfree">'var</span><span class="main">)</span> sparse_phis<span class="main">)</span> <span class="main">≡</span> Mapping.Mapping <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">v<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">.</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="bound">v<span class="hidden">⇩</span><sub>2</sub></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">(</span>phiDefNodes_aux <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">[</span><span class="bound">n</span> <span class="main">←</span> <span class="free">αn</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">∉</span> Mapping.keys <span class="free"><span class="bound"><span class="entity">phis</span></span></span><span class="main">]</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> vars <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="keyword1">then</span> Some <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> lookupDef <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">m</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">(</span>predecessors <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span>Mapping.lookup <span class="free"><span class="bound"><span class="entity">phis</span></span></span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">v<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="Construct_SSA_code-phis'_aux_keys_super"><span class="command">lemma</span></span> phis'_aux_keys_super<span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.keys <span class="main">(</span>phis'_aux <span class="free">g</span> <span class="free">v</span> <span class="free">ns</span> <span class="free">phis</span><span class="main">)</span> <span class="main">⊇</span> Mapping.keys <span class="free">phis</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup phis'_aux_def<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_code-phiDefNodes_aux_in_unvisited"><span class="command">lemma</span></span> phiDefNodes_aux_in_unvisited<span class="main">:</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="free">un</span> <span class="free">n</span> <span class="main">⊆</span> set <span class="free">un</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">un</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>removeAll_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">un</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> phiDefNodes_aux.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fold_union_elem<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> m n'<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x2<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n2<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> 1<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> m n'<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x2<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n2<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> 1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_code-phiDefNodes_aux_unvisited_monotonic"><span class="command">lemma</span></span> phiDefNodes_aux_unvisited_monotonic<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">un</span> <span class="main">⊆</span> set <span class="free">un'</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="free">un</span> <span class="free">n</span> <span class="main">⊆</span> phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="free">un'</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">un</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">un'</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>removeAll_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">un</span><span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">A</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="skolem">un</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="main">(</span>removeAll <span class="skolem">n</span> <span class="skolem">un</span><span class="main">)</span> <span class="bound">m</span> <span class="main">⊆</span> phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="main">(</span>removeAll <span class="skolem">n</span> <span class="skolem">un'</span><span class="main">)</span> <span class="bound">m</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> fold <span class="main">(∪)</span> <span class="main">(</span>map <span class="main">(</span>phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="main">(</span>removeAll <span class="skolem">n</span> <span class="skolem">un</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>predecessors <span class="free">g</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> fold <span class="main">(∪)</span> <span class="main">(</span>map <span class="main">(</span>phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="main">(</span>removeAll <span class="skolem">n</span> <span class="skolem">un'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>predecessors <span class="free">g</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> fold_union_elem<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> fold_union_elemI'<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> a<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> subsetD<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> phiDefNodes_aux.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_code-phiDefNodes_aux_single_pred"><span class="command">lemma</span></span> phiDefNodes_aux_single_pred<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"predecessors <span class="free">g</span> <span class="free">n</span> <span class="main">=</span> <span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="main">(</span>removeAll <span class="free">n</span> <span class="free">un</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="free">un</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n'</span> <span class="skolem">ns</span>
      <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">n'</span><span class="main">-</span><span class="skolem">ns</span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">ns</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>predecessors <span class="free">g</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> split<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="skolem">n'</span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">→</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span><span class="main">→</span><span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ns</span> <span class="main">=</span> butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="skolem">ns<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> path2_split_ex<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹distinct <span class="skolem">ns</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> path2_last_in_ns<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> split<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> path2_unsnoc<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> path2_nontrivial<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> assms asm<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> path2_not_Nil<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> phiDefNodes_aux_unvisited_monotonic<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> n'<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> phiDefNodes_auxE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> predecessor_is_node<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">n</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> phiDefNodes_auxI<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_code-phis'_aux_finite"><span class="command">lemma</span></span> phis'_aux_finite<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Mapping.keys <span class="free">phis</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Mapping.keys <span class="main">(</span>phis'_aux <span class="free">g</span> <span class="free">v</span> <span class="free">ns</span> <span class="free">phis</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="main">[</span><span class="bound">n</span><span class="main">←</span><span class="free">αn</span> <span class="free">g</span> <span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="main">∉</span> dom <span class="main">(</span>Mapping.lookup <span class="free">phis</span><span class="main">)</span><span class="main">]</span> <span class="bound">n</span> <span class="main">⊆</span> <span class="main">(</span>set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> phiDefNodes_aux_in_unvisited<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Mapping.keys <span class="main">(</span>phis'_aux <span class="free">g</span> <span class="free">v</span> <span class="free">ns</span> <span class="free">phis</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">×</span> vars <span class="free">g</span> <span class="main">∪</span> Mapping.keys <span class="free">phis</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phis'_aux_def keys_dom_lookup <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_code-phiDefNodes_aux_redirect"><span class="command">lemma</span></span> phiDefNodes_aux_redirect<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="free">ns</span><span class="main">→</span><span class="free">m</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set <span class="free">ns</span><span class="main">.</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">n</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"unvisitedPath <span class="free">un</span> <span class="free">ns</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> n'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">∈</span> set <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">∈</span> phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="free">un</span> <span class="free">m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> phiDefNodes_aux <span class="free">g</span> <span class="free">v</span> <span class="free">un</span> <span class="free">m'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> asm<span class="main">(</span>1<span class="main">)</span> n'<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span><span class="main">→</span><span class="free">n'</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊆</span> set <span class="free">ns</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> path2_split_ex<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> n'<span class="main">(</span>2-3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n'</span><span class="main">-</span><span class="skolem">ns'</span><span class="main">→</span><span class="free">m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set <span class="skolem">ns'</span><span class="main">.</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="free">g</span> <span class="bound">n</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>predecessors <span class="free">g</span> <span class="free">n'</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
      <span class="quoted"><span class="quoted">"unvisitedPath <span class="free">un</span> <span class="skolem">ns'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phiDefNodes_auxE<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> ns<span class="hidden">⇩</span><sub>1</sub><span class="main">(</span>1<span class="main">)</span> ns'<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ms</span></span> <span class="keyword2"><span class="keyword">where</span></span> ms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">n</span><span class="main">-</span><span class="skolem">ms</span><span class="main">→</span><span class="free">m'</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">ms</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ms</span> <span class="main">⊆</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> set <span class="main">(</span>tl <span class="skolem">ns'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">drule</span> path2_app<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> simple_path2<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> phiDefNodes_auxI<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> ms asm<span class="main">(</span>4<span class="main">)</span> ns<span class="hidden">⇩</span><sub>1</sub><span class="main">(</span>2<span class="main">)</span> ns'<span class="main">(</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">∈</span> set <span class="skolem">ns<span class="hidden">⇩</span><sub>1</sub></span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"set <span class="free">ns</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subsetD<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"set <span class="skolem">ns'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subsetD<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> asm<span class="main">(</span>2-3<span class="main">)</span> ns<span class="hidden">⇩</span><sub>1</sub><span class="main">(</span>2<span class="main">)</span> ns'<span class="main">(</span>2<span class="main">)</span> ms<span class="main">(</span>3<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bspec<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_code-snd_readVariableRecursive"><span class="command">lemma</span></span> snd_readVariableRecursive<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> vars <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Mapping.keys <span class="free">phis</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> Mapping.keys <span class="free">phis</span> <span class="main">⟹</span> length <span class="main">(</span>predecessors <span class="free">g</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="free">phis</span> <span class="main">(</span><span class="free">Entry</span> <span class="free">g</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span>None<span class="main">,</span> Some <span class="main">[]</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>
      <span class="quoted"><span class="quoted">"phis'_aux <span class="free">g</span> <span class="free">v</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span> <span class="free">phis</span> <span class="main">=</span> snd <span class="main">(</span>readVariableRecursive <span class="free">g</span> <span class="free">v</span> <span class="free">n</span> <span class="free">phis</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>phis'_aux <span class="free">g</span> <span class="free">v</span> <span class="main">(</span>set <span class="free">ms</span><span class="main">)</span> <span class="free">phis</span><span class="main">,</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> lookupDef <span class="free">g</span> <span class="bound">m</span> <span class="free">v</span><span class="main">)</span> <span class="free">ms</span><span class="main">)</span> <span class="main">=</span> readArgs <span class="free">g</span> <span class="free">v</span> <span class="free">n</span> <span class="free">phis</span> <span class="free">ms</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">phis</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">phis</span></span> <span class="quoted"><span class="free">ms</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> readVariableRecursive_readArgs.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">g</span> <span class="skolem">v</span> <span class="skolem">n</span> <span class="skolem">phis</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>1-3<span class="main">)</span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
    <span class="keyword1"><span class="command">note</span></span> phis_wf <span class="main">=</span> <span class="quoted">"1.prems"</span><span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Entry</span> <span class="skolem">g</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> Mapping.keys <span class="skolem">phis</span> <span class="main">⟹</span> Mapping.lookup <span class="skolem">phis</span> <span class="main">(</span><span class="free">Entry</span> <span class="skolem">g</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> IH1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="skolem">g</span> <span class="skolem">n</span> <span class="main">⟹</span> predecessors <span class="skolem">g</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">[</span><span class="bound">m</span><span class="main">]</span> <span class="main">⟹</span> phis'_aux <span class="skolem">g</span> <span class="skolem">v</span> <span class="main">{</span><span class="bound">m</span><span class="main">}</span> <span class="skolem">phis</span> <span class="main">=</span> snd <span class="main">(</span>readVariableRecursive <span class="skolem">g</span> <span class="skolem">v</span> <span class="bound">m</span> <span class="skolem">phis</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted">"1.IH"</span><span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>4<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> n'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> predecessor_is_node<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>5<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> phis_wf<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">m<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'node</span></span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ms'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'node</span> list"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ms</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">m<span class="hidden">⇩</span><sub>1</sub></span><span class="main">#</span><span class="skolem">m<span class="hidden">⇩</span><sub>2</sub></span><span class="main">#</span><span class="skolem">ms'</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?phis'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Mapping.update <span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">[]</span> <span class="skolem">phis</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> <span class="free">defs</span> <span class="skolem">g</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"predecessors <span class="skolem">g</span> <span class="skolem">n</span> <span class="main">=</span> <span class="var">?ms</span>"</span></span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="skolem">phis</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?ms</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">αn</span> <span class="skolem">g</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> predecessor_is_node<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> asm<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"readArgs <span class="skolem">g</span> <span class="skolem">v</span> <span class="skolem">n</span> <span class="var">?phis'</span> <span class="var">?ms</span> <span class="main">=</span> <span class="main">(</span>phis'_aux <span class="skolem">g</span> <span class="skolem">v</span> <span class="main">(</span>set <span class="var">?ms</span><span class="main">)</span> <span class="var">?phis'</span><span class="main">,</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> lookupDef <span class="skolem">g</span> <span class="bound">m</span> <span class="skolem">v</span><span class="main">)</span> <span class="var">?ms</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span><span class="main">(</span>5<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted">"1.IH"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> phis_wf <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_update_cases<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">note</span></span> IH2 <span class="main">=</span> this

    <span class="keyword1"><span class="command">note</span></span> foldr_Cons<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> fold_Cons<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> list.map<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> set_simps<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

    <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⋃</span><span class="main">(</span><span class="bound">f</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="bound">f</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> phis'_aux_def c
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> readVariableRecursive.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> phiDefNodes_aux.simps<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"predecessors <span class="skolem">g</span> <span class="skolem">n</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a Mapping_eq_lookup lookup_update_cases Entry_iff_unreachable<span class="main"><span class="main">[</span></span><span class="operator">OF</span> invar<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.split <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> m<span class="hidden">⇩</span><sub>1</sub> ms<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">ms</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Mapping_eq_lookup<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fold_Cons list.map<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> phis_wf<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> IH1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phis'_aux_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> rev_subsetD<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> phiDefNodes_aux_unvisited_monotonic<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> un'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">n</span><span class="main">←</span><span class="free">αn</span> <span class="skolem">g</span> <span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> Mapping.keys <span class="skolem">phis</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> IH1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phis'_aux_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> IH1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phis'_aux_def phiDefNodes_aux_single_pred<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Mapping_eq_lookup lookup_update_cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split prod.split<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> IH2<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> fold_union_elem<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_update_cases phis'_aux_def<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> rev_subsetD<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> phiDefNodes_aux_unvisited_monotonic<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> un'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">n'</span><span class="main">←</span><span class="free">αn</span> <span class="skolem">g</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">≠</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">n'</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> Mapping.keys <span class="skolem">phis</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> rev_subsetD<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> phiDefNodes_aux_unvisited_monotonic<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> un'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">n'</span><span class="main">←</span><span class="free">αn</span> <span class="skolem">g</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">≠</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">n'</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> Mapping.keys <span class="skolem">phis</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> m<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> rev_subsetD<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> phiDefNodes_aux_unvisited_monotonic<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> un'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">n'</span><span class="main">←</span><span class="free">αn</span> <span class="skolem">g</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">≠</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">n'</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> Mapping.keys <span class="skolem">phis</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> IH2<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split prod.split<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> IH2<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_update_neq phis'_aux_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits prod.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> IH2<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_update_cases phis'_aux_def removeAll_filter_not_eq image_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> fold_union_elemI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>3<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> fold_union_elemI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">x</span><span class="main">←</span><span class="free">αn</span> <span class="skolem">g</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> Mapping.keys <span class="skolem">phis</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="bound">x</span><span class="main">←</span><span class="free">αn</span> <span class="skolem">g</span> <span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> Mapping.keys <span class="skolem">phis</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="bound">x</span><span class="main">]</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">filter</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> fold_union_elemI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">x</span><span class="main">←</span><span class="free">αn</span> <span class="skolem">g</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> Mapping.keys <span class="skolem">phis</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="bound">x</span><span class="main">←</span><span class="free">αn</span> <span class="skolem">g</span> <span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> Mapping.keys <span class="skolem">phis</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="bound">x</span><span class="main">]</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">filter</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> fold_union_elemI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">x</span><span class="main">←</span><span class="free">αn</span> <span class="skolem">g</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> Mapping.keys <span class="skolem">phis</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="bound">x</span><span class="main">←</span><span class="free">αn</span> <span class="skolem">g</span> <span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> Mapping.keys <span class="skolem">phis</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="bound">x</span><span class="main">]</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">filter</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">g</span> <span class="skolem">v</span> <span class="skolem">n</span> <span class="skolem">phis</span> <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> <span class="quoted">"3.prems"</span><span class="main">(</span>2-4<span class="main">)</span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"3.prems"</span><span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> IH1<span class="main">:</span> <span class="quoted"><span class="quoted">"readArgs <span class="skolem">g</span> <span class="skolem">v</span> <span class="skolem">n</span> <span class="skolem">phis</span> <span class="skolem">ms</span> <span class="main">=</span> <span class="main">(</span>phis'_aux <span class="skolem">g</span> <span class="skolem">v</span> <span class="main">(</span>set <span class="skolem">ms</span><span class="main">)</span> <span class="skolem">phis</span><span class="main">,</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> lookupDef <span class="skolem">g</span> <span class="bound">m</span> <span class="skolem">v</span><span class="main">)</span> <span class="skolem">ms</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> IH2<span class="main">:</span> <span class="quoted"><span class="quoted">"phis'_aux <span class="skolem">g</span> <span class="skolem">v</span> <span class="main">{</span><span class="skolem">m</span><span class="main">}</span> <span class="main">(</span>phis'_aux <span class="skolem">g</span> <span class="skolem">v</span> <span class="main">(</span>set <span class="skolem">ms</span><span class="main">)</span> <span class="skolem">phis</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>readVariableRecursive <span class="skolem">g</span> <span class="skolem">v</span> <span class="skolem">m</span> <span class="main">(</span>phis'_aux <span class="skolem">g</span> <span class="skolem">v</span> <span class="main">(</span>set <span class="skolem">ms</span><span class="main">)</span> <span class="skolem">phis</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted">"3.IH"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> IH1 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> phis'_aux_finite<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>5<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> phis'_aux_def keys_dom_lookup dom_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> phiDefNodes_auxE<span class="main">)</span>
       <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"3.prems"</span><span class="main">(</span>1<span class="main">,</span>5<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>3<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"3.prems"</span><span class="main">(</span>6<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phis'_aux_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

    <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"phiDefNodes_aux <span class="skolem">g</span> <span class="skolem">v</span> <span class="main">[</span><span class="bound">n</span><span class="main">←</span><span class="free">αn</span> <span class="skolem">g</span> <span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> Mapping.keys <span class="main">(</span>phis'_aux <span class="skolem">g</span> <span class="skolem">v</span> <span class="main">(</span>set <span class="skolem">ms</span><span class="main">)</span> <span class="skolem">phis</span><span class="main">)</span><span class="main">]</span> <span class="skolem">m</span> <span class="main">⊆</span> phiDefNodes_aux <span class="skolem">g</span> <span class="skolem">v</span> <span class="main">[</span><span class="bound">n</span><span class="main">←</span><span class="free">αn</span> <span class="skolem">g</span> <span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> Mapping.keys <span class="skolem">phis</span><span class="main">]</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> phiDefNodes_aux_unvisited_monotonic<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> phis'_aux_keys_super<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> subsetD<span class="main"><span class="main">]</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
      <span class="keyword3"><span class="command">assume</span></span> m<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> phiDefNodes_aux <span class="skolem">g</span> <span class="skolem">v</span> <span class="main">[</span><span class="bound">n</span><span class="main">←</span><span class="free">αn</span> <span class="skolem">g</span> <span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> Mapping.keys <span class="skolem">phis</span><span class="main">]</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
             ms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="skolem">ms</span><span class="main">.</span> <span class="skolem">n</span> <span class="main">∉</span> phiDefNodes_aux <span class="skolem">g</span> <span class="skolem">v</span> <span class="main">[</span><span class="bound">n</span><span class="main">←</span><span class="free">αn</span> <span class="skolem">g</span> <span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> Mapping.keys <span class="skolem">phis</span><span class="main">]</span> <span class="bound">x</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> phiDefNodes_aux <span class="skolem">g</span> <span class="skolem">v</span> <span class="main">[</span><span class="bound">n</span><span class="main">←</span><span class="free">αn</span> <span class="skolem">g</span> <span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> Mapping.keys <span class="main">(</span>phis'_aux <span class="skolem">g</span> <span class="skolem">v</span> <span class="main">(</span>set <span class="skolem">ms</span><span class="main">)</span> <span class="skolem">phis</span><span class="main">)</span><span class="main">]</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> m
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> phiDefNodes_auxE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> phiDefNodes_auxI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phis'_aux_def keys_dom_lookup <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>3<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> phiDefNodes_aux_redirect<span class="main">)</span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"3.prems"</span><span class="main">(</span>1<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>6<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ms<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> ballE<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">note</span></span> b <span class="main">=</span> this

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> readArgs.simps phis'_aux_def
    <span class="keyword1"><span class="command">unfolding</span></span> IH1
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_def Let_def IH2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> phis'_aux_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> phis'_aux_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Mapping_eq_lookup fst_readVariableRecursive <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> a<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> subsetD<span class="main"><span class="main">]</span></span> b<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> readArgs.simps phis'_aux_def<span class="main">)</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">aux_1</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v</span> <span class="main">(</span><span class="bound">uses</span><span class="main">,</span><span class="bound">phis</span><span class="main">)</span><span class="main">.</span>
    <span class="keyword1">let</span> <span class="main">(</span><span class="bound">use</span><span class="main">,</span><span class="bound">phis'</span><span class="main">)</span> <span class="main">=</span> readVariableRecursive <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">v</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="bound">phis</span> <span class="keyword1">in</span>
    <span class="main">(</span>Mapping.update <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>insert <span class="bound">use</span> <span class="main">(</span>lookup_multimap <span class="bound">uses</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="bound">uses</span><span class="main">,</span> <span class="bound">phis'</span><span class="main">)</span>
  <span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">aux_2</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> foldr <span class="main">(</span>aux_1 <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>sorted_list_of_set <span class="main">(</span><span class="free">uses</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">init_state</span> <span class="main">≡</span> <span class="main">(</span>Mapping.empty<span class="main">,</span> Mapping.empty<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">from_sparse</span> <span class="main">≡</span> <span class="main">λ</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="main">(</span><span class="bound">v</span><span class="main">,</span><span class="bound">n</span><span class="main">,</span>PhiDef<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses'_phis'</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">let</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span> <span class="main">=</span> foldr <span class="main">(</span>aux_2 <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">αn</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> init_state <span class="keyword1">in</span>
    <span class="main">(</span><span class="bound">u</span><span class="main">,</span> map_keys from_sparse <span class="bound">p</span><span class="main">)</span>
  <span class="main">)</span>"</span></span>

  <span class="keyword1" id="Construct_SSA_code-from_sparse_inj"><span class="command">lemma</span></span> from_sparse_inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj from_sparse"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> injI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">declare</span></span> uses'_phis'_def<span class="main">[</span><span class="operator">unfolded</span> aux_2_def<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> aux_1_def<span class="main">,</span> <span class="operator">code</span><span class="main">]</span>

  <span class="keyword1"><span class="command">lift_definition</span></span> phis'_code <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">)</span> ssaVal<span class="main">)</span> phis_code"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">phis'</span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1" id="Construct_SSA_code-foldr_prod"><span class="command">lemma</span></span> foldr_prod<span class="main">:</span> <span class="quoted"><span class="quoted">"foldr <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">f1</span> <span class="bound">x</span> <span class="main">(</span>fst <span class="bound">y</span><span class="main">)</span><span class="main">,</span> <span class="free">f2</span> <span class="bound">x</span> <span class="main">(</span>snd <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>foldr <span class="free">f1</span> <span class="free">xs</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span><span class="main">,</span> foldr <span class="free">f2</span> <span class="free">xs</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_code-foldr_aux_1"><span class="command">lemma</span></span> foldr_aux_1<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">⊆</span> <span class="free">uses</span> <span class="free">g</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="free">u</span> <span class="free">n</span> <span class="main">=</span> None"</span></span> <span class="quoted"><span class="quoted">"foldr <span class="main">(</span>aux_1 <span class="free">g</span> <span class="free">n</span><span class="main">)</span> <span class="free">us</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">u'</span><span class="main">,</span><span class="free">p'</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"foldr <span class="var">?f</span> <span class="main">_</span> <span class="main">_</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Mapping.keys <span class="free">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> Mapping.keys <span class="free">p</span> <span class="main">⟹</span> length <span class="main">(</span>predecessors <span class="free">g</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> Mapping.lookup <span class="free">p</span> <span class="main">(</span><span class="free">Entry</span> <span class="free">g</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span>None<span class="main">,</span> Some <span class="main">[]</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lookupDef <span class="free">g</span> <span class="free">n</span> <span class="main">`</span> set <span class="free">us</span> <span class="main">=</span> lookup_multimap <span class="free">u'</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">≠</span> <span class="free">n</span> <span class="main">⟹</span> Mapping.lookup <span class="free">u'</span> <span class="bound">m</span> <span class="main">=</span> Mapping.lookup <span class="free">u</span> <span class="bound">m</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">m</span> <span class="main">∈</span> phiDefNodes_aux <span class="free">g</span> <span class="bound">v</span> <span class="main">[</span><span class="bound">n</span> <span class="main">←</span> <span class="free">αn</span> <span class="free">g</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">∉</span> Mapping.keys <span class="free">p</span><span class="main">]</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> set <span class="free">us</span> <span class="keyword1">then</span>
        Some <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> lookupDef <span class="free">g</span> <span class="bound">m</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span>predecessors <span class="free">g</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span>
        <span class="main">(</span>Mapping.lookup <span class="free">p</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Mapping.lookup <span class="free">p'</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">us</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u'</span></span> <span class="quoted"><span class="free">p'</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v</span> <span class="skolem">us</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>foldr <span class="var">?f</span> <span class="skolem">us</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>foldr <span class="var">?f</span> <span class="skolem">us</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span> uses_in_αn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lookupDef <span class="free">g</span> <span class="free">n</span> <span class="skolem">v</span> <span class="main">=</span> fst <span class="main">(</span>readVariableRecursive <span class="free">g</span> <span class="skolem">v</span> <span class="free">n</span> <span class="var">?p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fst_readVariableRecursive<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookupDef <span class="free">g</span> <span class="free">n</span> <span class="main">`</span> set <span class="skolem">us</span> <span class="main">=</span> lookup_multimap <span class="var">?u</span> <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> aux_1_def split_def Let_def lookup_multimap_def lookup_update <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="var">?u</span> <span class="skolem">m</span> <span class="main">=</span> Mapping.lookup <span class="free">u</span> <span class="skolem">m</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> aux_1_def split_def Let_def lookup_multimap_def lookup_update_neq <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">m</span> <span class="skolem">v'</span> <span class="skolem">u'</span> <span class="skolem">p'</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> set <span class="skolem">us</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">∈</span> vars <span class="free">g</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span> <span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">m</span> <span class="main">∈</span> phiDefNodes_aux <span class="free">g</span> <span class="bound">v'</span> <span class="main">[</span><span class="bound">n</span> <span class="main">←</span> <span class="free">αn</span> <span class="free">g</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">v'</span><span class="main">)</span> <span class="main">∉</span> Mapping.keys <span class="free">p</span><span class="main">]</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">v'</span> <span class="main">∈</span> set <span class="skolem">us</span> <span class="keyword1">then</span>
        Some <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> lookupDef <span class="free">g</span> <span class="bound">m</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">(</span>predecessors <span class="free">g</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span>
        <span class="main">(</span>Mapping.lookup <span class="free">p</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">v'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Mapping.lookup <span class="var">?p</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">v'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> rVV<span class="main">:</span> <span class="quoted"><span class="quoted">"phis'_aux <span class="free">g</span> <span class="skolem">v</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span> <span class="var">?p</span> <span class="main">=</span> snd <span class="main">(</span>readVariableRecursive <span class="free">g</span> <span class="skolem">v</span> <span class="free">n</span> <span class="var">?p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> snd_readVariableRecursive<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command">using</span></span> 3
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uses_in_αn<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> B<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">×</span> vars <span class="free">g</span> <span class="main">∪</span> Mapping.keys <span class="free">p</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup IH<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> phiDefNodes_aux_in_unvisited<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> subsetD<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 3<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>5-6<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup dom_def IH<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> phiDefNode_aux_is_join_node<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

      <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> phiDefNodes_aux <span class="free">g</span> <span class="skolem">v</span> <span class="main">[</span><span class="bound">n</span><span class="main">←</span><span class="free">αn</span> <span class="free">g</span> <span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> Mapping.keys <span class="var">?p</span><span class="main">]</span> <span class="free">n</span> <span class="main">⟹</span> <span class="skolem">m</span> <span class="main">∈</span> phiDefNodes_aux <span class="free">g</span> <span class="skolem">v</span> <span class="main">[</span><span class="bound">n</span><span class="main">←</span><span class="free">αn</span> <span class="free">g</span> <span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> Mapping.keys <span class="free">p</span><span class="main">]</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rev_subsetD<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> phiDefNodes_aux_unvisited_monotonic<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> IH<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> keys_dom_lookup <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> set <span class="skolem">us</span> <span class="main">⟹</span> <span class="main">[</span><span class="bound">n</span><span class="main">←</span><span class="free">αn</span> <span class="free">g</span> <span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> Mapping.keys <span class="var">?p</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="bound">n</span><span class="main">←</span><span class="free">αn</span> <span class="free">g</span> <span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> Mapping.keys <span class="free">p</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">filter</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup IH<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> aux_1_def
      <span class="keyword1"><span class="command">unfolding</span></span> foldr.foldr_Cons
      <span class="keyword1"><span class="command">unfolding</span></span> aux_1_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def split_def IH<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> rVV<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> phis'_aux_def b <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> a uses_in_vars <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_multimap_def<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_code-foldr_aux_2"><span class="command">lemma</span></span> foldr_aux_2<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ns</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"foldr <span class="main">(</span>aux_2 <span class="free">g</span><span class="main">)</span> <span class="free">ns</span> init_state <span class="main">=</span> <span class="main">(</span><span class="free">u'</span><span class="main">,</span><span class="free">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="free">ns</span> <span class="main">⟹</span> uses' <span class="free">g</span> <span class="bound">n</span> <span class="main">=</span> lookup_multimap <span class="free">u'</span> <span class="bound">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∉</span> set <span class="free">ns</span> <span class="main">⟹</span> Mapping.lookup <span class="free">u'</span> <span class="bound">n</span> <span class="main">=</span> None"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> set <span class="free">ns</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> phiDefNodes_aux <span class="free">g</span> <span class="bound">v</span> <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="bound">n</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="bound">n</span> <span class="keyword1">then</span>
        Some <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> lookupDef <span class="free">g</span> <span class="bound">m</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span>predecessors <span class="free">g</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span>
        None<span class="main">)</span> <span class="main">=</span> Mapping.lookup <span class="free">p'</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ns</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u'</span></span> <span class="quoted"><span class="free">p'</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">n</span> <span class="skolem">ns</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>foldr <span class="main">(</span>aux_2 <span class="free">g</span><span class="main">)</span> <span class="skolem">ns</span> init_state<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>foldr <span class="main">(</span>aux_2 <span class="free">g</span><span class="main">)</span> <span class="skolem">ns</span> init_state<span class="main">)</span>"</span></span>

    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">u'</span> <span class="skolem">p'</span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">n</span><span class="main">#</span><span class="skolem">ns</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="skolem">n</span><span class="main">#</span><span class="skolem">ns</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"foldr <span class="main">(</span>aux_2 <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">n</span><span class="main">#</span><span class="skolem">ns</span><span class="main">)</span> init_state <span class="main">=</span> <span class="main">(</span><span class="skolem">u'</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> IH<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="skolem">ns</span> <span class="main">⟹</span> uses' <span class="free">g</span> <span class="bound">n</span> <span class="main">=</span> lookup_multimap <span class="var">?u</span> <span class="bound">n</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∉</span> set <span class="skolem">ns</span> <span class="main">⟹</span> Mapping.lookup <span class="var">?u</span> <span class="bound">n</span> <span class="main">=</span> None"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> set <span class="skolem">ns</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> phiDefNodes_aux <span class="free">g</span> <span class="bound">v</span> <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="bound">n</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="bound">n</span> <span class="keyword1">then</span>
        Some <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> lookupDef <span class="free">g</span> <span class="bound">m</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span>predecessors <span class="free">g</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span>
        None<span class="main">)</span> <span class="main">=</span> Mapping.lookup <span class="var">?p</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Cons.IH<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> p'2<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="var">?p</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Cons.IH<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> p'2<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="var">?p</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.IH<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> u'2<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="var">?u</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

    <span class="keyword1"><span class="command">with</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main">]</span> asm<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a'<span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="var">?u</span> <span class="skolem">n</span> <span class="main">=</span> None"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Mapping.keys <span class="var">?p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> B<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">×</span> vars <span class="free">g</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup IH<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> phiDefNodes_aux_in_unvisited<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> subsetD<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> Mapping.keys <span class="var">?p</span> <span class="main">⟹</span> length <span class="main">(</span>predecessors <span class="free">g</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup dom_def IH<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> phiDefNode_aux_is_join_node<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> Mapping.lookup <span class="var">?p</span> <span class="main">(</span><span class="free">Entry</span> <span class="free">g</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span>None<span class="main">,</span> Some <span class="main">[]</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> IH<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> aux_2<span class="main">:</span> <span class="quoted"><span class="quoted">"lookupDef <span class="free">g</span> <span class="skolem">n</span> <span class="main">`</span> <span class="free">uses</span> <span class="free">g</span> <span class="skolem">n</span> <span class="main">=</span> lookup_multimap <span class="skolem">u'</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">≠</span> <span class="skolem">n</span> <span class="main">⟹</span> Mapping.lookup <span class="skolem">u'</span> <span class="bound">m</span> <span class="main">=</span> Mapping.lookup <span class="var">?u</span> <span class="bound">m</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">m</span> <span class="main">∈</span> phiDefNodes_aux <span class="free">g</span> <span class="bound">v</span> <span class="main">[</span><span class="bound">n</span> <span class="main">←</span> <span class="free">αn</span> <span class="free">g</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">∉</span> Mapping.keys <span class="var">?p</span><span class="main">]</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="skolem">n</span> <span class="keyword1">then</span>
        Some <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> lookupDef <span class="free">g</span> <span class="bound">m</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span>predecessors <span class="free">g</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span>
        <span class="main">(</span>Mapping.lookup <span class="var">?p</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Mapping.lookup <span class="skolem">p'</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> foldr_aux_1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sorted_list_of_set <span class="main">(</span><span class="free">uses</span> <span class="free">g</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="quoted"><span class="skolem">u'</span></span> <span class="quoted"><span class="skolem">p'</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aux_2_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> asm<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> foldr_aux_1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sorted_list_of_set <span class="main">(</span><span class="free">uses</span> <span class="free">g</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="quoted"><span class="skolem">u'</span></span> <span class="quoted"><span class="skolem">p'</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aux_2_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> asm<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> foldr_aux_1<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sorted_list_of_set <span class="main">(</span><span class="free">uses</span> <span class="free">g</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="quoted"><span class="skolem">u'</span></span> <span class="quoted"><span class="skolem">p'</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aux_2_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> asm<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">n</span><span class="main">#</span><span class="skolem">ns</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"uses' <span class="free">g</span> <span class="skolem">m</span> <span class="main">=</span> lookup_multimap <span class="skolem">u'</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uses'_def aux_2<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 1 asm<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> IH<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> lookup_multimap_def aux_2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">n</span><span class="main">#</span><span class="skolem">ns</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="skolem">u'</span> <span class="skolem">m</span> <span class="main">=</span> None"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aux_2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> IH<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">n</span><span class="main">#</span><span class="skolem">ns</span><span class="main">)</span><span class="main">.</span> <span class="skolem">m</span> <span class="main">∈</span> phiDefNodes_aux <span class="free">g</span> <span class="skolem">v</span> <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="bound">n</span> <span class="main">∧</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">uses</span> <span class="free">g</span> <span class="bound">n</span> <span class="keyword1">then</span>
        Some <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> lookupDef <span class="free">g</span> <span class="bound">m</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>predecessors <span class="free">g</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span>
        None<span class="main">)</span> <span class="main">=</span> Mapping.lookup <span class="skolem">p'</span> <span class="main">(</span><span class="skolem">m</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> aux_2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> IH<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> keys_dom_lookup dom_def<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> phiDefNodes_auxE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> uses_in_αn<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> phiDefNodes_auxI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>4<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> phiDefNodes_aux_redirect<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uses_in_αn<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> rev_subsetD<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> phiDefNodes_aux_unvisited_monotonic<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_empty<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_code-fst_uses'_phis'"><span class="command">lemma</span></span> fst_uses'_phis'<span class="main">:</span> <span class="quoted"><span class="quoted">"uses' <span class="free">g</span> <span class="main">=</span> lookup_multimap <span class="main">(</span>fst <span class="main">(</span>uses'_phis' <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uses'_phis'_def Let_def split_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> foldr_aux_2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ surjective_pairing<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_empty <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> αn_distinct<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> lookup_multimap_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> foldr_aux_2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ surjective_pairing<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_empty uses_in_αn uses'_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> αn_distinct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="Construct_SSA_code-fst_uses'_phis'_in_αn"><span class="command">lemma</span></span> fst_uses'_phis'_in_αn<span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.keys <span class="main">(</span>fst <span class="main">(</span>uses'_phis' <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uses'_phis'_def Let_def split_def keys_dom_lookup dom_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> foldr_aux_2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ surjective_pairing<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> αn_distinct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="Construct_SSA_code-snd_uses'_phis'"><span class="command">lemma</span></span> snd_uses'_phis'<span class="main">:</span> <span class="quoted"><span class="quoted">"phis'_code <span class="free">g</span> <span class="main">=</span> snd <span class="main">(</span>uses'_phis' <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span>fst <span class="bound">p</span><span class="main">,</span> snd <span class="bound">p</span><span class="main">,</span> fst <span class="bound">p</span><span class="main">,</span> PhiDef<span class="main">)</span><span class="main">)</span> <span class="main">-`</span> <span class="main">{</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> PhiDef<span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">k</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> the1_equality<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vimage_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Mapping_eq_lookup<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> phis'_def uses'_phis'_def Let_def split_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_map_keys a <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vimage_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> foldr_aux_2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ surjective_pairing<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phiDefNodes_def vimage_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fold_union_elem <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> αn_distinct <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>

    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> foldr_aux_2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ surjective_pairing<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phiDefNodes_def vimage_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fold_union_elem <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> αn_distinct <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
        
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> foldr_aux_2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ surjective_pairing<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phiDefNodes_def vimage_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fold_union_elem <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> αn_distinct fold_union_elemI <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SSA_Transfer_Rules">
<div class="head">
<h1>Theory SSA_Transfer_Rules</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      SSA_Transfer_Rules.thy
    Author:     Denis Lohner
*)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Locales Transfer Rules›</span></span>

<span class="keyword1"><span class="command">theory</span></span> SSA_Transfer_Rules <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#SSA_CFG">SSA_CFG</a>
  <a href="#Construct_SSA_code">Construct_SSA_code</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">includes</span></span> lifting_syntax
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> weak_All_transfer1 <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span> <span class="main">=</span> iffD1 <span class="main">[</span><span class="operator">OF</span> right_total_alt_def2<span class="main">]</span>
<span class="keyword1" id="SSA_Transfer_Rules-weak_All_transfer2"><span class="command">lemma</span></span> weak_All_transfer2 <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="main">===&gt;</span> <span class="main">(⟶)</span><span class="main">)</span> All All"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 4 4 <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> right_totalE rel_funE<span class="main">)</span>

<span class="keyword1" id="SSA_Transfer_Rules-weak_imp_transfer"><span class="command">lemma</span></span> weak_imp_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(=)</span> <span class="main">===&gt;</span> <span class="main">(=)</span> <span class="main">===&gt;</span> <span class="main">(⟶)</span><span class="main">)</span> <span class="main">(⟶)</span> <span class="main">(⟶)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="SSA_Transfer_Rules-weak_conj_transfer"><span class="command">lemma</span></span> weak_conj_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(⟶)</span> <span class="main">===&gt;</span> <span class="main">(⟶)</span> <span class="main">===&gt;</span> <span class="main">(⟶)</span><span class="main">)</span> <span class="main">(∧)</span> <span class="main">(∧)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="SSA_Transfer_Rules-graph_path_transfer"><span class="command">lemma</span></span> graph_path_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges</span> <span class="free">inEdges2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⟶)</span> <span class="main">(</span>graph_path <span class="free">αe</span> <span class="free">αn</span> <span class="free">invar</span> <span class="free">inEdges</span><span class="main">)</span> <span class="main">(</span>graph_path <span class="free">αe2</span> <span class="free">αn2</span> <span class="free">invar2</span> <span class="free">inEdges2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> graph_path_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> graph_def valid_graph_def graph_nodes_it_def graph_pred_it_def
  graph_nodes_it_axioms_def graph_pred_it_axioms_def set_iterator_def set_iterator_genord_def 
  foldri_def
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2-5<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> right_totalE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">erule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_funE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> right_totalE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">erule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_funE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> right_totalE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">erule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_funE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> right_totalE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">erule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_funE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> right_totalE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">erule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_funE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> right_totalE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">erule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_funE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> right_totalE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">erule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_funE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">x</span></span></span></span></span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> right_totalE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">erule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_funE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> right_totalE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">erule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_funE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> right_totalE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">erule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_funE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> right_totalE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">erule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_funE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">context</span></span> graph_path_base <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">includes</span></span> lifting_syntax
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-inEdges_transfer"><span class="command">lemma</span></span> inEdges_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> inEdges <span class="main">(</span>graph_path_base.inEdges <span class="free">inEdges2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> gp2<span class="main">:</span> graph_path_base <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> gp2.inEdges_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> inEdges_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-predecessors_transfer"><span class="command">lemma</span></span> predecessors_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> predecessors <span class="main">(</span>graph_path_base.predecessors <span class="free">inEdges2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> gp2<span class="main">:</span> graph_path_base <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> gp2.predecessors_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> predecessors_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-successors_transfer"><span class="command">lemma</span></span> successors_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> successors <span class="main">(</span>graph_path_base.successors <span class="free">αn2</span> <span class="free">inEdges2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> gp2<span class="main">:</span> graph_path_base <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> gp2.successors_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> successors_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-path_transfer"><span class="command">lemma</span></span> path_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> path <span class="main">(</span>graph_path_base.path <span class="free">αn2</span> <span class="free">invar2</span> <span class="free">inEdges2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> gp2<span class="main">:</span> graph_path_base <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> gp2.path_def path_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-path2_transfer"><span class="command">lemma</span></span> path2_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> path2 <span class="main">(</span>graph_path_base.path2 <span class="free">αn2</span> <span class="free">invar2</span> <span class="free">inEdges2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> gp2<span class="main">:</span> graph_path_base <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> gp2.path2_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> path2_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-weak_Ex_transfer"><span class="command">lemma</span></span> weak_Ex_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(=)</span> <span class="main">===&gt;</span> <span class="main">(⟶)</span><span class="main">)</span> <span class="main">===&gt;</span> <span class="main">(⟶)</span><span class="main">)</span> Ex Ex"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_funE<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> transfer_rules <span class="main">=</span> inEdges_transfer predecessors_transfer successors_transfer path_transfer path2_transfer

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-graph_Entry_transfer"><span class="command">lemma</span></span> graph_Entry_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">includes</span></span> lifting_syntax
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe1</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn1</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar1</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges1</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry1</span> <span class="free">Entry2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⟶)</span> <span class="main">(</span>graph_Entry <span class="free">αe1</span> <span class="free">αn1</span> <span class="free">invar1</span> <span class="free">inEdges1</span> <span class="free">Entry1</span><span class="main">)</span> <span class="main">(</span>graph_Entry <span class="free">αe2</span> <span class="free">αn2</span> <span class="free">invar2</span> <span class="free">inEdges2</span> <span class="free">Entry2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"graph_path <span class="free">αe1</span> <span class="free">αn1</span> <span class="free">invar1</span> <span class="free">inEdges1</span> <span class="main">∧</span> graph_Entry_axioms <span class="free">αn1</span> <span class="free">invar1</span> <span class="free">inEdges1</span> <span class="free">Entry1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> graph_path <span class="quoted"><span class="free">αe1</span></span> <span class="quoted"><span class="free">αn1</span></span> <span class="quoted"><span class="free">invar1</span></span> <span class="quoted"><span class="free">inEdges1</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> graph_Entry_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> graph_Entry_axioms_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> graph_Entry_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> graph_Entry_base <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-dominates_transfer"><span class="command">lemma</span></span> dominates_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">includes</span></span> lifting_syntax
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry</span> <span class="free">Entry2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> dominates <span class="main">(</span>graph_Entry_base.dominates <span class="free">αn2</span> <span class="free">invar2</span> <span class="free">inEdges2</span> <span class="free">Entry2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> gE2<span class="main">:</span> graph_Entry_base <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="quoted"><span class="free">Entry2</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> dominates_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> gE2.dominates_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> graph_Entry <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">includes</span></span> lifting_syntax
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-shortestPath_transfer"><span class="command">lemma</span></span> shortestPath_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry</span> <span class="free">Entry2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> shortestPath <span class="main">(</span>graph_Entry.shortestPath <span class="free">αn2</span> <span class="free">invar2</span> <span class="free">inEdges2</span> <span class="free">Entry2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> gE2<span class="main">:</span> graph_Entry <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="quoted"><span class="free">Entry2</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> shortestPath_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> gE2.shortestPath_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-dominators_transfer"><span class="command">lemma</span></span> dominators_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry</span> <span class="free">Entry2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> dominators <span class="main">(</span>graph_Entry.dominators <span class="free">αn2</span> <span class="free">invar2</span> <span class="free">inEdges2</span> <span class="free">Entry2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> gE2<span class="main">:</span> graph_Entry <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="quoted"><span class="free">Entry2</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> dominators_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> gE2.dominators_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-isIdom_transfer"><span class="command">lemma</span></span> isIdom_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry</span> <span class="free">Entry2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> isIdom <span class="main">(</span>graph_Entry.isIdom <span class="free">αn2</span> <span class="free">invar2</span> <span class="free">inEdges2</span> <span class="free">Entry2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> gE2<span class="main">:</span> graph_Entry <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="quoted"><span class="free">Entry2</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> isIdom_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> gE2.isIdom_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-idom_transfer"><span class="command">lemma</span></span> idom_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry</span> <span class="free">Entry2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> idom <span class="main">(</span>graph_Entry.idom <span class="free">αn2</span> <span class="free">invar2</span> <span class="free">inEdges2</span> <span class="free">Entry2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> gE2<span class="main">:</span> graph_Entry <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="quoted"><span class="free">Entry2</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> idom_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> gE2.idom_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> graph_Entry_transfer <span class="main">=</span>
  dominates_transfer
  shortestPath_transfer
  dominators_transfer
  isIdom_transfer
  idom_transfer
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-CFG_transfer"><span class="command">lemma</span></span> CFG_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">includes</span></span> lifting_syntax
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe1</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn1</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar1</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges1</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry1</span> <span class="free">Entry2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">defs1</span> <span class="free">defs2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">uses1</span> <span class="free">uses2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"SSA_CFG.CFG <span class="free">αe1</span> <span class="free">αn1</span> <span class="free">invar1</span> <span class="free">inEdges1</span> <span class="free">Entry1</span> <span class="free">defs1</span> <span class="free">uses1</span>
    <span class="main">⟶</span> SSA_CFG.CFG <span class="free">αe2</span> <span class="free">αn2</span> <span class="free">invar2</span> <span class="free">inEdges2</span> <span class="free">Entry2</span> <span class="free">defs2</span> <span class="free">uses2</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SSA_CFG.CFG_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> CFG_axioms_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>

<span class="keyword1"><span class="command">context</span></span> CFG_base <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">includes</span></span> lifting_syntax
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-vars_transfer"><span class="command">lemma</span></span> vars_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry</span> <span class="free">Entry2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">defs</span> <span class="free">defs2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">uses</span> <span class="free">uses2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> vars <span class="main">(</span>CFG_base.vars <span class="free">αn2</span> <span class="free">uses2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> CFG_base2<span class="main">:</span> CFG_base <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="quoted"><span class="free">Entry2</span></span> <span class="quoted"><span class="free">defs2</span></span> <span class="quoted"><span class="free">uses2</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vars_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> CFG_base2.vars_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-defAss'_transfer"><span class="command">lemma</span></span> defAss'_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry</span> <span class="free">Entry2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">defs</span> <span class="free">defs2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">uses</span> <span class="free">uses2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> defAss' <span class="main">(</span>CFG_base.defAss' <span class="free">αn2</span> <span class="free">invar2</span> <span class="free">inEdges2</span> <span class="free">Entry2</span> <span class="free">defs2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> CFG2<span class="main">:</span> CFG_base <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="quoted"><span class="free">Entry2</span></span> <span class="quoted"><span class="free">defs2</span></span> <span class="quoted"><span class="free">uses2</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> defAss'_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> CFG2.defAss'_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-defAss'Uses_transfer"><span class="command">lemma</span></span> defAss'Uses_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry</span> <span class="free">Entry2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">defs</span> <span class="free">defs2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">uses</span> <span class="free">uses2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> defAss'Uses <span class="main">(</span>CFG_base.defAss'Uses <span class="free">αn2</span> <span class="free">invar2</span> <span class="free">inEdges2</span> <span class="free">Entry2</span> <span class="free">defs2</span> <span class="free">uses2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> CFG2<span class="main">:</span> CFG_base <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="quoted"><span class="free">Entry2</span></span> <span class="quoted"><span class="free">defs2</span></span> <span class="quoted"><span class="free">uses2</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> defAss'Uses_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> CFG2.defAss'Uses_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemmas</span></span> CFG_transfers <span class="main">=</span>
  vars_transfer
  defAss'_transfer
  defAss'Uses_transfer

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">includes</span></span> lifting_syntax
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-CFG_Construct_transfer"><span class="command">lemma</span></span> CFG_Construct_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe1</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn1</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar1</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges1</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry1</span> <span class="free">Entry2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">defs1</span> <span class="free">defs2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">uses1</span> <span class="free">uses2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"CFG_Construct <span class="free">αe1</span> <span class="free">αn1</span> <span class="free">invar1</span> <span class="free">inEdges1</span> <span class="free">Entry1</span> <span class="free">defs1</span> <span class="free">uses1</span>
    <span class="main">⟶</span> CFG_Construct <span class="free">αe2</span> <span class="free">αn2</span> <span class="free">invar2</span> <span class="free">inEdges2</span> <span class="free">Entry2</span> <span class="free">defs2</span> <span class="free">uses2</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CFG_Construct_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>

<span class="keyword1" id="SSA_Transfer_Rules-CFG_Construct_linorder_transfer"><span class="command">lemma</span></span> CFG_Construct_linorder_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe1</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn1</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar1</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges1</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry1</span> <span class="free">Entry2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">defs1</span> <span class="free">defs2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">uses1</span> <span class="free">uses2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"CFG_Construct_linorder <span class="free">αe1</span> <span class="free">αn1</span> <span class="free">invar1</span> <span class="free">inEdges1</span> <span class="free">Entry1</span> <span class="free">defs1</span> <span class="free">uses1</span>
    <span class="main">⟶</span> CFG_Construct_linorder <span class="free">αe2</span> <span class="free">αn2</span> <span class="free">invar2</span> <span class="free">inEdges2</span> <span class="free">Entry2</span> <span class="free">defs2</span> <span class="free">uses2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"CFG_Construct_linorder <span class="free">αe1</span> <span class="free">αn1</span> <span class="free">invar1</span> <span class="free">inEdges1</span> <span class="free">Entry1</span> <span class="free">defs1</span> <span class="free">uses1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> CFG_Construct_linorder <span class="quoted"><span class="free">αe1</span></span> <span class="quoted"><span class="free">αn1</span></span> <span class="quoted"><span class="free">invar1</span></span> <span class="quoted"><span class="free">inEdges1</span></span> <span class="quoted"><span class="free">Entry1</span></span> <span class="quoted"><span class="free">defs1</span></span> <span class="quoted"><span class="free">uses1</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> CFG_Construct_linorder_def CFG_Construct_wf_def CFG_wf_def CFG_wf_axioms_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> CFG_Construct <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">includes</span></span> lifting_syntax
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-phiDefNodes_aux_transfer"><span class="command">lemma</span></span> phiDefNodes_aux_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry</span> <span class="free">Entry2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">defs</span> <span class="free">defs2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">uses</span> <span class="free">uses2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> phiDefNodes_aux <span class="main">(</span>CFG_Construct.phiDefNodes_aux <span class="free">inEdges2</span> <span class="free">defs2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> i<span class="main">:</span> CFG_Construct <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="quoted"><span class="free">Entry2</span></span> <span class="quoted"><span class="free">defs2</span></span> <span class="quoted"><span class="free">uses2</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g1</span> <span class="skolem">g2</span> <span class="skolem">v</span> <span class="skolem">unvisited</span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="skolem">g1</span> <span class="skolem">g2</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">inEdges2</span> <span class="skolem">g2</span> <span class="main">=</span> <span class="free">inEdges'</span> <span class="skolem">g1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs2</span> <span class="skolem">g2</span> <span class="main">=</span> <span class="free">defs</span> <span class="skolem">g1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_funE<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"phiDefNodes_aux <span class="skolem">g1</span> <span class="skolem">v</span> <span class="skolem">unvisited</span> <span class="skolem">n</span> <span class="main">=</span> CFG_Construct.phiDefNodes_aux <span class="free">inEdges2</span> <span class="free">defs2</span> <span class="skolem">g2</span> <span class="skolem">v</span> <span class="skolem">unvisited</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">g1</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">unvisited</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> phiDefNodes_aux.induct<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> phiDefNodes_aux.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> i.phiDefNodes_aux.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"i.predecessors <span class="skolem">g2</span> <span class="improper">n</span> <span class="main">=</span> predecessors <span class="improper">g</span> <span class="improper">n</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i.predecessors_def predecessors_def i.inEdges_def inEdges_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong arg_cong2 <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"fold <span class="main">(∪)</span>"</span></span><span class="main"><span class="main">]</span></span> map_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-phiDefNodes_transfer"><span class="command">lemma</span></span> phiDefNodes_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry</span> <span class="free">Entry2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">defs</span> <span class="free">defs2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">uses</span> <span class="free">uses2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> phiDefNodes <span class="main">(</span>CFG_Construct.phiDefNodes <span class="free">αn2</span> <span class="free">inEdges2</span> <span class="free">defs2</span> <span class="free">uses2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> i<span class="main">:</span> CFG_Construct <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="quoted"><span class="free">Entry2</span></span> <span class="quoted"><span class="free">defs2</span></span> <span class="quoted"><span class="free">uses2</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> phiDefNodes_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> i.phiDefNodes_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-lookupDef_transfer"><span class="command">lemma</span></span> lookupDef_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry</span> <span class="free">Entry2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">defs</span> <span class="free">defs2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">uses</span> <span class="free">uses2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> lookupDef <span class="main">(</span>CFG_Construct.lookupDef <span class="free">αn2</span> <span class="free">inEdges2</span> <span class="free">defs2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> i<span class="main">:</span> CFG_Construct <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="quoted"><span class="free">Entry2</span></span> <span class="quoted"><span class="free">defs2</span></span> <span class="quoted"><span class="free">uses2</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="skolem">g2</span> <span class="skolem">n</span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="skolem">g</span> <span class="skolem">g2</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">αn2</span> <span class="skolem">g2</span> <span class="main">=</span> <span class="free">αn</span> <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">inEdges2</span> <span class="skolem">g2</span> <span class="main">=</span> <span class="free">inEdges'</span> <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs2</span> <span class="skolem">g2</span> <span class="main">=</span> <span class="free">defs</span> <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_funE<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lookupDef <span class="skolem">g</span> <span class="skolem">n</span> <span class="skolem">v</span> <span class="main">=</span> i.lookupDef <span class="skolem">g2</span> <span class="skolem">n</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> lookupDef.induct<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lookupDef.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> i.lookupDef.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"i.predecessors <span class="skolem">g2</span> <span class="improper">n</span> <span class="main">=</span> predecessors <span class="improper">g</span> <span class="improper">n</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i.predecessors_def predecessors_def i.inEdges_def inEdges_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong list.case_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-defs'_transfer"><span class="command">lemma</span></span> defs'_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry</span> <span class="free">Entry2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">defs</span> <span class="free">defs2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">uses</span> <span class="free">uses2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> defs' <span class="main">(</span>CFG_Construct.defs' <span class="free">defs2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> i<span class="main">:</span> CFG_Construct <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="quoted"><span class="free">Entry2</span></span> <span class="quoted"><span class="free">defs2</span></span> <span class="quoted"><span class="free">uses2</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> defs'_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> i.defs'_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-uses'_transfer"><span class="command">lemma</span></span> uses'_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry</span> <span class="free">Entry2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">defs</span> <span class="free">defs2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">uses</span> <span class="free">uses2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> uses' <span class="main">(</span>CFG_Construct.uses' <span class="free">αn2</span> <span class="free">inEdges2</span> <span class="free">defs2</span> <span class="free">uses2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> i<span class="main">:</span> CFG_Construct <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="quoted"><span class="free">Entry2</span></span> <span class="quoted"><span class="free">defs2</span></span> <span class="quoted"><span class="free">uses2</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> uses'_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> i.uses'_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-phis'_transfer"><span class="command">lemma</span></span> phis'_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry</span> <span class="free">Entry2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">defs</span> <span class="free">defs2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">uses</span> <span class="free">uses2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> phis' <span class="main">(</span>CFG_Construct.phis' <span class="free">αn2</span> <span class="free">inEdges2</span> <span class="free">defs2</span> <span class="free">uses2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> i<span class="main">:</span> CFG_Construct <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="quoted"><span class="free">Entry2</span></span> <span class="quoted"><span class="free">defs2</span></span> <span class="quoted"><span class="free">uses2</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> phis'_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> i.phis'_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> CFG_Construct_transfer_rules <span class="main">=</span>
  phiDefNodes_aux_transfer
  phiDefNodes_transfer
  lookupDef_transfer
  defs'_transfer
  uses'_transfer
  phis'_transfer
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> CFG_SSA_base <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">includes</span></span> lifting_syntax
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-phiDefs_transfer"><span class="command">lemma</span></span> phiDefs_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry</span> <span class="free">Entry2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">defs</span> <span class="free">defs2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">uses</span> <span class="free">uses2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">phis</span> <span class="free">phis2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> phiDefs <span class="main">(</span>CFG_SSA_base.phiDefs <span class="free">phis2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> i<span class="main">:</span> CFG_SSA_base <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="quoted"><span class="free">Entry2</span></span> <span class="quoted"><span class="free">defs2</span></span> <span class="quoted"><span class="free">uses2</span></span> <span class="quoted"><span class="free">phis2</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> phiDefs_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> i.phiDefs_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-allDefs_transfer"><span class="command">lemma</span></span> allDefs_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry</span> <span class="free">Entry2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">defs</span> <span class="main">(</span><span class="free">defs2</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span> set<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">uses</span> <span class="main">(</span><span class="free">uses2</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span> set<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">phis</span> <span class="free">phis2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> allDefs <span class="main">(</span>CFG_SSA_base.allDefs <span class="free">defs2</span> <span class="free">phis2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> i<span class="main">:</span> CFG_SSA_base <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="quoted"><span class="free">Entry2</span></span> <span class="quoted"><span class="free">defs2</span></span> <span class="quoted"><span class="free">uses2</span></span> <span class="quoted"><span class="free">phis2</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> allDefs_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> i.allDefs_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-phiUses_transfer"><span class="command">lemma</span></span> phiUses_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry</span> <span class="free">Entry2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">defs</span> <span class="free">defs2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">uses</span> <span class="free">uses2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">phis</span> <span class="free">phis2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> phiUses <span class="main">(</span>CFG_SSA_base.phiUses <span class="free">αn2</span> <span class="free">inEdges2</span> <span class="free">phis2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> i<span class="main">:</span> CFG_SSA_base <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="quoted"><span class="free">Entry2</span></span> <span class="quoted"><span class="free">defs2</span></span> <span class="quoted"><span class="free">uses2</span></span> <span class="quoted"><span class="free">phis2</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> phiUses_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> i.phiUses_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-allUses_transfer"><span class="command">lemma</span></span> allUses_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry</span> <span class="free">Entry2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">defs</span> <span class="free">defs2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">uses</span> <span class="free">uses2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">phis</span> <span class="free">phis2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> allUses <span class="main">(</span>CFG_SSA_base.allUses <span class="free">αn2</span> <span class="free">inEdges2</span> <span class="free">uses2</span> <span class="free">phis2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> i<span class="main">:</span> CFG_SSA_base <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="quoted"><span class="free">Entry2</span></span> <span class="quoted"><span class="free">defs2</span></span> <span class="quoted"><span class="free">uses2</span></span> <span class="quoted"><span class="free">phis2</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> allUses_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> i.allUses_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-allVars_transfer"><span class="command">lemma</span></span> allVars_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry</span> <span class="free">Entry2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">defs</span> <span class="free">defs2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">uses</span> <span class="free">uses2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">phis</span> <span class="free">phis2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> allVars <span class="main">(</span>CFG_SSA_base.allVars <span class="free">αn2</span> <span class="free">inEdges2</span> <span class="free">defs2</span> <span class="free">uses2</span> <span class="free">phis2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> i<span class="main">:</span> CFG_SSA_base <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="quoted"><span class="free">Entry2</span></span> <span class="quoted"><span class="free">defs2</span></span> <span class="quoted"><span class="free">uses2</span></span> <span class="quoted"><span class="free">phis2</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> allVars_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> i.allVars_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-defAss_transfer"><span class="command">lemma</span></span> defAss_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry</span> <span class="free">Entry2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">defs</span> <span class="free">defs2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">uses</span> <span class="free">uses2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">phis</span> <span class="free">phis2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> defAss <span class="main">(</span>CFG_SSA_base.defAss <span class="free">αn2</span> <span class="free">invar2</span> <span class="free">inEdges2</span> <span class="free">Entry2</span> <span class="free">defs2</span> <span class="free">phis2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> i<span class="main">:</span> CFG_SSA_base <span class="quoted"><span class="free">αe2</span></span> <span class="quoted"><span class="free">αn2</span></span> <span class="quoted"><span class="free">invar2</span></span> <span class="quoted"><span class="free">inEdges2</span></span> <span class="quoted"><span class="free">Entry2</span></span> <span class="quoted"><span class="free">defs2</span></span> <span class="quoted"><span class="free">uses2</span></span> <span class="quoted"><span class="free">phis2</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> defAss_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> i.defAss_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> CFG_SSA_base_transfer_rules <span class="main">=</span>
  phiDefs_transfer
  allDefs_transfer
  phiUses_transfer
  allUses_transfer
  allVars_transfer
  defAss_transfer
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> CFG_SSA_base_code <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-CFG_SSA_base_code_transfer_rules"><span class="command">lemma</span></span> CFG_SSA_base_code_transfer_rules <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">includes</span></span> lifting_syntax
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges'</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry</span> <span class="free">Entry2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">defs</span> <span class="free">defs2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">uses</span> <span class="free">uses2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">phis</span> <span class="free">phis2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> phiDefs <span class="main">(</span>CFG_SSA_base.phiDefs <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">phis2</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> allDefs <span class="main">(</span>CFG_SSA_base.allDefs <span class="free">defs2</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">phis2</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> phiUses <span class="main">(</span>CFG_SSA_base.phiUses <span class="free">αn2</span> <span class="free">inEdges2</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">phis2</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> allUses <span class="main">(</span>CFG_SSA_base.allUses <span class="free">αn2</span> <span class="free">inEdges2</span> <span class="main">(</span>usesOf <span class="main">∘</span> <span class="free">uses2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">phis2</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> defAss <span class="main">(</span>CFG_SSA_base.defAss <span class="free">αn2</span> <span class="free">invar2</span> <span class="free">inEdges2</span> <span class="free">Entry2</span> <span class="free">defs2</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">phis2</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CFG_SSA_base.CFG_SSA_defs<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer_prover</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CFG_SSA_base.CFG_SSA_defs<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer_prover</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CFG_SSA_base.CFG_SSA_defs<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer_prover</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CFG_SSA_base.CFG_SSA_defs<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer_prover</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CFG_SSA_base.CFG_SSA_defs<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer_prover</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="SSA_Transfer_Rules-CFG_SSA_transfer"><span class="command">lemma</span></span> CFG_SSA_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">includes</span></span> lifting_syntax
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αe1</span> <span class="free">αe2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">αn1</span> <span class="free">αn2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">invar1</span> <span class="free">invar2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">inEdges1</span> <span class="free">inEdges2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">Entry1</span> <span class="free">Entry2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">defs1</span> <span class="free">defs2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">uses1</span> <span class="free">uses2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="free">phis1</span> <span class="free">phis2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"CFG_SSA  <span class="free">αe1</span> <span class="free">αn1</span> <span class="free">invar1</span> <span class="free">inEdges1</span> <span class="free">Entry1</span> <span class="free">defs1</span> <span class="free">uses1</span> <span class="free">phis1</span>
    <span class="main">⟶</span> CFG_SSA  <span class="free">αe2</span> <span class="free">αn2</span> <span class="free">invar2</span> <span class="free">inEdges2</span> <span class="free">Entry2</span> <span class="free">defs2</span> <span class="free">uses2</span> <span class="free">phis2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"CFG_SSA <span class="free">αe1</span> <span class="free">αn1</span> <span class="free">invar1</span> <span class="free">inEdges1</span> <span class="free">Entry1</span> <span class="free">defs1</span> <span class="free">uses1</span> <span class="free">phis1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> CFG_SSA <span class="quoted"><span class="free">αe1</span></span> <span class="quoted"><span class="free">αn1</span></span> <span class="quoted"><span class="free">invar1</span></span> <span class="quoted"><span class="free">inEdges1</span></span> <span class="quoted"><span class="free">Entry1</span></span> <span class="quoted"><span class="free">defs1</span></span> <span class="quoted"><span class="free">uses1</span></span> <span class="quoted"><span class="free">phis1</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> CFG_SSA_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> CFG_SSA_axioms_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Construct_SSA_notriv_code">
<div class="head">
<h1>Theory Construct_SSA_notriv_code</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Construct_SSA_notriv_code.thy
    Author:     Denis Lohner, Sebastian Ullrich
*)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Code Equations for SSA Minimization›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Construct_SSA_notriv_code <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#SSA_CFG_code">SSA_CFG_code</a>
  <a href="#Construct_SSA_notriv">Construct_SSA_notriv</a>
  <a href="#While_Combinator_Exts">While_Combinator_Exts</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">const</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> CFG_SSA_Transformed_notriv_base <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">substitution_code</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="main">=</span> the <span class="main">(</span>the_trivial <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">next</span></span></span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span><span class="free">phis</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">next</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">substNext_code</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">v</span> <span class="main">=</span> snd <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="keyword1">then</span> substitution_code <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="keyword1">else</span> <span class="bound">v</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">uses'_code</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> substNext_code <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="main">`</span> <span class="free">uses</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

  <span class="keyword1" id="Construct_SSA_notriv_code-substNext_code_alt_def"><span class="command">lemma</span></span> substNext_code_alt_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"substNext_code <span class="free">g</span> <span class="free">next</span> <span class="main">=</span> id<span class="main">(</span>snd <span class="free">next</span> <span class="main">:=</span> substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> substNext_code_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'g</span><span class="main">,</span> <span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> chooseNext_code <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis_code <span class="main">⇒</span> <span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'val</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_SSA_Transformed_notriv_base_code <span class="main">=</span>
  ssa<span class="main">:</span>CFG_SSA_wf_base_code <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span> <span class="main">+</span>
  CFG_SSA_Transformed_notriv_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"usesOf <span class="main">∘</span> <span class="free">uses</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">uses</span> <span class="bound">phis</span><span class="main">.</span> <span class="free">chooseNext_all</span> <span class="bound">uses</span> <span class="main">(</span>Mapping.Mapping <span class="bound">phis</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Entry</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">oldDefs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">oldUses</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span> set<span class="main">)</span> mapping"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">phis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis_code"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'val</span> <span class="main">⇒</span> <span class="tfree">'var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">chooseNext_all</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'g</span><span class="main">,</span> <span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> chooseNext_code"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cond_code</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> ssa.redundant_code <span class="free"><span class="bound"><span class="entity">g</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">uses'_codem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'val</span> <span class="main">⇒</span> <span class="tfree">'val</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'node</span> set<span class="main">)</span> mapping <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span> set<span class="main">)</span> mapping"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">uses'_codem</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="free"><span class="bound"><span class="entity">next'</span></span></span> <span class="free"><span class="bound"><span class="entity">nodes_of_uses</span></span></span> <span class="main">=</span>
    fold <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Mapping.update <span class="bound">n</span> <span class="main">(</span>Set.insert <span class="free"><span class="bound"><span class="entity">next'</span></span></span> <span class="main">(</span>Set.remove <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">next</span></span></span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">uses</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>sorted_list_of_set <span class="main">(</span>case_option <span class="main">{}</span> id <span class="main">(</span>Mapping.lookup <span class="free"><span class="bound"><span class="entity">nodes_of_uses</span></span></span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">next</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span><span class="free">uses</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">nodes_of_uses'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'val</span> <span class="main">⇒</span> <span class="tfree">'val</span> <span class="main">⇒</span> <span class="tfree">'val</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'node</span> set<span class="main">)</span> mapping <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'node</span> set<span class="main">)</span> mapping"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nodes_of_uses'</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="free"><span class="bound"><span class="entity">next'</span></span></span> <span class="free"><span class="bound"><span class="entity">phiVals</span></span></span> <span class="free"><span class="bound"><span class="entity">nodes_of_uses</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">users</span> <span class="main">=</span> case_option <span class="main">{}</span> id <span class="main">(</span>Mapping.lookup <span class="free"><span class="bound"><span class="entity">nodes_of_uses</span></span></span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">next</span></span></span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">in</span>
    <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">next'</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">phiVals</span></span></span><span class="main">)</span> <span class="keyword1">then</span> Mapping.map_default <span class="free"><span class="bound"><span class="entity">next'</span></span></span> <span class="main">{}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ns</span><span class="main">.</span> <span class="bound">ns</span> <span class="main">∪</span> <span class="bound">users</span><span class="main">)</span> <span class="main">(</span>Mapping.delete <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">next</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">nodes_of_uses</span></span></span><span class="main">)</span>
    <span class="keyword1">else</span> Mapping.delete <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">next</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">nodes_of_uses</span></span></span><span class="main">)</span>"</span></span>

  <span class="comment1">(* FIXME: phis'_code ist in O(n) → verwende nodes_of_uses ? *)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phis'_code</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="main">≡</span> map_values <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="bound">vs</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">v</span> <span class="main">=</span> snd <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="keyword1">then</span> None <span class="keyword1">else</span> Some <span class="main">(</span>map <span class="main">(</span>substNext_code <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">next</span></span></span><span class="main">)</span> <span class="bound">vs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">phis</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span>"</span></span>

  <span class="comment1">(* Schon besser: O(log(n)) *)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phis'_codem</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="free"><span class="bound"><span class="entity">next'</span></span></span> <span class="free"><span class="bound"><span class="entity">nodes_of_phis</span></span></span> <span class="main">=</span>
    fold <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Mapping.update <span class="bound">n</span> <span class="main">(</span>List.map <span class="main">(</span>id<span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">next'</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>sorted_list_of_set <span class="main">(</span>case_option <span class="main">{}</span> <span class="main">(</span>Set.remove <span class="free"><span class="bound"><span class="entity">next</span></span></span><span class="main">)</span> <span class="main">(</span>Mapping.lookup <span class="free"><span class="bound"><span class="entity">nodes_of_phis</span></span></span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">next</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>Mapping.delete <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="main">(</span><span class="free">phis</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">nodes_of_phis'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'val</span> <span class="main">⇒</span> <span class="tfree">'val</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'val</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'val</span><span class="main">)</span> set<span class="main">)</span> mapping <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'val</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'val</span><span class="main">)</span> set<span class="main">)</span> mapping"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nodes_of_phis'</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="free"><span class="bound"><span class="entity">next'</span></span></span> <span class="free"><span class="bound"><span class="entity">nodes_of_phis</span></span></span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">let</span> <span class="bound">old_phis</span> <span class="main">=</span> Set.remove <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="main">(</span>case_option <span class="main">{}</span> id <span class="main">(</span>Mapping.lookup <span class="free"><span class="bound"><span class="entity">nodes_of_phis</span></span></span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">next</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
        <span class="bound">nop</span> <span class="main">=</span> Mapping.delete <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">next</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">nodes_of_phis</span></span></span>
      <span class="keyword1">in</span>
      Mapping.map_default <span class="free"><span class="bound"><span class="entity">next'</span></span></span> <span class="main">{}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ns</span><span class="main">.</span> <span class="main">(</span>Set.remove <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="bound">ns</span><span class="main">)</span> <span class="main">∪</span> <span class="bound">old_phis</span><span class="main">)</span> <span class="bound">nop</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">triv_phis'</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="free"><span class="bound"><span class="entity">triv_phis</span></span></span> <span class="free"><span class="bound"><span class="entity">nodes_of_phis</span></span></span>
    <span class="main">=</span> <span class="main">(</span>Set.remove <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="free"><span class="bound"><span class="entity">triv_phis</span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>Set.filter <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ssa.trivial_code <span class="main">(</span>snd <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>case_option <span class="main">{}</span> <span class="main">(</span>Set.remove <span class="free"><span class="bound"><span class="entity">next</span></span></span><span class="main">)</span> <span class="main">(</span>Mapping.lookup <span class="free"><span class="bound"><span class="entity">nodes_of_phis</span></span></span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">next</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">step_code</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">next</span> <span class="main">=</span> chooseNext' <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="keyword1">in</span> <span class="main">(</span>uses'_code <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">next</span><span class="main">,</span> phis'_code <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">next</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">step_codem</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="free"><span class="bound"><span class="entity">next'</span></span></span> <span class="free"><span class="bound"><span class="entity">nodes_of_uses</span></span></span> <span class="free"><span class="bound"><span class="entity">nodes_of_phis</span></span></span> <span class="main">=</span> <span class="main">(</span>uses'_codem <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="free"><span class="bound"><span class="entity">next'</span></span></span> <span class="free"><span class="bound"><span class="entity">nodes_of_uses</span></span></span><span class="main">,</span> phis'_codem <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="free"><span class="bound"><span class="entity">next'</span></span></span> <span class="free"><span class="bound"><span class="entity">nodes_of_phis</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">phi_equiv_mapping</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'a</span> set<span class="main">)</span> mapping <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'a</span> set<span class="main">)</span> mapping <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊢</span> _ <span class="keyword1">≈<span class="hidden">⇩</span><sub>φ</sub></span> _"</span> 50<span class="main">)</span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">nou<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1"><span class="free">≈<span class="hidden">⇩</span><sub>φ</sub></span></span> <span class="free"><span class="bound"><span class="entity">nou<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> Mapping.keys <span class="main">(</span>ssa.phidefNodes <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">.</span> case_option <span class="main">{}</span> id <span class="main">(</span>Mapping.lookup <span class="free"><span class="bound"><span class="entity">nou<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> case_option <span class="main">{}</span> id <span class="main">(</span>Mapping.lookup <span class="free"><span class="bound"><span class="entity">nou<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="bound">v</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_SSA_Transformed_notriv_linorder <span class="main">=</span> CFG_SSA_Transformed_notriv_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">chooseNext_all</span></span>
   <span class="main">+</span> CFG_SSA_Transformed_notriv <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">chooseNext_all</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Entry</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">oldDefs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">oldUses</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">phis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'val</span> <span class="main">⇒</span> <span class="tfree">'var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">chooseNext_all</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis <span class="main">⇒</span> <span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'val</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="Construct_SSA_notriv_code-isTrivial_the_trivial"><span class="command">lemma</span></span> isTrivial_the_trivial<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> phi <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> Some <span class="free">vs</span><span class="main">;</span> isTrivialPhi <span class="free">g</span> <span class="free">v</span> <span class="free">v'</span> <span class="main">⟧</span> <span class="main">⟹</span> the_trivial <span class="free">v</span> <span class="free">vs</span> <span class="main">=</span> Some <span class="free">v'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> the_trivialI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">v'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> isTrivialPhi_def<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-the_trivial_THE_isTrivial"><span class="command">lemma</span></span> the_trivial_THE_isTrivial<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> phi <span class="free">g</span> <span class="free">v</span> <span class="main">=</span> Some <span class="free">vs</span><span class="main">;</span> trivial <span class="free">g</span> <span class="free">v</span> <span class="main">⟧</span> <span class="main">⟹</span> the_trivial <span class="free">v</span> <span class="free">vs</span> <span class="main">=</span> Some <span class="main">(</span>The <span class="main">(</span>isTrivialPhi <span class="free">g</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> isTrivialPhi_det<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> isTrivial_the_trivial<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> isTrivial_the_trivial <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> the_equality <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sym<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-substitution_code_correct"><span class="command">lemma</span></span> substitution_code_correct<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"redundant <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"substitution <span class="free">g</span> <span class="main">=</span> substitution_code <span class="free">g</span> <span class="main">(</span>chooseNext' <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> substitution <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"phi <span class="free">g</span> <span class="main">(</span>chooseNext <span class="free">g</span><span class="main">)</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> isTrivialPhi_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"phi <span class="free">g</span> <span class="main">(</span>chooseNext <span class="free">g</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">vs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> isTrivial_the_trivial <span class="main">[</span><span class="operator">OF</span> this substitution <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">]</span> chooseNext'<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> substitution_code_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phis_phi<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>chooseNext' <span class="free">g</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_notriv_code-substNext_code_correct"><span class="command">lemma</span></span> substNext_code_correct<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"redundant <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"substNext <span class="free">g</span> <span class="main">=</span> substNext_code <span class="free">g</span> <span class="main">(</span>chooseNext' <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> substNext_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> substNext_code_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> substitution_code_correct <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-uses'_code_correct"><span class="command">lemma</span></span> uses'_code_correct<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"redundant <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"uses' <span class="free">g</span> <span class="main">=</span> uses'_code <span class="free">g</span> <span class="main">(</span>chooseNext' <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> uses'_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> uses'_code_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> substNext_code_correct <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> CFG_SSA_Transformed_notriv_linorder
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="Construct_SSA_notriv_code-substAll_terminates"><span class="command">lemma</span></span> substAll_terminates<span class="main">:</span> <span class="quoted"><span class="quoted">"while_option <span class="main">(</span>cond <span class="free">g</span><span class="main">)</span> <span class="main">(</span>step <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="free">uses</span> <span class="free">g</span><span class="main">,</span> <span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="main">≠</span> None"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> while_option_None_invD <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"inst' <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> r<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>inst' <span class="free">g</span> <span class="bound">x</span> <span class="main">∧</span> cond <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> step <span class="free">g</span> <span class="bound">x</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wf_if_measure<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">.</span> card <span class="main">(</span>dom <span class="bound">p</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">s</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> step_def cond_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> step_preserves_inst <span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> step_def<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> step_def cond_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cond_def step_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>prod.split<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">p</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"CFG_SSA_Transformed_notriv <span class="free">αe</span> <span class="free">αn</span> <span class="free">invar</span> <span class="free">inEdges'</span> <span class="free">Entry</span> <span class="free">oldDefs</span> <span class="free">oldUses</span> <span class="free">defs</span> <span class="main">(</span><span class="free">uses</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="skolem">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">phis</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="free">var</span> <span class="free">chooseNext_all</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> i<span class="main">:</span> CFG_SSA_Transformed_notriv <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">phis</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">chooseNext_all</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"i.redundant <span class="free">g</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>dom <span class="main">(</span>i.phis' <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span>dom <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i.substAll_wf<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_SSA_Transformed_notriv_linorder_code <span class="main">=</span>
  CFG_SSA_Transformed_code <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span> <span class="quoted"><span class="free">var</span></span>
<span class="main">+</span> CFG_SSA_Transformed_notriv_base_code <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">chooseNext_all</span></span>
<span class="main">+</span> CFG_SSA_Transformed_notriv_linorder <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"usesOf <span class="main">∘</span> <span class="free">uses</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">var</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">uses</span> <span class="bound">phis</span><span class="main">.</span> <span class="free">chooseNext_all</span> <span class="bound">uses</span> <span class="main">(</span>Mapping.Mapping <span class="bound">phis</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Entry</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">oldDefs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">oldUses</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span> set<span class="main">)</span> mapping"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">phis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis_code"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'val</span> <span class="main">⇒</span> <span class="tfree">'var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">chooseNext_all</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'g</span><span class="main">,</span> <span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> chooseNext_code"</span></span>
<span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span> chooseNext_all_code<span class="main">:</span>
  <span class="quoted"><span class="quoted">"CFG_SSA_Transformed_code <span class="free">αe</span> <span class="free">αn</span> <span class="free">invar</span> <span class="free">inEdges'</span> <span class="free">Entry</span> <span class="free">oldDefs</span> <span class="free">oldUses</span> <span class="free">defs</span> <span class="free">u</span> <span class="free">p</span> <span class="free">var</span> <span class="main">⟹</span>
  CFG_SSA_wf_base_code.redundant_code <span class="free">p</span> <span class="free">g</span> <span class="main">⟹</span>
  <span class="free">chooseNext_all</span> <span class="main">(</span>usesOf <span class="main">(</span><span class="free">u</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="free">g</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> Max <span class="main">(</span>CFG_SSA_wf_base_code.trivial_phis <span class="free">p</span> <span class="free">g</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> CFG_SSA_step_code <span class="main">=</span>
  step_code<span class="main">:</span> CFG_SSA_Transformed_notriv_linorder_code <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">chooseNext_all</span></span>
<span class="main">+</span>
  CFG_SSA_step <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"usesOf <span class="main">∘</span> <span class="free">uses</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">uses</span> <span class="bound">phis</span><span class="main">.</span> <span class="free">chooseNext_all</span> <span class="bound">uses</span> <span class="main">(</span>Mapping.Mapping <span class="bound">phis</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">g</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">αe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder <span class="main">×</span> <span class="tfree">'edgeD</span> <span class="main">×</span> <span class="tfree">'node</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">αn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">inEdges'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span> <span class="main">×</span> <span class="tfree">'edgeD</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Entry</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">oldDefs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">oldUses</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">defs</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span><span class="main">::</span>linorder set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"<span class="free">uses</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span> set<span class="main">)</span> mapping"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">phis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis_code"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'val</span> <span class="main">⇒</span> <span class="tfree">'var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">chooseNext_all</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'g</span><span class="main">,</span> <span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> chooseNext_code"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">g</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'g</span></span></span>

<span class="keyword1"><span class="command">context</span></span> CFG_SSA_Transformed_notriv_linorder_code
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">u_g</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">≡</span> <span class="free">uses</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">:=</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">p_g</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="free">phis</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">:=</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">cN</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">uses</span> <span class="bound">phis</span><span class="main">.</span> <span class="free">chooseNext_all</span> <span class="bound">uses</span> <span class="main">(</span>Mapping.Mapping <span class="bound">phis</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">interpretation</span></span> uninst_code<span class="main">:</span> CFG_SSA_Transformed_notriv_base_code <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">chooseNext_all</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="free">u</span> <span class="free">p</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

  <span class="keyword1"><span class="command">interpretation</span></span> uninst<span class="main">:</span> CFG_SSA_Transformed_notriv_base <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted">cN</span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="free">u</span> <span class="free">p</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-phis'_code_correct"><span class="command">lemma</span></span> phis'_code_correct<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ssa.redundant <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"phis' <span class="free">g</span> <span class="main">=</span> Mapping.lookup <span class="main">(</span>phis'_code <span class="free">g</span> <span class="main">(</span>chooseNext' <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> phis'_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> phis'_code_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Mapping_lookup_map_values substNext_code_correct <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split Option.bind_split<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-redundant_ign"><span class="command">lemma</span></span> redundant_ign<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"uninst_code.ssa.redundant_code <span class="main">(</span>const <span class="free">p</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> uninst_code.ssa.redundant_code <span class="main">(</span><span class="free">phis</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> uninst_code.ssa.redundant_code_def uninst_code.ssa.trivial_code_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> CFG_SSA_wf_base.CFG_SSA_wf_defs uninst_code.ssa.trivial_phis_def
  <span class="keyword1"><span class="command">unfolding</span></span> fun_upd_same
  <span class="keyword1"><span class="command">..</span></span>

  <span class="keyword1" id="Construct_SSA_notriv_code-uses'_ign"><span class="command">lemma</span></span> uses'_ign<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"uninst_code.uses'_codem <span class="main">(</span>const <span class="free">u</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> uninst_code.uses'_codem <span class="main">(</span>u_g <span class="free">g</span> <span class="free">u</span><span class="main">)</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> uninst_code.uses'_codem_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> uninst.substNext_code_def uninst.substitution_code_def uninst_code.ssa.trivial_code_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> CFG_SSA_wf_base.CFG_SSA_wf_defs
    uninst.uses'_code_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-phis'_ign"><span class="command">lemma</span></span> phis'_ign<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"uninst_code.phis'_code <span class="main">(</span>const <span class="free">p</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> uninst_code.phis'_code <span class="main">(</span><span class="free">phis</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> uninst_code.phis'_code_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> uninst.substNext_code_def uninst.substitution_code_def uninst_code.ssa.trivial_code_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> CFG_SSA_wf_base.CFG_SSA_wf_defs
  <span class="keyword1"><span class="command">unfolding</span></span> fun_upd_same
  <span class="keyword1"><span class="command">..</span></span>

  <span class="keyword1" id="Construct_SSA_notriv_code-phis'm_ign"><span class="command">lemma</span></span> phis'm_ign<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"uninst_code.phis'_codem <span class="main">(</span>const <span class="free">p</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> uninst_code.phis'_codem <span class="main">(</span><span class="free">phis</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> uninst_code.phis'_codem_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> uninst.substNext_code_def uninst.substitution_code_def uninst_code.ssa.trivial_code_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> CFG_SSA_wf_base.CFG_SSA_wf_defs
  <span class="keyword1"><span class="command">unfolding</span></span> fun_upd_same
  <span class="keyword1"><span class="command">..</span></span>

  <span class="keyword1" id="Construct_SSA_notriv_code-set_sorted_list_of_set_phis_dom"><span class="command">lemma</span></span> set_sorted_list_of_set_phis_dom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>sorted_list_of_set <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> dom <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> dom <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> set_sorted_list_of_set<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ ssa.phis_finite <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-phis'_codem_correct"><span class="command">lemma</span></span> phis'_codem_correct<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">nodes_of_phis</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>φ</sub></span> <span class="main">(</span>ssa.phiNodes_of <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">next</span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"phis'_codem <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_phis</span> <span class="main">=</span> phis'_code <span class="free">g</span> <span class="free">next</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"phis'_code <span class="free">g</span> <span class="free">next</span> <span class="main">=</span> mmap <span class="main">(</span>map <span class="main">(</span>substNext_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Mapping.delete <span class="free">next</span> <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> phis'_code_def mmap_def phi_equiv_mapping_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mapping_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Mapping_lookup_map_values Mapping_lookup_map Option.bind_def map_option_case lookup_delete keys_dom_lookup
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ssa.phis_disj <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"fst <span class="free"><span class="free">next</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span></span> v<span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"snd <span class="free"><span class="free">next</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> phis'_codem <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_phis</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> phis'_codem_def mmap_def ssa.lookup_phiNodes_of <span class="main">[</span><span class="operator">OF</span> ssa.phis_finite<span class="main">]</span> phi_equiv_mapping_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mapping_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Mapping_lookup_map lookup_delete map_option_case<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">next</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
    <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> map_idI
      <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> substNext_code_def keys_dom_lookup fun_upd_apply
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_notriv_code-uses_transfer"><span class="command">lemma</span></span> uses_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rel_fun <span class="main">(=)</span> <span class="main">(</span>pcr_mapping <span class="main">(=)</span> <span class="main">(=)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="bound">n</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">uses</span> <span class="bound">g</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span> <span class="free">uses</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mapping.pcr_cr_eq cr_mapping_def Mapping.lookup.rep_eq<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-uses'_codem_correct"><span class="command">lemma</span></span> uses'_codem_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">nodes_of_uses</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>φ</sub></span> ssa.useNodes_of <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">next</span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"usesOf <span class="main">(</span>uses'_codem <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_uses</span><span class="main">)</span> <span class="main">=</span> uses'_code <span class="free">g</span> <span class="free">next</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dom_uses_in_graph <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> uses'_codem_def uses'_code_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mmap_def Mapping.replace_def <span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> phi_equiv_mapping_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer'</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> finite
             <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">uses</span> <span class="free">g</span><span class="main">)</span> <span class="bound">n</span> <span class="main">=</span> Some <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span>
                 <span class="main">(</span><span class="main">∀</span><span class="bound">x2</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">uses</span> <span class="free">g</span><span class="main">)</span> <span class="bound">n</span> <span class="main">=</span> Some <span class="bound">x2</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="bound">x2</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> B<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Mapping.keys_dom_lookup<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_of_map_restrict restrict_map_def substNext_code_def fold_update_conv Mapping.keys_dom_lookup
    <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-step_ign"><span class="command">lemma</span></span> step_ign<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"uninst_code.step_codem <span class="main">(</span>const <span class="free">u</span><span class="main">)</span> <span class="main">(</span>const <span class="free">p</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> uninst_code.step_codem <span class="main">(</span>u_g <span class="free">g</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="free">phis</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uninst_code.step_codem_def Let_def<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-cN_transfer"><span class="command">lemma</span></span> cN_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rel_fun <span class="main">(=)</span> <span class="main">(</span>rel_fun <span class="main">(</span>pcr_mapping <span class="main">(=)</span> <span class="main">(=)</span><span class="main">)</span> <span class="main">(=)</span><span class="main">)</span><span class="main">)</span> cN <span class="free">chooseNext_all</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_fun_def mapping.pcr_cr_eq cr_mapping_def mapping.rep_inverse<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-usesOf_transfer"><span class="command">lemma</span></span> usesOf_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rel_fun <span class="main">(</span>pcr_mapping <span class="main">(=)</span> <span class="main">(=)</span><span class="main">)</span> <span class="main">(=)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span> <span class="bound">x</span><span class="main">.</span> case_option <span class="main">{}</span> id <span class="main">(</span><span class="bound">m</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>  usesOf"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_fun_def mapping.pcr_cr_eq cr_mapping_def Mapping.lookup.rep_eq<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-dom_phis'_codem"><span class="command">lemma</span></span> dom_phis'_codem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ns</span><span class="main">.</span> Mapping.lookup <span class="free">nodes_of_phis</span> <span class="main">(</span>snd <span class="free">next</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">ns</span> <span class="main">⟹</span> finite <span class="bound">ns</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>Mapping.lookup <span class="main">(</span>phis'_codem <span class="free">g</span> <span class="free">next</span> <span class="free">next'</span> <span class="free">nodes_of_phis</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dom <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>case_option <span class="main">{}</span> id <span class="main">(</span>Mapping.lookup <span class="free">nodes_of_phis</span> <span class="main">(</span>snd <span class="free">next</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">next</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> phis'_codem_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits option.splits  <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_delete<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-dom_phis'_code"><span class="command">lemma</span></span> dom_phis'_code <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>Mapping.lookup <span class="main">(</span>phis'_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dom <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> snd <span class="bound">v</span> <span class="main">=</span> snd <span class="free">next</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phis'_code_def Mapping_lookup_map_values bind_eq_Some_conv<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-nodes_of_phis_finite"><span class="command">lemma</span></span> nodes_of_phis_finite <span class="main">[</span><span class="operator">simplified</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">nodes_of_phis</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>φ</sub></span> ssa.phiNodes_of <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="free">nodes_of_phis</span> <span class="free">v</span> <span class="main">=</span> Some <span class="free">ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> Mapping.keys <span class="main">(</span>ssa.phidefNodes <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> phi_equiv_mapping_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">v</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ ssa.phis_finite <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-lookup_phis'_codem_next"><span class="command">lemma</span></span> lookup_phis'_codem_next<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ns</span><span class="main">.</span> Mapping.lookup <span class="free">nodes_of_phis</span> <span class="main">(</span>snd <span class="free">next</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">ns</span> <span class="main">⟹</span> finite <span class="bound">ns</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span>phis'_codem <span class="free">g</span> <span class="free">next</span> <span class="free">next'</span> <span class="free">nodes_of_phis</span><span class="main">)</span> <span class="free">next</span> <span class="main">=</span> None"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> phis'_codem_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Set.remove_def lookup_delete <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-lookup_phis'_codem_other"><span class="command">lemma</span></span> lookup_phis'_codem_other<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">nodes_of_phis</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>φ</sub></span> <span class="main">(</span>ssa.phiNodes_of <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">next</span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">next</span> <span class="main">≠</span> <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span>phis'_codem <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_phis</span><span class="main">)</span> <span class="free">φ</span> <span class="main">=</span>
    map_option <span class="main">(</span>map <span class="main">(</span>substNext_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"snd <span class="free">next</span> <span class="main">≠</span> snd <span class="free">φ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> phis'_codem_correct <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> phis'_code_def
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> map_idI <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Mapping_lookup_map_values substNext_code_def lookup_delete map_option_case <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits prod.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">next</span> <span class="main">=</span> snd <span class="free">φ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="free">next</span> <span class="main">≠</span> fst <span class="free">φ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">next</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> False <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="free">φ</span> <span class="main">=</span> None"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">φ</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">next</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ssa.phis_disj<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹fst <span class="free">next</span> <span class="main">≠</span> fst <span class="free">φ</span>›</span></span> <span class="quoted"><span class="quoted">‹snd <span class="free">next</span> <span class="main">=</span> snd <span class="free">φ</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> phis'_codem_correct <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> phis'_code_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Mapping_lookup_map_values lookup_delete map_option_case substNext_code_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_notriv_code-lookup_nodes_of_phis'_subst"><span class="command">lemma</span></span> lookup_nodes_of_phis'_subst <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span>nodes_of_phis' <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_phis</span><span class="main">)</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="main">=</span>
    Some <span class="main">(</span><span class="main">(</span>case_option <span class="main">{}</span> <span class="main">(</span>Set.remove <span class="free">next</span><span class="main">)</span> <span class="main">(</span>Mapping.lookup <span class="free">nodes_of_phis</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>case_option <span class="main">{}</span> <span class="main">(</span>Set.remove <span class="free">next</span><span class="main">)</span> <span class="main">(</span>Mapping.lookup <span class="free">nodes_of_phis</span> <span class="main">(</span>snd <span class="free">next</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nodes_of_phis'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Mapping_lookup_map_default Set.remove_def lookup_delete <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-lookup_nodes_of_phis'_not_subst"><span class="command">lemma</span></span> lookup_nodes_of_phis'_not_subst<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> substitution_code <span class="free">g</span> <span class="free">next</span> <span class="main">⟹</span>
  Mapping.lookup <span class="main">(</span>nodes_of_phis' <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_phis</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">v</span> <span class="main">=</span> snd <span class="free">next</span> <span class="keyword1">then</span> None <span class="keyword1">else</span> Mapping.lookup <span class="free">nodes_of_phis</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nodes_of_phis'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Mapping_lookup_map_default lookup_delete<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-lookup_phis'_code"><span class="command">lemma</span></span> lookup_phis'_code<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span>phis'_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> snd <span class="free">v</span> <span class="main">=</span> snd <span class="free">next</span> <span class="keyword1">then</span> None <span class="keyword1">else</span> map_option <span class="main">(</span>map <span class="main">(</span>substNext_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> phis'_code_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Mapping_lookup_map_values bind_eq_None_conv map_conv_bind_option comp_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-phi_equiv_mappingE'"><span class="command">lemma</span></span> phi_equiv_mappingE'<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">m<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>φ</sub></span> ssa.phiNodes_of <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Some <span class="free">vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> snd <span class="main">`</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="free">m<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">=</span> Some <span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> <span class="free">b</span> <span class="main">∈</span> set <span class="main">(</span>the <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> phi_equiv_mapping_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> n φ_args<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">n</span><span class="main">,</span><span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">force</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-phi_equiv_mappingE"><span class="command">lemma</span></span> phi_equiv_mappingE<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">m<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>φ</sub></span> ssa.phiNodes_of <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Some <span class="free">vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">b</span> <span class="main">∈</span> set <span class="free">vs</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="free">m<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>snd <span class="free">b</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> snd <span class="free">b</span> <span class="main">∈</span> set <span class="main">(</span>the <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">b</span> <span class="main">∈</span> snd <span class="main">`</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> phi_equiv_mappingE'<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_notriv_code-phi_equiv_mappingE2'"><span class="command">lemma</span></span> phi_equiv_mappingE2'<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">m<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>φ</sub></span> ssa.phiNodes_of <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> snd <span class="main">`</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">φ</span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> <span class="free">b</span> <span class="main">∉</span> set <span class="main">(</span>the <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="bound">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="free">m<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">=</span> None <span class="main">∨</span> Mapping.lookup <span class="free">m<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">=</span> Some <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> phi_equiv_mapping_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> n φ_args<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">n</span><span class="main">,</span><span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="free">m<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-keys_phis'_codem"><span class="command">lemma</span></span> keys_phis'_codem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.keys <span class="main">(</span>phis'_codem <span class="free">g</span> <span class="free">next</span> <span class="free">next'</span> <span class="main">(</span>ssa.phiNodes_of <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">next</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> phis'_codem_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup fun_upd_apply lookup_delete <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-keys_phis'_codem'"><span class="command">lemma</span></span> keys_phis'_codem'<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">nodes_of_phis</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>φ</sub></span> ssa.phiNodes_of <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">next</span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Mapping.keys <span class="main">(</span>phis'_codem <span class="free">g</span> <span class="free">next</span> <span class="free">next'</span> <span class="free">nodes_of_phis</span><span class="main">)</span> <span class="main">=</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">next</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> phis'_codem_def phi_equiv_mapping_def ssa.keys_phidefNodes <span class="main">[</span><span class="operator">OF</span> ssa.phis_finite<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fold_update_conv fun_upd_apply keys_dom_lookup lookup_delete<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-triv_phis'_correct"><span class="command">lemma</span></span> triv_phis'_correct<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">nodes_of_phis</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>φ</sub></span> ssa.phiNodes_of <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">next</span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ssa.trivial <span class="free">g</span> <span class="main">(</span>snd <span class="free">next</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"uninst_code.triv_phis' <span class="main">(</span>const <span class="main">(</span>phis'_codem <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_phis</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>ssa.trivial_phis <span class="free">g</span><span class="main">)</span> <span class="free">nodes_of_phis</span> <span class="main">=</span> uninst_code.ssa.trivial_phis <span class="main">(</span>const <span class="main">(</span>phis'_codem <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_phis</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> keys_phis'_codem' <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">φ</span>

    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> ssa.phis_in_αn <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="quoted">"fst <span class="free">next</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">next</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ssa.redundant <span class="free">g</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ssa.redundant_def ssa.allVars_def ssa.allDefs_def ssa.phiDefs_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">next</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> step<span class="main">:</span> CFG_SSA_step_code <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">chooseNext_all</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u_g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.Mapping <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> step.u_g <span class="bound">g</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> None <span class="keyword1">else</span> Some <span class="main">(</span>step.u_g <span class="bound">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p_g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.Mapping <span class="main">(</span>step.p_g <span class="bound">g</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> u_g_is_u_g<span class="main">:</span> <span class="quoted"><span class="quoted">"usesOf <span class="main">∘</span> <span class="var">?u_g</span> <span class="main">=</span> step.u_g"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> usesOf_def <span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> p_g_is_p_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="var">?p_g</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> step.p_g"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">interpret</span></span> step<span class="main">:</span> CFG_SSA_wf_code <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.Mapping <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> step.u_g <span class="bound">g</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> None <span class="keyword1">else</span> Some <span class="main">(</span>step.u_g <span class="bound">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.Mapping <span class="main">(</span>step.p_g <span class="bound">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> CFG_SSA_wf_code.intro CFG_SSA_code.intro<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> u_g_is_u_g p_g_is_p_g <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_locales</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">∈</span> uninst_code.triv_phis' <span class="main">(</span>const <span class="main">(</span>phis'_codem <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_phis</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>ssa.trivial_phis <span class="free">g</span><span class="main">)</span> <span class="free">nodes_of_phis</span> <span class="main">⟷</span> <span class="skolem">φ</span> <span class="main">∈</span> uninst_code.ssa.trivial_phis <span class="main">(</span>const <span class="main">(</span>phis'_codem <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_phis</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">=</span> <span class="free">next</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">∉</span> uninst_code.triv_phis' <span class="main">(</span>const <span class="main">(</span>phis'_codem <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_phis</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>ssa.trivial_phis <span class="free">g</span><span class="main">)</span> <span class="free">nodes_of_phis</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> uninst_code.triv_phis'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">∉</span> Mapping.keys <span class="main">(</span>phis'_codem <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_phis</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> phis'_codem_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">nodes_of_phis</span></span> <span class="quoted"><span class="quoted">"<span class="free">next</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fold_update_conv <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits option.splits<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">∉</span> uninst_code.ssa.trivial_phis <span class="main">(</span>const <span class="main">(</span>phis'_codem <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_phis</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> uninst_code.ssa.trivial_phis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="free">nodes_of_phis</span> <span class="main">(</span>snd <span class="free">next</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> None
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"uninst_code.triv_phis' <span class="main">(</span>const <span class="main">(</span>phis'_codem <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_phis</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>ssa.trivial_phis <span class="free">g</span><span class="main">)</span> <span class="free">nodes_of_phis</span> <span class="main">=</span> ssa.trivial_phis <span class="free">g</span> <span class="main">-</span> <span class="main">{</span><span class="free">next</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> uninst_code.triv_phis'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> None
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uninst_code.ssa.trivial_phis <span class="main">(</span>const <span class="main">(</span>phis'_codem <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_phis</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> ssa.trivial_phis <span class="free">g</span> <span class="main">-</span> <span class="main">{</span><span class="free">next</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> phis'_codem_def uninst_code.ssa.trivial_phis_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_delete<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>Some <span class="skolem">nodes</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">next</span> <span class="main">∈</span> snd <span class="main">`</span> dom <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> Some <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">nodes</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nodes_of_phis_finite<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>sorted_list_of_set <span class="skolem">nodes</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">nodes</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">φ_node</span></span> <span class="skolem"><span class="skolem">φ_val</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">φ_node</span><span class="main">,</span> <span class="skolem">φ_val</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">φ</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">∈</span> <span class="skolem">nodes</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="main">≠</span> <span class="free">next</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">∈</span> uninst_code.triv_phis' <span class="main">(</span>const <span class="main">(</span>phis'_codem <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_phis</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>ssa.trivial_phis <span class="free">g</span><span class="main">)</span> <span class="free">nodes_of_phis</span> <span class="main">⟷</span> <span class="skolem">φ</span> <span class="main">∈</span> ssa.trivial_phis <span class="free">g</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> uninst_code.triv_phis'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span>

          <span class="keyword1"><span class="command">from</span></span> False <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="main">≠</span> <span class="free">next</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="skolem">φ</span> <span class="main">∈</span> uninst_code.ssa.trivial_phis <span class="main">(</span>const <span class="main">(</span>phis'_codem <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_phis</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> phis'_codem_def uninst_code.ssa.trivial_phis_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> keys_dom_lookup dom_def lookup_delete<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> phi_equiv_mapping_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">next</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits<span class="main">)</span>

          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">φ_args</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">φ_node</span><span class="main">,</span> <span class="skolem">φ_val</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">φ_args</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> keys_dom_lookup <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ssa.phi <span class="free">g</span> <span class="skolem">φ_val</span> <span class="main">=</span> Some <span class="skolem">φ_args</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ssa.phis_phi<span class="main">)</span>

          <span class="keyword1"><span class="command">from</span></span> True <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="main">≠</span> <span class="free">next</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">∈</span> uninst_code.triv_phis' <span class="main">(</span>const <span class="main">(</span>phis'_codem <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_phis</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>ssa.trivial_phis <span class="free">g</span><span class="main">)</span> <span class="free">nodes_of_phis</span> <span class="main">⟷</span>
            <span class="skolem">φ</span> <span class="main">∈</span> ssa.trivial_phis <span class="free">g</span> <span class="main">∨</span> ssa.trivial_code <span class="main">(</span>snd <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>Mapping.lookup <span class="main">(</span>phis'_codem <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_phis</span><span class="main">)</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> uninst_code.triv_phis'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span>

          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="main">≠</span> <span class="free">next</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">next</span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ_val</span> <span class="main">≠</span> snd <span class="free">next</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> keys_dom_lookup
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">next</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ssa.phis_disj<span class="main">)</span>

          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">∈</span> ssa.trivial_phis <span class="free">g</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ssa.trivial_code <span class="skolem">φ_val</span> <span class="skolem">φ_args</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> ssa.trivial_phis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ssa.trivial_code <span class="skolem">φ_val</span> <span class="main">(</span>map <span class="main">(</span>substNext_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="skolem">φ_args</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ssa.trivial_code_mapI<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> substNext_code_def<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> substNext_code_def substitution_code_def<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">φ_val</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> equalityCE<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"ssa.isTrivialPhi <span class="free">g</span> <span class="skolem">φ_val</span> <span class="main">(</span>snd <span class="free">next</span><span class="main">)</span>"</span></span><span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"ssa.isTrivialPhi <span class="free">g</span> <span class="main">(</span>snd <span class="free">next</span><span class="main">)</span> <span class="skolem">φ_val</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> isTrivialPhi_asymmetric<span class="main">)</span>
               <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">next</span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>›</span></span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ssa.trivial_def keys_dom_lookup<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> isTrivial_the_trivial <span class="main"><span class="main">[</span></span><span class="operator">rotated</span> 1<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> v<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"snd <span class="free">next</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ssa.phis_phi <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"fst <span class="free">next</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ_val</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">v</span><span class="main">)</span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ssa.trivial_code <span class="skolem">φ_val</span> <span class="skolem">φ_args</span>›</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ssa.trivial_code_def<span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> the_trivial_SomeE<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ssa.isTrivialPhi_def<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> calculation True <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="main">≠</span> <span class="free">next</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="main">∈</span> <span class="skolem">nodes</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> uninst_code.ssa.trivial_phis_def phis'_codem_def
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup substNext_code_alt_def<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">with</span></span> calculation <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="main">≠</span> <span class="free">next</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>›</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> phis'_codem_def uninst_code.ssa.trivial_phis_def
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup triv_phis'_def ssa.trivial_code_def<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_notriv_code-nodes_of_phis'_correct"><span class="command">lemma</span></span> nodes_of_phis'_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">nodes_of_phis</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>φ</sub></span> ssa.phiNodes_of <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">next</span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ssa.trivial <span class="free">g</span> <span class="main">(</span>snd <span class="free">next</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="main">(</span>nodes_of_phis' <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_phis</span><span class="main">)</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>φ</sub></span> <span class="main">(</span>uninst_code.ssa.phiNodes_of <span class="main">(</span>const <span class="main">(</span>phis'_codem <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_phis</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">next_args</span></span> <span class="keyword2"><span class="keyword">where</span></span> lookup_next <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="free">next</span> <span class="main">=</span> Some <span class="skolem">next_args</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> keys_dom_lookup <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> phi_next <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ssa.phi <span class="free">g</span> <span class="main">(</span>snd <span class="free">next</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">next_args</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> ssa.phis_phi <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"fst <span class="free">next</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> in_next_args<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> set <span class="skolem">next_args</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">=</span> snd <span class="free">next</span> <span class="main">∨</span> <span class="bound">v</span> <span class="main">=</span> substitution_code <span class="free">g</span> <span class="free">next</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ssa.trivial_def substitution_code_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> isTrivial_the_trivial<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ssa.phis_phi <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> n<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"fst <span class="free">next</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ssa.isTrivialPhi_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">dest</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">vs</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> snd <span class="free">next</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">vs</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> fst <span class="free">next</span> <span class="main">∧</span> <span class="bound">vs</span> <span class="main">=</span> <span class="skolem">next_args</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> keys_dom_lookup <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ssa.phis_disj <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n'<span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"fst <span class="free"><span class="free">next</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> phi_equiv_mapping_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>dom <span class="main">(</span>Mapping.lookup <span class="main">(</span>phis'_codem <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_phis</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> dom_phis'_codem<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> nodes_of_phis_finite <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="main">[</span><span class="operator">simplified</span> keys_dom_lookup<span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ssa.phis_finite <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> nodes_of_phis_finite <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="main">[</span><span class="operator">simplified</span> keys_dom_lookup<span class="main">]</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> phis'_codem_correct <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> v<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> ssa.keys_phidefNodes <span class="main"><span class="main">[</span></span><span class="operator">OF</span> ssa.phis_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> uninst_code.ssa.lookup_phiNodes_of<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lookup_phis'_code<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> substNext_code_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> dom_phis'_code<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">φ</span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> snd <span class="free">next</span> <span class="main">∈</span> set <span class="main">(</span>the <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="bound">φ</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> bexE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> keys_dom_lookup<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> domD<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> phi_equiv_mappingE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"substitution_code <span class="free">g</span> <span class="free">next</span> <span class="main">∈</span> snd <span class="main">`</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">φ'</span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> substitution_code <span class="free">g</span> <span class="free">next</span> <span class="main">∈</span> set <span class="main">(</span>the <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="bound">φ'</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> bexE<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> keys_dom_lookup<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> domD<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">φ'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> phi_equiv_mappingE' <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">v</span> <span class="main">=</span> substitution_code <span class="free">g</span> <span class="free">next</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lookup_nodes_of_phis'_subst<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_phis'_code<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> 4 4 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_image_eqI
          <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup map_option_case substNext_code_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lookup_nodes_of_phis'_not_subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">φ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> <span class="improper">v</span> <span class="main">∈</span> set <span class="main">(</span>the <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="bound">φ<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> bexE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> domD<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">φ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> phi_equiv_mappingE' <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> n v φ_args n' v' n'' φ_args' φ_args''<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_next_args<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">n</span><span class="main">,</span><span class="improper">v</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_next_args<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command">using</span></span> phi_equiv_mappingE2' <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">rotated</span> 1<span class="main">]</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">v</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_allE<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> meta_impE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">using</span></span> phi_equiv_mappingE2' <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">rotated</span> 1<span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"substitution_code <span class="free">g</span> <span class="free">next</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_allE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> meta_impE<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> meta_impE<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">v</span> <span class="main">=</span> substitution_code <span class="free">g</span> <span class="free">next</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lookup_nodes_of_phis'_not_subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">φ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> <span class="improper">v</span> <span class="main">∈</span> set <span class="main">(</span>the <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="bound">φ<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> bexE<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> domD<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">φ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> phi_equiv_mappingE' <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_next_args<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_next_args<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_next_args<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command">using</span></span> phi_equiv_mappingE2' <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">rotated</span> 1<span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">v</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_allE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> meta_impE<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">v</span> <span class="main">=</span> substitution_code <span class="free">g</span> <span class="free">next</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lookup_nodes_of_phis'_not_subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">φ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> <span class="improper">v</span> <span class="main">∈</span> set <span class="main">(</span>the <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="bound">φ<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> bexE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> domD<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">φ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> phi_equiv_mappingE' <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_next_args<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_next_args<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command">using</span></span> phi_equiv_mappingE2' <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">rotated</span> 1<span class="main">]</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_allE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> meta_impE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">using</span></span> phi_equiv_mappingE2' <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">rotated</span> 1<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"snd <span class="free">next</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> meta_impE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> meta_impE<span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> snd <span class="free">next</span> <span class="main">∈</span> set <span class="main">(</span>the <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"substitution_code <span class="free">g</span> <span class="free">next</span> <span class="main">∈</span> snd <span class="main">`</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">φ'</span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> substitution_code <span class="free">g</span> <span class="free">next</span> <span class="main">∈</span> set <span class="main">(</span>the <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="bound">φ'</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> bexE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> keys_dom_lookup<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> domD<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">φ'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> phi_equiv_mappingE' <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">v</span> <span class="main">=</span> substitution_code <span class="free">g</span> <span class="free">next</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lookup_nodes_of_phis'_not_subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">φ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> <span class="improper">v</span> <span class="main">∈</span> set <span class="main">(</span>the <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="bound">φ<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> bexE<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> domD<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">φ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> phi_equiv_mappingE' <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_next_args<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_next_args<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_next_args<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command">using</span></span> phi_equiv_mappingE2' <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">rotated</span> 1<span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">v</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_allE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> meta_impE<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command">using</span></span> phi_equiv_mappingE2' <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">rotated</span> 1<span class="main">]</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"substitution_code <span class="free">g</span> <span class="free">next</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_allE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> meta_impE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> meta_impE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">v</span> <span class="main">=</span> substitution_code <span class="free">g</span> <span class="free">next</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lookup_nodes_of_phis'_not_subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">φ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> <span class="improper">v</span> <span class="main">∈</span> set <span class="main">(</span>the <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="bound">φ<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> bexE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> domD<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">φ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> phi_equiv_mappingE' <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_next_args<span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_next_args<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command">using</span></span> phi_equiv_mappingE2' <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">rotated</span> 1<span class="main">]</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_allE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> meta_impE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> meta_impE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">v</span> <span class="main">=</span> substitution_code <span class="free">g</span> <span class="free">next</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lookup_nodes_of_phis'_not_subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">φ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> <span class="improper">v</span> <span class="main">∈</span> set <span class="main">(</span>the <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="bound">φ<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> bexE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> domD<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">φ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> phi_equiv_mappingE' <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_next_args<span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_next_args<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> phi_equiv_mappingE2' <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">rotated</span> 1<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">v</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> meta_impE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> meta_impE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Construct_SSA_notriv_code-nodes_of_uses'_correct"><span class="command">lemma</span></span> nodes_of_uses'_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="free">nodes_of_uses</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>φ</sub></span> ssa.useNodes_of <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">next</span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ssa.trivial <span class="free">g</span> <span class="main">(</span>snd <span class="free">next</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊢</span> <span class="main">(</span>nodes_of_uses' <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="main">(</span>Mapping.keys <span class="main">(</span>ssa.phidefNodes <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">nodes_of_uses</span><span class="main">)</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>φ</sub></span> <span class="main">(</span>uninst_code.ssa.useNodes_of <span class="main">(</span>const <span class="main">(</span>uses'_codem <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_uses</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> ssa.phis_in_αn <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="quoted">"fst <span class="free">next</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">next</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ssa.redundant <span class="free">g</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ssa.redundant_def ssa.allVars_def ssa.allDefs_def ssa.phiDefs_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">next</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> step<span class="main">:</span> CFG_SSA_step_code <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">uses</span>"</span></span> <span class="quoted"><span class="free">phis</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">chooseNext_all</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>


    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">next_args</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> lookup_next <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="free">next</span> <span class="main">=</span> Some <span class="skolem">next_args</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ssa.isTrivialPhi <span class="free">g</span> <span class="main">(</span>snd <span class="free">next</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> keys_dom_lookup ssa.trivial_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> phi_next <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ssa.phi <span class="free">g</span> <span class="main">(</span>snd <span class="free">next</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">next_args</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> ssa.phis_phi <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"fst <span class="free">next</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> the_trivial_next_args <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"the_trivial <span class="main">(</span>snd <span class="free">next</span><span class="main">)</span> <span class="skolem">next_args</span> <span class="main">=</span> Some <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ssa.isTrivialPhi <span class="free">g</span> <span class="main">(</span>snd <span class="free">next</span><span class="main">)</span> <span class="skolem">v</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> isTrivial_the_trivial<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> in_next_args<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> set <span class="skolem">next_args</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">=</span> snd <span class="free">next</span> <span class="main">∨</span> <span class="bound">v</span> <span class="main">=</span> substitution_code <span class="free">g</span> <span class="free">next</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ssa.trivial_def substitution_code_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> the_trivial_next_args<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> isTrivial_the_trivial<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ssa.phis_phi <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> n<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"fst <span class="free">next</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ssa.isTrivialPhi_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ssa.isTrivialPhi <span class="free">g</span> <span class="main">(</span>snd <span class="free">next</span><span class="main">)</span> <span class="skolem">v</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> triv_phi_is_v <span class="main">[</span><span class="operator">dest</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v'</span><span class="main">.</span> ssa.isTrivialPhi <span class="free">g</span> <span class="main">(</span>snd <span class="free">next</span><span class="main">)</span> <span class="bound">v'</span> <span class="main">⟹</span> <span class="bound">v'</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> isTrivialPhi_det <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ssa.isTrivialPhi <span class="free">g</span> <span class="main">(</span>snd <span class="free">next</span><span class="main">)</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> snd <span class="free">next</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ssa.isTrivialPhi_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">dest</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">vs</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> snd <span class="free">next</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">vs</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> fst <span class="free">next</span> <span class="main">∧</span> <span class="bound">vs</span> <span class="main">=</span> <span class="skolem">next_args</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> keys_dom_lookup <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ssa.phis_disj <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n'<span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"fst <span class="free"><span class="free">next</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>CFG_base.useNodes_of <span class="free">αn</span>
              <span class="main">(</span>const
                <span class="main">(</span>CFG_SSA_Transformed_notriv_base.uses' <span class="free">αn</span> <span class="free">defs</span> <span class="main">(</span>usesOf <span class="main">∘</span> <span class="free">uses</span><span class="main">)</span>
                  <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> cN <span class="free">g</span><span class="main">)</span><span class="main">)</span>
              <span class="free">g</span><span class="main">)</span>
     <span class="main">=</span> <span class="main">(</span>CFG_base.useNodes_of <span class="free">αn</span>
     <span class="main">(</span><span class="main">(</span>usesOf <span class="main">∘</span> <span class="free">uses</span><span class="main">)</span>
      <span class="main">(</span><span class="free">g</span> <span class="main">:=</span> CFG_SSA_Transformed_notriv_base.uses' <span class="free">αn</span> <span class="free">defs</span> <span class="main">(</span>usesOf <span class="main">∘</span> <span class="free">uses</span><span class="main">)</span>
             <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> cN <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> uninst.useNodes_of_def uninst.addN_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> substNext_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> substNext <span class="free">g</span> <span class="main">(</span>substNext <span class="free">g</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> substNext <span class="free">g</span> <span class="bound">v</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> substNext_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> nodes_of_uses_eq_NoneD <span class="main">[</span><span class="operator">elim_format</span><span class="main">,</span> <span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">n</span> <span class="bound">args</span><span class="main">.</span> <span class="main">⟦</span>Mapping.lookup <span class="free">nodes_of_uses</span> <span class="bound">v</span> <span class="main">=</span> None<span class="main">;</span> Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">args</span> <span class="main">⟧</span>
      <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">vs</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">uses</span> <span class="free">g</span><span class="main">)</span> <span class="bound">n</span> <span class="main">=</span> Some <span class="bound">vs</span> <span class="main">⟶</span> <span class="bound">v</span> <span class="main">∉</span> <span class="bound">vs</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">unfolding</span></span> phi_equiv_mapping_def
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ssa.lookup_useNodes_of <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits<span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">n</span><span class="main">,</span><span class="improper">v</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> nodes_of_uses_eq_SomeD <span class="main">[</span><span class="operator">elim_format</span><span class="main">,</span> <span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">nodes</span> <span class="bound">n</span> <span class="bound">args</span><span class="main">.</span> <span class="main">⟦</span> Mapping.lookup <span class="free">nodes_of_uses</span> <span class="bound">v</span> <span class="main">=</span> Some <span class="bound">nodes</span><span class="main">;</span> Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">args</span><span class="main">⟧</span>
      <span class="main">⟹</span> <span class="bound">nodes</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">vs</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">uses</span> <span class="free">g</span><span class="main">)</span> <span class="bound">n</span> <span class="main">=</span> Some <span class="bound">vs</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> <span class="bound">vs</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> phi_equiv_mapping_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ssa.lookup_useNodes_of <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">n</span><span class="main">,</span><span class="improper">v</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> phi_equiv_mapping_def nodes_of_uses'_def substitution_code_def Let_def ssa.keys_phidefNodes <span class="main">[</span><span class="operator">OF</span> ssa.phis_finite<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> o_def <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"const <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem">g</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> uses'_codem_correct <span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> substitution_code_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> uninst.lookup_useNodes_of'<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uses'_code_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> ssa.uses_finite <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> snd <span class="main">`</span> dom <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_image_eqI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_delete uninst_code.uses'_code_def substNext_code_def substitution_code_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Mapping_lookup_map_default lookup_delete uses'_code_def substNext_code_def substitution_code_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> n n' v' phi_args phi_args'<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
                         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> nodes_of_uses_eq_SomeD <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"fst <span class="free">next</span>"</span></span><span class="main"><span class="main">]</span></span>
                           nodes_of_uses_eq_NoneD <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"fst <span class="free">next</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phi_equiv_mapping_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>13<span class="main"><span class="keyword3">]</span></span>

            <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> phi_equiv_mapping_def<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">n</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ssa.lookup_useNodes_of <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>

           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> nodes_of_uses_eq_SomeD <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"fst <span class="free">next</span>"</span></span><span class="main"><span class="main">]</span></span>
             nodes_of_uses_eq_NoneD <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"fst <span class="free">next</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>

          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> phi_equiv_mapping_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">n</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ssa.lookup_useNodes_of <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>

         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> 4 3 <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> nodes_of_uses_eq_SomeD <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"fst <span class="free">next</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>4<span class="main"><span class="keyword3">]</span></span>

     <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> phi_equiv_mapping_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">n'</span><span class="main">,</span><span class="improper">v'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ssa.lookup_useNodes_of <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>

    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">definition</span></span><span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">substAll_efficient</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span>
    <span class="keyword1">let</span> <span class="bound">phiVals</span> <span class="main">=</span> Mapping.keys <span class="main">(</span>ssa.phidefNodes <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">;</span>
        <span class="bound">u</span> <span class="main">=</span> <span class="free">uses</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">;</span>
        <span class="bound">p</span> <span class="main">=</span> <span class="free">phis</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">;</span>
        <span class="bound">tp</span> <span class="main">=</span> ssa.trivial_phis <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">;</span>
        <span class="bound">nou</span> <span class="main">=</span> ssa.useNodes_of <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">;</span>
        <span class="bound">nop</span> <span class="main">=</span> ssa.phiNodes_of <span class="free"><span class="bound"><span class="entity">g</span></span></span>
    <span class="keyword1">in</span>
    while
    <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">,</span><span class="bound">triv_phis</span><span class="main">,</span><span class="bound">nodes_of_uses</span><span class="main">,</span><span class="bound">nodes_of_phis</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> Set.is_empty <span class="bound">triv_phis</span><span class="main">)</span>
    <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">,</span><span class="bound">triv_phis</span><span class="main">,</span><span class="bound">nodes_of_uses</span><span class="main">,</span><span class="bound">nodes_of_phis</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">let</span>
        <span class="bound">next</span> <span class="main">=</span> Max <span class="bound">triv_phis</span><span class="main">;</span>
        <span class="bound">next'</span> <span class="main">=</span> uninst_code.substitution_code <span class="main">(</span>const <span class="bound">p</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">next</span><span class="main">;</span>
        <span class="main">(</span><span class="bound">u'</span><span class="main">,</span><span class="bound">p'</span><span class="main">)</span> <span class="main">=</span> uninst_code.step_codem <span class="main">(</span>const <span class="bound">u</span><span class="main">)</span> <span class="main">(</span>const <span class="bound">p</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">next</span> <span class="bound">next'</span> <span class="bound">nodes_of_uses</span> <span class="bound">nodes_of_phis</span><span class="main">;</span>
        <span class="bound">tp'</span> <span class="main">=</span> uninst_code.triv_phis' <span class="main">(</span>const <span class="bound">p'</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">next</span> <span class="bound">triv_phis</span> <span class="bound">nodes_of_phis</span><span class="main">;</span>
        <span class="bound">nou'</span> <span class="main">=</span> uninst_code.nodes_of_uses' <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">next</span> <span class="bound">next'</span> <span class="bound">phiVals</span> <span class="bound">nodes_of_uses</span><span class="main">;</span>
        <span class="bound">nop'</span> <span class="main">=</span> uninst_code.nodes_of_phis' <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">next</span> <span class="bound">next'</span> <span class="bound">nodes_of_phis</span>
      <span class="keyword1">in</span> <span class="main">(</span><span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">p'</span><span class="main">)</span><span class="main">,</span> <span class="bound">tp'</span><span class="main">,</span> <span class="bound">nou'</span><span class="main">,</span> <span class="bound">nop'</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">,</span> <span class="bound">tp</span><span class="main">,</span> <span class="bound">nou</span><span class="main">,</span> <span class="bound">nop</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">u_c</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> const <span class="main">(</span>usesOf <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">p_c</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> const <span class="main">(</span>Mapping.lookup <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> u_g <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> p_g <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="Construct_SSA_notriv_code-usesOf_upd"><span class="command">lemma</span></span> usesOf_upd <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>usesOf <span class="main">∘</span> u <span class="free">g</span> <span class="free">s1</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="main">:=</span> usesOf <span class="free">us</span><span class="main">)</span> <span class="main">=</span> usesOf <span class="main">∘</span> u_g <span class="free">g</span> <span class="free">us</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_upd_apply usesOf_def <span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-keys_uses'_codem"><span class="command">lemma</span></span> keys_uses'_codem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.keys <span class="main">(</span>uses'_codem <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="main">(</span>ssa.useNodes_of <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Mapping.keys <span class="main">(</span><span class="free">uses</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> uses'_codem_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fold_update_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> sorted_list_of_set<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ finite_set<span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-keys_uses'_codem'"><span class="command">lemma</span></span> keys_uses'_codem'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">g</span> <span class="main">⊢</span> <span class="free">nodes_of_uses</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>φ</sub></span> ssa.useNodes_of <span class="free">g</span><span class="main">;</span> <span class="free">next</span> <span class="main">∈</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟧</span>
    <span class="main">⟹</span> Mapping.keys <span class="main">(</span>uses'_codem <span class="free">g</span> <span class="free">next</span> <span class="main">(</span>substitution_code <span class="free">g</span> <span class="free">next</span><span class="main">)</span> <span class="free">nodes_of_uses</span><span class="main">)</span> <span class="main">=</span> Mapping.keys <span class="main">(</span><span class="free">uses</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> uses'_codem_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phi_equiv_mapping_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">next</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ssa.lookup_useNodes_of <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits option.splits<span class="main">)</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-triv_phis_base"><span class="command">lemma</span></span> triv_phis_base <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"uninst_code.ssa.trivial_phis <span class="main">(</span>const <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> ssa.trivial_phis <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> uninst_code.ssa.trivial_phis_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1" id="Construct_SSA_notriv_code-useNodes_of_base"><span class="command">lemma</span></span> useNodes_of_base <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"uninst_code.ssa.useNodes_of <span class="main">(</span>const <span class="main">(</span><span class="free">uses</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> ssa.useNodes_of <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> uninst_code.ssa.useNodes_of_def uninst_code.ssa.addN_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> mmap_def Mapping.map_default_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> Mapping.default_def
    <span class="keyword1"><span class="command">unfolding</span></span> usesOf_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-phiNodes_of_base"><span class="command">lemma</span></span> phiNodes_of_base <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"uninst_code.ssa.phiNodes_of <span class="main">(</span>const <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> ssa.phiNodes_of <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> uninst_code.ssa.phiNodes_of_def uninst_code.ssa.phis_addN_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> mmap_def Mapping.map_default_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> Mapping.default_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-phi_equiv_mapping_refl"><span class="command">lemma</span></span> phi_equiv_mapping_refl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"uninst_code.phi_equiv_mapping <span class="free">ph</span> <span class="free">g</span> <span class="free">m</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> uninst_code.phi_equiv_mapping_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1" id="Construct_SSA_notriv_code-substAll_efficient_code"><span class="command">lemma</span></span> substAll_efficient_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"substAll <span class="free">g</span> <span class="main">=</span> map_prod usesOf Mapping.lookup <span class="main">(</span>fst <span class="main">(</span>substAll_efficient <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> substAll_efficient_def while_def substAll_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> map_option_the <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ substAll_terminates<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> while_option_sim <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span>
      R<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> map_option <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> map_prod usesOf Mapping.lookup <span class="main">(</span>fst <span class="main">(</span><span class="skolem">f</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span>
      I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">,</span><span class="bound">triv_phis</span><span class="main">,</span><span class="bound">nodes_of_uses</span><span class="main">,</span> <span class="bound">phis_of_nodes</span><span class="main">)</span><span class="main">.</span> Mapping.keys <span class="bound">u</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">∧</span> Mapping.keys <span class="bound">p</span> <span class="main">⊆</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>
        <span class="main">∧</span> CFG_SSA_Transformed_notriv_linorder_code <span class="free">αe</span> <span class="free">αn</span> <span class="free">invar</span> <span class="free">inEdges'</span> <span class="free">Entry</span> <span class="free">oldDefs</span> <span class="free">oldUses</span> <span class="free">defs</span> <span class="main">(</span><span class="free">uses</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">phis</span><span class="main">(</span><span class="free">g</span><span class="main">:=</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="free">var</span> <span class="free">chooseNext_all</span>
        <span class="main">∧</span> <span class="bound">triv_phis</span> <span class="main">=</span> uninst_code.ssa.trivial_phis <span class="main">(</span>const <span class="bound">p</span><span class="main">)</span> <span class="free">g</span>
        <span class="main">∧</span> uninst_code.phi_equiv_mapping <span class="main">(</span>const <span class="bound">p</span><span class="main">)</span> <span class="free">g</span> <span class="bound">nodes_of_uses</span> <span class="main">(</span>uninst_code.ssa.useNodes_of <span class="main">(</span>const <span class="bound">u</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span>
        <span class="main">∧</span> uninst_code.phi_equiv_mapping <span class="main">(</span>const <span class="bound">p</span><span class="main">)</span> <span class="free">g</span> <span class="bound">phis_of_nodes</span> <span class="main">(</span>uninst_code.ssa.phiNodes_of <span class="main">(</span>const <span class="bound">p</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem">f</span>
      <span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_def dom_uses_in_graph Set.is_empty_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"CFG_SSA_Transformed_notriv_linorder_code <span class="free">αe</span> <span class="free">αn</span> <span class="free">invar</span> <span class="free">inEdges'</span> <span class="free">Entry</span> <span class="free">oldDefs</span> <span class="free">oldUses</span> <span class="free">defs</span> <span class="free">uses</span> <span class="free">phis</span> <span class="free">var</span>
     <span class="free">chooseNext_all</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s1</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Mapping.keys <span class="main">(</span>fst <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">∧</span> Mapping.keys <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>
      <span class="main">∧</span> CFG_SSA_Transformed_notriv_linorder_code <span class="free">αe</span> <span class="free">αn</span> <span class="free">invar</span> <span class="free">inEdges'</span> <span class="free">Entry</span> <span class="free">oldDefs</span> <span class="free">oldUses</span> <span class="free">defs</span> <span class="main">(</span>u <span class="free">g</span> <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>p <span class="free">g</span> <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="free">var</span> <span class="free">chooseNext_all</span>
      <span class="main">∧</span> fst <span class="main">(</span>snd <span class="skolem">s1</span><span class="main">)</span> <span class="main">=</span> uninst_code.ssa.trivial_phis <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span>
      <span class="main">∧</span> uninst_code.phi_equiv_mapping <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>uninst_code.ssa.useNodes_of <span class="main">(</span>const <span class="main">(</span>fst <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span>
      <span class="main">∧</span> uninst_code.phi_equiv_mapping <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>uninst_code.ssa.phiNodes_of <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s1_uses</span></span> <span class="skolem"><span class="skolem">s1_phis</span></span> <span class="skolem"><span class="skolem">s1_triv_phis</span></span> <span class="skolem"><span class="skolem">s1_nodes_of_uses</span></span> <span class="skolem"><span class="skolem">s1_phi_nodes_of</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s1_uses</span><span class="main">,</span> <span class="skolem">s1_phis</span><span class="main">)</span><span class="main">,</span> <span class="skolem">s1_triv_phis</span><span class="main">,</span> <span class="skolem">s1_nodes_of_uses</span><span class="main">,</span> <span class="skolem">s1_phi_nodes_of</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Mapping.keys <span class="skolem">s1_uses</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Mapping.keys <span class="skolem">s1_phis</span> <span class="main">⊆</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"CFG_SSA_Transformed_notriv_linorder_code <span class="free">αe</span> <span class="free">αn</span> <span class="free">invar</span> <span class="free">inEdges'</span> <span class="free">Entry</span> <span class="free">oldDefs</span> <span class="free">oldUses</span> <span class="free">defs</span> <span class="main">(</span>u_g <span class="free">g</span> <span class="skolem">s1_uses</span><span class="main">)</span> <span class="main">(</span>p_g <span class="free">g</span> <span class="skolem">s1_phis</span><span class="main">)</span> <span class="free">var</span> <span class="free">chooseNext_all</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s1_triv_phis</span> <span class="main">=</span> uninst_code.ssa.trivial_phis <span class="main">(</span>const <span class="skolem">s1_phis</span><span class="main">)</span> <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> nou_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"uninst_code.phi_equiv_mapping <span class="main">(</span>const <span class="skolem">s1_phis</span><span class="main">)</span> <span class="free">g</span> <span class="skolem">s1_nodes_of_uses</span> <span class="main">(</span>uninst_code.ssa.useNodes_of <span class="main">(</span>const <span class="skolem">s1_uses</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> pno_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"uninst_code.phi_equiv_mapping <span class="main">(</span>const <span class="skolem">s1_phis</span><span class="main">)</span> <span class="free">g</span> <span class="skolem">s1_phi_nodes_of</span> <span class="main">(</span>uninst_code.ssa.phiNodes_of <span class="main">(</span>const <span class="skolem">s1_phis</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">s1</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">interpret</span></span> i<span class="main">:</span> CFG_SSA_Transformed_notriv_linorder_code <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"u_g <span class="free">g</span> <span class="skolem">s1_uses</span>"</span></span> <span class="quoted"><span class="quoted">"p_g <span class="free">g</span> <span class="skolem">s1_phis</span>"</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">chooseNext_all</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_prod usesOf Mapping.lookup <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"uninst_code.ssa.trivial_phis <span class="main">(</span>const <span class="skolem">s1_phis</span><span class="main">)</span> <span class="free">g</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟷</span> cond <span class="free">g</span> <span class="var">?s2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> uninst_code.ssa.redundant_code_def <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cond_def i.ssa.redundant_code <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> CFG_SSA_wf_base.CFG_SSA_wf_defs<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"uninst_code.ssa.trivial_phis <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟷</span> cond <span class="free">g</span> <span class="var">?s2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"uninst_code.ssa.trivial_phis <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> red<span class="main">:</span> <span class="quoted"><span class="quoted">"uninst.redundant <span class="main">(</span>usesOf <span class="main">∘</span> u_g <span class="free">g</span> <span class="skolem">s1_uses</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g'</span><span class="main">.</span> Mapping.lookup <span class="main">(</span>p_g <span class="free">g</span> <span class="skolem">s1_phis</span> <span class="bound">g'</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cond_def uninst.CFG_SSA_wf_defs<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> step<span class="main">:</span> CFG_SSA_step_code <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span>
        <span class="quoted"><span class="quoted">"u_g <span class="free">g</span> <span class="skolem">s1_uses</span>"</span></span> <span class="quoted"><span class="quoted">"p_g <span class="free">g</span> <span class="skolem">s1_phis</span>"</span></span> <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">chooseNext_all</span></span> <span class="quoted"><span class="free">g</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> step.step_CFG_SSA_Transformed_notriv<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>
      <span class="keyword1"><span class="command">interpret</span></span> step_step<span class="main">:</span> CFG_SSA_Transformed_notriv <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>usesOf <span class="main">∘</span> u_g <span class="free">g</span> <span class="skolem">s1_uses</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="main">:=</span> uninst.uses' <span class="main">(</span>usesOf <span class="main">∘</span> u_g <span class="free">g</span> <span class="skolem">s1_uses</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g'</span><span class="main">.</span> Mapping.lookup <span class="main">(</span>p_g <span class="free">g</span> <span class="skolem">s1_phis</span> <span class="bound">g'</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">g'</span><span class="main">.</span> Mapping.lookup <span class="main">(</span>p_g <span class="free">g</span> <span class="skolem">s1_phis</span> <span class="bound">g'</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="main">:=</span> uninst.phis' <span class="main">(</span>usesOf <span class="main">∘</span> u_g <span class="free">g</span> <span class="skolem">s1_uses</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g'</span><span class="main">.</span> Mapping.lookup <span class="main">(</span>p_g <span class="free">g</span> <span class="skolem">s1_phis</span> <span class="bound">g'</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="free">var</span></span> <span class="quoted">i.cN</span> <span class="keyword1"><span class="command">.</span></span>

      <span class="keyword1"><span class="command">interpret</span></span> step_step<span class="main">:</span> CFG_SSA_ext <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges'</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>usesOf <span class="main">∘</span> u_g <span class="free">g</span> <span class="skolem">s1_uses</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="main">:=</span> uninst.uses' <span class="main">(</span>usesOf <span class="main">∘</span> <span class="main">(</span>u_g <span class="free">g</span> <span class="skolem">s1_uses</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g'</span><span class="main">.</span> Mapping.lookup <span class="main">(</span>p_g <span class="free">g</span> <span class="skolem">s1_phis</span> <span class="bound">g'</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">g'</span><span class="main">.</span> Mapping.lookup <span class="main">(</span>p_g <span class="free">g</span> <span class="skolem">s1_phis</span> <span class="bound">g'</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="main">:=</span> uninst.phis' <span class="main">(</span>usesOf <span class="main">∘</span> u_g <span class="free">g</span> <span class="skolem">s1_uses</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g'</span><span class="main">.</span> Mapping.lookup <span class="main">(</span>p_g <span class="free">g</span> <span class="skolem">s1_phis</span> <span class="bound">g'</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">..</span></span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Mapping.keys <span class="skolem">s1_uses</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> keys_u_g<span class="main">:</span> <span class="quoted"><span class="quoted">"Mapping.keys <span class="main">(</span>u_g <span class="free">g</span> <span class="skolem">s1_uses</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>CFG_SSA_wf_base_code.trivial_phis <span class="main">(</span>p_g <span class="free">g</span> <span class="skolem">s1_phis</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="free">chooseNext_all</span> <span class="main">(</span>usesOf <span class="main">(</span>u_g <span class="free">g</span> <span class="skolem">s1_uses</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>p_g <span class="free">g</span> <span class="skolem">s1_phis</span> <span class="free">g</span><span class="main">)</span> <span class="free">g</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> chooseNext_all_code <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> u<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"u_g <span class="free">g</span> <span class="skolem">s1_uses</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i.ssa.redundant_code <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

      <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>CFG_SSA_wf_base_code.trivial_phis <span class="main">(</span>const <span class="skolem">s1_phis</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="free">chooseNext_all</span> <span class="main">(</span>usesOf <span class="skolem">s1_uses</span><span class="main">)</span> <span class="skolem">s1_phis</span> <span class="free">g</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uninst_code.ssa.trivial_phis_def<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">chooseNext_all</span> <span class="main">(</span>usesOf <span class="skolem">s1_uses</span><span class="main">)</span> <span class="skolem">s1_phis</span> <span class="free">g</span> <span class="main">∈</span> Mapping.keys <span class="skolem">s1_phis</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i.chooseNext' <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Mapping.keys_dom_lookup<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"uninst_code.ssa.useNodes_of <span class="main">(</span>const <span class="skolem">s1_uses</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> uninst_code.ssa.useNodes_of <span class="main">(</span>u_g <span class="free">g</span> <span class="skolem">s1_uses</span><span class="main">)</span> <span class="free">g</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> uninst_code.ssa.useNodes_of_def
        <span class="keyword1"><span class="command">unfolding</span></span> uninst_code.ssa.addN_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"uninst_code.ssa.phiNodes_of <span class="main">(</span>const <span class="skolem">s1_phis</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> uninst_code.ssa.phiNodes_of <span class="main">(</span>p_g <span class="free">g</span> <span class="skolem">s1_phis</span><span class="main">)</span> <span class="free">g</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> uninst_code.ssa.phiNodes_of_def
        <span class="keyword1"><span class="command">unfolding</span></span> uninst_code.ssa.phis_addN_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Mapping.keys <span class="skolem">s1_phis</span> <span class="main">⊆</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Mapping.keys <span class="skolem">s1_phis</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ssa.phis_finite<span class="main">)</span>

      <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"uninst_code.phi_equiv_mapping <span class="main">(</span>const <span class="skolem">s1_phis</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> uninst_code.phi_equiv_mapping <span class="main">(</span>p_g <span class="free">g</span> <span class="skolem">s1_phis</span><span class="main">)</span> <span class="free">g</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uninst_code.phi_equiv_mapping_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> uninst.keys_phidefNodes<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>

      <span class="keyword1"><span class="command">have</span></span> uses_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>usesOf <span class="main">∘</span>
          u_g <span class="free">g</span>
           <span class="main">(</span>CFG_SSA_Transformed_notriv_base_code.uses'_codem <span class="main">(</span>u_g <span class="free">g</span> <span class="skolem">s1_uses</span><span class="main">)</span>
             <span class="free">g</span> <span class="main">(</span><span class="free">chooseNext_all</span> <span class="main">(</span>usesOf <span class="skolem">s1_uses</span><span class="main">)</span> <span class="skolem">s1_phis</span> <span class="free">g</span><span class="main">)</span>
             <span class="main">(</span>uninst_code.substitution_code <span class="main">(</span>p_g <span class="free">g</span> <span class="skolem">s1_phis</span><span class="main">)</span> <span class="free">g</span> <span class="main">(</span><span class="free">chooseNext_all</span> <span class="main">(</span>usesOf <span class="skolem">s1_uses</span><span class="main">)</span> <span class="skolem">s1_phis</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>
             <span class="skolem">s1_nodes_of_uses</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">=</span> <span class="main">(</span><span class="main">(</span>usesOf <span class="main">∘</span> u_g <span class="free">g</span> <span class="skolem">s1_uses</span><span class="main">)</span>
       <span class="main">(</span><span class="free">g</span> <span class="main">:=</span> CFG_SSA_Transformed_notriv_base.uses' <span class="free">αn</span> <span class="free">defs</span> <span class="main">(</span>usesOf <span class="main">∘</span> u_g <span class="free">g</span> <span class="skolem">s1_uses</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ga</span><span class="main">.</span> Mapping.lookup <span class="main">(</span>p_g <span class="free">g</span> <span class="skolem">s1_phis</span> <span class="bound">ga</span><span class="main">)</span><span class="main">)</span>
              i.cN <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">unfolding</span></span> i.uses'_code_correct <span class="main">[</span><span class="operator">OF</span> red<span class="main">]</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> i.uses'_codem_correct <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> nodes_of_uses<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">s1_nodes_of_uses</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> nou_equiv <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> phis_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">ga</span><span class="main">.</span> Mapping.lookup
                <span class="main">(</span>p_g <span class="free">g</span> <span class="main">(</span>CFG_SSA_Transformed_notriv_base_code.phis'_codem <span class="main">(</span>p_g <span class="free">g</span> <span class="skolem">s1_phis</span><span class="main">)</span> <span class="free">g</span>
                         <span class="main">(</span><span class="free">chooseNext_all</span> <span class="main">(</span>usesOf <span class="skolem">s1_uses</span><span class="main">)</span> <span class="skolem">s1_phis</span> <span class="free">g</span><span class="main">)</span>
                         <span class="main">(</span>uninst_code.substitution_code <span class="main">(</span>p_g <span class="free">g</span> <span class="skolem">s1_phis</span><span class="main">)</span> <span class="free">g</span> <span class="main">(</span><span class="free">chooseNext_all</span> <span class="main">(</span>usesOf <span class="skolem">s1_uses</span><span class="main">)</span> <span class="skolem">s1_phis</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">(</span>CFG_SSA_base.phiNodes_of <span class="main">(</span><span class="main">λ</span><span class="bound">ga</span><span class="main">.</span> Mapping.lookup <span class="main">(</span>p_g <span class="free">g</span> <span class="skolem">s1_phis</span> <span class="bound">ga</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>
                  <span class="bound">ga</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">(</span><span class="main">λ</span><span class="bound">ga</span><span class="main">.</span> Mapping.lookup <span class="main">(</span>p_g <span class="free">g</span> <span class="skolem">s1_phis</span> <span class="bound">ga</span><span class="main">)</span><span class="main">)</span>
       <span class="main">(</span><span class="free">g</span> <span class="main">:=</span> CFG_SSA_Transformed_notriv_base.phis' <span class="free">αn</span> <span class="free">defs</span> <span class="main">(</span>usesOf <span class="main">∘</span> u_g <span class="free">g</span> <span class="skolem">s1_uses</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ga</span><span class="main">.</span> Mapping.lookup <span class="main">(</span>p_g <span class="free">g</span> <span class="skolem">s1_phis</span> <span class="bound">ga</span><span class="main">)</span><span class="main">)</span>
              i.cN <span class="free">g</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> i.phis'_code_correct <span class="main"><span class="main">[</span></span><span class="operator">OF</span> red<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> i.phis'_codem_correct <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"uninst_code.substitution_code <span class="main">(</span>const <span class="skolem">s1_phis</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> uninst_code.substitution_code <span class="main">(</span>p_g <span class="free">g</span> <span class="skolem">s1_phis</span><span class="main">)</span> <span class="free">g</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uninst_code.substitution_code_def<span class="main">)</span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?next</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>uninst_code.ssa.trivial_phis <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>uninst_code.step_codem <span class="main">(</span>u <span class="free">g</span> <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>p <span class="free">g</span> <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span> <span class="main">(</span>uninst_code.substitution_code <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>uninst_code.step_codem <span class="main">(</span>u <span class="free">g</span> <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>p <span class="free">g</span> <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span> <span class="main">(</span>uninst_code.substitution_code <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

      <span class="keyword3"><span class="command">show</span></span> step_s2<span class="main">:</span> <span class="quoted"><span class="quoted">"step <span class="free">g</span> <span class="var">?s2</span> <span class="main">=</span> map_prod usesOf Mapping.lookup <span class="main">(</span>uninst_code.step_codem <span class="main">(</span>u <span class="free">g</span> <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>p <span class="free">g</span> <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span>
        <span class="var">?next</span> <span class="main">(</span>uninst_code.substitution_code <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span><span class="main">)</span>
        <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> uninst_code.step_codem_def uninst.step_def split_def map_prod_def Let_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_prod_def Let_def step_step.usesOf_cache<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span>
        i.phis'_codem_correct <span class="main"><span class="main">[</span></span><span class="operator">OF</span> pno_equiv <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">simplified</span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span>
        i.phis'_code_correct<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> red<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
        i.uses'_codem_correct <span class="main"><span class="main">[</span></span><span class="operator">OF</span> nou_equiv <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">simplified</span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span>
        i.uses'_code_correct <span class="main"><span class="main">[</span></span><span class="operator">OF</span> red<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> uninst.uses'_def <span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uninst.substNext_def uninst.substitution_def CFG_SSA_wf_base.CFG_SSA_wf_defs<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> uninst.phis'_def <span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uninst.substNext_def <span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> uninst.substitution_def CFG_SSA_wf_base.CFG_SSA_wf_defs <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong option.case_cong<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
        <span class="quoted"><span class="quoted">"uninst_code.phis'_codem <span class="main">(</span>p <span class="free">g</span> <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span> <span class="main">(</span>uninst_code.substitution_code <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span><span class="main">)</span> <span class="skolem">s1_phi_nodes_of</span>
          <span class="main">=</span> uninst_code.phis'_codem <span class="main">(</span>p <span class="free">g</span> <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span> <span class="main">(</span>uninst_code.substitution_code <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span><span class="main">)</span> <span class="main">(</span>uninst_code.ssa.phiNodes_of <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i.phis'_codem_correct <span class="main"><span class="main">[</span></span><span class="operator">OF</span> phi_equiv_mapping_refl<span class="main"><span class="main">]</span></span> i.phis'_codem_correct <span class="main"><span class="main">[</span></span><span class="operator">OF</span> pno_equiv <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">simplified</span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
        <span class="quoted"><span class="quoted">"usesOf <span class="main">(</span>uninst_code.uses'_codem <span class="main">(</span>u <span class="free">g</span> <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span> <span class="main">(</span>uninst_code.substitution_code <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span><span class="main">)</span> <span class="skolem">s1_nodes_of_uses</span><span class="main">)</span>
          <span class="main">=</span> usesOf <span class="main">(</span>uninst_code.uses'_codem <span class="main">(</span>u <span class="free">g</span> <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span> <span class="main">(</span>uninst_code.substitution_code <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span><span class="main">)</span> <span class="main">(</span>uninst_code.ssa.useNodes_of <span class="main">(</span>const <span class="main">(</span>fst <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i.uses'_codem_correct <span class="main"><span class="main">[</span></span><span class="operator">OF</span> phi_equiv_mapping_refl<span class="main"><span class="main">]</span></span> i.uses'_codem_correct <span class="main"><span class="main">[</span></span><span class="operator">OF</span> nou_equiv <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">simplified</span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> step_s2<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> step.step_CFG_SSA_Transformed_notriv <span class="quoted"><span class="quoted">‹Mapping.keys <span class="skolem">s1_uses</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span>›</span></span>
        <span class="quoted"><span class="quoted">‹Mapping.keys <span class="skolem">s1_phis</span> <span class="main">⊆</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Mapping.keys <span class="var">?u'</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">∧</span>
          Mapping.keys <span class="var">?p'</span> <span class="main">⊆</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="main">∧</span>
          CFG_SSA_Transformed_notriv_linorder_code <span class="free">αe</span> <span class="free">αn</span> <span class="free">invar</span> <span class="free">inEdges'</span> <span class="free">Entry</span> <span class="free">oldDefs</span> <span class="free">oldUses</span> <span class="free">defs</span>
           <span class="main">(</span>u <span class="free">g</span> <span class="main">(</span>uninst_code.step_codem <span class="main">(</span>u <span class="free">g</span> <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>p <span class="free">g</span> <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span> <span class="main">(</span>uninst_code.substitution_code <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span><span class="main">)</span> <span class="skolem">s1_nodes_of_uses</span> <span class="skolem">s1_phi_nodes_of</span><span class="main">)</span><span class="main">)</span>
           <span class="main">(</span>p <span class="free">g</span> <span class="main">(</span>uninst_code.step_codem <span class="main">(</span>u <span class="free">g</span> <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>p <span class="free">g</span> <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span> <span class="main">(</span>uninst_code.substitution_code <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span><span class="main">)</span> <span class="skolem">s1_nodes_of_uses</span> <span class="skolem">s1_phi_nodes_of</span><span class="main">)</span><span class="main">)</span>
           <span class="free">var</span> <span class="free">chooseNext_all</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> CFG_SSA_Transformed_notriv_linorder_code_def
        CFG_SSA_Transformed_notriv_linorder_def
        CFG_SSA_Transformed_code_def
        CFG_SSA_wf_code_def CFG_SSA_code_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_prod_def split_def uninst_code.step_codem_def Let_def uses_conv phis_conv<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> g'<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">≠</span> <span class="improper">g'</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dom_uses_in_graph chooseNext_all_code
          <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_upd_apply
            i.keys_phis'_codem' <span class="main"><span class="main">[</span></span><span class="operator">OF</span> pno_equiv <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">simplified</span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?next</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> fun_upd_apply<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span>
            i.keys_uses'_codem' <span class="main"><span class="main">[</span></span><span class="operator">OF</span> nou_equiv <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">simplified</span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?next</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> fun_upd_apply<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"uninst_code.ssa.trivial_phis <span class="main">(</span>p_g <span class="free">g</span> <span class="skolem">s1_phis</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> uninst_code.ssa.trivial_phis <span class="main">(</span>const <span class="skolem">s1_phis</span><span class="main">)</span> <span class="free">g</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> uninst_code.ssa.trivial_phis_def uninst_code.ssa.trivial_code_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>

      <span class="keyword1"><span class="command">from</span></span> i.triv_phis'_correct <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?next</span></span></span><span class="main">]</span> i.chooseNext' <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uninst_code.triv_phis' <span class="main">(</span>const <span class="var">?p'</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span> <span class="skolem">s1_triv_phis</span> <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
        <span class="main">=</span> uninst_code.ssa.trivial_phis <span class="main">(</span>const <span class="var">?p'</span><span class="main">)</span> <span class="free">g</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> pno_equiv <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uninst_code.step_codem_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Mapping.keys <span class="skolem">s1_phis</span> <span class="main">⊆</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>›</span></span> ssa.phis_finite
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>dom <span class="main">(</span>Mapping.lookup <span class="skolem">s1_phis</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_dom_lookup<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> phi_equiv_mapping_p'I <span class="main">[</span><span class="operator">simplified</span><span class="main">]</span><span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m1</span> <span class="bound">m2</span><span class="main">.</span> uninst_code.phi_equiv_mapping <span class="main">(</span>const <span class="skolem">s1_phis</span><span class="main">)</span> <span class="free">g</span> <span class="bound">m1</span> <span class="bound">m2</span> <span class="main">⟹</span> uninst_code.phi_equiv_mapping <span class="main">(</span>const <span class="var">?p'</span><span class="main">)</span> <span class="free">g</span> <span class="bound">m1</span> <span class="bound">m2</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> uninst_code.phi_equiv_mapping_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> uninst.keys_phidefNodes<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> uninst.keys_phidefNodes<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uninst_code.step_codem_def keys_dom_lookup <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uninst_code.step_codem_def keys_dom_lookup <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">fastforce</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?next</span> <span class="main">∈</span> Mapping.keys <span class="skolem">s1_phis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Mapping.keys <span class="skolem">s1_phis</span> <span class="main">⊆</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span>›</span></span> nou_equiv i.chooseNext' <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uninst_code.nodes_of_uses' <span class="free">g</span> <span class="var">?next</span> <span class="main">(</span>uninst_code.substitution_code <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">`</span> dom <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
        <span class="main">=</span> uninst_code.nodes_of_uses' <span class="free">g</span> <span class="var">?next</span> <span class="main">(</span>uninst_code.substitution_code <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">`</span> dom <span class="main">(</span>Mapping.lookup <span class="skolem">s1_phis</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> uninst_code.nodes_of_uses'_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> meta_impE<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def uninst_code.substitution_code_def keys_dom_lookup uninst_code.ssa.trivial_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> i.isTrivial_the_trivial <span class="main"><span class="main">[</span></span><span class="operator">rotated</span> 1<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i.ssa.phis_phi <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"fst <span class="var">?next</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> i.ssa.allVars_in_allDefs<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> ssa.phis_phi<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uninst_code.ssa.allVars_def uninst_code.ssa.allDefs_def uninst_code.ssa.allUses_def uninst_code.ssa.phiDefs_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ssa.simpleDef_not_phi<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_image_eqI<span class="main">)</span>

      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Mapping.keys <span class="var">?u'</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">αn</span> <span class="free">g</span><span class="main">)</span> <span class="main">∧</span>
          Mapping.keys <span class="var">?p'</span> <span class="main">⊆</span> Mapping.keys <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span> <span class="main">∧</span>
          CFG_SSA_Transformed_notriv_linorder_code <span class="free">αe</span> <span class="free">αn</span> <span class="free">invar</span> <span class="free">inEdges'</span> <span class="free">Entry</span> <span class="free">oldDefs</span> <span class="free">oldUses</span> <span class="free">defs</span>
           <span class="main">(</span>u <span class="free">g</span> <span class="main">(</span>uninst_code.step_codem <span class="main">(</span>u <span class="free">g</span> <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>p <span class="free">g</span> <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="main">(</span>Max <span class="main">(</span>uninst_code.ssa.trivial_phis <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>uninst_code.substitution_code <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">(</span>p <span class="free">g</span> <span class="main">(</span>uninst_code.step_codem <span class="main">(</span>u <span class="free">g</span> <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>p <span class="free">g</span> <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="main">(</span>Max <span class="main">(</span>uninst_code.ssa.trivial_phis <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>uninst_code.substitution_code <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="free">var</span> <span class="free">chooseNext_all</span> <span class="main">∧</span>
          uninst_code.triv_phis' <span class="main">(</span>const <span class="var">?p'</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span> <span class="main">(</span>uninst_code.ssa.trivial_phis <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">=</span> uninst_code.ssa.trivial_phis <span class="main">(</span>const <span class="var">?p'</span><span class="main">)</span> <span class="free">g</span> <span class="main">∧</span>
          uninst_code.phi_equiv_mapping <span class="main">(</span>const <span class="var">?p'</span><span class="main">)</span> <span class="free">g</span> <span class="main">(</span>uninst_code.nodes_of_uses' <span class="free">g</span> <span class="var">?next</span> <span class="main">(</span>uninst_code.substitution_code <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">`</span> dom <span class="main">(</span>Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>uninst_code.ssa.useNodes_of <span class="main">(</span>const <span class="var">?u'</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span> <span class="main">∧</span>
          uninst_code.phi_equiv_mapping <span class="main">(</span>const <span class="var">?p'</span><span class="main">)</span> <span class="free">g</span> <span class="main">(</span>uninst_code.nodes_of_phis' <span class="free">g</span> <span class="var">?next</span> <span class="main">(</span>uninst_code.substitution_code <span class="main">(</span>const <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="var">?next</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>uninst_code.ssa.phiNodes_of <span class="main">(</span>const <span class="var">?p'</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i.nodes_of_uses'_correct <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">s1_nodes_of_uses</span></span> <span class="var"><span class="quoted"><span class="var">?next</span></span></span><span class="main">,</span> <span class="operator">OF</span> nou_equiv <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">]</span>
        i.chooseNext' <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span>
        i.nodes_of_phis'_correct <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">s1_phi_nodes_of</span></span> <span class="var"><span class="quoted"><span class="var">?next</span></span></span><span class="main">,</span> <span class="operator">OF</span> pno_equiv <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> phi_equiv_mapping_p'I<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uninst_code.step_codem_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> phi_equiv_mapping_p'I<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uninst_code.step_codem_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Generic_Interpretation">
<div class="head">
<h1>Theory Generic_Interpretation</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Generic_Interpretation.thy
    Author:     Sebastian Ullrich, Denis Lohner
*)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Generic Code Extraction Based on typedefs›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Generic_Interpretation
<span class="keyword2"><span class="keyword">imports</span></span>
<a href="#Construct_SSA_code">Construct_SSA_code</a>
<a href="#Construct_SSA_notriv_code">Construct_SSA_notriv_code</a>
<a href="#RBT_Mapping_Exts">RBT_Mapping_Exts</a>
<a href="#SSA_Transfer_Rules">SSA_Transfer_Rules</a>
<span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/RBT_Set.html">HOL-Library.RBT_Set</a>"</span>
<span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Code_Target_Numeral.html">HOL-Library.Code_Target_Numeral</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">record</span></span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">,</span> <span class="tfree">'edge</span><span class="main">)</span> gen_cfg <span class="main">=</span>
  gen_αe <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'edge</span><span class="main">)</span> edge set"</span></span>
  gen_αn <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'node</span> list"</span></span>
  gen_inEdges <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'edge</span><span class="main">)</span> edge list"</span></span>
  gen_Entry <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'node</span>"</span></span>
  gen_defs <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span>
  gen_uses <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">trivial_gen_cfg</span> <span class="free"><span class="bound"><span class="entity">ext</span></span></span> <span class="main">≡</span> gen_cfg_ext <span class="main">{}</span> <span class="main">[</span>undefined<span class="main">]</span> <span class="main">(</span>const <span class="main">[]</span><span class="main">)</span> undefined <span class="main">(</span>const <span class="main">{}</span><span class="main">)</span> <span class="main">(</span>const <span class="main">{}</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ext</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">ign</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">::</span>unit<span class="main">)</span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span>"</span></span>

<span class="keyword1" id="Generic_Interpretation-set_iterator_foldri_Nil"><span class="command">lemma</span></span> set_iterator_foldri_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set_iterator <span class="main">(</span>foldri <span class="main">[]</span><span class="main">)</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_iterator_I<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> foldri_def<span class="main">)</span>

<span class="keyword1" id="Generic_Interpretation-set_iterator_foldri_one"><span class="command">lemma</span></span> set_iterator_foldri_one <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set_iterator <span class="main">(</span>foldri <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_iterator_I<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> foldri_def<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">gen_inEdges'</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">d</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>gen_inEdges <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Generic_Interpretation-gen_cfg_inhabited"><span class="command">lemma</span></span> gen_cfg_inhabited<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">g</span> <span class="main">=</span> trivial_gen_cfg <span class="free">ext</span> <span class="keyword1">in</span> CFG_wf <span class="main">(</span>ign gen_αe <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>ign gen_αn <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>const True<span class="main">)</span> <span class="main">(</span>ign gen_inEdges' <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>ign gen_Entry <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>ign gen_defs <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>ign gen_uses <span class="bound">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_cfg.defs graph_path_base.path2_def pred_def graph_path_base.inEdges_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> graph_path_base.path.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> exI<span class="main">)</span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">,</span> <span class="tfree">'edge</span><span class="main">)</span> gen_cfg_wf <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">g</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'var</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'edge</span><span class="main">)</span> gen_cfg<span class="main">.</span>
  CFG_wf <span class="main">(</span>ign gen_αe <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>ign gen_αn <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>const True<span class="main">)</span> <span class="main">(</span>ign gen_inEdges' <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>ign gen_Entry <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>ign gen_defs <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>ign gen_uses <span class="bound">g</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"trivial_gen_cfg undefined"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_cfg_inhabited<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_gen_cfg_wf

<span class="keyword1"><span class="command">lift_definition</span></span> gen_wf_αn <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'var</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'edge</span><span class="main">)</span> gen_cfg_wf <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">gen_αn</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> gen_wf_αe <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'var</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'edge</span><span class="main">)</span> gen_cfg_wf <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'edge</span><span class="main">)</span> edge set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">gen_αe</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> gen_wf_inEdges <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'var</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'edge</span><span class="main">)</span> gen_cfg_wf <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'edge</span><span class="main">)</span> edge list"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">gen_inEdges</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> gen_wf_Entry <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'var</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'edge</span><span class="main">)</span> gen_cfg_wf <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">gen_Entry</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> gen_wf_defs <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'var</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'edge</span><span class="main">)</span> gen_cfg_wf <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">gen_defs</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> gen_wf_uses <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'var</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'edge</span><span class="main">)</span> gen_cfg_wf <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">gen_uses</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">gen_wf_invar</span> <span class="main">≡</span> const True"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">gen_wf_inEdges'</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">d</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>gen_wf_inEdges <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Generic_Interpretation-gen_wf_inEdges'_transfer"><span class="command">lemma</span></span> gen_wf_inEdges'_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rel_fun cr_gen_cfg_wf <span class="main">(=)</span> gen_inEdges' gen_wf_inEdges'"</span></span>
  <span class="keyword1"><span class="command">using</span></span> gen_wf_inEdges.transfer
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_fun_def cr_gen_cfg_wf_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1" id="Generic_Interpretation-gen_wf_invar_trans"><span class="command">lemma</span></span> gen_wf_invar_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_fun cr_gen_cfg_wf <span class="main">(=)</span> gen_wf_invar gen_wf_invar"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">declare</span></span> graph_path_base.transfer_rules<span class="main">[</span><span class="operator">OF</span> gen_cfg_wf.right_total gen_wf_αe.transfer gen_wf_αn.transfer gen_wf_invar_trans gen_wf_inEdges'_transfer<span class="main">,</span> <span class="operator">transfer_rule</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> CFG_base.defAss'_transfer<span class="main">[</span><span class="operator">OF</span> gen_cfg_wf.right_total gen_wf_αe.transfer gen_wf_αn.transfer gen_wf_invar_trans gen_wf_inEdges'_transfer<span class="main">,</span> <span class="operator">transfer_rule</span><span class="main">]</span>

<span class="keyword1"><span class="command">global_interpretation</span></span> gen_wf<span class="main">:</span> CFG_Construct_linorder <span class="quoted">gen_wf_αe</span> <span class="quoted">gen_wf_αn</span> <span class="quoted">gen_wf_invar</span> <span class="quoted">gen_wf_inEdges'</span> <span class="quoted">gen_wf_Entry</span> <span class="quoted">gen_wf_defs</span> <span class="quoted">gen_wf_uses</span>
<span class="keyword2"><span class="keyword">defines</span></span>
  gen_wf_predecessors <span class="main">=</span> <span class="quoted">gen_wf.predecessors</span> <span class="keyword2"><span class="keyword">and</span></span>
  gen_wf_successors <span class="main">=</span> <span class="quoted">gen_wf.successors</span> <span class="keyword2"><span class="keyword">and</span></span>
  gen_wf_defs' <span class="main">=</span> <span class="quoted">gen_wf.defs'</span> <span class="keyword2"><span class="keyword">and</span></span>
  gen_wf_vars <span class="main">=</span> <span class="quoted">gen_wf.vars</span> <span class="keyword2"><span class="keyword">and</span></span>
  gen_wf_var <span class="main">=</span> <span class="quoted">gen_wf.var</span> <span class="keyword2"><span class="keyword">and</span></span>
  gen_wf_readVariableRecursive <span class="main">=</span> <span class="quoted">gen_wf.readVariableRecursive</span> <span class="keyword2"><span class="keyword">and</span></span>
  gen_wf_readArgs <span class="main">=</span> <span class="quoted">gen_wf.readArgs</span> <span class="keyword2"><span class="keyword">and</span></span>
  gen_wf_uses'_phis' <span class="main">=</span> <span class="quoted">gen_wf.uses'_phis'</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CFG_Construct_wf_def CFG_wf_def CFG_def graph_Entry_def graph_path_def graph_Entry_axioms_def<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CFG_Construct_wf_def CFG_wf_def CFG_def graph_Entry_def graph_path_def graph_def<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CFG_Construct_wf_def CFG_wf_def CFG_def graph_Entry_def graph_path_def graph_def valid_graph_def<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CFG_Construct_wf_def CFG_wf_def CFG_def graph_Entry_def graph_path_def graph_Entry_axioms_def graph_def valid_graph_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_iterator_foldri_correct<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CFG_Construct_wf_def CFG_wf_def CFG_def graph_Entry_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> graph_path.αn_distinct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_Construct_wf_def CFG_wf_def CFG_def graph_Entry_def graph_path_def graph_pred_it_def graph_pred_it_axioms_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_Construct_wf_def CFG_wf_def CFG_def graph_Entry_def graph_Entry_axioms_def<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_Construct_wf_def CFG_wf_def CFG_def graph_Entry_def graph_Entry_axioms_def graph_path_base.inEdges_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_Construct_wf_def CFG_wf_def CFG_def graph_Entry_def graph_Entry_axioms_def graph_path_base.path2_def graph_path_base.path_def graph_path_base.predecessors_def graph_path_base.inEdges_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> CFG_Construct_wf_def CFG_wf_def CFG_def CFG_axioms_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> CFG_Construct_wf_def CFG_wf_def CFG_def CFG_axioms_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> CFG_Construct_wf_def CFG_wf_def CFG_def CFG_axioms_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> CFG_Construct_wf_def CFG_wf_def CFG_def CFG_axioms_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_Construct_wf_def CFG_wf_def CFG_wf_axioms_def CFG_base.defAss'_def <span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span>
  graph_path_base.path2_def graph_path_base.path_def graph_path_base.predecessors_def graph_path_base.inEdges_def<span class="main">)</span>

<span class="keyword1"><span class="command">record</span></span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">,</span> <span class="tfree">'edge</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> gen_ssa_cfg <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">,</span> <span class="tfree">'edge</span><span class="main">)</span> gen_cfg"</span></span> <span class="main">+</span>
  gen_ssa_defs <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span> set"</span></span>
  gen_ssa_uses <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span> set<span class="main">)</span> mapping"</span></span>
  gen_phis <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis_code"</span></span>
  gen_var <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'val</span> <span class="main">⇒</span> <span class="tfree">'var</span>"</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">,</span> <span class="tfree">'edge</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> gen_ssa_cfg_wf <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">g</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'var</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'edge</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">::</span>linorder<span class="main">)</span> gen_ssa_cfg<span class="main">.</span>
  CFG_SSA_Transformed_code <span class="main">(</span>ign gen_αe <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>ign gen_αn <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>const True<span class="main">)</span> <span class="main">(</span>ign gen_inEdges' <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>ign gen_Entry <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>ign gen_defs <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>ign gen_uses <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>ign gen_ssa_defs <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>ign gen_ssa_uses <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>ign gen_phis <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>ign gen_var <span class="bound">g</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"trivial_gen_cfg <span class="main">⦇</span> gen_ssa_defs <span class="main">=</span> const <span class="main">{}</span><span class="main">,</span> gen_ssa_uses <span class="main">=</span> Mapping.empty<span class="main">,</span> gen_phis <span class="main">=</span> Mapping.empty<span class="main">,</span> gen_var <span class="main">=</span> undefined<span class="main">,</span> <span class="main">…</span> <span class="main">=</span> undefined <span class="main">⦈</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_cfg.defs graph_path_base.path2_def dom_def Mapping.lookup_empty CFG_SSA_base.CFG_SSA_defs pred_def  graph_path_base.inEdges_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> graph_path_base.path.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> exI<span class="main">)</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_gen_ssa_cfg_wf

<span class="keyword1"><span class="command">lift_definition</span></span> gen_ssa_wf_αn <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'var</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'edge</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">::</span>linorder<span class="main">)</span> gen_ssa_cfg_wf <span class="main">⇒</span> <span class="tfree">'node</span> list"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">gen_αn</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> gen_ssa_wf_αe <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'var</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'edge</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">::</span>linorder<span class="main">)</span> gen_ssa_cfg_wf <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'edge</span><span class="main">)</span> edge set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">gen_αe</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> gen_ssa_wf_inEdges <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'var</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'edge</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">::</span>linorder<span class="main">)</span> gen_ssa_cfg_wf <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'edge</span><span class="main">)</span> edge list"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">gen_inEdges</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> gen_ssa_wf_Entry <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'var</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'edge</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">::</span>linorder<span class="main">)</span> gen_ssa_cfg_wf <span class="main">⇒</span> <span class="tfree">'node</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">gen_Entry</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> gen_ssa_wf_defs <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'var</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'edge</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">::</span>linorder<span class="main">)</span> gen_ssa_cfg_wf <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">gen_defs</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> gen_ssa_wf_uses <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'var</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'edge</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">::</span>linorder<span class="main">)</span> gen_ssa_cfg_wf <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">gen_uses</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> gen_ssa_wf_ssa_defs <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'var</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'edge</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">::</span>linorder<span class="main">)</span> gen_ssa_cfg_wf <span class="main">⇒</span> <span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'val</span> set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">gen_ssa_defs</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> gen_ssa_wf_ssa_uses <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'var</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'edge</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">::</span>linorder<span class="main">)</span> gen_ssa_cfg_wf <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span> set<span class="main">)</span> mapping"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">gen_ssa_uses</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> gen_ssa_wf_phis <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'var</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'edge</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">::</span>linorder<span class="main">)</span> gen_ssa_cfg_wf <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> phis_code"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">gen_phis</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> gen_ssa_wf_var <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'var</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'edge</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">::</span>linorder<span class="main">)</span> gen_ssa_cfg_wf <span class="main">⇒</span> <span class="tfree">'val</span> <span class="main">⇒</span> <span class="tfree">'var</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">gen_var</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">gen_ssa_wf_inEdges'</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">d</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>gen_ssa_wf_inEdges <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Generic_Interpretation-gen_ssa_wf_inEdges'_transfer"><span class="command">lemma</span></span> gen_ssa_wf_inEdges'_transfer <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rel_fun cr_gen_ssa_cfg_wf <span class="main">(=)</span> gen_inEdges' gen_ssa_wf_inEdges'"</span></span>
  <span class="keyword1"><span class="command">using</span></span> gen_ssa_wf_inEdges.transfer
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_fun_def cr_gen_cfg_wf_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">global_interpretation</span></span> uninst<span class="main">:</span> CFG_SSA_wf_base_code <span class="quoted">gen_ssa_wf_αe</span> <span class="quoted">gen_ssa_wf_αn</span> <span class="quoted">gen_wf_invar</span> <span class="quoted">gen_ssa_wf_inEdges'</span> <span class="quoted">gen_ssa_wf_Entry</span> <span class="quoted">gen_ssa_wf_ssa_defs</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">p</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">u</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">p</span>
  <span class="keyword2"><span class="keyword">defines</span></span>
      uninst_predecessors <span class="main">=</span> <span class="quoted">uninst.predecessors</span>
  <span class="keyword2"><span class="keyword">and</span></span> uninst_successors <span class="main">=</span> <span class="quoted">uninst.successors</span>
  <span class="keyword2"><span class="keyword">and</span></span> uninst_phiDefs <span class="main">=</span> <span class="quoted">uninst.phiDefs</span>
  <span class="keyword2"><span class="keyword">and</span></span> uninst_phiUses <span class="main">=</span> <span class="quoted">uninst.phiUses</span>
  <span class="keyword2"><span class="keyword">and</span></span> uninst_allDefs <span class="main">=</span> <span class="quoted">uninst.allDefs</span>
  <span class="keyword2"><span class="keyword">and</span></span> uninst_allUses <span class="main">=</span> <span class="quoted">uninst.allUses</span>
  <span class="keyword2"><span class="keyword">and</span></span> uninst_allVars <span class="main">=</span> <span class="quoted">uninst.allVars</span>
  <span class="keyword2"><span class="keyword">and</span></span> uninst_isTrivialPhi <span class="main">=</span> <span class="quoted">uninst.isTrivialPhi</span>
  <span class="keyword2"><span class="keyword">and</span></span> uninst_trivial <span class="main">=</span> <span class="quoted">uninst.trivial_code</span>
  <span class="keyword2"><span class="keyword">and</span></span> uninst_redundant <span class="main">=</span> <span class="quoted">uninst.redundant_code</span>
  <span class="keyword2"><span class="keyword">and</span></span> uninst_phi <span class="main">=</span> <span class="quoted">uninst.phi</span>
  <span class="keyword2"><span class="keyword">and</span></span> uninst_defNode <span class="main">=</span> <span class="quoted">uninst.defNode</span>
  <span class="keyword2"><span class="keyword">and</span></span> uninst_trivial_phis <span class="main">=</span> <span class="quoted">uninst.trivial_phis</span>
  <span class="keyword2"><span class="keyword">and</span></span> uninst_phidefNodes <span class="main">=</span> <span class="quoted">uninst.phidefNodes</span>
  <span class="keyword2"><span class="keyword">and</span></span> uninst_useNodes_of <span class="main">=</span> <span class="quoted">uninst.useNodes_of</span>
  <span class="keyword2"><span class="keyword">and</span></span> uninst_phiNodes_of <span class="main">=</span> <span class="quoted">uninst.phiNodes_of</span>
<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">uninst_chooseNext</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> Max <span class="main">(</span>uninst_trivial_phis <span class="main">(</span>const <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Generic_Interpretation-gen_ssa_wf_invar_trans"><span class="command">lemma</span></span> gen_ssa_wf_invar_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_fun cr_gen_ssa_cfg_wf <span class="main">(=)</span> gen_wf_invar gen_wf_invar"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">declare</span></span> graph_path_base.transfer_rules<span class="main">[</span><span class="operator">OF</span> gen_ssa_cfg_wf.right_total gen_ssa_wf_αe.transfer gen_ssa_wf_αn.transfer gen_ssa_wf_invar_trans gen_ssa_wf_inEdges'_transfer<span class="main">,</span> <span class="operator">transfer_rule</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> CFG_base.defAss'_transfer<span class="main">[</span><span class="operator">OF</span> gen_ssa_cfg_wf.right_total gen_ssa_wf_αe.transfer gen_ssa_wf_αn.transfer gen_ssa_wf_invar_trans gen_ssa_wf_inEdges'_transfer<span class="main">,</span> <span class="operator">transfer_rule</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> CFG_SSA_base_code.CFG_SSA_base_code_transfer_rules<span class="main">[</span><span class="operator">OF</span> gen_ssa_cfg_wf.right_total gen_ssa_wf_αe.transfer gen_ssa_wf_αn.transfer gen_ssa_wf_invar_trans gen_ssa_wf_inEdges'_transfer gen_ssa_wf_Entry.transfer gen_ssa_wf_ssa_defs.transfer gen_ssa_wf_ssa_uses.transfer gen_ssa_wf_phis.transfer<span class="main">,</span> <span class="operator">transfer_rule</span><span class="main">]</span>


<span class="keyword1" id="Generic_Interpretation-path2_ign"><span class="command">lemma</span></span> path2_ign<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"graph_path_base.path2 <span class="main">(</span>ign gen_αn <span class="free">g</span><span class="main">)</span> gen_wf_invar <span class="main">(</span>ign gen_inEdges' <span class="free">g</span><span class="main">)</span> <span class="free">g'</span> <span class="free">n</span> <span class="free">ns</span> <span class="free">m</span> <span class="main">⟷</span> graph_path_base.path2 gen_αn gen_wf_invar gen_inEdges' <span class="free">g</span> <span class="free">n</span> <span class="free">ns</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> graph_path_base.path2_def graph_path_base.path_def graph_path_base.predecessors_def graph_path_base.inEdges_def<span class="main">)</span>
<span class="keyword1" id="Generic_Interpretation-allDefs_ign"><span class="command">lemma</span></span> allDefs_ign<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"CFG_SSA_base.allDefs <span class="main">(</span>ign gen_ssa_defs <span class="free">g</span><span class="main">)</span> <span class="main">(</span>ign Mapping.lookup <span class="main">(</span>gen_phis <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">ga</span> <span class="free">n</span> <span class="main">=</span> CFG_SSA_base.allDefs gen_ssa_defs <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.lookup <span class="main">(</span>gen_phis <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CFG_SSA_base.CFG_SSA_defs<span class="main">)</span>
<span class="keyword1" id="Generic_Interpretation-successors_ign"><span class="command">lemma</span></span> successors_ign<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"graph_path_base.successors <span class="main">(</span>ign gen_αn <span class="free">g</span><span class="main">)</span> <span class="main">(</span>ign gen_inEdges' <span class="free">g</span><span class="main">)</span> <span class="free">ga</span> <span class="free">n</span> <span class="main">=</span> graph_path_base.successors gen_αn gen_inEdges' <span class="free">g</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> graph_path_base.successors_def graph_path_base.predecessors_def graph_path_base.inEdges_def<span class="main">)</span>
<span class="keyword1" id="Generic_Interpretation-predecessors_ign"><span class="command">lemma</span></span> predecessors_ign<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"graph_path_base.predecessors <span class="main">(</span>ign gen_inEdges' <span class="free">g</span><span class="main">)</span> <span class="free">ga</span> <span class="free">n</span> <span class="main">=</span> graph_path_base.predecessors gen_inEdges' <span class="free">g</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> graph_path_base.predecessors_def graph_path_base.inEdges_def<span class="main">)</span>
<span class="keyword1" id="Generic_Interpretation-phiDefs_ign"><span class="command">lemma</span></span> phiDefs_ign<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"CFG_SSA_base.phiDefs <span class="main">(</span>ign Mapping.lookup <span class="main">(</span>gen_phis <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">ga</span> <span class="main">=</span> CFG_SSA_base.phiDefs <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.lookup <span class="main">(</span>gen_phis <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CFG_SSA_base.phiDefs_def <span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1" id="Generic_Interpretation-defAss_ign"><span class="command">lemma</span></span> defAss_ign<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"CFG_SSA_base.defAss <span class="main">(</span>ign gen_αn <span class="free">g</span><span class="main">)</span> gen_wf_invar <span class="main">(</span>ign gen_inEdges' <span class="free">g</span><span class="main">)</span> <span class="main">(</span>ign gen_Entry <span class="free">g</span><span class="main">)</span> <span class="main">(</span>ign gen_ssa_defs <span class="free">g</span><span class="main">)</span> <span class="main">(</span>ign Mapping.lookup <span class="main">(</span>gen_phis <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">ga</span>
  <span class="main">=</span> CFG_SSA_base.defAss gen_αn gen_wf_invar gen_inEdges' gen_Entry gen_ssa_defs <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.lookup <span class="main">(</span>gen_phis <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CFG_SSA_base.defAss_def <span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1" id="Generic_Interpretation-allUses_ign"><span class="command">lemma</span></span> allUses_ign<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"CFG_SSA_base.allUses <span class="main">(</span>ign gen_αn <span class="free">g</span><span class="main">)</span> <span class="main">(</span>ign gen_inEdges' <span class="free">g</span><span class="main">)</span> <span class="main">(</span>usesOf <span class="main">∘</span> ign gen_ssa_uses <span class="free">g</span><span class="main">)</span> <span class="main">(</span>ign Mapping.lookup <span class="main">(</span>gen_phis <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">ga</span> <span class="free">m</span>
  <span class="main">=</span> CFG_SSA_base.allUses gen_αn gen_inEdges' <span class="main">(</span>usesOf <span class="main">∘</span> gen_ssa_uses<span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.lookup <span class="main">(</span>gen_phis <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="free">g</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CFG_SSA_base.CFG_SSA_defs<span class="main">)</span>
<span class="keyword1" id="Generic_Interpretation-defAss'_ign"><span class="command">lemma</span></span> defAss'_ign<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"CFG_base.defAss' <span class="main">(</span>ign gen_αn <span class="free">g</span><span class="main">)</span> gen_wf_invar <span class="main">(</span>ign gen_inEdges' <span class="free">g</span><span class="main">)</span> <span class="main">(</span>ign gen_Entry <span class="free">g</span><span class="main">)</span> <span class="main">(</span>ign gen_defs <span class="free">g</span><span class="main">)</span> <span class="free">ga</span>
  <span class="main">=</span> CFG_base.defAss' gen_αn gen_wf_invar gen_inEdges' gen_Entry gen_defs <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CFG_base.defAss'_def <span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">global_interpretation</span></span> gen_ssa_wf_notriv<span class="main">:</span> CFG_SSA_Transformed_notriv_linorder_code <span class="quoted">gen_ssa_wf_αe</span> <span class="quoted">gen_ssa_wf_αn</span> <span class="quoted">gen_wf_invar</span> <span class="quoted">gen_ssa_wf_inEdges'</span> <span class="quoted">gen_ssa_wf_Entry</span> <span class="quoted">gen_ssa_wf_defs</span> <span class="quoted">gen_ssa_wf_uses</span> <span class="quoted">gen_ssa_wf_ssa_defs</span> <span class="quoted">gen_ssa_wf_ssa_uses</span> <span class="quoted">gen_ssa_wf_phis</span> <span class="quoted">gen_ssa_wf_var</span> <span class="quoted">uninst_chooseNext</span>
<span class="keyword2"><span class="keyword">defines</span></span>
  gen_ssa_wf_notriv_substAll <span class="main">=</span> <span class="quoted">gen_ssa_wf_notriv.substAll</span> <span class="keyword2"><span class="keyword">and</span></span>
  gen_ssa_wf_notriv_substAll_efficient <span class="main">=</span> <span class="quoted">gen_ssa_wf_notriv.substAll_efficient</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
                                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_wf_def CFG_def graph_Entry_def graph_path_def graph_def<span class="main">)</span>
                               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_wf_def CFG_def graph_Entry_def graph_path_def graph_def valid_graph_def<span class="main">)</span>
                              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_wf_def CFG_def graph_Entry_def graph_path_def graph_def valid_graph_def<span class="main">)</span>
                             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_wf_def CFG_def graph_Entry_def graph_path_def graph_nodes_it_def graph_nodes_it_axioms_def<span class="main">)</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_wf_def CFG_def graph_Entry_def graph_path_def graph_pred_it_def graph_pred_it_axioms_def<span class="main">)</span>
                           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_wf_def CFG_SSA_def CFG_wf_def CFG_def graph_Entry_def graph_Entry_axioms_def<span class="main">)</span>
                          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_wf_def CFG_SSA_def CFG_wf_def CFG_def graph_Entry_def graph_Entry_axioms_def graph_path_base.inEdges_def<span class="main">)</span>
                         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_wf_def CFG_SSA_def  CFG_wf_def CFG_def graph_Entry_def graph_Entry_axioms_def graph_path_base.path2_def
                                                    graph_path_base.path_def graph_path_base.predecessors_def graph_path_base.inEdges_def<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_wf_def CFG_SSA_def  CFG_wf_def CFG_def CFG_axioms_def<span class="main">)</span>
                       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_wf_def CFG_SSA_def  CFG_wf_def CFG_def CFG_axioms_def<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_wf_def CFG_SSA_def  CFG_wf_def CFG_def CFG_axioms_def<span class="main">)</span>
                     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_wf_def CFG_SSA_def  CFG_wf_def CFG_def CFG_axioms_def<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                   <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_wf_def CFG_wf_def CFG_def CFG_axioms_def CFG_SSA_def CFG_SSA_axioms_def<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_wf_def CFG_SSA_def CFG_SSA_axioms_def<span class="main">)</span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_wf_def CFG_SSA_def CFG_SSA_axioms_def graph_path_base.predecessors_def graph_path_base.inEdges_def<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_wf_def CFG_SSA_def CFG_SSA_axioms_def<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_wf_def CFG_SSA_def CFG_SSA_axioms_def<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_wf_def CFG_SSA_wf_axioms_def CFG_SSA_base.defAss_def<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_wf_def CFG_SSA_wf_axioms_def<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_wf_def CFG_wf_def CFG_def CFG_axioms_def<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_wf_def CFG_wf_def CFG_def CFG_axioms_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_wf_def CFG_wf_def CFG_def CFG_axioms_def<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_wf_def CFG_wf_def CFG_def CFG_axioms_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_wf_def CFG_wf_def CFG_wf_axioms_def<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_Transformed_axioms_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_Transformed_axioms_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_Transformed_axioms_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_Transformed_axioms_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_def CFG_SSA_Transformed_axioms_def<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">g</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"CFG_SSA_Transformed gen_ssa_wf_αe gen_ssa_wf_αn gen_wf_invar gen_ssa_wf_inEdges' gen_ssa_wf_Entry gen_ssa_wf_defs gen_ssa_wf_uses gen_ssa_wf_ssa_defs <span class="main">(</span><span class="skolem">u</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> gen_ssa_cfg_wf <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span> set<span class="main">)</span> <span class="skolem">p</span> gen_ssa_wf_var"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> i<span class="main">:</span> CFG_SSA_Transformed <span class="quoted">gen_ssa_wf_αe</span> <span class="quoted">gen_ssa_wf_αn</span> <span class="quoted">gen_wf_invar</span> <span class="quoted">gen_ssa_wf_inEdges'</span> <span class="quoted">gen_ssa_wf_Entry</span> <span class="quoted">gen_ssa_wf_defs</span> <span class="quoted">gen_ssa_wf_uses</span> <span class="quoted">gen_ssa_wf_ssa_defs</span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted">gen_ssa_wf_var</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"usesOf <span class="main">∘</span> <span class="skolem">u'</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.Mapping <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="skolem">u</span> <span class="bound">g</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> None <span class="keyword1">else</span> Some <span class="main">(</span><span class="skolem">u</span> <span class="bound">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_allE<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> meta_impE<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> 4 4 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def usesOf_def <span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> code<span class="main">:</span> CFG_SSA_wf_code <span class="quoted">gen_ssa_wf_αe</span> <span class="quoted">gen_ssa_wf_αn</span> <span class="quoted">gen_wf_invar</span> <span class="quoted">gen_ssa_wf_inEdges'</span> <span class="quoted">gen_ssa_wf_Entry</span> <span class="quoted">gen_ssa_wf_ssa_defs</span> <span class="quoted"><span class="skolem">u'</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.Mapping <span class="main">(</span><span class="skolem">p</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CFG_SSA_wf_code_def CFG_SSA_code_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

  <span class="keyword1"><span class="command">have</span></span> aux<span class="main">:</span> <span class="quoted"><span class="quoted">"uninst_trivial_phis <span class="main">(</span>const <span class="main">(</span>Mapping.Mapping <span class="main">(</span><span class="skolem">p</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">g</span> <span class="main">=</span> uninst_trivial_phis <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span>Mapping.Mapping <span class="main">(</span><span class="skolem">p</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uninst.trivial_phis_def<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword3"><span class="command">assume</span></span> red<span class="main">:</span> <span class="quoted"><span class="quoted">"i.redundant <span class="skolem">g</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cN</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"uninst_chooseNext <span class="main">(</span><span class="skolem">u</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span>Mapping.Mapping <span class="main">(</span><span class="skolem">p</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">g</span>"</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cN</span> <span class="main">∈</span> dom <span class="main">(</span><span class="skolem">p</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">∧</span> i.trivial <span class="skolem">g</span> <span class="main">(</span>snd <span class="var">?cN</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> uninst_chooseNext_def aux
  <span class="keyword1"><span class="command">unfolding</span></span> uninst_trivial_phis_def code.trivial_phis
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> CollectD<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Max <span class="main">_</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ Max_in<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ i.phis_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">using</span></span> red
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i.redundant_def<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> code.trivial_phi<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i.phi_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Mapping.keys <span class="main">(</span>gen_ssa_wf_ssa_uses <span class="main">(</span><span class="skolem">g</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> gen_ssa_cfg_wf<span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>gen_ssa_wf_αn <span class="skolem">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_Transformed_code_def CFG_SSA_Transformed_code_axioms_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uninst_chooseNext_def uninst_trivial_phis_def CFG_SSA_wf_base_code.trivial_phis_def<span class="main">)</span>

<span class="keyword1"><span class="command">global_interpretation</span></span> uninst_code<span class="main">:</span> CFG_SSA_Transformed_notriv_base_code <span class="quoted">gen_ssa_wf_αe</span> <span class="quoted">gen_ssa_wf_αn</span> <span class="quoted">gen_wf_invar</span> <span class="quoted">gen_ssa_wf_inEdges'</span> <span class="quoted">gen_ssa_wf_Entry</span> <span class="quoted">gen_ssa_wf_defs</span> <span class="quoted">gen_ssa_wf_uses</span> <span class="quoted">gen_ssa_wf_ssa_defs</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted">gen_ssa_wf_var</span> <span class="quoted">uninst_chooseNext</span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">u</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">p</span>
<span class="keyword2"><span class="keyword">defines</span></span>
  uninst_code_step_code <span class="main">=</span> <span class="quoted">uninst_code.step_codem</span> <span class="keyword2"><span class="keyword">and</span></span>
  uninst_code_phis' <span class="main">=</span> <span class="quoted">uninst_code.phis'_codem</span> <span class="keyword2"><span class="keyword">and</span></span>
  uninst_code_uses' <span class="main">=</span> <span class="quoted">uninst_code.uses'_codem</span> <span class="keyword2"><span class="keyword">and</span></span>
  uninst_code_substNext <span class="main">=</span> <span class="quoted">uninst_code.substNext_code</span> <span class="keyword2"><span class="keyword">and</span></span>
  uninst_code_substitution <span class="main">=</span> <span class="quoted">uninst_code.substitution_code</span> <span class="keyword2"><span class="keyword">and</span></span>
  uninst_code_triv_phis' <span class="main">=</span> <span class="quoted">uninst_code.triv_phis'</span> <span class="keyword2"><span class="keyword">and</span></span>
  uninst_code_nodes_of_uses' <span class="main">=</span> <span class="quoted">uninst_code.nodes_of_uses'</span> <span class="keyword2"><span class="keyword">and</span></span>
  uninst_code_nodes_of_phis' <span class="main">=</span> <span class="quoted">uninst_code.nodes_of_phis'</span>
<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> gen_cfg_wf_extend <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'b</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> gen_cfg_wf <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> gen_cfg_scheme"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">gen_cfg.extend</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Generic_Interpretation-gen_αe_wf_extend"><span class="command">lemma</span></span> gen_αe_wf_extend <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gen_αe <span class="main">(</span>gen_cfg_wf_extend <span class="free">gen_cfg_wf</span> <span class="main">⦇</span>gen_ssa_defs <span class="main">=</span> <span class="free">d</span><span class="main">,</span> gen_ssa_uses <span class="main">=</span> <span class="free">u</span><span class="main">,</span> gen_phis <span class="main">=</span> <span class="free">p</span><span class="main">,</span> gen_var <span class="main">=</span> <span class="free">v</span><span class="main">⦈</span><span class="main">)</span>
  <span class="main">=</span> gen_wf_αe <span class="free">gen_cfg_wf</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_cfg_wf_extend_def gen_cfg.defs gen_wf_αe_def<span class="main">)</span>

<span class="keyword1" id="Generic_Interpretation-gen_αn_wf_extend"><span class="command">lemma</span></span> gen_αn_wf_extend <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gen_αn <span class="main">(</span>gen_cfg_wf_extend <span class="free">gen_cfg_wf</span> <span class="main">⦇</span>gen_ssa_defs <span class="main">=</span> <span class="free">d</span><span class="main">,</span> gen_ssa_uses <span class="main">=</span> <span class="free">u</span><span class="main">,</span> gen_phis <span class="main">=</span> <span class="free">p</span><span class="main">,</span> gen_var <span class="main">=</span> <span class="free">v</span><span class="main">⦈</span><span class="main">)</span>
  <span class="main">=</span> gen_wf_αn <span class="free">gen_cfg_wf</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_cfg_wf_extend_def gen_cfg.defs gen_wf_αn_def<span class="main">)</span>

<span class="keyword1" id="Generic_Interpretation-gen_inEdges_wf_extend"><span class="command">lemma</span></span> gen_inEdges_wf_extend <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gen_inEdges <span class="main">(</span>gen_cfg_wf_extend <span class="free">gen_cfg_wf</span> <span class="main">⦇</span>gen_ssa_defs <span class="main">=</span> <span class="free">d</span><span class="main">,</span> gen_ssa_uses <span class="main">=</span> <span class="free">u</span><span class="main">,</span> gen_phis <span class="main">=</span> <span class="free">p</span><span class="main">,</span> gen_var <span class="main">=</span> <span class="free">v</span><span class="main">⦈</span><span class="main">)</span>
  <span class="main">=</span> gen_wf_inEdges <span class="free">gen_cfg_wf</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_cfg_wf_extend_def gen_cfg.defs gen_wf_inEdges_def<span class="main">)</span>

<span class="keyword1" id="Generic_Interpretation-gen_Entry_wf_extend"><span class="command">lemma</span></span> gen_Entry_wf_extend <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gen_Entry <span class="main">(</span>gen_cfg_wf_extend <span class="free">gen_cfg_wf</span> <span class="main">⦇</span>gen_ssa_defs <span class="main">=</span> <span class="free">d</span><span class="main">,</span> gen_ssa_uses <span class="main">=</span> <span class="free">u</span><span class="main">,</span> gen_phis <span class="main">=</span> <span class="free">p</span><span class="main">,</span> gen_var <span class="main">=</span> <span class="free">v</span><span class="main">⦈</span><span class="main">)</span>
  <span class="main">=</span> gen_wf_Entry <span class="free">gen_cfg_wf</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_cfg_wf_extend_def gen_cfg.defs gen_wf_Entry_def<span class="main">)</span>

<span class="keyword1" id="Generic_Interpretation-gen_defs_wf_extend"><span class="command">lemma</span></span> gen_defs_wf_extend <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gen_defs <span class="main">(</span>gen_cfg_wf_extend <span class="free">gen_cfg_wf</span> <span class="main">⦇</span>gen_ssa_defs <span class="main">=</span> <span class="free">d</span><span class="main">,</span> gen_ssa_uses <span class="main">=</span> <span class="free">u</span><span class="main">,</span> gen_phis <span class="main">=</span> <span class="free">p</span><span class="main">,</span> gen_var <span class="main">=</span> <span class="free">v</span><span class="main">⦈</span><span class="main">)</span>
  <span class="main">=</span> gen_wf_defs <span class="free">gen_cfg_wf</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_cfg_wf_extend_def gen_cfg.defs gen_wf_defs_def<span class="main">)</span>

<span class="keyword1" id="Generic_Interpretation-gen_uses_wf_extend"><span class="command">lemma</span></span> gen_uses_wf_extend <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gen_uses <span class="main">(</span>gen_cfg_wf_extend <span class="free">gen_cfg_wf</span> <span class="main">⦇</span>gen_ssa_defs <span class="main">=</span> <span class="free">d</span><span class="main">,</span> gen_ssa_uses <span class="main">=</span> <span class="free">u</span><span class="main">,</span> gen_phis <span class="main">=</span> <span class="free">p</span><span class="main">,</span> gen_var <span class="main">=</span> <span class="free">v</span><span class="main">⦈</span><span class="main">)</span>
  <span class="main">=</span> gen_wf_uses <span class="free">gen_cfg_wf</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_cfg_wf_extend_def gen_cfg.defs gen_wf_uses_def<span class="main">)</span>

<span class="keyword1" id="Generic_Interpretation-gen_ssa_defs_wf_extend"><span class="command">lemma</span></span> gen_ssa_defs_wf_extend <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gen_ssa_defs <span class="main">(</span>gen_cfg_wf_extend <span class="free">gen_cfg_wf</span> <span class="main">⦇</span>gen_ssa_defs <span class="main">=</span> <span class="free">d</span><span class="main">,</span> gen_ssa_uses <span class="main">=</span> <span class="free">u</span><span class="main">,</span> gen_phis <span class="main">=</span> <span class="free">p</span><span class="main">,</span> gen_var <span class="main">=</span> <span class="free">v</span><span class="main">⦈</span><span class="main">)</span>
  <span class="main">=</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_cfg_wf_extend_def gen_cfg.defs<span class="main">)</span>

<span class="keyword1" id="Generic_Interpretation-gen_ssa_uses_wf_extend"><span class="command">lemma</span></span> gen_ssa_uses_wf_extend <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gen_ssa_uses <span class="main">(</span>gen_cfg_wf_extend <span class="free">gen_cfg_wf</span> <span class="main">⦇</span>gen_ssa_defs <span class="main">=</span> <span class="free">d</span><span class="main">,</span> gen_ssa_uses <span class="main">=</span> <span class="free">u</span><span class="main">,</span> gen_phis <span class="main">=</span> <span class="free">p</span><span class="main">,</span> gen_var <span class="main">=</span> <span class="free">v</span><span class="main">⦈</span><span class="main">)</span>
  <span class="main">=</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_cfg_wf_extend_def gen_cfg.defs<span class="main">)</span>

<span class="keyword1" id="Generic_Interpretation-gen_phis_wf_extend"><span class="command">lemma</span></span> gen_phis_wf_extend <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gen_phis <span class="main">(</span>gen_cfg_wf_extend <span class="free">gen_cfg_wf</span> <span class="main">⦇</span>gen_ssa_defs <span class="main">=</span> <span class="free">d</span><span class="main">,</span> gen_ssa_uses <span class="main">=</span> <span class="free">u</span><span class="main">,</span> gen_phis <span class="main">=</span> <span class="free">p</span><span class="main">,</span> gen_var <span class="main">=</span> <span class="free">v</span><span class="main">⦈</span><span class="main">)</span>
  <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_cfg_wf_extend_def gen_cfg.defs<span class="main">)</span>

<span class="keyword1" id="Generic_Interpretation-gen_var_wf_extend"><span class="command">lemma</span></span> gen_var_wf_extend <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gen_var <span class="main">(</span>gen_cfg_wf_extend <span class="free">gen_cfg_wf</span> <span class="main">⦇</span>gen_ssa_defs <span class="main">=</span> <span class="free">d</span><span class="main">,</span> gen_ssa_uses <span class="main">=</span> <span class="free">u</span><span class="main">,</span> gen_phis <span class="main">=</span> <span class="free">p</span><span class="main">,</span> gen_var <span class="main">=</span> <span class="free">v</span><span class="main">⦈</span><span class="main">)</span>
  <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_cfg_wf_extend_def gen_cfg.defs<span class="main">)</span>

<span class="keyword1" id="Generic_Interpretation-CFG_SSA_Transformed_codeI"><span class="command">lemma</span></span> CFG_SSA_Transformed_codeI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"CFG_SSA_Transformed <span class="free">αe</span> <span class="free">αn</span> <span class="free">invar</span> <span class="free">inEdges</span> <span class="free">Entry</span> <span class="free">oldDefs</span> <span class="free">oldUses</span> <span class="free">defs</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> lookup_multimap <span class="main">(</span><span class="free">uses</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="free">var</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> Mapping.keys <span class="main">(</span><span class="free">uses</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">αn</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"CFG_SSA_Transformed_code <span class="free">αe</span> <span class="free">αn</span> <span class="free">invar</span> <span class="free">inEdges</span> <span class="free">Entry</span> <span class="free">oldDefs</span> <span class="free">oldUses</span> <span class="free">defs</span> <span class="free">uses</span> <span class="free">phis</span> <span class="free">var</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> CFG_SSA_Transformed <span class="quoted"><span class="free">αe</span></span> <span class="quoted"><span class="free">αn</span></span> <span class="quoted"><span class="free">invar</span></span> <span class="quoted"><span class="free">inEdges</span></span> <span class="quoted"><span class="free">Entry</span></span> <span class="quoted"><span class="free">oldDefs</span></span> <span class="quoted"><span class="free">oldUses</span></span> <span class="quoted"><span class="quoted">"<span class="free">defs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> lookup_multimap <span class="main">(</span><span class="free">uses</span> <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Mapping.lookup <span class="main">(</span><span class="free">phis</span> <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">var</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"usesOf <span class="main">=</span> lookup_multimap"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_multimap_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
                   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> defs_uses_disjoint<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> defs_finite<span class="main">)</span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> uses_in_αn<span class="main">)</span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> invar<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> phis_finite<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> phis_in_αn<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> phis_wf<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> simpleDefs_phiDefs_disjoint<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allDefs_disjoint<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allUses_def_ass<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Entry_no_phis<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> oldDefs_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> oldUses_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conventional<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> phis_same_var<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allDefs_var_disjoint<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Generic_Interpretation-CFG_SSA_Transformed_ign"><span class="command">lemma</span></span> CFG_SSA_Transformed_ign<span class="main">:</span>
  <span class="quoted"><span class="quoted">"CFG_SSA_Transformed <span class="main">(</span>ign gen_wf_αe <span class="free">gen_cfg_wf</span><span class="main">)</span> <span class="main">(</span>ign gen_wf_αn <span class="free">gen_cfg_wf</span><span class="main">)</span> gen_wf_invar
        <span class="main">(</span>const <span class="main">(</span>gen_wf_inEdges' <span class="free">gen_cfg_wf</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ign gen_wf_Entry <span class="free">gen_cfg_wf</span><span class="main">)</span> <span class="main">(</span>ign gen_wf_defs <span class="free">gen_cfg_wf</span><span class="main">)</span>
        <span class="main">(</span>ign gen_wf_uses <span class="free">gen_cfg_wf</span><span class="main">)</span> <span class="main">(</span>ign gen_wf_defs' <span class="free">gen_cfg_wf</span><span class="main">)</span> <span class="main">(</span>ign gen_wf.uses' <span class="free">gen_cfg_wf</span><span class="main">)</span>
        <span class="main">(</span>ign gen_wf.phis' <span class="free">gen_cfg_wf</span><span class="main">)</span>
        <span class="main">(</span>ign gen_wf_var <span class="free">gen_cfg_wf</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> CFG_SSA_Transformed_def CFG_wf_def CFG_def CFG_wf_axioms_def
  graph_Entry_def graph_path_def graph_Entry_axioms_def
  CFG_axioms_def CFG_SSA_wf_def CFG_SSA_def CFG_SSA_axioms_def
  CFG_SSA_wf_axioms_def CFG_SSA_Transformed_axioms_def
  graph_def graph_nodes_it_def graph_pred_it_def
  graph_nodes_it_axioms_def graph_pred_it_axioms_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_wf.Entry_unreachable gen_wf.defs_uses_disjoint <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">gen_cfg_wf</span></span><span class="main"><span class="main">]</span></span>
  gen_wf.uses_in_αn
  gen_wf.braun_ssa.uses_in_αn gen_wf.phis'_finite
  gen_wf.αn_distinct
  gen_wf.valid gen_wf.finite <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span>
  gen_wf.ni.nodes_list_it_correct <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span>
  gen_wf.pi.pred_list_it_correct <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
               <span class="keyword1"><span class="command">using</span></span> gen_wf.Entry_unreachable <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">gen_cfg_wf</span></span><span class="main">]</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> graph_path_base.inEdges_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
              <span class="keyword1"><span class="command">using</span></span> gen_wf.Entry_reaches
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">cong</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> imp_cong <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> graph_path_base.path2_def graph_path_base.path_def graph_path_base.predecessors_def graph_path_base.inEdges_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
             <span class="keyword1"><span class="command">using</span></span> gen_wf.def_ass_uses <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">gen_cfg_wf</span></span><span class="main">]</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_base.defAss'_def graph_path_base.path2_def graph_path_base.path_def graph_path_base.predecessors_def graph_path_base.inEdges_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
            <span class="keyword1"><span class="command">using</span></span> gen_wf.Entry_unreachable <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">gen_cfg_wf</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> graph_path_base.inEdges_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
           <span class="keyword1"><span class="command">using</span></span> gen_wf.Entry_reaches
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">cong</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> imp_cong <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> graph_path_base.path2_def graph_path_base.path_def graph_path_base.predecessors_def gen_wf.defs_uses_disjoint graph_path_base.inEdges_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> gen_wf.defs'_uses'_disjoint <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">gen_cfg_wf</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> gen_wf.braun_ssa.phis_in_αn<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> gen_wf.phis'_wf <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> graph_path_base.predecessors_def gen_wf_predecessors_def graph_path_base.inEdges_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> gen_wf.braun_ssa.simpleDefs_phiDefs_disjoint <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_base.phiDefs_def dom_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command">using</span></span> gen_wf.braun_ssa.allDefs_disjoint<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">gen_cfg_wf</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_base.CFG_SSA_defs<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> gen_wf.braun_ssa.allUses_def_ass <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">gen_cfg_wf</span></span><span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> 1<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_wf_base.CFG_SSA_wf_defs CFG_SSA_wf_base.defAssUses_def
        graph_path_base.path2_def graph_path_base.path_def graph_path_base.predecessors_def
        graph_path_base.successors_def graph_path_base.inEdges_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_wf.oldDefs_correct<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_wf.oldUses_correct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI impI gen_wf.conventional<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> graph_path_base.path2_def graph_path_base.path_def graph_path_base.predecessors_def graph_path_base.successors_def CFG_SSA_base.CFG_SSA_defs graph_path_base.inEdges_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI impI gen_wf.phis'_fst<span class="main"><span class="keyword3">;</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI gen_wf.allDefs_var_disjoint<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CFG_SSA_base.CFG_SSA_defs<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> gen_ssa_cfg_wf <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'node</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'var</span><span class="main">::</span>linorder<span class="main">,</span> <span class="tfree">'edge</span><span class="main">)</span> gen_cfg_wf <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span> <span class="tfree">'var</span><span class="main">,</span> <span class="tfree">'edge</span> <span class="main">,</span> <span class="main">(</span><span class="tfree">'node</span><span class="main">,</span><span class="tfree">'var</span><span class="main">)</span> ssaVal<span class="main">)</span> gen_ssa_cfg_wf"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">uses</span><span class="main">,</span><span class="bound">phis</span><span class="main">)</span> <span class="main">=</span> gen_wf_uses'_phis' <span class="bound">g</span> <span class="keyword1">in</span> <span class="main">(</span>gen_cfg_wf_extend <span class="bound">g</span><span class="main">)</span><span class="main">⦇</span>
    gen_ssa_defs <span class="main">=</span> gen_wf_defs' <span class="bound">g</span><span class="main">,</span>
    gen_ssa_uses <span class="main">=</span> <span class="bound">uses</span><span class="main">,</span>
    gen_phis <span class="main">=</span> <span class="bound">phis</span><span class="main">,</span>
    gen_var <span class="main">=</span> gen_wf_var <span class="bound">g</span>
  <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def gen_wf_uses'_phis'_def split_beta<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CFG_Construct_linorder.snd_uses'_phis'<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted">gen_wf_αe</span> <span class="main"><span class="main">_</span></span> <span class="quoted">gen_wf_invar</span> <span class="main"><span class="main">_</span></span> <span class="quoted">gen_wf_Entry</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> CFG_SSA_Transformed_codeI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CFG_Construct_linorder.fst_uses'_phis'<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted">gen_wf_αe</span> <span class="main"><span class="main">_</span></span> <span class="quoted">gen_wf_invar</span> <span class="main"><span class="main">_</span></span> <span class="quoted">gen_wf_Entry</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> CFG_SSA_Transformed_ign<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> CFG_Construct_linorder.fst_uses'_phis'_in_αn<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">declare</span></span> uninst.defNode_code<span class="main">[</span><span class="operator">abs_def</span><span class="main">,</span> <span class="operator">code</span><span class="main">]</span> uninst.allVars_code<span class="main">[</span><span class="operator">abs_def</span><span class="main">,</span> <span class="operator">code</span><span class="main">]</span> uninst.allUses_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">,</span> <span class="operator">code</span><span class="main">]</span> uninst.allDefs_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">,</span> <span class="operator">code</span><span class="main">]</span>
  uninst.phiUses_code<span class="main">[</span><span class="operator">abs_def</span><span class="main">,</span> <span class="operator">code</span><span class="main">]</span> uninst.phi_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">,</span> <span class="operator">code</span><span class="main">]</span> uninst.redundant_code_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">,</span> <span class="operator">code</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> uninst_code.uses'_code_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">,</span> <span class="operator">code</span><span class="main">]</span> uninst_code.substNext_code_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">,</span> <span class="operator">code</span><span class="main">]</span> uninst_code.substitution_code_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">,</span> <span class="operator">folded</span> uninst_phi_def<span class="main">,</span> <span class="operator">code</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> uninst_code.phis'_code_def<span class="main">[</span><span class="operator">folded</span> uninst_code_substNext_def<span class="main">,</span> <span class="operator">code</span><span class="main">]</span> uninst_code.step_code_def<span class="main">[</span><span class="operator">folded</span> uninst_code.uses'_code_def uninst_code.phis'_code_def<span class="main">,</span> <span class="operator">code</span><span class="main">]</span>
  uninst_code.cond_code_def<span class="main">[</span><span class="operator">folded</span> uninst_redundant_def<span class="main">,</span> <span class="operator">code</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> gen_ssa_wf_notriv.substAll_efficient_def
  <span class="main">[</span><span class="operator">folded</span> uninst_code_nodes_of_phis'_def uninst_code_nodes_of_uses'_def uninst_code_triv_phis'_def
    uninst_code_substitution_def
    uninst_code_step_code_def uninst_code_phis'_def uninst_code_uses'_def uninst_trivial_phis_def
    uninst_phidefNodes_def uninst_useNodes_of_def uninst_phiNodes_of_def<span class="main">,</span> <span class="operator">code</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> keys_dom_lookup <span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">code_unfold</span><span class="main">]</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">map_keys_from_sparse</span> <span class="main">≡</span> map_keys gen_wf.from_sparse"</span></span>

<span class="keyword1"><span class="command">declare</span></span> map_keys_code<span class="main">[</span><span class="operator">OF</span> gen_wf.from_sparse_inj<span class="main">,</span> <span class="operator">folded</span> map_keys_from_sparse_def<span class="main">,</span> <span class="operator">code</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> map_keys_from_sparse_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">code_unfold</span><span class="main">]</span>

<span class="keyword1" id="Generic_Interpretation-fold_Cons_commute"><span class="command">lemma</span></span> fold_Cons_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">a</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">;</span> <span class="bound">b</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">∘</span> <span class="free">f</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">b</span> <span class="main">∘</span> <span class="free">f</span> <span class="bound">a</span><span class="main">)</span>
  <span class="main">⟹</span> fold <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">∘</span> <span class="main">(</span>fold <span class="free">f</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fold_commute<span class="main">)</span>

<span class="keyword1" id="Generic_Interpretation-Union_of_code"><span class="command">lemma</span></span> Union_of_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Union_of <span class="free">f</span> <span class="main">(</span>RBT_Set.Set <span class="free">r</span><span class="main">)</span> <span class="main">=</span> RBT.fold <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">(∪)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="free">r</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">()</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">xs</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> fold <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">.</span> <span class="main">(∪)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fold_Cons_commute<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> Union_fold <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Union_of_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> RBT_Set.Set_def RBT.fold_fold RBT.lookup_in_tree<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> Union_fold <span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span><span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">disjoint</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">gen_ssa_wf_notriv_substAll'</span> <span class="main">=</span> fst <span class="main">∘</span> gen_ssa_wf_notriv_substAll_efficient"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">fold_set</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> fold <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>sorted_list_of_set <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">declare</span></span> fold_set_def <span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">code_unfold</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> fold_set_def
  <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"RBT_Set.Set <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">r</span><span class="main">,</span>
    <span class="operator">unfolded</span> sorted_list_set fold_keys_def_alt <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> fold_keys_def <span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main">,</span>
    <span class="operator">code</span><span class="main">]</span>

<span class="keyword1"><span class="command">declare</span></span> graph_path_base.inEdges_def <span class="main">[</span><span class="operator">code</span><span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Generic_Extract">
<div class="head">
<h1>Theory Generic_Extract</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Generic_Extract.thy
    Author:     Sebastian Ullrich, Denis Lohner
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Generic_Extract <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#Generic_Interpretation">Generic_Interpretation</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">export_code</span></span> <span class="keyword2"><span class="keyword">open</span></span>
  <span class="quoted"><span class="quoted">set</span></span> <span class="quoted"><span class="quoted">sorted_list_of_set</span></span> <span class="quoted"><span class="quoted">disjoint</span></span> <span class="quoted"><span class="quoted">RBT.fold</span></span>
  <span class="quoted"><span class="quoted">gen_ssa_cfg_wf</span></span> <span class="quoted"><span class="quoted">gen_wf_var</span></span> <span class="quoted"><span class="quoted">gen_ssa_wf_notriv_substAll'</span></span>
  <span class="keyword2"><span class="keyword">in</span></span> OCaml <span class="keyword2"><span class="keyword">module_name</span></span> BraunSSA

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Disjoin_Transform">
<div class="head">
<h1>Theory Disjoin_Transform</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Disjoin_Transform.thy
    Author:     Sebastian Ullrich
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Disjoin_Transform <span class="keyword2"><span class="keyword">imports</span></span>
<a href="../../slicing/theories/#AdditionalLemmas">Slicing.AdditionalLemmas</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">subcmd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cmd <span class="main">⇒</span> cmd <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  sub_Skip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">subcmd</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> Skip"</span></span>
<span class="main">|</span> sub_Base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">subcmd</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="main">|</span> sub_Seq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">subcmd</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">⟹</span> <span class="free">subcmd</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="main">|</span> sub_Seq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">subcmd</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">⟹</span> <span class="free">subcmd</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="main">|</span> sub_If1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">subcmd</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">⟹</span> <span class="free">subcmd</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="main">|</span> sub_If2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">subcmd</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">⟹</span> <span class="free">subcmd</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="main">|</span> sub_While<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">subcmd</span> <span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">⟹</span> <span class="free">subcmd</span> <span class="main">(</span><span class="keyword1">while</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">maxVnameLen_aux</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"expr <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">maxVnameLen_aux</span> <span class="main">(</span>Val <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">maxVnameLen_aux</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span> <span class="main">=</span> length <span class="free"><span class="bound"><span class="entity">V</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">maxVnameLen_aux</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">«</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">»</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span><span class="free">maxVnameLen_aux</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">maxVnameLen_aux</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">maxVnameLen</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cmd <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">maxVnameLen</span> Skip <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">maxVnameLen</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">:=</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span> <span class="main">(</span>maxVnameLen_aux <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">maxVnameLen</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span><span class="free">maxVnameLen</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">maxVnameLen</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">maxVnameLen</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span><span class="free">maxVnameLen</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span>max <span class="main">(</span>maxVnameLen_aux <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">maxVnameLen</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">maxVnameLen</span> <span class="main">(</span><span class="keyword1">while</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span><span class="free">maxVnameLen</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span>maxVnameLen_aux <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tempName</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cmd <span class="main">⇒</span> vname"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tempName</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> replicate <span class="main">(</span>Suc <span class="main">(</span>maxVnameLen <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">CHR</span> <span class="inner_quoted">''a''</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">newname</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cmd <span class="main">⇒</span> vname <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">newname</span> Skip <span class="free"><span class="bound"><span class="entity">V</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">∉</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">V'</span></span></span><span class="main">}</span> <span class="main">∪</span> rhs_aux <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">⟹</span> <span class="free">newname</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">V'</span></span></span><span class="main">:=</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">newname</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">;</span> <span class="free">newname</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">newname</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">newname</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">;</span> <span class="free">newname</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">∉</span> rhs_aux <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">newname</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">newname</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">∉</span> rhs_aux <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">newname</span> <span class="main">(</span><span class="keyword1">while</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span>"</span></span>

<span class="keyword1" id="Disjoin_Transform-maxVnameLen_aux_newname"><span class="command">lemma</span></span> maxVnameLen_aux_newname<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">V</span> <span class="main">&gt;</span> maxVnameLen_aux <span class="free">e</span> <span class="main">⟹</span> <span class="free">V</span> <span class="main">∉</span> rhs_aux <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Disjoin_Transform-maxVnameLen_newname"><span class="command">lemma</span></span> maxVnameLen_newname<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">V</span> <span class="main">&gt;</span> maxVnameLen <span class="free">c</span> <span class="main">⟹</span> newname <span class="free">c</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>newname.intros <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>maxVnameLen_aux_newname<span class="main">)</span>

<span class="keyword1" id="Disjoin_Transform-tempname_newname"><span class="command">lemma</span></span> tempname_newname<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"newname <span class="free">c</span> <span class="main">(</span>tempName <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> maxVnameLen_newname<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tempName_def<span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">transform_aux</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"vname <span class="main">⇒</span> cmd <span class="main">⇒</span> cmd"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">transform_aux</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> Skip <span class="main">=</span> Skip"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">transform_aux</span> <span class="free"><span class="bound"><span class="entity">V'</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">:=</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">∈</span> rhs <span class="main">(</span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">:=</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">V'</span></span></span><span class="main">:=</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">:=</span>Var <span class="free"><span class="bound"><span class="entity">V'</span></span></span>
     <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">:=</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">transform_aux</span> <span class="free"><span class="bound"><span class="entity">V'</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">transform_aux</span> <span class="free"><span class="bound"><span class="entity">V'</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free">transform_aux</span> <span class="free"><span class="bound"><span class="entity">V'</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">transform_aux</span> <span class="free"><span class="bound"><span class="entity">V'</span></span></span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free">transform_aux</span> <span class="free"><span class="bound"><span class="entity">V'</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">else</span> <span class="free">transform_aux</span> <span class="free"><span class="bound"><span class="entity">V'</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">transform_aux</span> <span class="free"><span class="bound"><span class="entity">V'</span></span></span> <span class="main">(</span><span class="keyword1">while</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">while</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free">transform_aux</span> <span class="free"><span class="bound"><span class="entity">V'</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">transform</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cmd <span class="main">⇒</span> cmd"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">transform</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> transform_aux <span class="main">(</span>tempName <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">leftmostCmd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cmd <span class="main">⇒</span> cmd"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">leftmostCmd</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">leftmostCmd</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">leftmostCmd</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>

<span class="keyword1" id="Disjoin_Transform-leftmost_lhs"><span class="command">lemma</span></span> leftmost_lhs<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lhs <span class="main">(</span>leftmostCmd <span class="free">c</span><span class="main">)</span> <span class="main">=</span> lhs <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Disjoin_Transform-leftmost_rhs"><span class="command">lemma</span></span> leftmost_rhs<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rhs <span class="main">(</span>leftmostCmd <span class="free">c</span><span class="main">)</span> <span class="main">=</span> rhs <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Disjoin_Transform-leftmost_subcmd"><span class="command">lemma</span></span> leftmost_subcmd<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"subcmd <span class="free">c</span> <span class="main">(</span>leftmostCmd <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>subcmd.intros<span class="main">)</span>

<span class="keyword1" id="Disjoin_Transform-leftmost_labels"><span class="command">lemma</span></span> leftmost_labels<span class="main">:</span> <span class="quoted"><span class="quoted">"labels <span class="free">c</span> <span class="free">n</span> <span class="free">c'</span> <span class="main">⟹</span> subcmd <span class="free">c</span> <span class="main">(</span>leftmostCmd <span class="free">c'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>labels.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>subcmd.intros<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> transform_disjoint<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subcmd <span class="main">(</span>transform_aux <span class="free">temp</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="free">V</span><span class="main">:=</span><span class="free">e</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"newname <span class="free">c</span> <span class="free">temp</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">∉</span> rhs_aux <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">c</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>transform_aux.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">V</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"3.prems"</span><span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>transform_aux <span class="free">temp</span> <span class="skolem">c1</span><span class="main">;;</span> transform_aux <span class="free">temp</span> <span class="skolem">c2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">:=</span><span class="free">e</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>subcmd.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> sub_Seq2
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"3.prems"</span><span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> <span class="quoted">"3.IH"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>newname.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> sub_If1
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"3.prems"</span><span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> <span class="quoted">"3.IH"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>newname.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">V</span> <span class="skolem">b</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"4.prems"</span><span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="skolem">b</span><span class="main">)</span> transform_aux <span class="free">temp</span> <span class="skolem">c1</span> <span class="keyword1">else</span> transform_aux <span class="free">temp</span> <span class="skolem">c2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">:=</span><span class="free">e</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>subcmd.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> sub_If2
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"4.prems"</span><span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> <span class="quoted">"4.IH"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>newname.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> sub_While
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"4.prems"</span><span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> <span class="quoted">"4.IH"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>newname.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 5
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"5.prems"</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">rule</span> <span class="quoted">"5.IH"</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>subcmd.cases newname.cases<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>subcmd.cases newname.cases <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>

<span class="keyword1" id="Disjoin_Transform-transform_disjoint'"><span class="command">lemma</span></span> transform_disjoint'<span class="main">:</span> <span class="quoted"><span class="quoted">"subcmd <span class="main">(</span>transform <span class="free">c</span><span class="main">)</span> <span class="main">(</span>leftmostCmd <span class="free">c'</span><span class="main">)</span> <span class="main">⟹</span> lhs <span class="free">c'</span> <span class="main">∩</span> rhs <span class="free">c'</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">c'</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> transform_disjoint<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> Defs_Uses_transform_disjoint <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Defs <span class="main">(</span>transform <span class="free">c</span><span class="main">)</span> <span class="free">n</span> <span class="main">∩</span> Uses <span class="main">(</span>transform <span class="free">c</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> leftmost_labels transform_disjoint' labels_det<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="WhileGraphSSA">
<div class="head">
<h1>Theory WhileGraphSSA</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      WhileGraphSSA.thy
    Author:     Denis Lohner, Sebastian Ullrich
*)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Instantiation for a Simple While Language›</span></span>

<span class="keyword1"><span class="command">theory</span></span> WhileGraphSSA <span class="keyword2"><span class="keyword">imports</span></span>
<a href="#Generic_Interpretation">Generic_Interpretation</a>
<a href="#Disjoin_Transform">Disjoin_Transform</a>
<span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/List_Lexorder.html">HOL-Library.List_Lexorder</a>"</span>
<span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Char_ord.html">HOL-Library.Char_ord</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> w_node <span class="main">::</span> <span class="quoted">ord</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_eq_w_node</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">(_Entry_)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(_</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">_)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span>
     <span class="keyword1">(_Entry_)</span> <span class="main">⇒</span> False
   <span class="main">|</span> <span class="main">(_</span> <span class="bound">m</span> <span class="main">_)</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≤</span> <span class="bound">m</span>
   <span class="main">|</span> <span class="keyword1">(_Exit_)</span> <span class="main">⇒</span> True<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="keyword1">(_Exit_)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="keyword1">(_Exit_)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_w_node</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">(_Entry_)</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> <span class="keyword1">(_Entry_)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(_</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">_)</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span>
     <span class="keyword1">(_Entry_)</span> <span class="main">⇒</span> False
   <span class="main">|</span> <span class="main">(_</span> <span class="bound">m</span> <span class="main">_)</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&lt;</span> <span class="bound">m</span>
   <span class="main">|</span> <span class="keyword1">(_Exit_)</span> <span class="main">⇒</span> True<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="keyword1">(_Exit_)</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> w_node <span class="main">::</span> <span class="quoted">linorder</span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">w_node</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">declare</span></span> Defs.simps <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> Uses.simps <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> Let_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">declare</span></span> finite_valid_nodes <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span>

<span class="keyword1" id="WhileGraphSSA-finite_valid_edge"><span class="command">lemma</span></span> finite_valid_edge <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Collect <span class="main">(</span>valid_edge <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_edge_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> inj_on_finite <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">d</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> B<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Collect <span class="main">(</span>valid_node <span class="free">c</span><span class="main">)</span> <span class="main">×</span> Collect <span class="main">(</span>valid_node <span class="free">c</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> WCFG_edge_det<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valid_node_def valid_edge_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="WhileGraphSSA-uses_expr_finite"><span class="command">lemma</span></span> uses_expr_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>rhs_aux <span class="free">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="WhileGraphSSA-uses_cmd_finite"><span class="command">lemma</span></span> uses_cmd_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>rhs <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> uses_expr_finite<span class="main">)</span>

<span class="keyword1" id="WhileGraphSSA-defs_cmd_finite"><span class="command">lemma</span></span> defs_cmd_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>lhs <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="WhileGraphSSA-finite_labels'"><span class="command">lemma</span></span> finite_labels'<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">.</span> labels <span class="free">prog</span> <span class="bound">l</span> <span class="bound">c</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">l</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c</span><span class="main">.</span> labels <span class="free">prog</span> <span class="bound">l</span> <span class="bound">c</span><span class="main">}</span> <span class="main">=</span> fst <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">.</span> labels <span class="free">prog</span> <span class="bound">l</span> <span class="bound">c</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> finite_labels <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">prog</span></span><span class="main">]</span> labels_det <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">prog</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 4 4 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> inj_onI <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> finite_imageD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="WhileGraphSSA-finite_Defs"><span class="command">lemma</span></span> finite_Defs <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Defs <span class="free">c</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Defs.simps
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> B<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>lhs <span class="main">`</span> snd <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">c'</span><span class="main">)</span><span class="main">.</span> labels <span class="free">c</span> <span class="bound">l</span> <span class="bound">c'</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> finite_subset<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_Union<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_labels'<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> defs_cmd_finite<span class="main">)</span>

<span class="keyword1" id="WhileGraphSSA-finite_Uses"><span class="command">lemma</span></span> finite_Uses <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Uses <span class="free">c</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Uses.simps
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> B<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>rhs <span class="main">`</span> snd <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">c'</span><span class="main">)</span><span class="main">.</span> labels <span class="free">c</span> <span class="bound">l</span> <span class="bound">c'</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> finite_subset<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_Union<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_labels'<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uses_cmd_finite<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">while_cfg_αe</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> Collect <span class="main">(</span>valid_edge <span class="main">(</span>transform <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">while_cfg_αn</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> sorted_list_of_set <span class="main">(</span>Collect <span class="main">(</span>valid_node <span class="main">(</span>transform <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">while_cfg_invar</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> True"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">while_cfg_inEdges'</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">ls</span><span class="main">.</span> distinct <span class="bound">ls</span> <span class="main">∧</span> set <span class="bound">ls</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>sourcenode <span class="bound">e</span><span class="main">,</span> kind <span class="bound">e</span><span class="main">)</span><span class="main">|</span> <span class="bound">e</span><span class="main">.</span> valid_edge <span class="main">(</span>transform <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="bound">e</span> <span class="main">∧</span> targetnode <span class="bound">e</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">while_cfg_Entry</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="keyword1">(_Entry_)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">while_cfg_defs</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">(</span>Defs <span class="main">(</span>transform <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="keyword1">(_Entry_)</span> <span class="main">:=</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> Uses <span class="main">(</span>transform <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">while_cfg_uses</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> Uses <span class="main">(</span>transform <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">while_cfg_inEdges</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≡</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">d</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>while_cfg_inEdges' <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> while_cfg_defs <span class="main">=</span> while_cfg_αe_def while_cfg_αn_def
  while_cfg_invar_def while_cfg_inEdges'_def
  while_cfg_Entry_def while_cfg_defs_def
  while_cfg_uses_def

<span class="keyword1"><span class="command">interpretation</span></span> while<span class="main">:</span> graph_path <span class="quoted">while_cfg_αe</span> <span class="quoted">while_cfg_αn</span> <span class="quoted">while_cfg_invar</span> <span class="quoted">while_cfg_inEdges'</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> while_cfg_defs<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valid_node_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valid_node_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_iterator_I<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> foldri_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Graph_path.pred_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">v'</span><span class="main">,</span> <span class="bound">w</span><span class="main">)</span><span class="main">.</span> valid_edge <span class="main">(</span>transform <span class="improper">g</span><span class="main">)</span> <span class="main">(</span><span class="bound">v'</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="improper">v</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> finite_distinct_list<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">xs</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> someI2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> set_iterator_foldri_correct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">d</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> finite_surj <span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_valid_edge<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_image_eqI<span class="main">)</span>

<span class="keyword1" id="WhileGraphSSA-right_total_const"><span class="command">lemma</span></span> right_total_const<span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> right_totalI<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1" id="WhileGraphSSA-const_transfer"><span class="command">lemma</span></span> const_transfer<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">c</span><span class="main">)</span> <span class="main">(=)</span> <span class="free">f</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">f</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_fun_def<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> while_ign<span class="main">:</span> graph_path <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> while_cfg_αe <span class="free">cmd</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> while_cfg_αn <span class="free">cmd</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> while_cfg_invar <span class="free">cmd</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> while_cfg_inEdges' <span class="free">cmd</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> graph_path_transfer <span class="main"><span class="main">[</span></span><span class="operator">OF</span> right_total_const const_transfer const_transfer const_transfer const_transfer<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">gen_while_cfg</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">⦇</span>
  gen_αe <span class="main">=</span> while_cfg_αe <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">,</span>
  gen_αn <span class="main">=</span> while_cfg_αn <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">,</span>
  gen_inEdges <span class="main">=</span> while_cfg_inEdges <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">,</span>
  gen_Entry <span class="main">=</span> while_cfg_Entry <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">,</span>
  gen_defs <span class="main">=</span> while_cfg_defs <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">,</span>
  gen_uses <span class="main">=</span> while_cfg_uses <span class="free"><span class="bound"><span class="entity">g</span></span></span>
<span class="main">⦈</span>"</span></span>

<span class="keyword1" id="WhileGraphSSA-while_path_graph_pathD"><span class="command">lemma</span></span>  while_path_graph_pathD<span class="main">:</span> <span class="quoted"><span class="quoted">"While_CFG.path <span class="main">(</span>transform <span class="free">c</span><span class="main">)</span> <span class="free">n</span> <span class="free">es</span> <span class="free">m</span> <span class="main">⟹</span> while.path2 <span class="free">c</span> <span class="free">n</span> <span class="main">(</span><span class="free">n</span><span class="main">#</span>map targetnode <span class="free">es</span><span class="main">)</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> while.path2_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">es</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> While_CFG.path.induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> while.path.intros<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> while_cfg_defs valid_node_def While_CFG.valid_node_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> while_cfg_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> while.path.intros<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> while.predecessors_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> n ed m<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">n</span><span class="main">,</span><span class="improper">ed</span><span class="main">,</span><span class="improper">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> image_eqI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> while.inEdges_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">n</span><span class="main">,</span><span class="improper">ed</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> image_eqI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> while_cfg_inEdges'_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">aa</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span><span class="main">.</span> valid_edge <span class="main">(</span>transform <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="bound">aa</span><span class="main">,</span> <span class="bound">a</span><span class="main">,</span> <span class="improper">m</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">d</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> finite_surj <span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_valid_edge<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_image_eqI<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> finite_distinct_list<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">xs</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> someI2<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="WhileGraphSSA-Uses_Entry"><span class="command">lemma</span></span> Uses_Entry <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Uses <span class="free">c</span> <span class="keyword1">(_Entry_)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Uses.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="WhileGraphSSA-in_Uses_valid_node"><span class="command">lemma</span></span> in_Uses_valid_node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">∈</span> Uses <span class="free">c</span> <span class="free">n</span> <span class="main">⟹</span> valid_node <span class="free">c</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> label_less_num_inner_nodes less_num_nodes_edge
    <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Uses.simps valid_node_def valid_edge_def<span class="main">)</span>

<span class="keyword1" id="WhileGraphSSA-while_cfg_CFG_wf_impl"><span class="command">lemma</span></span> while_cfg_CFG_wf_impl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"SSA_CFG.CFG_wf <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> gen_αe <span class="main">(</span>gen_while_cfg <span class="free">cmd</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> gen_αn <span class="main">(</span>gen_while_cfg <span class="free">cmd</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> while_cfg_invar <span class="free">cmd</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> gen_inEdges' <span class="main">(</span>gen_while_cfg <span class="free">cmd</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> gen_Entry <span class="main">(</span>gen_while_cfg <span class="free">cmd</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> gen_defs <span class="main">(</span>gen_while_cfg <span class="free">cmd</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> gen_uses <span class="main">(</span>gen_while_cfg <span class="free">cmd</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_while_cfg_def o_def split_beta<span class="main">)</span>
<span class="keyword1"><span class="command">unfolding</span></span> SSA_CFG.CFG_wf_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> CFG_transfer <span class="main"><span class="main">[</span></span><span class="operator">OF</span> right_total_const const_transfer const_transfer const_transfer const_transfer const_transfer const_transfer const_transfer<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> while_cfg_defs valid_node_def valid_edge_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> While_CFG.intros<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> while.inEdges_def<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> while_cfg_defs valid_edge_def<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">aa</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span><span class="main">.</span> transform <span class="improper">g</span> <span class="main">⊢</span> <span class="bound">aa</span> <span class="main">-</span><span class="bound">a</span><span class="main">→</span> <span class="keyword1">(_Entry_)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> someI2<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> while_cfg_αn_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> valid_node_Entry_path<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> while_path_graph_pathD<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> while_cfg_Entry_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> while_cfg_defs<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> while_cfg_defs<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> Uses <span class="main">(</span>transform <span class="improper">g</span><span class="main">)</span> <span class="bound">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span> <span class="main">∈</span> Collect <span class="main">(</span>valid_node <span class="main">(</span>transform <span class="improper">g</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> Uses <span class="main">(</span>transform <span class="improper">g</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_Uses_valid_node<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> label_less_num_inner_nodes less_num_nodes_edge
     <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Uses.simps valid_node_def valid_edge_def while_cfg_defs<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> while_cfg_defs<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> while_cfg_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SSA_CFG.CFG_wf_axioms_def CFG_base.defAss'_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="keyword1">(_Entry_)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> while_cfg_defs<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> graph_path_base.path.cases <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> graph_path_base.path2_def while_cfg_Entry_def<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> gen_while_cfg_wf <span class="main">::</span> <span class="quoted"><span class="quoted">"cmd <span class="main">⇒</span> <span class="main">(</span>w_node<span class="main">,</span> vname<span class="main">,</span> state edge_kind<span class="main">)</span> gen_cfg_wf"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">gen_while_cfg</span>
<span class="keyword1"><span class="command">using</span></span> while_cfg_CFG_wf_impl
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_while_cfg_def o_def split_beta while_cfg_invar_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">build_ssa</span> <span class="free"><span class="bound"><span class="entity">cmd</span></span></span> <span class="main">=</span> gen_ssa_wf_notriv_substAll <span class="main">(</span>gen_ssa_cfg_wf <span class="main">(</span>gen_while_cfg_wf <span class="free"><span class="bound"><span class="entity">cmd</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>